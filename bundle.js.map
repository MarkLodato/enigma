{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./lib/dom.ts","webpack:///./lib/helpers.ts","webpack:///./lib/logic.ts","webpack:///./lib/main.ts","webpack:///./lib/graphics.ts","webpack:///./node_modules/svg.js/dist/svg.js","webpack:///./lib/drag.ts","webpack:///./lib/svg.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","getElementByIdOrThrow","id","element","document","getElementById","Error","regexp","RegExp","klass","getAttribute","replace","v","setAttribute","mod","a","result","difference","divisor","message","this","_map","_message","default_value","has","undefined","val","super","helpers","Dictionary","M3_DEF","alphabet","rotors","permutation","notch","reflectors","defaults","rotor_order","reflector","Alphabet","string","toUpperCase","length","_to_index","letter","set","toLowerCase","character","index","indices","out","idx","b","indexOf","callback","len","charAt","Permutation","permutation_string","last_forward","input","output","last_inverse","setTo","_forward_table","_inverse_table","forward_table","inverse_table","plain","fromIndex","cipher","Rotor","notch_string","_notches","Set","map","_alphabet","_indicator","_ring_setting","offset","add","forward","inverse","indicator","Plugboard","pair_string","_toPermutationString","e","split","pairs","pair","j","tmp","join","spec","_onUpdateCallbacks","Array","_spec","_plugboard","setRotorOrder","setReflector","_ring_locked","push","field","fromIndices","_rotors","error","_validateRotorField","_callRotorUpdate","allValid","valid","forEach","onIndicatorChange","getIndicator","onRingSettingChange","getRingSetting","_getRotorField","_setRotorField","_setRotorFieldAtIndex","_rotor_order","validate_only","new_rotors","rotor_name","rotor_spec","old_rotors","ring_setting","onRotorOrderChange","onRotorChange","_reflector_name","_permutation","_reflector","onReflectorChange","onPlugboardChange","validate","onRingLocked","plugboard","stepAndEncryptSingle","step","encryptSingleNoStep","x","onEncrypt","getLastValues","suppress_on_update","isOnNotch","state","getRotorOrder","getPlugboard","setIfValid","query_param","console","warn","setRingSetting","setIndicator","setPlugboard","setBooleanIfValid","setRingLocked","getInputElementByIdOrThrow","HtmlInterface","enigma","_enigma","SetupInputHandler","validateRotorOrder","validateRingSetting","validateIndicator","validatePlugboard","SetupCheckbox","registerOnUpdateCallback","oninput","event","classList","remove","onchange","checked","setting","order","graphics","EnigmaGraphics","Enigma","addEventListeners","onHashChange","URLSearchParams","window","location","hash","substring","loadState","addEventListener","SetupOnHashChange","main","logic","KEYBOARD_X","KEYBOARD_Y","DISPLAY_Y","KEY_RADIUS","KEY_ROW_SPACING","KEY_COL_SPACING","ROTOR_CX","ROTOR_CY","REFLECTOR_RADIUS","REFLECTOR_RING_WIDTH","ROTOR_WIDTH","RING_WIDTH","WINDOW_THICKNESS","A_DOT_RADIUS","PLUGBOARD_TOP","PLUGBOARD_HEIGHT","PLUGBOARD_LETTER_HEIGHT","PLUGBOARD_HANDLE_WIDTH","PLUGBOARD_HANDLE_HEIGHT","PLUGBOARD_MAX_DRAG_Y_OFFSET","ETW_HEIGHT","ETW_X_OFFSET","WIRE_TOP","ROTOR_IN_LENGTH","kAlphabet","kKeyboardOrder","keyX","column","keyY","drawEverything","svg","draw","SVG","size","viewbox","keyboardEnclosure","group","translate","display","drawKeyboardLike","keyboard","container","height","width","topBox","bottomBox","wires","each","attr","y","wireGroup","addClass","path","plot","SvgPathBuilder","M","L","build","rect","h","z","drawPlugboard","rotorEnclosure","drawRotor","outer_radius","reflector_name","keys","def","perm","drawReflectorWires","drawRingLetters","drawReflector","reflectorRadius","rotorWidth","center","cx","cy","ring_width","inner_radius","circle","radius","drawRotorFrame","idPrefix","donut","drawRotorHotspots","connectorEnclosure","xOffset","yOffset","line","drawDisplayKeyboardConnector","rbox","yBreak","y2","yDest","xStart","xDest","yStart","V","C","drawKeyboardPlugboardConnector","rotor","etw_top","x2","etw_delta","N","rotor_center","start","angle","end","addPoints","fromPolar","deg","end_in","moveTo","H","lineTo","drawPlugboardRotorConnector","back","transform","rotation","drawRotorWires","r_outer","r_inner","kGap","kBand","eachPair","i_angle","j_angle","circularDistance","half_angle","Math","sign","5","7","8","9","10","11","12","13","26","spread","quadraticCurveTo","abs","arcTo","sweep","handle","color_index","color","cubicCurveTo","_svg","_enableAnimation","setupKeyboardClick","setupPlugboardDrag","setupRotorDrag","setupWindowKeyboardListener","hotspot","getSVGGraphicsElementByIdOrThrow","plainIndex","plainX","fakePlugboard","origPlugboardSetting","computePlugboard","dx","mouse","current","dy","target","round","keyXOffsetToLetterOffset","cipherIndex","sort","draggable","onStart","_disableAnimation","onMove","newPlugboardSetting","onFinish","getPlugboardPermutation","rotorIndex","wireHotspot","ringHotspot","rotorStartPosition","wiresStartPosition","setupHotspot","_rotorPosition","deltaPosition","degreesTo","_rotateRotor","UnreachableCaseError","roundToLetter","position","setIndicatorAtIndex","setRingSettingAtIndex","defaultPrevented","nodeName","getModifierState","isValidLetter","_clear","setClassKeyValue","selectedName","_setWires","_setNotches","allNames","found","el","assert","id_or_el","direction","old_position","new_position","tick","dataset","style","values","highlight","showOutput","clear","clearClassKey","root","supported","Doc","parser","prepare","xmlns","xlink","svgjs","createElementNS","createSVGRect","did","eid","capitalize","extend","methods","slice","arguments","pop","inherit","invent","config","initializer","constructor","construct","parent","Container","adopt","node","instance","parentNode","SVGElement","Nested","Gradient","Element","type","namespace","defs","setData","JSON","parse","body","getElementsByTagName","documentElement","nested","poly","polyline","native","regex","numberAndUnit","hex","rgb","reference","transforms","whitespace","isHex","isRgb","isCss","isBlank","isNumber","isPercent","isImage","delimiter","hyphen","pathLetters","isPathLetter","numbersWithDots","dots","utils","array","block","il","filter","radians","PI","degrees","filterSVGElements","nodes","attrs","fill","stroke","opacity","rx","ry","Color","match","g","test","exec","parseInt","toString","toHex","compToHex","toRgb","brightness","morph","destination","at","pos","isColor","fallback","valueOf","lastValue","lastDestination","settle","seen","isArray","trim","parseFloat","reverse","clone","array_clone","arr","PointArray","toLine","x1","y1","points","move","box","bbox","isNaN","getBBox","pathHandlers","p0","S","Q","T","Z","A","mlhvqtcsa","jl","PathArray","arrayToString","equalCommands","pathArray","sourceArray","destinationArray","paramCnt","pathRegReplace","reduce","prev","curr","concat","Point","Number","unit","isFinite","toJSON","plus","number","minus","times","divide","to","relative","_stroke","_event","_events","dom","proportionalSize","writeDataToDom","assignNewId","cloneNode","after","removeElement","addTo","put","putIn","inside","show","hide","visible","classes","hasClass","removeClass","toggleClass","matches","doc","parents","selector","matchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","oMatchesSelector","well","createElement","Parent","appendChild","innerHTML","firstChild","childNodes","lines","removeAttribute","stringify","is","obj","easing","cos","sin","from","MorphObj","Situation","init","reversed","reversing","duration","delay","Date","finish","ease","loop","loops","animations","styles","once","FX","_target","situations","active","situation","paused","lastPos","absPos","_speed","animate","queue","timeToAbsPos","timestamp","absPosToTime","startAnimFrame","stopAnimFrame","animationFrame","requestAnimationFrame","cancelAnimationFrame","startCurrent","initAnimations","fn","shift","dequeue","stop","source","initialTransformation","matrixify","clearQueue","clearCurrent","jumpToEnd","atEnd","reset","temp","atStart","isAbsPos","durDivSpd","speed","pause","last","play","progress","easeIt","on","wrapper","detail","off","_callStart","during","eased","afterAll","duringAll","method","args","ignoreTime","absPosInt","lastLoop","max","floor","Boolean","min","fire","fx","eachAt","self","apply","Matrix","multiply","undo","extract","matrix","isEased","setTimeout","real","G","num","Text","leading","ViewBox","update","Stop","Box","left","top","fullBox","merge","xMin","Infinity","xMax","yMin","yMax","BBox","contains","Exception","topParent","Shape","clientLeft","clientTop","clientWidth","clientHeight","tbox","RBox","getBoundingClientRect","addOffset","pageXOffset","pageYOffset","screenCTM","base","arrayToMatrix","abcdef","px","deltaTransformPoint","py","skewX","atan2","f","transformedX","sqrt","transformedY","skewY","scaleX","scaleY","parseMatrix","scale","around","rotate","flip","skew","tan","createSVGMatrix","float32String","ctm","getCTM","getScreenCTM","point","createSVGPoint","matrixTransform","attributes","nodeValue","image","Image","pattern","setAttributeNS","rebuild","ensureCentre","Rotate","Scale","Skew","Translate","untransform","str","kv","toParent","pCtm","toDoc","Transformation","inversed","params","_undo","cssText","camelCase","children","insertBefore","first","deep","removeChild","hasChildNodes","lastChild","_defs","ungroup","depth","Defs","flatten","view","we","he","wm","hm","reg","offsetWidth","offsetHeight","zoom","listenerId","events","listener","binding","options","bag","_svgjsListenerId","ev","removeEventListener","data","Event","dispatchEvent","CustomEvent","cancelable","gbox","trans","version","spof","nextSibling","siblings","next","previous","backward","front","before","Mask","targets","unmask","mask","maskWith","masker","ClipPath","unclip","clip","clipWith","clipper","gradient","fy","Pattern","patternUnits","Bare","words","text","createTextNode","symbol","Use","file","use","Rect","Circle","Ellipse","ellipse","Line","Polyline","Polygon","polygon","_array","morphArray","Path","load","url","img","_loaded","ratio","_error","src","loaded","_rebuild","_build","oy","nodeType","newLined","textContent","tspan","newLine","textPath","blankLineOffset","Tspan","getComputedTextLength","TextPath","track","link","linkTo","Marker","ref","marker","sugar","prefix","comp","w","extension","dmove","getTotalLength","pointAt","getPointAtLength","font","members","elements","splice","remember","k","memory","forget","_memory","idFromReference","select","query","querySelectorAll","CustomEventPoly","bubbles","createEvent","initCustomEvent","lastTime","vendors","currTime","getTime","timeToCall","clearTimeout","factory","other","ownerSVGElement","computeCenter","scrollX","scrollY","translatePoint","clientX","clientY","mouseMoveHandler","c1","c2","isArcOptionsR","largeArc","c1x","c1y","c2x","c2y","c1dx","c1dy","c2dx","c2dy","cdx","cdy","xAxisRotate","lAF","sF","rdx","rdy","close"],"mappings":"aACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QAKfF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,G,+BC/ErD,SAAgBC,EAAsBC,GACpC,MAAMC,EAAUC,SAASC,eAAeH,GACxC,IAAKC,EACH,MAAMG,MAAM,wBAA0BJ,GAExC,OAAOC,E,iDALT,0BASA,4CAAiDD,GAE/C,OAAQD,EAAsBC,IAKhC,4BAAiCC,EAAsBX,EACtBN,GAC/B,MAAMqB,EAAS,IAAIC,OAAO,YAAchB,EAAM,QAAS,KAGvD,IAAIiB,GAASN,EAAQO,aAAa,UAAY,IAAIC,QAAQJ,EAAQ,IAClE,GAAqB,iBAAVrB,EACTuB,OAAajB,KAAON,SAEpB,IAAK,MAAM0B,KAAK1B,EACduB,OAAajB,KAAOoB,IAGxBT,EAAQU,aAAa,QAASJ,IAIhC,yBAA8BN,EAAsBX,GAClD,MAAMe,EAAS,IAAIC,OAAO,YAAchB,EAAM,QAAS,KAGjDiB,GAASN,EAAQO,aAAa,UAAY,IAAIC,QAAQJ,EAAQ,IACpEJ,EAAQU,aAAa,QAASJ,K,6BCtBhC,SAAgBK,EAAIC,EAAWrB,GAC7B,IAAIsB,EAASD,EAAIrB,EAIjB,OAHIsB,EAAS,IACXA,GAAUtB,GAELsB,E,iDAdT,4BAAiCC,EAAoBC,GACnD,IAAI3C,EAAIuC,EAAIG,EAAYC,GAIxB,OAHI3C,EAAI2C,EAAU,IAChB3C,GAAK2C,GAEA3C,GAIT,QAaA,mBAIE,YAAY4C,EAAkB,iBAC5BC,KAAKC,KAAO,GACZD,KAAKE,SAAWH,EAGX,IAAI3B,EAAaN,GAAkBkC,KAAKC,KAAK7B,GAAON,EACpD,IAAIM,GAAwB,OAAO4B,KAAKC,KAAKvB,eAAeN,GAC5D,IAAIA,EAAa+B,GACtB,GAAIH,KAAKI,IAAIhC,GAAM,OAAO4B,KAAKC,KAAK7B,GACpC,QAAsBiC,IAAlBF,EAA6B,OAAOA,EACxC,MAAMjB,MAAMc,KAAKE,SAAW,KAAO9B,KAQvC,qCAA0Cc,MACxC,YAAYoB,GAAcC,2BAA2BD,Q,8ECnDvD,aAEMZ,EAAMc,EAAQd,IACde,EAAaD,EAAQC,WA+ChB,EAAAC,OAAe,CACxBC,SAAU,6BACVC,OAAQ,CACN,EAAK,CAACC,YAAa,6BAA8BC,MAAO,KACxD,GAAM,CAACD,YAAa,6BAA8BC,MAAO,KACzD,IAAO,CAACD,YAAa,6BAA8BC,MAAO,KAC1D,GAAM,CAACD,YAAa,6BAA8BC,MAAO,KACzD,EAAK,CAACD,YAAa,6BAA8BC,MAAO,KACxD,GAAM,CAACD,YAAa,6BAA8BC,MAAO,MACzD,IAAO,CAACD,YAAa,6BAA8BC,MAAO,MAC1D,KAAQ,CAACD,YAAa,6BAA8BC,MAAO,OAE7DC,WAAY,CACV,EAAK,6BACL,EAAK,6BACL,EAAK,8BAEPC,SAAU,CACRC,YAAa,WACbC,UAAW,MAUf,MAAaC,EAMX,YAAYR,GACVX,KAAKoB,OAAST,EAASU,cACvBrB,KAAKsB,OAASX,EAASW,OACvBtB,KAAKuB,UAAY,IAAId,EAAmB,kBACxC,IAAK,IAAI5D,EAAI,EAAGA,EAAImD,KAAKoB,OAAOE,OAAQzE,IAAK,CAC3C,MAAM2E,EAASxB,KAAKoB,OAAOvE,GAC3BmD,KAAKuB,UAAUE,IAAID,EAAQ3E,GAC3BmD,KAAKuB,UAAUE,IAAID,EAAOE,cAAe7E,IAKtC,MAAM2E,GAA2B,OAAOxB,KAAKuB,UAAUnB,IAAIoB,GAG3D,SAAS5C,GACd,IAAK,MAAM+C,KAAa/C,EACtB,IAAKoB,KAAKuB,UAAUnB,IAAIuB,GACtB,OAAO,EAGX,OAAO,EAKF,QAAQH,GAA0B,OAAOxB,KAAKuB,UAAU7D,IAAI8D,GAG5D,UAAUI,GAAyB,OAAO5B,KAAKoB,OAAOQ,GAGtD,eAAeC,GACpB,IAAIC,EAAM,GACV,IAAK,MAAMC,KAAOF,EAChBC,GAAO9B,KAAKoB,OAAOW,GAErB,OAAOD,EAIF,IAAInC,EAAkBqC,GAG3B,MAFiB,iBAANrC,IAAgBA,EAAIK,KAAKiC,QAAQtC,IAC3B,iBAANqC,IAAgBA,EAAIhC,KAAKiC,QAAQD,IACrChC,KAAKoB,OAAO1B,EAAIC,EAAIqC,EAAGhC,KAAKsB,SAI9B,KAAKY,GACV,IAAK,IAAIrF,EAAI,EAAGsF,EAAMnC,KAAKoB,OAAOE,OAAQzE,EAAIsF,EAAKtF,IACjDqF,EAASlC,KAAKoB,OAAOgB,OAAOvF,GAAIA,IAxDtC,aAkEA,MAAawF,EASX,YAAYC,EAA4B3B,GAPjC,KAAA4B,aAA0B,CAACC,MAAO,GAAIC,OAAQ,IAC9C,KAAAC,aAA0B,CAACF,MAAO,GAAIC,OAAQ,IAOnDzC,KAAKW,SAAWA,EAChBX,KAAK2C,MAAML,GAIN,QAAQd,GACbA,EAASA,EAAOH,cAChB,MAAMoB,EAASzC,KAAK4C,eAAelF,IAAI8D,GAEvC,OADAxB,KAAKuC,aAAe,CAACC,MAAOhB,EAAQiB,OAAQA,GACrCA,EAIF,QAAQjB,GACbA,EAASA,EAAOH,cAChB,MAAMoB,EAASzC,KAAK6C,eAAenF,IAAI8D,GAEvC,OADAxB,KAAK0C,aAAe,CAACF,MAAOhB,EAAQiB,OAAQA,GACrCA,EAIF,MAAMH,GAEX,IADAA,EAAqBA,EAAmBjB,eACjBC,SAAWtB,KAAKW,SAASW,OAC9C,MAAMpC,MAAM,+BAAiCoD,EAAmBhB,OACpD,cAAgBtB,KAAKW,SAASW,QAE5C,MAAMwB,EAAgB,IAAIrC,EAAmB,kBACvCsC,EAAgB,IAAItC,EAAmB,kBAC7C,IAAK,IAAI5D,EAAI,EAAGA,EAAImD,KAAKW,SAASW,OAAQzE,IAAK,CAC7C,MAAMmG,EAAQhD,KAAKW,SAASsC,UAAUpG,GAChCqG,EAASZ,EAAmBzF,GAElC,GADAmD,KAAKW,SAASsB,QAAQiB,GAClBH,EAAc3C,IAAI8C,GACpB,MAAMhE,MAAM,+BAAiCgE,EACjC,wBAEdJ,EAAcrB,IAAIuB,EAAOE,GACzBH,EAActB,IAAIyB,EAAQF,GAG5BhD,KAAKoB,OAASkB,EACdtC,KAAK4C,eAAiBE,EACtB9C,KAAK6C,eAAiBE,EAKjB,SAASb,GAEd,IAAK,IAAIrF,EAAI,EAAGA,EAAImD,KAAKoB,OAAOE,OAAQzE,IACtCqF,EAASlC,KAAKW,SAASS,OAAOvE,GAAImD,KAAKoB,OAAOvE,KA7DpD,gBAuEA,MAAasG,EASX,YAAYb,EAA4Bc,EAC5BzC,GACVX,KAAKa,YAAc,IAAIwB,EAAYC,EAAoB3B,GACvDX,KAAKoD,aAAeA,EACpBpD,KAAKqD,SAAW,IAAIC,IAChB,IAAIF,GAAcG,IAAK/B,GAAWb,EAASsB,QAAQT,KACvDxB,KAAKwD,UAAY7C,EACjBX,KAAKyD,WAAa,EAClBzD,KAAK0D,cAAgB,EAGvB,gBAA0B,OAAO1D,KAAKyD,WACtC,cAAc3F,GACZkC,KAAKyD,WAAa/D,EAAI5B,EAAOkC,KAAKwD,UAAUlC,QAG9C,mBAA6B,OAAOtB,KAAK0D,cACzC,iBAAiB5F,GACfkC,KAAK0D,cAAgBhE,EAAI5B,EAAOkC,KAAKwD,UAAUlC,QAG1C,QAAQE,GACb,MAAMmC,EAAS3D,KAAKyD,WAAazD,KAAK0D,cAGtC,OAFAlC,EAASxB,KAAKwD,UAAUI,IAAID,EAAQnC,GACpCA,EAASxB,KAAKa,YAAYgD,QAAQrC,GAC3BxB,KAAKwD,UAAUI,KAAKD,EAAQnC,GAG9B,QAAQA,GACb,MAAMmC,EAAS3D,KAAKyD,WAAazD,KAAK0D,cAGtC,OAFAlC,EAASxB,KAAKwD,UAAUI,IAAID,EAAQnC,GACpCA,EAASxB,KAAKa,YAAYiD,QAAQtC,GAC3BxB,KAAKwD,UAAUI,KAAKD,EAAQnC,GAG9B,OAAexB,KAAK+D,WAAa,EAEjC,YAAuB,OAAO/D,KAAKqD,SAASjD,IAAIJ,KAAKyD,aA9C9D,UAqDA,MAAaO,EAMX,YAAYrD,GACVX,KAAKwD,UAAY7C,EACjBX,KAAKa,YAAc,IAAIwB,EAAYrC,KAAKwD,UAAUpC,OAAQpB,KAAKwD,WAC/DxD,KAAKoB,OAAS,GAGT,QAAQI,GACb,OAAOxB,KAAKa,YAAYgD,QAAQrC,GAE3B,QAAQA,GACb,OAAOxB,KAAKa,YAAYiD,QAAQtC,GAI3B,MAAMyC,GACXA,EAAcA,EAAY5C,cAC1BrB,KAAKa,YAAY8B,MAAM3C,KAAKkE,qBAAqBD,IACjDjE,KAAKoB,OAAS6C,EAIT,SAASA,GACd,IAEE,OADAjE,KAAKkE,qBAAqBD,EAAY5C,eAC/B,GACP,MAAO8C,GACP,OAAOA,EAAEpE,SAML,qBAAqBkE,GAC3B,MAAMnC,EAAM9B,KAAKwD,UAAUpC,OAAOgD,MAAM,IAClCC,EAAQJ,EAAY5C,cAAc+C,MAAM,OAC9C,IAAK,MAAME,KAAQD,EAAO,CACxB,GAAa,KAATC,EAAa,SACjB,GAAoB,IAAhBA,EAAKhD,QAAgBgD,EAAK,KAAOA,EAAK,GACxC,MAAMpF,MAAM,4BAA8BoF,EAAO,KAEnD,MAAMzH,EAAImD,KAAKwD,UAAUvB,QAAQqC,EAAK,IAChCC,EAAIvE,KAAKwD,UAAUvB,QAAQqC,EAAK,IACtC,GAAIxC,EAAIjF,KAAOyH,EAAK,GAClB,MAAMpF,MAAM,oBAAsBoF,EAAK,GAAK,yBAE9C,GAAIxC,EAAIyC,KAAOD,EAAK,GAClB,MAAMpF,MAAM,oBAAsBoF,EAAK,GAAK,yBAE9C,MAAME,EAAM1C,EAAIjF,GAChBiF,EAAIjF,GAAKiF,EAAIyC,GACbzC,EAAIyC,GAAKC,EAEX,OAAO1C,EAAI2C,KAAK,KA1DpB,cAkEA,eAWE,YAAYC,GACV1E,KAAK2E,mBAAqB,IAAIC,MAC9B5E,KAAK6E,MAAQH,EACb1E,KAAKwD,UAAY,IAAIrC,EAASuD,EAAK/D,UACnCX,KAAK8E,WAAa,IAAId,EAAUhE,KAAKwD,WACrCxD,KAAK+E,cAAcL,EAAK1D,SAASC,aACjCjB,KAAKgF,aAAaN,EAAK1D,SAASE,WAChClB,KAAKiF,cAAe,EAGf,yBAAyB/C,GAC9BlC,KAAK2E,mBAAmBO,KAAKhD,GAGvB,eAAeiD,GACrB,OAAOnF,KAAKwD,UAAU4B,YAClBpF,KAAKqF,QAAQ,GAAGF,GAAQnF,KAAKqF,QAAQ,GAAGF,GAAQnF,KAAKqF,QAAQ,GAAGF,IAG9D,eAAeA,EAAmCrH,GACxD,MAAMwH,EAAQtF,KAAKuF,oBAAoBJ,EAAOrH,GAC9C,GAAIwH,EAAO,MAAM,IAAIpG,MAAMoG,GAC3B,IAAK,IAAIzI,EAAI,EAAGA,EAAIiB,EAAMwD,OAAQzE,IAChCmD,KAAKqF,QAAQxI,GAAGsI,GAASnF,KAAKwD,UAAUvB,QAAQnE,EAAMjB,IAExDmD,KAAKwF,iBAAiBL,GAGhB,oBAAoBA,EACArH,GAE1B,OAAqB,KADrBA,EAAQA,EAAMuD,eACJC,OACD6D,EAAQ,oBAEZnF,KAAKwD,UAAUiC,SAAS3H,GAGtB,GAFE,WAAaqH,EAAQ,YAAcrH,EAKtC,sBAAsB8D,EACAuD,EACArH,GAC5B,GAAI8D,EAAQ,GAAKA,EAAQ,EACvB,MAAM,IAAI1C,MAAM,wBAA0B0C,GAE5C,IAAK5B,KAAKwD,UAAUkC,MAAM5H,GACxB,MAAM,IAAIoB,MAAM,mBAAqBpB,GAEvCkC,KAAKqF,QAAQzD,GAAOuD,GAASnF,KAAKwD,UAAUvB,QAAQnE,GACpDkC,KAAKwF,iBAAiBL,GAGhB,iBAAiBA,GACT,cAAVA,EACFnF,KAAK2E,mBAAmBgB,QACpBzI,GAAKA,EAAE0I,kBAAkB5F,KAAK6F,iBAElC7F,KAAK2E,mBAAmBgB,QACpBzI,GAAKA,EAAE4I,oBAAoB9F,KAAK+F,mBAIjC,eAAyB,OAAO/F,KAAKgG,eAAe,aACpD,aAAalI,GAClBkC,KAAKiG,eAAe,YAAanI,GAE5B,oBAAoB8D,EAAe9D,GACxCkC,KAAKkG,sBAAsBtE,EAAO,YAAa9D,GAE1C,kBAAkBA,GACvB,OAAOkC,KAAKuF,oBAAoB,YAAazH,GAGxC,iBACL,OAAOkC,KAAKgG,eAAe,gBAEtB,eAAelI,GACpBkC,KAAKiG,eAAe,eAAgBnI,GAE/B,sBAAsB8D,EAAe9D,GAC1CkC,KAAKkG,sBAAsBtE,EAAO,eAAgB9D,GAE7C,oBAAoBA,GACzB,OAAOkC,KAAKuF,oBAAoB,eAAgBzH,GAG3C,gBAA0B,OAAOkC,KAAKmG,aACtC,cAAcrI,EAAesI,GAAgB,GAElD,MAAMzG,GADN7B,EAAQA,EAAMuD,eACE+C,MAAM,KACtB,GAAiB,IAAbzE,EAAE2B,OACJ,MAAM,IAAIpC,MAAM,6CAElB,MAAMmH,EAAsB,GAC5B,IAAK,MAAMC,KAAc3G,EAAG,CAC1B,MAAM4G,EAAavG,KAAK6E,MAAMjE,OAAO0F,GACrC,QAAmBjG,IAAfkG,EACF,MAAMrH,MAAM,uBAAyBoH,GAEvCD,EAAWnB,KACP,IAAI/B,EAAMoD,EAAW1F,YAAa0F,EAAWzF,MAAOd,KAAKwD,YAE/D,IAAK4C,EAAe,CAClB,MAAMI,EAAaxG,KAAKqF,QACxB,GAAImB,EACF,IAAK,IAAI3J,EAAI,EAAGA,EAAIwJ,EAAW/E,OAAQzE,IACrCwJ,EAAWxJ,GAAGkH,UAAYyC,EAAW3J,GAAGkH,UACxCsC,EAAWxJ,GAAG4J,aAAeD,EAAW3J,GAAG4J,aAG/CzG,KAAKqF,QAAUgB,EACfrG,KAAKmG,aAAerI,EACpBkC,KAAK2E,mBAAmBgB,QACpBzI,GAAKA,EAAEwJ,mBAAmB1G,KAAKmG,eACnCnG,KAAK2E,mBAAmBgB,QAAQzI,GAAKA,EAAEyJ,cAAc,IAAKhH,EAAE,KAC5DK,KAAK2E,mBAAmBgB,QAAQzI,GAAKA,EAAEyJ,cAAc,IAAKhH,EAAE,KAC5DK,KAAK2E,mBAAmBgB,QAAQzI,GAAKA,EAAEyJ,cAAc,IAAKhH,EAAE,MAGzD,mBAAmB7B,GACxB,IACEkC,KAAK+E,cAAcjH,GAAO,GAC1B,MAAOqG,GACP,OAAOA,EAAEpE,QAEX,MAAO,GAGF,eAAyB,OAAOC,KAAK4G,gBACrC,aAAaxJ,EAAcgJ,GAAgB,GAChD,MAAMS,EAAe7G,KAAK6E,MAAM9D,WAAW3D,GAC3C,QAAqBiD,IAAjBwG,EACF,MAAM3H,MAAM,2BAA6B9B,GAEtCgJ,IACHpG,KAAK8G,WAAa,IAAI3D,EAAM0D,EAAc,GAAI7G,KAAKwD,WACnDxD,KAAK4G,gBAAkBxJ,EACvB4C,KAAK2E,mBAAmBgB,QAAQzI,GAAKA,EAAE6J,kBAAkB3J,KAGtD,kBAAkBA,GACvB,IACE4C,KAAKgF,aAAa5H,GAAM,GACxB,MAAO+G,GACP,OAAOA,EAAEpE,QAEX,MAAO,GAEF,0BACL,OAAOC,KAAK8G,WAAWjG,YAGlB,eAAyB,OAAOb,KAAK8E,WAAW1D,OAChD,aAAatD,GAClBkC,KAAK8E,WAAWnC,MAAM7E,GACtBkC,KAAK2E,mBAAmBgB,QACpBzI,GAAKA,EAAE8J,kBAAkBhH,KAAK8E,WAAWjE,YAChBb,KAAK8E,WAAW1D,SAExC,kBAAkBtD,GACvB,OAAOkC,KAAK8E,WAAWmC,SAASnJ,GAE3B,0BACL,OAAOkC,KAAK8E,WAAWjE,YAGlB,cAAc/C,GACnBkC,KAAKiF,aAAenH,EACpBkC,KAAK2E,mBAAmBgB,QAAQzI,GAAKA,EAAEgK,aAAapJ,IAI/C,gBACL,MAAO,CACLqJ,UAAW,CACTtD,QAAS7D,KAAK8E,WAAWjE,YAAY0B,aACrCuB,QAAS9D,KAAK8E,WAAWjE,YAAY6B,cAEvC9B,OAAQ,CACN,CACEiD,QAAS7D,KAAKqF,QAAQ,GAAGxE,YAAY0B,aACrCuB,QAAS9D,KAAKqF,QAAQ,GAAGxE,YAAY6B,cAEvC,CACEmB,QAAS7D,KAAKqF,QAAQ,GAAGxE,YAAY0B,aACrCuB,QAAS9D,KAAKqF,QAAQ,GAAGxE,YAAY6B,cAEvC,CACEmB,QAAS7D,KAAKqF,QAAQ,GAAGxE,YAAY0B,aACrCuB,QAAS9D,KAAKqF,QAAQ,GAAGxE,YAAY6B,eAGzCxB,UAAWlB,KAAK8G,WAAWjG,YAAY0B,cAIpC,cAAcf,GACnB,OAAOxB,KAAKwD,UAAUkC,MAAMlE,GAIvB,eAAezB,GACpB,IAAI+B,EAAM,GACV,IAAK,MAAMH,KAAa5B,EACtB+B,GAAO9B,KAAKoH,qBAAqBzF,GAEnC,OAAOG,EAKF,qBAAqBN,GAE1B,OADAxB,KAAKqH,MAAK,GACHrH,KAAKsH,oBAAoB9F,GAI3B,oBAAoBA,GACzB,IAAI+F,EAAI/F,EAWR,OAVA+F,EAAIvH,KAAK8E,WAAWjB,QAAQ0D,GAC5BA,EAAIvH,KAAKqF,QAAQ,GAAGxB,QAAQ0D,GAC5BA,EAAIvH,KAAKqF,QAAQ,GAAGxB,QAAQ0D,GAC5BA,EAAIvH,KAAKqF,QAAQ,GAAGxB,QAAQ0D,GAC5BA,EAAIvH,KAAK8G,WAAWjD,QAAQ0D,GAC5BA,EAAIvH,KAAKqF,QAAQ,GAAGvB,QAAQyD,GAC5BA,EAAIvH,KAAKqF,QAAQ,GAAGvB,QAAQyD,GAC5BA,EAAIvH,KAAKqF,QAAQ,GAAGvB,QAAQyD,GAC5BA,EAAIvH,KAAK8E,WAAWhB,QAAQyD,GAC5BvH,KAAK2E,mBAAmBgB,QAAQzI,GAAKA,EAAEsK,UAAUxH,KAAKyH,kBAC/CF,EAIF,KAAKG,GACN1H,KAAKqF,QAAQ,GAAGsC,aAClB3H,KAAKqF,QAAQ,GAAGgC,QAEdrH,KAAKqF,QAAQ,GAAGsC,aAAe3H,KAAKqF,QAAQ,GAAGsC,cACjD3H,KAAKqF,QAAQ,GAAGgC,OAElBrH,KAAKqF,QAAQ,GAAGgC,OAChBrH,KAAK2E,mBAAmBgB,QACpBzI,GAAKA,EAAE0I,kBAAkB5F,KAAK6F,iBAG7B,UAAU+B,GACfA,EAAMnG,IAAI,cAAezB,KAAK6H,iBAC9BD,EAAMnG,IAAI,eAAgBzB,KAAK+F,kBAC/B6B,EAAMnG,IAAI,YAAazB,KAAK6F,gBAC5B+B,EAAMnG,IAAI,YAAazB,KAAK8H,gBAC5BF,EAAMnG,IAAI,SAAUzB,KAAKiF,aAAe,IAAM,KAGzC,UAAU2C,GACf,SAASG,EAAWC,EAAqBvG,GACvC,MAAM3D,EAAQ8J,EAAMlK,IAAIsK,GACxB,GAAc,OAAVlK,EAGJ,IACE2D,EAAI3D,GACJ,MAAOqG,GACP8D,QAAQC,KAAK,kCAAmCF,EAAalK,EAAOqG,IAkBxE4D,EAAW,cAAgBvI,GAAMQ,KAAK+E,cAAcvF,IACpDuI,EAAW,eAAiBvI,GAAMQ,KAAKmI,eAAe3I,IACtDuI,EAAW,YAAcvI,GAAMQ,KAAKoI,aAAa5I,IACjDuI,EAAW,YAAcvI,GAAMQ,KAAKqI,aAAa7I,IAlBjD,SAA2BwI,EACAvG,GACzB,MAAM3D,EAAQ8J,EAAMlK,IAAIsK,GACV,OAAVlK,IAGU,MAAVA,EACF2D,GAAI,GACe,MAAV3D,EACT2D,GAAI,GAEJwG,QAAQC,KAAK,kDACAF,EAAalK,IAO9BwK,CAAkB,cAAgB9I,GAAMQ,KAAKuI,cAAc/I,O,mHCvnB/D,aACA,OACA,OAcA,SAASgJ,EAA2B1J,GAClC,OAAO,EAAAD,sBAAsBC,GAY/B,MAAM2J,EAQJ,YAAYC,GACV1I,KAAK2I,QAAUD,EACf1I,KAAKmG,aACDnG,KAAK4I,kBAAkB,cACCpJ,GAAMkJ,EAAOG,mBAAmBrJ,GAChCA,GAAMkJ,EAAO3D,cAAcvF,IACvDQ,KAAK0D,cACD1D,KAAK4I,kBAAkB,eACCpJ,GAAMkJ,EAAOI,oBAAoBtJ,GACjCA,GAAMkJ,EAAOP,eAAe3I,IACxDQ,KAAKyD,WACDzD,KAAK4I,kBAAkB,YACCpJ,GAAMkJ,EAAOK,kBAAkBvJ,GAC/BA,GAAMkJ,EAAON,aAAa5I,IACtDQ,KAAK8E,WACD9E,KAAK4I,kBAAkB,YACCpJ,GAAMkJ,EAAOM,kBAAkBxJ,GAC/BA,GAAMkJ,EAAOL,aAAa7I,IACtDQ,KAAKiF,aACDjF,KAAKiJ,cAAc,cAAgBzJ,GAAMkJ,EAAOH,cAAc/I,IAClEQ,KAAK2I,QAAQO,yBAAyBlJ,MAGhC,kBAAkBlB,EAAYmI,EACZxF,GACxB,MAAM1C,EAAUyJ,EAA2B1J,GAgB3C,OAfAC,EAAQoK,QAAWC,IACe,KAA5BnC,EAASlI,EAAQjB,OACnBiB,EAAQsK,UAAUC,OAAO,OAEzBvK,EAAQsK,UAAUzF,IAAI,QAG1B7E,EAAQwK,SAAYH,IAClB,IACE3H,EAAI1C,EAAQjB,OACZiB,EAAQsK,UAAUC,OAAO,OACzB,MAAOnF,GACPpF,EAAQsK,UAAUzF,IAAI,SAGnB7E,EAID,cAAcD,EACA2C,GACpB,MAAM1C,EAAUyJ,EAA2B1J,GAE3C,OADAC,EAAQwK,SAAYH,IAAY3H,EAAI1C,EAAQyK,UACrCzK,EAGF,kBAAkB8B,EAA0B4I,GACjDzJ,KAAK8E,WAAWhH,MAAQ2L,EAEnB,mBAAmBC,GACxB1J,KAAKmG,aAAarI,MAAQ4L,EAErB,oBAAoB5L,GACzBkC,KAAK0D,cAAc5F,MAAQA,EAEtB,kBAAkBA,GACvBkC,KAAKyD,WAAW3F,MAAQA,EAEnB,aAAaA,GAClBkC,KAAKiF,aAAauE,QAAU1L,EAGvB,qBACA,iBACA,eAvGT,WACE,MAAM6L,EAAW,IAAI,EAAAC,eAAe,UAAW,EAAAlJ,QACzCgI,EAAS,IAAI,EAAAmB,OAAO,EAAAnJ,QAC1BgI,EAAOQ,yBAAyBS,GAChCA,EAASG,kBAAkBpB,GACJ,IAAID,EAAcC,GAW3C,SAA2BA,GACzB,SAASqB,IACP,MAAMnC,EAAQ,IAAIoC,gBAAgBC,OAAOC,SAASC,KAAKC,UAAU,IACjE1B,EAAO2B,UAAUzC,GAEnBmC,IACAE,OAAOK,iBAAiB,aAAcP,GAAc,GAhBpDQ,CAAkB7B,GAGlBA,EAAOpB,oBAAoB,KAiG7BkD,I,8EC5GA,aACA,OACA,OACA,OACA,OACA,OAEMrJ,EAAWsJ,EAAMtJ,SASjBuJ,EAAa,GACbC,EAAa,IACbC,EAAY,IAEZC,EAAa,GACbC,EAA+B,EAAbD,EAClBE,EAA+B,KAAbF,EAGlBG,EAAW,KACXC,EAAW,IACXC,EAAmB,GACnBC,EAAuB,GAEvBC,EAAc,IACdC,EAAa,GAEbC,EAAmB,EACnBC,EAAe,EAEfC,EAAgB,IAChBC,EAAmB,IACnBC,EAA0B,GAE1BC,EAAyB,GACzBC,EAA0B,GAC1BC,EAA8BJ,EAAmB,EAEjDK,EAAa,IACbC,EAAe,GACfC,EAAW,GACXC,EAAkB,GAwBlBC,EAAY,IAAI/K,EA1DL,8BA2DXgL,EAAiB,IAAIhL,EA1DJ,8BA4DvB,SAASiL,EAAKC,GACZ,OAAOxB,EAAawB,EAAStB,EAG/B,SAASuB,EAAKD,GAEZ,OAAOxB,GADMwB,EAAS,GAAK,EACDvB,EA0B5B,SAASyB,EAAeC,EAAkB9H,GACxC,MAAM+H,EAAOC,EAAIF,GAGjBC,EAAKE,KAAK,KAAM,KAAKC,QAAQ,EAAG,EAAG,KAAM,KAEzC,MAAMC,EACFJ,EAAKK,QAAQhO,GAAG,wBAAwBiO,UAAUrC,EAAYE,GAC5DoC,EAAUC,EAAiBJ,EAAkBC,QAAQhO,GAAG,cACxDoO,EAAWD,EAAiBJ,EAAkBC,QACbhO,GAAG,cACHiO,UAAU,EAAGpC,EAAaC,IAC3DzD,EA+CR,SAAuBgG,GACrB,MAAM/P,EAAO+P,EAAUrO,KACjBsO,EAAS3B,EACT4B,EAAQxC,EAAaqB,EAAU5K,OAASyJ,EAExCuC,EAASH,EAAUL,QAAQhO,MAAM1B,SACjCmQ,EAAYJ,EAAUL,QAAQhO,MAAM1B,YACpCoQ,EAAQL,EAAUL,QAAQhO,MAAM1B,WA0CtC,OAzCA8O,EAAUuB,KAAK,CAACjM,EAAQ6K,KACtB,MAAM9E,EAAI6E,EAAKC,GACfiB,EAAOtK,MAAMxB,GAAQkM,KAAK,CAACnG,EAAGA,EAAGoG,EAAGjC,EAA0B,IAC9D6B,EAAUvK,MAAMxB,GAAQkM,KACpB,CAACnG,EAAGA,EAAGoG,EAAGP,EAAS1B,EAA0B,IACjD,MAAMkC,EAAYJ,EAAMV,QAAQe,kBAAkBrM,KAClDoM,EAAUE,OACLhP,MAAM1B,KAAQoE,KACdqM,iBAAiBrM,KACjBqM,SAAS,YACTA,SAAS,QAGTd,UAAUxF,EAAGmE,GACbqC,MAAK,IAAI,EAAAC,gBACCC,EAAE,EAAG,GACLC,EAAE,EAAGd,EAAS,EAAI1B,GAClByC,SACfP,EAAUQ,KAAKzC,EAAwBC,GAClC9M,MAAM1B,KAAQoE,iBACdkM,KAAK,CACJnG,EAAGA,EAAIoE,EAAyB,EAChCgC,EAAGP,EAAS1B,EAA0BE,IAEvCiC,uBAAuBrM,KACvBqM,SAAS,uBAGhBV,EAAUW,OAAOD,SAAS,OAAOE,MAC7B,IAAI,EAAAC,gBACCC,EAAE,EAAG,GACLI,EAAEhB,GACF7N,EAAE4N,GACFiB,GAAGhB,GACHiB,IACArR,EAAE,EAAGyO,GACL2C,EAAEhB,GACFpQ,EAAE,EAAGmQ,EAAS,EAAI1B,GAClB2C,GAAGhB,GACHc,SAEFhB,EAhGWoB,CAAc1B,EAAkBC,QACbhO,GAAG,eACHiO,UAAU,EAAGvB,EAAgBZ,IAE5D4D,EACF/B,EAAKK,QAAQhO,GAAG,qBAAqBiO,UAAU/B,EAAUC,GAC7DwD,EAAUD,EAAe1B,QAAQhO,GAAG,aAC1BoM,EAAmB,EAAIE,EAAa1G,GAC9C+J,EAAUD,EAAe1B,QAAQhO,GAAG,aAC1BoM,EAAmB,EAAIE,EAAa1G,GAC9C+J,EAAUD,EAAe1B,QAAQhO,GAAG,aAC1BoM,EAAmB,EAAIE,EAAa1G,GAuPhD,SAAuByI,EAA0BuB,EAC1BhK,GACrB,MAAMtH,EAAO+P,EAAUrO,KAEjB0O,EAAQL,EAAUL,QAAQhO,MAAM1B,WACtC,IAAK,MAAMuR,KAAkBpR,OAAOqR,KAAKlK,EAAK3D,YAAa,CACzD,MAAM8N,EAAMnK,EAAK3D,WAAW4N,GACtBG,EAAO,IAAIrE,EAAMpI,YAAYwM,EAAK3C,GACxC6C,EAAmBvB,EAAMV,QAAQhO,MAAM1B,WAAcuR,KAClCD,EAAcI,GAKnCE,EAAgB7B,EAAUL,QAAQhO,MAAM1B,UAAcsR,EACtCvD,GArQhB8D,CAAcT,EAAe1B,QAAQhO,GAAG,eAAgBoM,EAC1CxG,GAuFhB,SAAwByI,EAA0B+B,EAC1BC,GACtB,MAAMC,EAAS,CAACC,GAAI,EAAGC,GAAI,GAC3B,IAAK,IAAIzS,EAAI,EAAGA,GAAK,EAAGA,IAAK,CAC3B,MAAM6R,EAAeQ,EAAkBrS,EAAIsS,EACrCI,EAAmB,IAAN1S,EAAUsO,EAAuBE,EAC9CmE,EAAed,EAAea,EAGpC,GAFApC,EAAUsC,OAAsB,EAAff,GAAkBhB,KAAK0B,GAAQvB,SAAS,aACzDV,EAAUsC,OAAsB,EAAfD,GAAkB9B,KAAK0B,GAAQvB,SAAS,aACrDhR,GAAK,EAAG,CACV,MAAMwQ,EAAQkC,EAAajE,EAC3B6B,EAAUiB,KAAKf,EAAOA,GACjBQ,SAAS,eACT6B,OAAOpE,GACP+D,GAAGG,EAAeD,EAAa,GAC/BD,GAAG,KArGZK,CAAenB,EAAe1B,QAAQhO,GAAG,iBAAkBoM,EAC5CE,GA2GjB,SAA2B+B,EAA0B+B,EAC1BC,GACzB,SAAS1C,EAAKmD,EAAkBlB,GAC9BvB,EAAUW,OACLhP,MAAM8Q,UACN/B,SAAS,iBACTE,KAAK,EAAA8B,MAAMnB,EAAcrD,IAC9B8B,EAAUW,OACLhP,MAAM8Q,WACN/B,SAAS,iBACTE,KAAK,EAAA8B,MAAMnB,EAAerD,EAAY8D,EAAa9D,IAE1DoB,EAAK,oBAAqByC,EAAkB,EAAIC,GAChD1C,EAAK,oBAAqByC,EAAkB,EAAIC,GAChD1C,EAAK,oBAAqByC,EAAkB,EAAIC,GAxHhDW,CAAkBtB,EAAe1B,QAAQhO,GAAG,oBAC1BoM,EAAkBE,GAEpC,MAAM2E,EAAqBtD,EAAKK,QAAQhO,GAAG,iBAmQ7C,SAAsCqO,EACAH,EACAE,GACvBC,EAAUrO,KACvBqN,EAAesB,KAAK,CAACjM,EAAQ6K,KAC3B,MAAM2D,EAAU5D,EAAKC,GACf4D,EAAU3D,EAAKD,GACrBc,EACK+C,KAAKlD,EAAQzF,EAAIyI,EAAShD,EAAQW,EAAIsC,EACjC/C,EAAS3F,EAAIyI,EAAS9C,EAASS,EAAIsC,GACxCpC,iBAAiBrM,KACjBqM,kBAAkBrM,KAClBqM,SAAS,UA9QhBsC,CACIJ,EAAmBjD,QAAQhO,GAAG,yBAA0BkO,EAAQoD,OAChElD,EAASkD,QAiRf,SAAwCjD,EACAD,EACA/F,GACzBgG,EAAUrO,KAAvB,MACMuR,EAASnD,EAASoD,GAClBC,EAAQpJ,EAAUwG,EAClBsC,EAAUM,EAAQF,EACxBlE,EAAesB,KAAK,CAACjM,EAAQ6K,KAC3B,MAAMmE,EAAStD,EAAS3F,EAAI6E,EAAKC,GAC3BoE,EAAQtJ,EAAUI,EAAI6E,EAAKF,EAAUjK,QAAQT,IAC7CkP,EAASxD,EAASS,EAAIrB,EAAKD,GACjCc,EAAUW,OACLD,iBAAiBrM,KACjBqM,kBAAkBrM,KAClBqM,SAAS,QACTE,MAAK,IAAI,EAAAC,gBACCC,EAAEuC,EAAQE,GACVC,EAAEN,GACFO,EAAEJ,EAAQH,EAASJ,EAAU,EAC3BQ,EAAOF,EAAQN,EAAU,EACzBQ,EAAOF,GACTpC,WArSjB0C,CACId,EAAmBjD,QAAQhO,GAAG,2BAA4BoO,EAASkD,OACnEjJ,EAAUiJ,QAwShB,SACIjD,EAA0BhG,EAC1B2J,GACF,MAAMC,EAAU,CAACxJ,EAAGJ,EAAU6J,GAAKjF,EAAc4B,EAAGxG,EAAUmJ,IACxDW,EAAYnF,EAAaI,EAAU5K,OACnC4P,EAAIhF,EAAU5K,OACd6P,EAAe,CAAC5J,EAAGuJ,EAAMzB,GAAI1B,EAAGmD,EAAMxB,IACtC3R,EAAImT,EAAMnT,EAChBuO,EAAUuB,KAAK,CAACjM,EAAQ3E,KACtB,MAAMuU,EAAQ,CAAC7J,EAAGJ,EAAUI,EAAI6E,EAAKvP,GAAI8Q,EAAGxG,EAAUmJ,IAChDe,EAAQ,IAAMxU,EAAIqU,EAClBI,EAAM,EAAAC,UAAUJ,EAAc,EAAAK,UAAU,CAACC,IAAKJ,EAAO1T,EAAGA,KACxD+T,EAAS,EAAAH,UAAUD,EAAK,EAAAE,UAAU,CAACC,IAAKJ,EAAO1T,EAAGsO,KAClD6B,EAAO,IAAI,EAAAE,eAGjB,GAFAF,EAAK6D,OAAOP,GACZtD,EAAKtO,EAAEsM,EAAajP,EAAIoU,GACpBI,EAAQ,IAAK,CACf,MAAM1N,GAAUuN,EAAI,EAAIrU,GAAKoU,EAC7BnD,EAAK8D,EAAEb,EAAQxJ,EAAI5D,GACnBmK,EAAK6C,EAAE3E,EAAWrI,GAEpBmK,EAAK8D,EAAEF,EAAOnK,GACduG,EAAK6C,EAAEe,EAAO/D,GACdG,EAAK+D,OAAOP,GACZnE,EAAUW,OACLD,iBAAiBrM,KACjBqM,kBAAkBrM,KAClBqM,SAAS,QACTE,KAAKD,EAAKK,WAnUjB2D,CACI/B,EAAmBjD,QAAQhO,GAAG,wBAAyBqI,EAAUiJ,OACjE,CAACf,GAAIrE,EAAUsE,GAAIrE,EAAUtN,EAAGuN,EAAmB,EAAIE,IAC3D2E,EAAmBgC,OAGrB,SAAS9E,EAAiBE,GACxB,MAAM/P,EAAO+P,EAAUrO,KAWvB,OAVAqO,EAAUU,SAAS,iBACnB1B,EAAesB,KAAK,CAACjM,EAAQ6K,KAC3B,MAAMjO,EAAM+O,EAAUL,QACLsC,OAAOhD,EAAKC,GAASC,EAAKD,IAC1BvN,MAAM1B,SAAYoE,KAClBqM,SAAS,gBACTA,mBAAmBrM,KACpCpD,EAAIqR,OAAO,EAAI5E,GAAYuE,OAAO,EAAG,GACrChR,EAAI4E,MAAMxB,KAEL2L,EAkGT,SAAS6B,EAAgB7B,EAA0BuB,EAC1Ba,GACvB,MAAMnS,EAAO+P,EAAUrO,KACjB0Q,EAAed,EAAea,EAQpC,OAPArD,EAAUuB,KAAK,CAACjM,EAAQ3E,KACtBsQ,EAAUnK,MAAMxB,GACXkM,KAAK,CAACnG,EAAGiI,EAAeD,EAAa,EAAG5B,EAAG,IAC3CqE,UAAU,CAAC3C,GAAI,EAAGC,GAAI,EAAG2C,SAAc,IAAJpV,EAAUqP,EAAU5K,SACvDuM,SAAS,eACT/O,MAAM1B,YAAeoE,OAErB2L,EAIT,SAAS+E,EAAe/E,EAA0BuB,EAC1B7N,GACtBsM,EAAUU,SAAS,wBACNV,EAAUrO,KAAvB,MACMoS,EAAIhF,EAAU5K,OACd6Q,EAAUzD,EAAerD,EACzB+G,EAAU1D,EAAetD,EACzBiH,EAAO,KAAQjH,EAAcC,GAC7BiH,EAAQ,IAAOlH,EAAcC,GA+BnC,OA9BAxK,EAAY0R,SAAS,CAACvP,EAAOE,KAC3B,MAAMrG,EAAIqP,EAAUjK,QAAQe,GACtBuB,EAAI2H,EAAUjK,QAAQiB,GACtBsP,EAAU,IAAM3V,EAAIqU,EACpBuB,EAAU,IAAMlO,EAAI2M,EACpB/T,EAAI,EAAAuV,iBAAiBnO,EAAI1H,EAAGqU,GAC5ByB,EAAa,IAAYzB,EAAI0B,KAAKC,KAAK1V,GACvCQ,EAAIwU,EAAUE,EA1MxB,SAAgBxV,EAAWyB,GAQzB,OAAQzB,GAFJ,CAACiW,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGC,GAAI,EAAGC,GAAI,EAAGC,GAAI,EAAGC,GAAI,EAAGC,GAAI,IAC1ChV,IAAM,GACLA,EAkMSiV,CAAO1W,EAAGqU,GAAKoB,EAAQpB,EAE5CpD,EAAO,IAAI,EAAAE,eACjBF,EAAK6D,OAAO,EAAAH,UAAU,CAACC,IAAKe,EAAS7U,EAAGwU,KAKxCrE,EAAK0F,iBAAiB,EAAAhC,UAAU,CAACC,IAAKe,EAAS7U,EAAGA,IAC5B,EAAA6T,UAAU,CAACC,IAAKe,EAAUG,EAAYhV,EAAGA,KAC3DiV,KAAKa,IAAItW,GAAK,GAChB2Q,EAAK4F,MAAM,CAAC/V,EAAGA,EAAGgW,MAAOxW,EAAI,GAClB,EAAAqU,UAAU,CAACC,IAAKgB,EAAUE,EAAYhV,EAAGA,KAEtDmQ,EAAK0F,iBAAiB,EAAAhC,UAAU,CAACC,IAAKgB,EAAS9U,EAAGA,IAC5B,EAAA6T,UAAU,CAACC,IAAKgB,EAAS9U,EAAGyU,KAElDjF,EAAUW,OACLD,iBAAiB7K,KACjB6K,kBAAkB7K,KAClB6K,SAAS,QACTE,KAAKD,EAAKK,WAEVhB,EAGT,SAAS4B,EAAmB5B,EAA0BuB,EAC1B7N,GAC1BsM,EAAUU,SAAS,wBACNV,EAAUrO,KAAvB,MACMoS,EAAIhF,EAAU5K,OACdoO,EAAShB,EAAevD,EACxByI,EAAS,GAAMlE,EACrB,IAAImE,EAAc,EAsBlB,OArBAhT,EAAY0R,SAAS,CAACvP,EAAOE,KAC3B,MAAMrG,EAAIqP,EAAUjK,QAAQe,GACtBuB,EAAI2H,EAAUjK,QAAQiB,GAC5B,GAAIrG,GAAK0H,EAAG,CACV,MAAMuP,EAAQ5H,EAAUjJ,UAAU4Q,GAC5BrB,EAAU,IAAM3V,EAAIqU,EACpBuB,EAAU,IAAMlO,EAAI2M,EACpBpD,EAAO,IAAI,EAAAE,eACjBF,EAAK6D,OAAO,EAAAH,UAAU,CAACC,IAAKe,EAAS7U,EAAG+R,KACxC5B,EAAKiG,aAAa,EAAAvC,UAAU,CAACC,IAAKe,EAAS7U,EAAGiW,IAC5B,EAAApC,UAAU,CAACC,IAAKgB,EAAS9U,EAAGiW,IAC5B,EAAApC,UAAU,CAACC,IAAKgB,EAAS9U,EAAG+R,KAC9CvC,EAAUW,OACLD,iBAAiB7K,KACjB6K,iBAAiB3K,KACjB2K,kBAAkBiG,KAClBjG,SAAS,QACTE,KAAKD,EAAKK,SACf0F,GAAe,KAGZ1G,EAGT,SAASsB,EAAUtB,EAA0BuB,EAC1BhK,GACjB,MAAMtH,EAAO+P,EAAUrO,KACvBqO,EAAUU,SAAS,SAEnB,MAAML,EAAQL,EAAUL,QAAQhO,MAAM1B,WAAcyQ,SAAS,eAC7D,IAAK,MAAMvH,KAAc/I,OAAOqR,KAAKlK,EAAK9D,QAAS,CACjD,MAAMiO,EAAMnK,EAAK9D,OAAO0F,GAClBwI,EAAO,IAAIrE,EAAMpI,YAAYwM,EAAIhO,YAAaqL,GACpDgG,EAAe1E,EAAMV,QAAQhO,MAAM1B,WAAckJ,KAClCoI,EAAcI,GAc/B,OAVAtB,EAAMiC,OAAsB,EAAflE,GAAkBzM,MAAM1B,SAAYyQ,SAAS,YAAYH,KAAK,CACzE2B,GAAIX,EAAerD,EAAaE,EAChC+D,GAAI,IAKNN,EAAgB7B,EAAUL,QAAQhO,MAAM1B,UAAcsR,EACtCrD,GAET8B,EAwGT,uBAKE,YAAYrO,EAAY4F,GACtB1E,KAAKgU,KAAO,EAAAnV,sBAAsBC,GAClCkB,KAAK6E,MAAQH,EACb1E,KAAKiF,cAAe,EAGpBsH,EAAevM,KAAKgU,KAAMtP,GAG1B,MAAMzD,EAAcyD,EAAK1D,SAASC,YAAYmD,MAAM,KACpDpE,KAAK2G,cAAc,IAAK1F,EAAY,IACpCjB,KAAK2G,cAAc,IAAK1F,EAAY,IACpCjB,KAAK2G,cAAc,IAAK1F,EAAY,IACpCjB,KAAK+G,kBAAkBrC,EAAK1D,SAASE,WAGrClB,KAAKiU,mBAGC,mBAAqBjU,KAAKgU,KAAK3K,UAAUzF,IAAI,YAE7C,oBAAsB5D,KAAKgU,KAAK3K,UAAUC,OAAO,YAGlD,kBAAkBZ,GACvBwD,EAAUuB,KAAMjM,IACdxB,KAAKkU,mBAAmBxL,EAAQlH,GAChCxB,KAAKmU,mBAAmBzL,EAAQlH,KAGlCxB,KAAKoU,eAAe1L,EAAQ,YAAa,GACzC1I,KAAKoU,eAAe1L,EAAQ,YAAa,GACzC1I,KAAKoU,eAAe1L,EAAQ,YAAa,GAEzC1I,KAAKqU,4BAA4B3L,GAG3B,mBAAmBA,EAAsBlH,GAC/C,EAAA3C,wCAAwC2C,KACnC8I,iBAAiB,QACA,KAAQ5B,EAAOtB,qBAAqB5F,KAGpD,mBAAmBkH,EAAsB1F,GAC/C,MAAMsR,EACF,EAAAC,gDAAgDvR,iBAC9CwR,EAAatI,EAAUjK,QAAQe,GAC/ByR,EAAS/J,EAAa0B,EAAKoI,GAC3BE,EAAgB,IAAIjK,EAAMzG,UAAUkI,GAC1C,IAAIyI,EACJ,MAAMC,EAAoBhN,IACxB,MAAMiN,EAAKjN,EAAMkN,MAAMC,QAAQxN,EAAIkN,EAC7BO,EAAKpN,EAAMkN,MAAMC,QAAQpH,EAAI/F,EAAMqN,OAAO7D,MAAMzD,EAChDhK,EAncZ,SAAkCkR,GAChC,OAAOjC,KAAKsC,MAAML,EAAK9J,GAkcJoK,CAAyBN,GAClCO,EAAcZ,EAAa7Q,EACjC,GAAIiP,KAAKa,IAAIuB,GAAMnJ,GAA+BuJ,EAAc,GAC5DA,GAAelJ,EAAU5K,OAC3B,OAAO,KAET,MAAM4B,EAASgJ,EAAUjJ,UAAUmS,GAC7BtT,EAAM,IAAI8C,MACZ5B,IAAUE,GACZpB,EAAIoD,KAAKlC,EAAQE,GAEnB,IAAK,MAAMoB,KAAQqQ,EAAqBtT,cAAc+C,MAAM,OAC7C,KAATE,GAAeA,EAAKrC,QAAQe,GAAS,GACrCsB,EAAKrC,QAAQiB,GAAU,GACzBpB,EAAIoD,KAAKZ,GAIb,IAAK,IAAIzH,EAAI,EAAGA,EAAIiF,EAAIR,OAAQzE,IAC9BiF,EAAIjF,GAAKiF,EAAIjF,GAAGuH,MAAM,IAAIiR,OAAO5Q,KAAK,IAGxC,OADA3C,EAAIuT,OACGvT,EAAI2C,KAAK,MAElB,EAAA6Q,UAAU,CACRvW,QAASuV,EACTiB,QAAS,KAIPvV,KAAKwV,oBACLb,EAAuBjM,EAAOZ,gBAEhC2N,OAAS7N,IACP,IAAI8N,EAAsBd,EAAiBhN,GACf,OAAxB8N,IACFA,EAAsBf,GAExBD,EAAc/R,MAAM+S,GACpB1V,KAAKgH,kBAAkB0N,EAAc7T,YAAa6U,IAEpDC,SAAW/N,IACT,MAAM8N,EAAsBd,EAAiBhN,GACjB,OAAxB8N,EACFhN,EAAOL,aAAaqN,GAEpB1V,KAAKgH,kBAAkB0B,EAAOkN,0BACPlN,EAAOZ,gBAEhC9H,KAAKiU,sBAKH,eAAevL,EAAsB5J,EAAY+W,GACvD,MAAM/E,EAAQ,EAAAyD,iCAAiCzV,GACzC0O,EAAQ,EAAA+G,oCAAoCzV,WAE5CgX,GADO,EAAAvB,oCAAoCzV,UAC7B,EAAAyV,oCAAoCzV,oBAClDiX,EAAc,EAAAxB,oCAAoCzV,kBAOxD,IAAId,EACAgY,EAAqB,EACrBC,EAAqB,EACzB,MAAMC,EAAgBnX,IACpB,EAAAuW,UAAU,CACRvW,QAASA,EACTwW,QAAS,KACPvV,KAAKwV,oBACLxX,EAAOgC,KAAKiF,aAAe,SACAlG,IAAY+W,EAAc,QAAU,OAC/DE,EAAqBhW,KAAKmW,eAAerF,GACzCmF,EAAqBjW,KAAKmW,eAAe3I,IAE3CiI,OAAS7N,IACP,MAIMwO,IAJUxO,EAAMqN,OAAO7D,MAAMiF,UAAUzO,EAAMkN,MAAMC,SACrDnN,EAAMqN,OAAO7D,MAAMiF,UAAUzO,EAAMkN,MAAM1D,QAGZ,IAAMlF,EAAU5K,OACjD,OAAQtD,GACN,IAAK,SACHgC,KAAKsW,aAAaxF,EAAOkF,EAAqBI,EAC5B,qBAClB,MACF,IAAK,OACHpW,KAAKsW,aAAaxF,EAAOkF,EAAqBI,EAC5B,qBAClBpW,KAAKsW,aAAa9I,EAAOyI,EAAqBG,EAC5B,aAClB,MACF,IAAK,QACHpW,KAAKsW,aAAa9I,EAAOyI,EAAqBG,EAC5B,aAClB,MACF,QACE,MAAM,IAAI,EAAAG,qBAAqBvY,KAGrC2X,SAAW/N,IAGT,SAAS4O,EAAcC,GACrB,OAAOvK,EAAUjJ,UACb,EAAAvD,IAAIkT,KAAKsC,MAAMuB,GAAWvK,EAAU5K,SAE1C,MAAM8U,IANUxO,EAAMqN,OAAO7D,MAAMiF,UAAUzO,EAAMkN,MAAMC,SACrDnN,EAAMqN,OAAO7D,MAAMiF,UAAUzO,EAAMkN,MAAM1D,QAKZ,IAAMlF,EAAU5K,OAEjD,OADAtB,KAAKiU,mBACGjW,GACN,IAAK,SACH0K,EAAOgO,oBACHb,EACAW,EAAcR,EAAqBI,IACvC,MACF,IAAK,OACH1N,EAAOgO,oBACHb,EACAW,EAAcR,EAAqBI,IACvC1N,EAAOiO,sBACHd,EACAW,EAAcP,EAAqBG,IACvC,MACF,IAAK,QACH1N,EAAOiO,sBACHd,EACAW,EAAcP,EAAqBG,IACvC,MACF,QACE,MAAM,IAAI,EAAAG,qBAAqBvY,QAKzCkY,EAAaJ,GACbI,EAAaH,GAGP,4BAA4BrN,GAClC1J,SAASsL,iBAAiB,UAAYlB,IAGhCA,EAAMwN,mBAAqBxN,EAAM6L,QACM,UAAtC7L,EAAM6L,OAAmB4B,UACa,aAAtCzN,EAAM6L,OAAmB4B,UAC1BzN,EAAM0N,iBAAiB,YAAc1N,EAAM0N,iBAAiB,QAC5D1N,EAAM0N,iBAAiB,UAIvBpO,EAAOqO,cAAc3N,EAAMhL,KAC7BsK,EAAOtB,qBAAqBgC,EAAMhL,KACzBgL,EAAMhL,OAKhB,GAKE,kBAAkByC,EAAgC4I,GACvDzJ,KAAKgX,SAGLnW,EAAY0R,SAAS,CAACvP,EAAOE,KAC3B,MAAMS,EAASuI,EAAUjK,QAAQiB,GAAUgJ,EAAUjK,QAAQe,GAC7D,EAAAiU,iBAAiB,EAAApY,qCAAqCmE,KAAU,SAC/C,GAAKW,KAInB,kBAAkBuT,GACvBlX,KAAKgX,SACLhX,KAAKmX,UAAU,oBAAqB5Z,OAAOqR,KAAK5O,KAAK6E,MAAM9D,YAC5CmW,GAGV,mBAAmBxN,IAEnB,cAAc+M,EAA+BS,GAClDlX,KAAKgX,SACLhX,KAAKmX,qBAAqBV,UAAkBlZ,OAAOqR,KAAK5O,KAAK6E,MAAMjE,QACpDsW,GACflX,KAAKoX,uBAAuBX,gBACXzW,KAAK6E,MAAMjE,OAAOsW,GAAcpW,OAG3C,UAAU8O,EAAkByH,EAClBH,GAChB,IAAII,GAAQ,EACZ,IAAK,MAAMla,KAAQia,EAAU,CAC3B,MAAME,EAAK,EAAA1Y,yBAAyB+Q,KAAYxS,KAC5CA,IAAS8Z,GAMXK,EAAGlO,UAAUzF,IAAI,YACjB0T,GAAQ,GAERC,EAAGlO,UAAUC,OAAO,YAGnBgO,GACHrP,QAAQ3C,iBAAiBlI,2BAA2Bia,KAIhD,YAAYzH,EAAkB9O,GACpCoL,EAAUuB,KAAMjM,IACd,MAAM+V,EAAK,EAAA1Y,yBAAyB+Q,KAAYpO,KAC5CV,EAAMmB,QAAQT,IAAW,EAC3B+V,EAAGlO,UAAUzF,IAAI,SAEjB2T,EAAGlO,UAAUC,OAAO,WAKnB,oBAAoBxL,GACzBmK,QAAQuP,OAAwB,IAAjB1Z,EAAMwD,OAAc,yBAA0BxD,GAC7DkC,KAAKgX,SACLhX,KAAKsW,aAAa,kBAAmBxY,EAAM,GAAI,aAC/CkC,KAAKsW,aAAa,kBAAmBxY,EAAM,GAAI,aAC/CkC,KAAKsW,aAAa,kBAAmBxY,EAAM,GAAI,aAG1C,kBAAkBA,GACvBmK,QAAQuP,OAAwB,IAAjB1Z,EAAMwD,OAAc,yBAA0BxD,GAC7DkC,KAAKgX,SACLhX,KAAKsW,aAAa,YAAaxY,EAAM,GAAI,qBACzCkC,KAAKsW,aAAa,YAAaxY,EAAM,GAAI,qBACzCkC,KAAKsW,aAAa,YAAaxY,EAAM,GAAI,qBAGpC,aAAaA,GAAwBkC,KAAKiF,aAAenH,EAExD,aAAa2Z,EAA6BhB,EAC7BiB,GACnB,MAAMH,EAA0B,iBAAbE,EACf,EAAAlD,iCAAiCkD,GACjCA,EACJhB,EAAgC,iBAAbA,EAAyBvK,EAAUjK,QAAQwU,GAClB,EAAA/W,IAAI+W,EAAUvK,EAAU5K,QAMpE,MAAMqW,EAAe3X,KAAKmW,eAAeoB,GAEnCK,EAAeD,EADP,EAAAjF,iBAAiB+D,EAAWkB,EAAczL,EAAU5K,QAE5DuW,EAA8C,KAAxB,cAAdH,EAA4B,GAAK,GAAWxL,EAAU5K,OACpEiW,EAAGO,QAAQrB,SAAW,GAAKmB,EAC3BL,EAAGQ,MAAM/F,oBAAsB6F,EAAOD,QAGhC,eAAeL,GACrB,QAASA,EAAGO,QAAQrB,UAAY,GAG3B,UAAUuB,GACf,SAASC,EAAUnZ,EAAY0C,EACZ0W,GACK,iBAAX1W,EACT,EAAAyV,iBAAiB,EAAApY,sBAAsBC,GAAK,kBAAmB0C,GACtD0W,EACT,EAAAjB,iBAAiB,EAAApY,sBAAsBC,GAAK,kBAC3B,CAAC0C,EAAOqC,QAAQpB,OAAQjB,EAAOsC,QAAQtB,QAExD,EAAAyU,iBAAiB,EAAApY,sBAAsBC,GAAK,kBAC3B,CAAC0C,EAAOqC,QAAQrB,MAAOhB,EAAOsC,QAAQrB,SAG3DwV,EAAU,YAAaD,EAAO7Q,UAAUrD,QAAQrB,QAChDwV,EAAU,wBAAyBD,EAAO7Q,UAAUrD,QAAQrB,QAC5DwV,EAAU,aAAcD,EAAO7Q,UAAUtD,QAAQrB,OACjDyV,EAAU,0BAA2BD,EAAO7Q,WAC5C8Q,EAAU,cAAeD,EAAO7Q,WAChC8Q,EAAU,uBAAwBD,EAAO7Q,WAAW,GACpD8Q,EAAU,YAAaD,EAAOpX,OAAO,IACrCqX,EAAU,YAAaD,EAAOpX,OAAO,IACrCqX,EAAU,YAAaD,EAAOpX,OAAO,IACrCqX,EAAU,cAAeD,EAAO9W,UAAUsB,OAGpC,SACN,SAAS2V,EAAMrZ,GACb,EAAAsZ,cAAc,EAAAvZ,sBAAsBC,GAAK,mBAE3CqZ,EAAM,aACNA,EAAM,yBACNA,EAAM,cACNA,EAAM,2BACNA,EAAM,eACNA,EAAM,wBACNA,EAAM,aACNA,EAAM,aACNA,EAAM,aACNA,EAAM,kB,gBC/0BV,MAUUE;;;;;;;;;;EAAAA,EAWU,oBAAXpO,OAAyBA,OAASjK,UANtC,KAFD,aACE,OAO2C,SAASiK,EAAQjL,GAIlE,IAGI0N,QAH6B,IAAT1M,KAAwBA,KAAOiK,GAGnCyC,IAAM,SAAS3N,GACjC,GAAI2N,EAAI4L,UAMN,OALAvZ,EAAU,IAAI2N,EAAI6L,IAAIxZ,GAElB2N,EAAI8L,OAAO/L,MACbC,EAAI+L,UAEC1Z,GAiBX,GAZA2N,EAAIxO,GAAQ,6BACZwO,EAAIgM,MAAQ,gCACZhM,EAAIiM,MAAQ,+BACZjM,EAAIkM,MAAQ,yBAGZlM,EAAI4L,YACQtZ,EAAS6Z,mBACT7Z,EAAS6Z,gBAAgBnM,EAAIxO,GAAG,OAAO4a,eAI9CpM,EAAI4L,UAAW,OAAO,EAG3B5L,EAAIqM,IAAO,IAGXrM,EAAIsM,IAAM,SAAS5b,GACjB,MAAO,QAAU6b,EAAW7b,GAASsP,EAAIqM,OAI3CrM,EAAIvO,OAAS,SAASf,GAEpB,IAAI2B,EAAUC,EAAS6Z,gBAAgB7Y,KAAK9B,GAAId,GAKhD,OAFA2B,EAAQU,aAAa,KAAMO,KAAKgZ,IAAI5b,IAE7B2B,GAIT2N,EAAIwM,OAAS,WACX,IAAInc,EAASoc,EAAS/a,EAAKvB,EAQ3B,IAFAsc,GAHApc,EAAU,GAAGqc,MAAMpc,KAAKqc,YAGNC,MAEbzc,EAAIE,EAAQuE,OAAS,EAAGzE,GAAK,EAAGA,IACnC,GAAIE,EAAQF,GACV,IAAKuB,KAAO+a,EACVpc,EAAQF,GAAG4B,UAAUL,GAAO+a,EAAQ/a,GAGtCsO,EAAIpJ,KAAOoJ,EAAIpJ,IAAIiW,SACrB7M,EAAIpJ,IAAIiW,WAIZ7M,EAAI8M,OAAS,SAASC,GAEpB,IAAIC,EAAsC,mBAAjBD,EAAOtb,OAC9Bsb,EAAOtb,OACP,WACE6B,KAAK2Z,YAAY3c,KAAKgD,KAAM0M,EAAIvO,OAAOsb,EAAOtb,UAelD,OAXIsb,EAAOF,UACTG,EAAYjb,UAAY,IAAIgb,EAAOF,SAGjCE,EAAOP,QACTxM,EAAIwM,OAAOQ,EAAaD,EAAOP,QAG7BO,EAAOG,WACTlN,EAAIwM,OAAOO,EAAOI,QAAUnN,EAAIoN,UAAWL,EAAOG,WAE7CF,GAIThN,EAAIqN,MAAQ,SAASC,GAEnB,OAAKA,EAGDA,EAAKC,SAAiBD,EAAKC,WAO7Blb,EADmB,OAAjBib,EAAKnD,SACGmD,EAAKE,sBAAsBjQ,EAAOkQ,WAAa,IAAIzN,EAAI0N,OAAS,IAAI1N,EAAI6L,IAC1D,kBAAjByB,EAAKnD,SACF,IAAInK,EAAI2N,SAAS,UACH,kBAAjBL,EAAKnD,SACF,IAAInK,EAAI2N,SAAS,UACpB3N,EAAIuM,EAAWe,EAAKnD,WACjB,IAAInK,EAAIuM,EAAWe,EAAKnD,YAExB,IAAInK,EAAI4N,QAAQN,IAGpBO,KAAQP,EAAKnD,SACrB9X,EAAQib,KAAQA,EAChBA,EAAKC,SAAWlb,EAGZA,aAAmB2N,EAAI6L,KACzBxZ,EAAQyb,YAAYC,OAGtB1b,EAAQ2b,QAAQC,KAAKC,MAAMZ,EAAK1a,aAAa,gBAAkB,IAExDP,GAhCW,KAMlB,IAAIA,GA8BN2N,EAAI+L,QAAU,WAEZ,IAAIoC,EAAO7b,EAAS8b,qBAAqB,QAAQ,GAC7CrO,GAAQoO,EAAO,IAAInO,EAAI6L,IAAIsC,GAAQnO,EAAIqN,MAAM/a,EAAS+b,iBAAiBC,UAAUrO,KAAK,EAAG,GAG7FD,EAAI8L,OAAS,CACXqC,KAAMA,GAAQ7b,EAAS+b,gBACvBtO,KAAMA,EAAKsL,MAAM,oEAAoErK,KAAK,YAAa,SAASsM,KAChHiB,KAAMxO,EAAKyO,WAAWlB,KACtBlM,KAAMrB,EAAKqB,OAAOkM,KAClBmB,OAAQzO,EAAIvO,OAAO,SAIvBuO,EAAI8L,OAAS,CACX2C,OAAQzO,EAAIvO,OAAO,QAGrBa,EAASsL,iBAAiB,mBAAoB,WACxCoC,EAAI8L,OAAO/L,MACbC,EAAI+L,YACL,GAGH/L,EAAI0O,MAAQ,CAEVC,cAAkB,qDAGlBC,IAAkB,4CAGlBC,IAAkB,2BAGlBC,UAAkB,mBAGlBC,WAAkB,aAGlBC,WAAkB,MAGlBC,MAAkB,oBAGlBC,MAAkB,SAGlBC,MAAkB,gBAGlBC,QAAkB,WAGlBC,SAAkB,0CAGlBC,UAAkB,eAGlBC,QAAkB,wCAGlBC,UAAkB,SAKlBC,OAAkB,aAGlBC,YAAkB,iBAGlBC,aAAkB,gBAGlBC,gBAAkB,0DAGlBC,KAAkB,OAGpB7P,EAAI8P,MAAQ,CAEVjZ,IAAK,SAASkZ,EAAOC,GACnB,IAAI7f,EACA8f,EAAKF,EAAMnb,OACX1B,EAAS,GAEb,IAAK/C,EAAI,EAAGA,EAAI8f,EAAI9f,IAClB+C,EAAOsF,KAAKwX,EAAMD,EAAM5f,KAE1B,OAAO+C,GAITgd,OAAQ,SAASH,EAAOC,GACtB,IAAI7f,EACA8f,EAAKF,EAAMnb,OACX1B,EAAS,GAEb,IAAK/C,EAAI,EAAGA,EAAI8f,EAAI9f,IACd6f,EAAMD,EAAM5f,KACd+C,EAAOsF,KAAKuX,EAAM5f,IAEtB,OAAO+C,GAITid,QAAS,SAAS1f,GAChB,OAAOA,EAAI,IAAMyV,KAAKkK,GAAK,KAI7BC,QAAS,SAASpf,GAChB,OAAW,IAAJA,EAAUiV,KAAKkK,GAAK,KAG7BE,kBAAmB,SAASC,GAC1B,OAAOjd,KAAK4c,OAAQK,EAAO,SAAS1F,GAAM,OAAOA,aAActN,EAAOkQ,eAK1EzN,EAAI1L,SAAW,CAEbkc,MAAO,CAEL,eAAoB,EACpB,iBAAoB,EACpB,eAAoB,EACpB,kBAAoB,QACpB,iBAAoB,OACpBC,KAAoB,UACpBC,OAAoB,UACpBC,QAAoB,EAEpB9V,EAAoB,EACpBoG,EAAoB,EACpB0B,GAAoB,EACpBC,GAAoB,EAEpBjC,MAAoB,EACpBD,OAAoB,EAEpBzP,EAAoB,EACpB2f,GAAoB,EACpBC,GAAoB,EAEpB5Z,OAAoB,EACpB,eAAoB,EACpB,aAAoB,UAEpB,YAAoB,GACpB,cAAoB,+BACpB,cAAoB,UAKxB+I,EAAI8Q,MAAQ,SAAS1J,GACnB,IAAI2J,EAm+JWnC,EAh+Jftb,KAAKrC,EAAI,EACTqC,KAAK0d,EAAI,EACT1d,KAAKgC,EAAI,EAEL8R,IAGiB,iBAAVA,EACLpH,EAAI0O,MAAMQ,MAAM+B,KAAK7J,IAEvB2J,EAAQ/Q,EAAI0O,MAAMG,IAAIqC,KAAK9J,EAAMvU,QAAQmN,EAAI0O,MAAMM,WAAW,KAG9D1b,KAAKrC,EAAIkgB,SAASJ,EAAM,IACxBzd,KAAK0d,EAAIG,SAASJ,EAAM,IACxBzd,KAAKgC,EAAI6b,SAASJ,EAAM,KAEf/Q,EAAI0O,MAAMO,MAAMgC,KAAK7J,KAE9B2J,EAAQ/Q,EAAI0O,MAAME,IAAIsC,KA88JL,IADNtC,EA78JwBxH,GA88J5BxS,OACT,CAAE,IACAga,EAAIlR,UAAU,EAAG,GAAIkR,EAAIlR,UAAU,EAAG,GACtCkR,EAAIlR,UAAU,EAAG,GAAIkR,EAAIlR,UAAU,EAAG,GACtCkR,EAAIlR,UAAU,EAAG,GAAIkR,EAAIlR,UAAU,EAAG,IACtC3F,KAAK,IAAM6W,GAh9JXtb,KAAKrC,EAAIkgB,SAASJ,EAAM,GAAI,IAC5Bzd,KAAK0d,EAAIG,SAASJ,EAAM,GAAI,IAC5Bzd,KAAKgC,EAAI6b,SAASJ,EAAM,GAAI,KAIJ,iBAAV3J,IAChB9T,KAAKrC,EAAImW,EAAMnW,EACfqC,KAAK0d,EAAI5J,EAAM4J,EACf1d,KAAKgC,EAAI8R,EAAM9R,KAMnB0K,EAAIwM,OAAOxM,EAAI8Q,MAAO,CAEpBM,SAAU,WACR,OAAO9d,KAAK+d,SAGdA,MAAO,WACL,MAAO,IACHC,EAAUhe,KAAKrC,GACfqgB,EAAUhe,KAAK0d,GACfM,EAAUhe,KAAKgC,IAGrBic,MAAO,WACL,MAAO,OAAS,CAACje,KAAKrC,EAAGqC,KAAK0d,EAAG1d,KAAKgC,GAAGyC,OAAS,KAGpDyZ,WAAY,WACV,OAAQle,KAAKrC,EAAI,IAAM,GACfqC,KAAK0d,EAAI,IAAM,IACf1d,KAAKgC,EAAI,IAAM,KAGzBmc,MAAO,SAASrK,GAGd,OAFA9T,KAAKoe,YAAc,IAAI1R,EAAI8Q,MAAM1J,GAE1B9T,MAGTqe,GAAI,SAASC,GAEX,OAAKte,KAAKoe,aAGVE,EAAMA,EAAM,EAAI,EAAIA,EAAM,EAAI,EAAIA,EAG3B,IAAI5R,EAAI8Q,MAAM,CACnB7f,KAAMqC,KAAKrC,GAAKqC,KAAKoe,YAAYzgB,EAAIqC,KAAKrC,GAAK2gB,GAC/CZ,KAAM1d,KAAK0d,GAAK1d,KAAKoe,YAAYV,EAAI1d,KAAK0d,GAAKY,GAC/Ctc,KAAMhC,KAAKgC,GAAKhC,KAAKoe,YAAYpc,EAAIhC,KAAKgC,GAAKsc,MATnBte,QAkBlC0M,EAAI8Q,MAAMG,KAAO,SAAS7J,GAExB,OADAA,GAAS,GACFpH,EAAI0O,MAAMO,MAAMgC,KAAK7J,IACrBpH,EAAI0O,MAAMQ,MAAM+B,KAAK7J,IAI9BpH,EAAI8Q,MAAM5B,MAAQ,SAAS9H,GACzB,OAAOA,GAA2B,iBAAXA,EAAMnW,GACK,iBAAXmW,EAAM4J,GACK,iBAAX5J,EAAM9R,GAI/B0K,EAAI8Q,MAAMe,QAAU,SAASzK,GAC3B,OAAOpH,EAAI8Q,MAAM5B,MAAM9H,IAAUpH,EAAI8Q,MAAMG,KAAK7J,IAGlDpH,EAAI9H,MAAQ,SAAS6X,EAAO+B,GAIN,IAHpB/B,GAASA,GAAS,IAAIgC,WAGZnd,QAAekd,IACvB/B,EAAQ+B,EAASC,WAGnBze,KAAKlC,MAAQkC,KAAK4a,MAAM6B,IAG1B/P,EAAIwM,OAAOxM,EAAI9H,MAAO,CAEpBuZ,MAAO,SAAS1B,GAId,GAHAzc,KAAKoe,YAAcpe,KAAK4a,MAAM6B,GAG1Bzc,KAAKlC,MAAMwD,QAAUtB,KAAKoe,YAAY9c,OAAQ,CAIhD,IAHA,IAAIod,EAAkB1e,KAAKlC,MAAMkC,KAAKlC,MAAMwD,OAAS,GACjDqd,EAAkB3e,KAAKoe,YAAYpe,KAAKoe,YAAY9c,OAAS,GAE3DtB,KAAKlC,MAAMwD,OAAStB,KAAKoe,YAAY9c,QACzCtB,KAAKoe,YAAYlZ,KAAKyZ,GACxB,KAAM3e,KAAKlC,MAAMwD,OAAStB,KAAKoe,YAAY9c,QACzCtB,KAAKlC,MAAMoH,KAAKwZ,GAGpB,OAAO1e,MAGT4e,OAAQ,WAEN,IAAK,IAAI/hB,EAAI,EAAG8f,EAAK3c,KAAKlC,MAAMwD,OAAQud,EAAO,GAAIhiB,EAAI8f,EAAI9f,KACrB,GAAhCgiB,EAAK5c,QAAQjC,KAAKlC,MAAMjB,KAC1BgiB,EAAK3Z,KAAKlF,KAAKlC,MAAMjB,IAGzB,OAAOmD,KAAKlC,MAAQ+gB,GAGtBR,GAAI,SAASC,GAEX,IAAKte,KAAKoe,YAAa,OAAOpe,KAG9B,IAAK,IAAInD,EAAI,EAAG8f,EAAK3c,KAAKlC,MAAMwD,OAAQmb,EAAQ,GAAI5f,EAAI8f,EAAI9f,IAC1D4f,EAAMvX,KAAKlF,KAAKlC,MAAMjB,IAAMmD,KAAKoe,YAAYvhB,GAAKmD,KAAKlC,MAAMjB,IAAMyhB,GAErE,OAAO,IAAI5R,EAAI9H,MAAM6X,IAGvBqB,SAAU,WACR,OAAO9d,KAAKlC,MAAM2G,KAAK,MAGzBga,QAAS,WACP,OAAOze,KAAKlC,OAGd8c,MAAO,SAAS6B,GAId,OAHAA,EAAQA,EAAMgC,UAGV7Z,MAAMka,QAAQrC,GAAeA,EAE1Bzc,KAAKoE,MAAMqY,IAGpBrY,MAAO,SAAShD,GACd,OAAOA,EAAO2d,OAAO3a,MAAMsI,EAAI0O,MAAMc,WAAW3Y,IAAIyb,aAGtDC,QAAS,WAGP,OAFAjf,KAAKlC,MAAMmhB,UAEJjf,MAETkf,MAAO,WACL,IAAIA,EAAQ,IAAIlf,KAAK2Z,YAErB,OADAuF,EAAMphB,MAwwJV,SAASqhB,EAAYC,GAEnB,IADA,IAAIF,EAAQE,EAAIhG,MAAM,GACdvc,EAAIqiB,EAAM5d,OAAQzE,KACrB+H,MAAMka,QAAQI,EAAMriB,MACrBqiB,EAAMriB,GAAKsiB,EAAYD,EAAMriB,KAGjC,OAAOqiB,EA/wJSC,CAAYnf,KAAKlC,OACxBohB,KAIXxS,EAAI2S,WAAa,SAAS5C,EAAO+B,GAC/B9R,EAAI9H,MAAM5H,KAAKgD,KAAMyc,EAAO+B,GAAY,CAAC,CAAC,EAAE,MAI9C9R,EAAI2S,WAAW5gB,UAAY,IAAIiO,EAAI9H,MACnC8H,EAAI2S,WAAW5gB,UAAUkb,YAAcjN,EAAI2S,WAE3C3S,EAAIwM,OAAOxM,EAAI2S,WAAY,CAEzBvB,SAAU,WAER,IAAK,IAAIjhB,EAAI,EAAG8f,EAAK3c,KAAKlC,MAAMwD,OAAQmb,EAAQ,GAAI5f,EAAI8f,EAAI9f,IAC1D4f,EAAMvX,KAAKlF,KAAKlC,MAAMjB,GAAG4H,KAAK,MAEhC,OAAOgY,EAAMhY,KAAK,MAGpB6a,OAAQ,WACN,MAAO,CACLC,GAAIvf,KAAKlC,MAAM,GAAG,GAClB0hB,GAAIxf,KAAKlC,MAAM,GAAG,GAClBkT,GAAIhR,KAAKlC,MAAM,GAAG,GAClBwS,GAAItQ,KAAKlC,MAAM,GAAG,KAItBugB,GAAI,SAASC,GAEX,IAAKte,KAAKoe,YAAa,OAAOpe,KAG9B,IAAK,IAAInD,EAAI,EAAG8f,EAAK3c,KAAKlC,MAAMwD,OAAQmb,EAAQ,GAAI5f,EAAI8f,EAAI9f,IAC1D4f,EAAMvX,KAAK,CACTlF,KAAKlC,MAAMjB,GAAG,IAAMmD,KAAKoe,YAAYvhB,GAAG,GAAKmD,KAAKlC,MAAMjB,GAAG,IAAMyhB,EACjEte,KAAKlC,MAAMjB,GAAG,IAAMmD,KAAKoe,YAAYvhB,GAAG,GAAKmD,KAAKlC,MAAMjB,GAAG,IAAMyhB,IAGrE,OAAO,IAAI5R,EAAI2S,WAAW5C,IAG5B7B,MAAO,SAAS6B,GACd,IAAIgD,EAAS,GAKb,GAHAhD,EAAQA,EAAMgC,UAGV7Z,MAAMka,QAAQrC,GAAQ,CAExB,GAAG7X,MAAMka,QAAQrC,EAAM,IAErB,OAAOA,EAAMlZ,IAAI,SAAUgU,GAAM,OAAOA,EAAG6B,UACtC,GAAkB,MAAdqD,EAAM,GAAGlV,EAElB,OAAOkV,EAAMlZ,IAAI,SAAUgU,GAAM,MAAO,CAACA,EAAGhQ,EAAGgQ,EAAG5J,UAIpD8O,EAAQA,EAAMsC,OAAO3a,MAAMsI,EAAI0O,MAAMc,WAAW3Y,IAAIyb,YAKlDvC,EAAMnb,OAAS,GAAM,GAAGmb,EAAMnD,MAGlC,IAAI,IAAIzc,EAAI,EAAGsF,EAAMsa,EAAMnb,OAAQzE,EAAIsF,EAAKtF,GAAQ,EAClD4iB,EAAOva,KAAK,CAAEuX,EAAM5f,GAAI4f,EAAM5f,EAAE,KAElC,OAAO4iB,GAGTC,KAAM,SAASnY,EAAGoG,GAChB,IAAIgS,EAAM3f,KAAK4f,OAOf,GAJArY,GAAKoY,EAAIpY,EACToG,GAAKgS,EAAIhS,GAGJkS,MAAMtY,KAAOsY,MAAMlS,GACtB,IAAK,IAAI9Q,EAAImD,KAAKlC,MAAMwD,OAAS,EAAGzE,GAAK,EAAGA,IAC1CmD,KAAKlC,MAAMjB,GAAK,CAACmD,KAAKlC,MAAMjB,GAAG,GAAK0K,EAAGvH,KAAKlC,MAAMjB,GAAG,GAAK8Q,GAE9D,OAAO3N,MAGT2M,KAAM,SAASU,EAAOD,GACpB,IAAIvQ,EAAG8iB,EAAM3f,KAAK4f,OAGlB,IAAK/iB,EAAImD,KAAKlC,MAAMwD,OAAS,EAAGzE,GAAK,EAAGA,IACnC8iB,EAAItS,QAAOrN,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIpY,GAAK8F,EAAUsS,EAAItS,MAASsS,EAAIpY,GACvFoY,EAAIvS,SAAQpN,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIhS,GAAKP,EAAUuS,EAAIvS,OAASuS,EAAIhS,GAG7F,OAAO3N,MAGT4f,KAAM,WAGJ,OAFAlT,EAAI8L,OAAOyC,KAAKxb,aAAa,SAAUO,KAAK8d,YAErCpR,EAAI8L,OAAOyC,KAAK6E,aA0D3B,IAtDA,IAAIC,EAAe,CACjB9R,EAAG,SAAS/Q,EAAGyB,EAAGqhB,GAIhB,OAHArhB,EAAE4I,EAAIyY,EAAGzY,EAAIrK,EAAE,GACfyB,EAAEgP,EAAIqS,EAAGrS,EAAIzQ,EAAE,GAER,CAAC,IAAKyB,EAAE4I,EAAG5I,EAAEgP,IAEtBO,EAAG,SAAShR,EAAGyB,GAGb,OAFAA,EAAE4I,EAAIrK,EAAE,GACRyB,EAAEgP,EAAIzQ,EAAE,GACD,CAAC,IAAKA,EAAE,GAAIA,EAAE,KAEvB0U,EAAG,SAAS1U,EAAGyB,GAEb,OADAA,EAAE4I,EAAIrK,EAAE,GACD,CAAC,IAAKA,EAAE,KAEjByT,EAAG,SAASzT,EAAGyB,GAEb,OADAA,EAAEgP,EAAIzQ,EAAE,GACD,CAAC,IAAKA,EAAE,KAEjB0T,EAAG,SAAS1T,EAAGyB,GAGb,OAFAA,EAAE4I,EAAIrK,EAAE,GACRyB,EAAEgP,EAAIzQ,EAAE,GACD,CAAC,IAAKA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAE/C+iB,EAAG,SAAS/iB,EAAGyB,GAGb,OAFAA,EAAE4I,EAAIrK,EAAE,GACRyB,EAAEgP,EAAIzQ,EAAE,GACD,CAAC,IAAKA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAEnCgjB,EAAG,SAAShjB,EAAGyB,GAGb,OAFAA,EAAE4I,EAAIrK,EAAE,GACRyB,EAAEgP,EAAIzQ,EAAE,GACD,CAAC,IAAKA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAEnCijB,EAAG,SAASjjB,EAAGyB,GAGb,OAFAA,EAAE4I,EAAIrK,EAAE,GACRyB,EAAEgP,EAAIzQ,EAAE,GACD,CAAC,IAAKA,EAAE,GAAIA,EAAE,KAEvBkjB,EAAG,SAASljB,EAAGyB,EAAGqhB,GAGhB,OAFArhB,EAAE4I,EAAIyY,EAAGzY,EACT5I,EAAEgP,EAAIqS,EAAGrS,EACF,CAAC,MAEV0S,EAAG,SAASnjB,EAAGyB,GAGb,OAFAA,EAAE4I,EAAIrK,EAAE,GACRyB,EAAEgP,EAAIzQ,EAAE,GACD,CAAC,IAAKA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,MAInDojB,EAAY,aAAalc,MAAM,IAE3BvH,EAAI,EAAG8f,EAAK2D,EAAUhf,OAAQzE,EAAI8f,IAAM9f,EAC9CkjB,EAAaO,EAAUzjB,IAAM,SAAUA,GACrC,OAAO,SAASK,EAAGyB,EAAGqhB,GACpB,GAAQ,KAALnjB,EAAUK,EAAE,GAAKA,EAAE,GAAKyB,EAAE4I,OACxB,GAAQ,KAAL1K,EAAUK,EAAE,GAAKA,EAAE,GAAKyB,EAAEgP,OAC7B,GAAQ,KAAL9Q,EACNK,EAAE,GAAKA,EAAE,GAAKyB,EAAE4I,EAChBrK,EAAE,GAAKA,EAAE,GAAKyB,EAAEgP,OAGhB,IAAI,IAAIpJ,EAAI,EAAGgc,EAAKrjB,EAAEoE,OAAQiD,EAAIgc,IAAMhc,EACtCrH,EAAEqH,GAAKrH,EAAEqH,IAAMA,EAAE,EAAI5F,EAAEgP,EAAIhP,EAAE4I,GAGjC,OAAOwY,EAAaljB,GAAGK,EAAGyB,EAAGqhB,IAbJ,CAe1BM,EAAUzjB,GAAGwE,eAIlBqL,EAAI8T,UAAY,SAAS/D,EAAO+B,GAC9B9R,EAAI9H,MAAM5H,KAAKgD,KAAMyc,EAAO+B,GAAY,CAAC,CAAC,IAAK,EAAG,MAIpD9R,EAAI8T,UAAU/hB,UAAY,IAAIiO,EAAI9H,MAClC8H,EAAI8T,UAAU/hB,UAAUkb,YAAcjN,EAAI8T,UAE1C9T,EAAIwM,OAAOxM,EAAI8T,UAAW,CAExB1C,SAAU,WACR,OAiqJJ,SAAuBne,GACrB,IAAK,IAAI9C,EAAI,EAAG8f,EAAKhd,EAAE2B,OAAQ1C,EAAI,GAAI/B,EAAI8f,EAAI9f,IAC7C+B,GAAKe,EAAE9C,GAAG,GAEK,MAAX8C,EAAE9C,GAAG,KACP+B,GAAKe,EAAE9C,GAAG,GAEK,MAAX8C,EAAE9C,GAAG,KACP+B,GAAK,IACLA,GAAKe,EAAE9C,GAAG,GAEK,MAAX8C,EAAE9C,GAAG,KACP+B,GAAK,IACLA,GAAKe,EAAE9C,GAAG,GACV+B,GAAK,IACLA,GAAKe,EAAE9C,GAAG,GAEK,MAAX8C,EAAE9C,GAAG,KACP+B,GAAK,IACLA,GAAKe,EAAE9C,GAAG,GACV+B,GAAK,IACLA,GAAKe,EAAE9C,GAAG,GAEK,MAAX8C,EAAE9C,GAAG,KACP+B,GAAK,IACLA,GAAKe,EAAE9C,GAAG,QAQtB,OAAO+B,EAAI,IAlsJF6hB,CAAczgB,KAAKlC,QAG5B4hB,KAAM,SAASnY,EAAGoG,GAEhB,IAAIgS,EAAM3f,KAAK4f,OAMf,GAHArY,GAAKoY,EAAIpY,EACToG,GAAKgS,EAAIhS,GAEJkS,MAAMtY,KAAOsY,MAAMlS,GAEtB,IAAK,IAAI7Q,EAAGD,EAAImD,KAAKlC,MAAMwD,OAAS,EAAGzE,GAAK,EAAGA,IAGpC,MAFTC,EAAIkD,KAAKlC,MAAMjB,GAAG,KAEG,KAALC,GAAiB,KAALA,GAC1BkD,KAAKlC,MAAMjB,GAAG,IAAM0K,EACpBvH,KAAKlC,MAAMjB,GAAG,IAAM8Q,GAEN,KAAL7Q,EACTkD,KAAKlC,MAAMjB,GAAG,IAAM0K,EAEN,KAALzK,EACTkD,KAAKlC,MAAMjB,GAAG,IAAM8Q,EAEN,KAAL7Q,GAAiB,KAALA,GAAiB,KAALA,GACjCkD,KAAKlC,MAAMjB,GAAG,IAAM0K,EACpBvH,KAAKlC,MAAMjB,GAAG,IAAM8Q,EACpB3N,KAAKlC,MAAMjB,GAAG,IAAM0K,EACpBvH,KAAKlC,MAAMjB,GAAG,IAAM8Q,EAEX,KAAL7Q,IACFkD,KAAKlC,MAAMjB,GAAG,IAAM0K,EACpBvH,KAAKlC,MAAMjB,GAAG,IAAM8Q,IAGR,KAAL7Q,IACTkD,KAAKlC,MAAMjB,GAAG,IAAM0K,EACpBvH,KAAKlC,MAAMjB,GAAG,IAAM8Q,GAM1B,OAAO3N,MAGT2M,KAAM,SAASU,EAAOD,GAEpB,IAAIvQ,EAAGC,EAAG6iB,EAAM3f,KAAK4f,OAGrB,IAAK/iB,EAAImD,KAAKlC,MAAMwD,OAAS,EAAGzE,GAAK,EAAGA,IAG7B,MAFTC,EAAIkD,KAAKlC,MAAMjB,GAAG,KAEG,KAALC,GAAiB,KAALA,GAC1BkD,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIpY,GAAK8F,EAAUsS,EAAItS,MAASsS,EAAIpY,EAC5EvH,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIhS,GAAKP,EAAUuS,EAAIvS,OAASuS,EAAIhS,GAE9D,KAAL7Q,EACTkD,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIpY,GAAK8F,EAAUsS,EAAItS,MAASsS,EAAIpY,EAE9D,KAALzK,EACTkD,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIhS,GAAKP,EAAUuS,EAAIvS,OAASuS,EAAIhS,EAE9D,KAAL7Q,GAAiB,KAALA,GAAiB,KAALA,GACjCkD,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIpY,GAAK8F,EAAUsS,EAAItS,MAASsS,EAAIpY,EAC5EvH,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIhS,GAAKP,EAAUuS,EAAIvS,OAASuS,EAAIhS,EAC5E3N,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIpY,GAAK8F,EAAUsS,EAAItS,MAASsS,EAAIpY,EAC5EvH,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIhS,GAAKP,EAAUuS,EAAIvS,OAASuS,EAAIhS,EAEnE,KAAL7Q,IACFkD,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIpY,GAAK8F,EAAUsS,EAAItS,MAASsS,EAAIpY,EAC5EvH,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIhS,GAAKP,EAAUuS,EAAIvS,OAASuS,EAAIhS,IAGhE,KAAL7Q,IAETkD,KAAKlC,MAAMjB,GAAG,GAAMmD,KAAKlC,MAAMjB,GAAG,GAAKwQ,EAAUsS,EAAItS,MACrDrN,KAAKlC,MAAMjB,GAAG,GAAMmD,KAAKlC,MAAMjB,GAAG,GAAKuQ,EAAUuS,EAAIvS,OAGrDpN,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIpY,GAAK8F,EAAUsS,EAAItS,MAASsS,EAAIpY,EAC5EvH,KAAKlC,MAAMjB,GAAG,IAAOmD,KAAKlC,MAAMjB,GAAG,GAAK8iB,EAAIhS,GAAKP,EAAUuS,EAAIvS,OAASuS,EAAIhS,GAKhF,OAAO3N,MAGT0gB,cAAe,SAASC,GACtB,IAAI9jB,EAAG8f,EAAI+D,EAKX,IAHAC,EAAY,IAAIjU,EAAI8T,UAAUG,GAE9BD,EAAgB1gB,KAAKlC,MAAMwD,SAAWqf,EAAU7iB,MAAMwD,OAClDzE,EAAI,EAAG8f,EAAK3c,KAAKlC,MAAMwD,OAAQof,GAAiB7jB,EAAI8f,EAAI9f,IAC1D6jB,EAAgB1gB,KAAKlC,MAAMjB,GAAG,KAAO8jB,EAAU7iB,MAAMjB,GAAG,GAG1D,OAAO6jB,GAGTvC,MAAO,SAASwC,GASd,OARAA,EAAY,IAAIjU,EAAI8T,UAAUG,GAE3B3gB,KAAK0gB,cAAcC,GACpB3gB,KAAKoe,YAAcuC,EAEnB3gB,KAAKoe,YAAc,KAGdpe,MAGTqe,GAAI,SAASC,GAEX,IAAKte,KAAKoe,YAAa,OAAOpe,KAE9B,IAGInD,EAAG8f,EAAIpY,EAAGgc,EAHVK,EAAc5gB,KAAKlC,MACnB+iB,EAAmB7gB,KAAKoe,YAAYtgB,MACpC2e,EAAQ,GAAIkE,EAAY,IAAIjU,EAAI8T,UAKpC,IAAK3jB,EAAI,EAAG8f,EAAKiE,EAAYtf,OAAQzE,EAAI8f,EAAI9f,IAAK,CAEhD,IADA4f,EAAM5f,GAAK,CAAC+jB,EAAY/jB,GAAG,IACvB0H,EAAI,EAAGgc,EAAKK,EAAY/jB,GAAGyE,OAAQiD,EAAIgc,EAAIhc,IAC7CkY,EAAM5f,GAAG0H,GAAKqc,EAAY/jB,GAAG0H,IAAMsc,EAAiBhkB,GAAG0H,GAAKqc,EAAY/jB,GAAG0H,IAAM+Z,EAOhE,MAAhB7B,EAAM5f,GAAG,KACV4f,EAAM5f,GAAG,KAAsB,GAAf4f,EAAM5f,GAAG,IACzB4f,EAAM5f,GAAG,KAAsB,GAAf4f,EAAM5f,GAAG,KAM7B,OADA8jB,EAAU7iB,MAAQ2e,EACXkE,GAGT/F,MAAO,SAAS6B,GAEd,GAAIA,aAAiB/P,EAAI8T,UAAW,OAAO/D,EAAMgC,UAGjD,IAAe7f,EAGXkiB,EAAW,CAAE,EAAI,EAAG,EAAI,EAAG,EAAI,EAAG,EAAI,EAAG,EAAI,EAAG,EAAI,EAAG,EAAI,EAAG,EAAI,EAAG,EAAI,EAAG,EAAI,GAIlFrE,EAFiB,iBAATA,EAEAA,EACLld,QAAQmN,EAAI0O,MAAMkB,gBAAiByE,GACnCxhB,QAAQmN,EAAI0O,MAAMgB,YAAa,QAC/B7c,QAAQmN,EAAI0O,MAAMe,OAAQ,QAC1B4C,OACA3a,MAAMsI,EAAI0O,MAAMc,WAGXO,EAAMuE,OAAO,SAASC,EAAMC,GAClC,MAAO,GAAGC,OAAOnkB,KAAKikB,EAAMC,IAC3B,IAIL,IAAI9B,EAAM,GACNzgB,EAAI,IAAI+N,EAAI0U,MACZpB,EAAK,IAAItT,EAAI0U,MACbxf,EAAQ,EACRO,EAAMsa,EAAMnb,OAEhB,GAEKoL,EAAI0O,MAAMiB,aAAasB,KAAKlB,EAAM7a,KACnChD,EAAI6d,EAAM7a,KACRA,GAEU,KAALhD,EACPA,EAAI,IACQ,KAALA,IACPA,EAAI,KAGNwgB,EAAIla,KAAK6a,EAAanhB,GAAG5B,KAAK,KAC1Byf,EAAMrD,MAAMxX,EAAQA,GAAgBkf,EAASliB,EAAEyC,gBAAiBkC,IAAIyb,YACpErgB,EAAGqhB,UAIF7d,EAAMP,GAEb,OAAOwd,GAITQ,KAAM,WAGJ,OAFAlT,EAAI8L,OAAO1K,KAAKrO,aAAa,IAAKO,KAAK8d,YAEhCpR,EAAI8L,OAAO1K,KAAKgS,aAM3BpT,EAAI2U,OAAS3U,EAAI8M,OAAO,CAEtBrb,OAAQ,SAASL,EAAOwjB,GAEtBthB,KAAKlC,MAAQ,EACbkC,KAAKshB,KAAQA,GAAQ,GAGA,iBAAVxjB,EAETkC,KAAKlC,MAAQ+hB,MAAM/hB,GAAS,EAAKyjB,SAASzjB,GAA6CA,EAAnCA,EAAQ,GAAK,MAAU,MAEjD,iBAAVA,GAChBwjB,EAAOxjB,EAAM2f,MAAM/Q,EAAI0O,MAAMC,kBAI3Brb,KAAKlC,MAAQkhB,WAAWsC,EAAK,IAGd,KAAXA,EAAK,GACPthB,KAAKlC,OAAS,IACI,KAAXwjB,EAAK,KACZthB,KAAKlC,OAAS,KAGhBkC,KAAKshB,KAAOA,EAAK,IAIfxjB,aAAiB4O,EAAI2U,SACvBrhB,KAAKlC,MAAQA,EAAM2gB,UACnBze,KAAKshB,KAAQxjB,EAAMwjB,OAMzBpI,OAAQ,CAEN4E,SAAU,WACR,OACe,KAAb9d,KAAKshB,QACa,IAAbthB,KAAKlC,OAAe,IACZ,KAAbkC,KAAKshB,KACHthB,KAAKlC,MAAQ,IACbkC,KAAKlC,OACLkC,KAAKshB,MAEXE,OAAQ,WACN,OAAOxhB,KAAK8d,YAGdW,QAAS,WACP,OAAOze,KAAKlC,OAGd2jB,KAAM,SAASC,GAEb,OADAA,EAAS,IAAIhV,EAAI2U,OAAOK,GACjB,IAAIhV,EAAI2U,OAAOrhB,KAAO0hB,EAAQ1hB,KAAKshB,MAAQI,EAAOJ,OAG3DK,MAAO,SAASD,GAEd,OADAA,EAAS,IAAIhV,EAAI2U,OAAOK,GACjB,IAAIhV,EAAI2U,OAAOrhB,KAAO0hB,EAAQ1hB,KAAKshB,MAAQI,EAAOJ,OAG3DM,MAAO,SAASF,GAEd,OADAA,EAAS,IAAIhV,EAAI2U,OAAOK,GACjB,IAAIhV,EAAI2U,OAAOrhB,KAAO0hB,EAAQ1hB,KAAKshB,MAAQI,EAAOJ,OAG3DO,OAAQ,SAASH,GAEf,OADAA,EAAS,IAAIhV,EAAI2U,OAAOK,GACjB,IAAIhV,EAAI2U,OAAOrhB,KAAO0hB,EAAQ1hB,KAAKshB,MAAQI,EAAOJ,OAG3DQ,GAAI,SAASR,GACX,IAAII,EAAS,IAAIhV,EAAI2U,OAAOrhB,MAK5B,MAHoB,iBAATshB,IACTI,EAAOJ,KAAOA,GAETI,GAGTvD,MAAO,SAASuD,GAOd,OANA1hB,KAAKoe,YAAc,IAAI1R,EAAI2U,OAAOK,GAE/BA,EAAOK,WACR/hB,KAAKoe,YAAYtgB,OAASkC,KAAKlC,OAG1BkC,MAGTqe,GAAI,SAASC,GAEX,OAAKte,KAAKoe,YAGH,IAAI1R,EAAI2U,OAAOrhB,KAAKoe,aACtBuD,MAAM3hB,MACN4hB,MAAMtD,GACNmD,KAAKzhB,MANoBA,SAapC0M,EAAI4N,QAAU5N,EAAI8M,OAAO,CAEvBrb,OAAQ,SAAS6b,GAEfha,KAAKgiB,QAAUtV,EAAI1L,SAASkc,MAAME,OAClCpd,KAAKiiB,OAAS,KACdjiB,KAAKkiB,QAAU,GAGfliB,KAAKmiB,IAAM,IAGPniB,KAAKga,KAAOA,KACdha,KAAKua,KAAOP,EAAKnD,SACjB7W,KAAKga,KAAKC,SAAWja,KACrBA,KAAKkiB,QAAUlI,EAAKkI,SAAW,GAG/BliB,KAAKgiB,QAAUhI,EAAK1a,aAAa,WAAaU,KAAKgiB,UAKvD9I,OAAQ,CAEN3R,EAAG,SAASA,GACV,OAAOvH,KAAK0N,KAAK,IAAKnG,IAGxBoG,EAAG,SAASA,GACV,OAAO3N,KAAK0N,KAAK,IAAKC,IAGxB0B,GAAI,SAAS9H,GACX,OAAY,MAALA,EAAYvH,KAAKuH,IAAMvH,KAAKqN,QAAU,EAAIrN,KAAKuH,EAAEA,EAAIvH,KAAKqN,QAAU,IAG7EiC,GAAI,SAAS3B,GACX,OAAY,MAALA,EAAY3N,KAAK2N,IAAM3N,KAAKoN,SAAW,EAAIpN,KAAK2N,EAAEA,EAAI3N,KAAKoN,SAAW,IAG/EsS,KAAM,SAASnY,EAAGoG,GAChB,OAAO3N,KAAKuH,EAAEA,GAAGoG,EAAEA,IAGrByB,OAAQ,SAAS7H,EAAGoG,GAClB,OAAO3N,KAAKqP,GAAG9H,GAAG+H,GAAG3B,IAGvBN,MAAO,SAASA,GACd,OAAOrN,KAAK0N,KAAK,QAASL,IAG5BD,OAAQ,SAASA,GACf,OAAOpN,KAAK0N,KAAK,SAAUN,IAG7BT,KAAM,SAASU,EAAOD,GACpB,IAAIzO,EAAIyjB,EAAiBpiB,KAAMqN,EAAOD,GAEtC,OAAOpN,KACJqN,MAAM,IAAIX,EAAI2U,OAAO1iB,EAAE0O,QACvBD,OAAO,IAAIV,EAAI2U,OAAO1iB,EAAEyO,UAG7B8R,MAAO,SAASrF,GAEd7Z,KAAKqiB,iBAGL,IAAInD,EAAQoD,EAAYtiB,KAAKga,KAAKuI,WAAU,IAM5C,OAHG1I,EAAQA,EAAOjW,IAAIsb,GACjBlf,KAAKwiB,MAAMtD,GAETA,GAGT5V,OAAQ,WAIN,OAHItJ,KAAK6Z,UACP7Z,KAAK6Z,SAAS4I,cAAcziB,MAEvBA,MAGTT,QAAS,SAASR,GAGhB,OAFAiB,KAAKwiB,MAAMzjB,GAASuK,SAEbvK,GAGT2jB,MAAO,SAAS7I,GACd,OAAOA,EAAO8I,IAAI3iB,OAGpB4iB,MAAO,SAAS/I,GACd,OAAOA,EAAOjW,IAAI5D,OAGpBlB,GAAI,SAASA,GACX,OAAOkB,KAAK0N,KAAK,KAAM5O,IAGzB+jB,OAAQ,SAAStb,EAAGoG,GAClB,IAAIgS,EAAM3f,KAAK4f,OAEf,OAAOrY,EAAIoY,EAAIpY,GACRoG,EAAIgS,EAAIhS,GACRpG,EAAIoY,EAAIpY,EAAIoY,EAAItS,OAChBM,EAAIgS,EAAIhS,EAAIgS,EAAIvS,QAGzB0V,KAAM,WACJ,OAAO9iB,KAAK+X,MAAM,UAAW,KAG/BgL,KAAM,WACJ,OAAO/iB,KAAK+X,MAAM,UAAW,SAG/BiL,QAAS,WACP,MAAgC,QAAzBhjB,KAAK+X,MAAM,YAGpB+F,SAAU,WACR,OAAO9d,KAAK0N,KAAK,OAGnBuV,QAAS,WACP,IAAIvV,EAAO1N,KAAK0N,KAAK,SAErB,OAAe,MAARA,EAAe,GAAKA,EAAKqR,OAAO3a,MAAMsI,EAAI0O,MAAMc,YAGzDgH,SAAU,SAAS9lB,GACjB,OAAwC,GAAjC4C,KAAKijB,UAAUhhB,QAAQ7E,IAGhCyQ,SAAU,SAASzQ,GACjB,IAAK4C,KAAKkjB,SAAS9lB,GAAO,CACxB,IAAIqf,EAAQzc,KAAKijB,UACjBxG,EAAMvX,KAAK9H,GACX4C,KAAK0N,KAAK,QAAS+O,EAAMhY,KAAK,MAGhC,OAAOzE,MAGTmjB,YAAa,SAAS/lB,GAOpB,OANI4C,KAAKkjB,SAAS9lB,IAChB4C,KAAK0N,KAAK,QAAS1N,KAAKijB,UAAUrG,OAAO,SAAS1f,GAChD,OAAOA,GAAKE,IACXqH,KAAK,MAGHzE,MAGTojB,YAAa,SAAShmB,GACpB,OAAO4C,KAAKkjB,SAAS9lB,GAAQ4C,KAAKmjB,YAAY/lB,GAAQ4C,KAAK6N,SAASzQ,IAGtEoe,UAAW,SAAS9N,GAClB,OAAOhB,EAAIhP,IAAIsC,KAAK0N,KAAKA,KAG3BmM,OAAQ,SAASU,GACf,IAAIV,EAAS7Z,KAGb,IAAI6Z,EAAOG,KAAKE,WAAY,OAAO,KAKnC,GAFAL,EAASnN,EAAIqN,MAAMF,EAAOG,KAAKE,aAE3BK,EAAM,OAAOV,EAGjB,KAAMA,GAAUA,EAAOG,gBAAgB/P,EAAOkQ,YAAW,CACvD,GAAmB,iBAATI,EAAoBV,EAAOwJ,QAAQ9I,GAAQV,aAAkBU,EAAM,OAAOV,EACpF,IAAIA,EAAOG,KAAKE,YAAiD,aAAnCL,EAAOG,KAAKE,WAAWrD,UAA8D,sBAAnCgD,EAAOG,KAAKE,WAAWrD,SAAkC,OAAO,KAChJgD,EAASnN,EAAIqN,MAAMF,EAAOG,KAAKE,cAInCoJ,IAAK,WACH,OAAOtjB,gBAAgB0M,EAAI6L,IAAMvY,KAAOA,KAAK6Z,OAAOnN,EAAI6L,MAG1DgL,QAAS,SAAShJ,GAChB,IAAIgJ,EAAU,GAAI1J,EAAS7Z,KAE3B,EAAE,CAEA,KADA6Z,EAASA,EAAOA,OAAOU,MACRV,EAAOG,KAAM,MAE5BuJ,EAAQre,KAAK2U,SACPA,EAAOA,QAEf,OAAO0J,GAGTF,QAAS,SAASG,GAChB,OAmkIN,SAAiBjM,EAAIiM,GACnB,OAAQjM,EAAG8L,SAAW9L,EAAGkM,iBAAmBlM,EAAGmM,mBAAqBnM,EAAGoM,oBAAsBpM,EAAGqM,uBAAyBrM,EAAGsM,kBAAkB7mB,KAAKua,EAAIiM,GApkI5IH,CAAQrjB,KAAKga,KAAMwJ,IAG5BrI,OAAQ,WACN,OAAOnb,KAAKga,MAGdxN,IAAK,SAASA,GAEZ,IAAIsX,EAAO9kB,EAAS+kB,cAAc,OAGlC,KAAIvX,GAAOxM,gBAAgB0M,EAAIsX,QAoB7B,OATAF,EAAKG,YAAYzX,EAAMxN,EAAS+kB,cAAc,QAG9C/jB,KAAKqiB,iBAGL7V,EAAIyX,YAAYjkB,KAAKga,KAAKuI,WAAU,IAG7BuB,EAAKI,UAAU3kB,QAAQ,SAAU,IAAIA,QAAQ,WAAY,IAlBhEukB,EAAKI,UAAY,QAAU1X,EAAIjN,QAAQ,KAAM,IAAIA,QAAQ,yBAA0B,eAAiB,SAGpG,IAAK,IAAI1C,EAAI,EAAG8f,EAAKmH,EAAKK,WAAWC,WAAW9iB,OAAQzE,EAAI8f,EAAI9f,IAC9DmD,KAAKga,KAAKiK,YAAYH,EAAKK,WAAWA,YAiB1C,OAAOnkB,MAGTqiB,eAAgB,WAgBd,OAbGriB,KAAKyN,MAAQzN,KAAKqkB,SACVrkB,KAAKyN,KAAOzN,KAAOA,KAAKqkB,SAC9B5W,KAAK,WACNzN,KAAKqiB,mBAKTriB,KAAKga,KAAKsK,gBAAgB,cAEvB/mB,OAAOqR,KAAK5O,KAAKmiB,KAAK7gB,QACvBtB,KAAKga,KAAKva,aAAa,aAAckb,KAAK4J,UAAUvkB,KAAKmiB,MAEpDniB,MAGT0a,QAAS,SAASpd,GAEhB,OADA0C,KAAKmiB,IAAM7kB,EACJ0C,MAETwkB,GAAI,SAASC,GACX,OAggIN,SAAYlN,EAAIkN,GACd,OAAOlN,aAAckN,EAjgIVD,CAAGxkB,KAAMykB,OAKtB/X,EAAIgY,OAAS,CACX,IAAK,SAASpG,GAAK,OAAOA,GAC1B,KAAK,SAASA,GAAK,OAAQ1L,KAAK+R,IAAIrG,EAAM1L,KAAKkK,IAAM,EAAI,IACzD,IAAK,SAASwB,GAAK,OAAQ1L,KAAKgS,IAAItG,EAAM1L,KAAKkK,GAAK,IACpD,IAAK,SAASwB,GAAK,OAAsC,EAA9B1L,KAAK+R,IAAIrG,EAAM1L,KAAKkK,GAAK,KAGtDpQ,EAAIyR,MAAQ,SAASG,GACnB,OAAO,SAASuG,EAAM/C,GACpB,OAAO,IAAIpV,EAAIoY,SAASD,EAAM/C,GAAIzD,GAAGC,KAIzC5R,EAAIqY,UAAYrY,EAAI8M,OAAO,CAEzBrb,OAAQ,SAASb,GACf0C,KAAKglB,MAAO,EACZhlB,KAAKilB,UAAW,EAChBjlB,KAAKklB,WAAY,EAEjBllB,KAAKmlB,SAAW,IAAIzY,EAAI2U,OAAO/jB,EAAE6nB,UAAU1G,UAC3Cze,KAAKolB,MAAQ,IAAI1Y,EAAI2U,OAAO/jB,EAAE8nB,OAAO3G,UAErCze,KAAKoR,OAAS,IAAIiU,KAASrlB,KAAKolB,MAChCplB,KAAKslB,OAAStlB,KAAKoR,MAAQpR,KAAKmlB,SAChCnlB,KAAKulB,KAAOjoB,EAAEioB,KAIdvlB,KAAKwlB,KAAO,EACZxlB,KAAKylB,OAAQ,EAEbzlB,KAAK0lB,WAAa,GAKlB1lB,KAAKkd,MAAQ,GAKbld,KAAK2lB,OAAS,GAKd3lB,KAAKyb,WAAa,GAKlBzb,KAAK4lB,KAAO,MAUhBlZ,EAAImZ,GAAKnZ,EAAI8M,OAAO,CAElBrb,OAAQ,SAASY,GACfiB,KAAK8lB,QAAU/mB,EACfiB,KAAK+lB,WAAa,GAClB/lB,KAAKgmB,QAAS,EACdhmB,KAAKimB,UAAY,KACjBjmB,KAAKkmB,QAAS,EACdlmB,KAAKmmB,QAAU,EACfnmB,KAAKse,IAAM,EAGXte,KAAKomB,OAAS,EACdpmB,KAAKqmB,OAAS,GAGhBnN,OAAQ,CASNoN,QAAS,SAAShpB,EAAGioB,EAAMH,GAEV,iBAAL9nB,IACRioB,EAAOjoB,EAAEioB,KACTH,EAAQ9nB,EAAE8nB,MACV9nB,EAAIA,EAAE6nB,UAGR,IAAIc,EAAY,IAAIvZ,EAAIqY,UAAU,CAChCI,SAAU7nB,GAAK,IACf8nB,MAAOA,GAAS,EAChBG,KAAM7Y,EAAIgY,OAAOa,GAAQ,MAAQA,IAKnC,OAFAvlB,KAAKumB,MAAMN,GAEJjmB,MAQTolB,MAAO,SAASA,GAGd,IAAIa,EAAY,IAAIvZ,EAAIqY,UAAU,CAChCI,SAAUC,EACVA,MAAO,EACPG,KAAM7Y,EAAIgY,OAAO,OAGnB,OAAO1kB,KAAKumB,MAAMN,IAQpBhR,OAAQ,SAASA,GACf,OAAGA,GAAUA,aAAkBvI,EAAI4N,SACjCta,KAAK8lB,QAAU7Q,EACRjV,MAGFA,KAAK8lB,SAIdU,aAAc,SAASC,GACrB,OAAQA,EAAYzmB,KAAKimB,UAAU7U,QAAUpR,KAAKimB,UAAUd,SAASnlB,KAAKqmB,SAI5EK,aAAc,SAASN,GACrB,OAAOpmB,KAAKimB,UAAUd,SAASnlB,KAAKqmB,OAASD,EAASpmB,KAAKimB,UAAU7U,OAIvEuV,eAAgB,WACd3mB,KAAK4mB,gBACL5mB,KAAK6mB,eAAiB5c,EAAO6c,sBAAsB,WAAY9mB,KAAKqH,QAAShJ,KAAK2B,QAIpF4mB,cAAe,WACb3c,EAAO8c,qBAAqB/mB,KAAK6mB,iBAInCzV,MAAO,WAOL,OALIpR,KAAKgmB,QAAUhmB,KAAKimB,YACtBjmB,KAAKgmB,QAAS,EACdhmB,KAAKgnB,gBAGAhnB,MAITgnB,aAAc,WAGZ,OAFAhnB,KAAKimB,UAAU7U,OAAS,IAAIiU,KAAOrlB,KAAKimB,UAAUb,MAAMplB,KAAKqmB,OAC7DrmB,KAAKimB,UAAUX,OAAStlB,KAAKimB,UAAU7U,MAAQpR,KAAKimB,UAAUd,SAASnlB,KAAKqmB,OACrErmB,KAAKinB,iBAAiB5f,QAQ/Bkf,MAAO,SAASW,GAMd,OALgB,mBAANA,GAAoBA,aAAcxa,EAAIqY,YAC9C/kB,KAAK+lB,WAAW7gB,KAAKgiB,GAEnBlnB,KAAKimB,YAAWjmB,KAAKimB,UAAYjmB,KAAK+lB,WAAWoB,SAE9CnnB,MAOTonB,QAAS,WAgBP,OAdApnB,KAAKqnB,OAGLrnB,KAAKimB,UAAYjmB,KAAK+lB,WAAWoB,QAE9BnnB,KAAKimB,YACHjmB,KAAKimB,qBAAqBvZ,EAAIqY,UAC/B/kB,KAAKoR,QAGLpR,KAAKimB,UAAUjpB,KAAKgD,OAIjBA,MAKTinB,eAAgB,WACd,IAAIpqB,EAAG0H,EAAG+iB,EACN1oB,EAAIoB,KAAKimB,UAEb,GAAGrnB,EAAEomB,KAAM,OAAOhlB,KAElB,IAAInD,KAAK+B,EAAE8mB,WAeT,IAdA4B,EAAStnB,KAAKiV,SAASpY,KAEnB+H,MAAMka,QAAQwI,KAChBA,EAAS,CAACA,IAGR1iB,MAAMka,QAAQlgB,EAAE8mB,WAAW7oB,MAC7B+B,EAAE8mB,WAAW7oB,GAAK,CAAC+B,EAAE8mB,WAAW7oB,KAO9B0H,EAAI+iB,EAAOhmB,OAAQiD,KAGlB3F,EAAE8mB,WAAW7oB,GAAG0H,aAAcmI,EAAI2U,SACnCiG,EAAO/iB,GAAK,IAAImI,EAAI2U,OAAOiG,EAAO/iB,KAEpC3F,EAAE8mB,WAAW7oB,GAAG0H,GAAK+iB,EAAO/iB,GAAG4Z,MAAMvf,EAAE8mB,WAAW7oB,GAAG0H,IAIzD,IAAI1H,KAAK+B,EAAEse,MACTte,EAAEse,MAAMrgB,GAAK,IAAI6P,EAAIoY,SAAS9kB,KAAKiV,SAASvH,KAAK7Q,GAAI+B,EAAEse,MAAMrgB,IAG/D,IAAIA,KAAK+B,EAAE+mB,OACT/mB,EAAE+mB,OAAO9oB,GAAK,IAAI6P,EAAIoY,SAAS9kB,KAAKiV,SAAS8C,MAAMlb,GAAI+B,EAAE+mB,OAAO9oB,IAMlE,OAHA+B,EAAE2oB,sBAAwBvnB,KAAKiV,SAASuS,YAExC5oB,EAAEomB,MAAO,EACFhlB,MAETynB,WAAY,WAEV,OADAznB,KAAK+lB,WAAa,GACX/lB,MAET0nB,aAAc,WAEZ,OADA1nB,KAAKimB,UAAY,KACVjmB,MAOTqnB,KAAM,SAASM,EAAWF,GACxB,IAAIzB,EAAShmB,KAAKgmB,OAelB,OAdAhmB,KAAKgmB,QAAS,EAEXyB,GACDznB,KAAKynB,aAGJE,GAAa3nB,KAAKimB,aAElBD,GAAUhmB,KAAKgnB,eAChBhnB,KAAK4nB,SAGP5nB,KAAK4mB,gBAEE5mB,KAAK0nB,gBAMdG,MAAO,WACL,GAAG7nB,KAAKimB,UAAU,CAChB,IAAI6B,EAAO9nB,KAAKimB,UAChBjmB,KAAKqnB,OACLrnB,KAAKimB,UAAY6B,EACjB9nB,KAAK+nB,UAEP,OAAO/nB,MAITslB,OAAQ,WAIN,IAFAtlB,KAAKqnB,MAAK,GAAM,GAEVrnB,KAAKonB,UAAUnB,WAAajmB,KAAKqnB,MAAK,GAAM,KAIlD,OAFArnB,KAAKynB,aAAaC,eAEX1nB,MAIT+nB,QAAS,WACP,OAAO/nB,KAAKqe,GAAG,GAAG,IAIpBuJ,MAAO,WAML,OAL6B,IAAzB5nB,KAAKimB,UAAUR,QAEjBzlB,KAAKimB,UAAUR,MAAQzlB,KAAKimB,UAAUT,KAAO,GAGb,iBAAxBxlB,KAAKimB,UAAUR,MAEhBzlB,KAAKqe,GAAGre,KAAKimB,UAAUR,OAAO,GAG9BzlB,KAAKqe,GAAG,GAAG,IAMtBA,GAAI,SAASC,EAAK0J,GAChB,IAAIC,EAAYjoB,KAAKimB,UAAUd,SAASnlB,KAAKqmB,OAY7C,OAVArmB,KAAKomB,OAAS9H,EAET0J,IACChoB,KAAKimB,UAAUhB,WAAUjlB,KAAKomB,OAAS,EAAIpmB,KAAKomB,QACpDpmB,KAAKomB,QAAUpmB,KAAKimB,UAAUT,MAGhCxlB,KAAKimB,UAAU7U,OAAS,IAAIiU,KAAOrlB,KAAKomB,OAAS6B,EACjDjoB,KAAKimB,UAAUX,OAAStlB,KAAKimB,UAAU7U,MAAQ6W,EAExCjoB,KAAKqH,MAAK,IAQnB6gB,MAAO,SAASA,GACd,OAAc,IAAVA,EAAoBloB,KAAKmoB,QAEzBD,GACFloB,KAAKqmB,OAAS6B,EAEPloB,KAAKqe,GAAGre,KAAKomB,QAAQ,IAChBpmB,KAAKqmB,QAIrBb,KAAM,SAAS5D,EAAO3C,GACpB,IAAI/hB,EAAI8C,KAAKooB,OAOb,OAJAlrB,EAAEuoB,MAAkB,MAAT7D,GAAiBA,EAC5B1kB,EAAEsoB,KAAO,EAENvG,IAAS/hB,EAAEgoB,WAAY,GACnBllB,MAITmoB,MAAO,WAIL,OAHAnoB,KAAKkmB,QAAS,EACdlmB,KAAK4mB,gBAEE5mB,MAITqoB,KAAM,WACJ,OAAIroB,KAAKkmB,QACTlmB,KAAKkmB,QAAS,EAEPlmB,KAAKqe,GAAGre,KAAKomB,QAAQ,IAHJpmB,MAY1Bif,QAAS,SAASgG,GAChB,IAAI/nB,EAAI8C,KAAKooB,OAKb,OAHmClrB,EAAE+nB,cAAf,IAAZA,GAAuC/nB,EAAE+nB,SACjCA,EAEXjlB,MASTsoB,SAAU,SAASC,GACjB,OAAOA,EAASvoB,KAAKimB,UAAUV,KAAKvlB,KAAKse,KAAOte,KAAKse,KAQvDkE,MAAO,SAAS0E,GACd,IAAIhqB,EAAI8C,KAAKooB,OAUb,OAFApoB,KAAKiV,SAASuT,GAAG,cAPH,SAASC,EAAQtkB,GACtBA,EAAEukB,OAAOzC,WAAa/oB,IACvBgqB,EAAGlqB,KAAKgD,KAAM9C,GACd8C,KAAK2oB,IAAI,cAAeF,MAMzBzoB,KAAK4oB,cAIdC,OAAQ,SAAS3B,GACf,IAAIhqB,EAAI8C,KAAKooB,OACTK,EAAU,SAAStkB,GACdA,EAAEukB,OAAOzC,WAAa/oB,GACvBgqB,EAAGlqB,KAAKgD,KAAMmE,EAAEukB,OAAOpK,IAAK5R,EAAIyR,MAAMha,EAAEukB,OAAOpK,KAAMna,EAAEukB,OAAOI,MAAO5rB,IAW7E,OANA8C,KAAKiV,SAAS0T,IAAI,YAAaF,GAASD,GAAG,YAAaC,GAExDzoB,KAAKwiB,MAAM,WACTxiB,KAAK2oB,IAAI,YAAaF,KAGjBzoB,KAAK4oB,cAIdG,SAAU,SAAS7B,GACjB,IAAIuB,EAAU,SAASA,EAAQtkB,GACzB+iB,EAAGlqB,KAAKgD,MACRA,KAAK2oB,IAAI,iBAAkBF,IAMjC,OAFAzoB,KAAKiV,SAAS0T,IAAI,iBAAkBF,GAASD,GAAG,iBAAkBC,GAE3DzoB,KAAK4oB,cAIdI,UAAW,SAAS9B,GAClB,IAAIuB,EAAU,SAAStkB,GACjB+iB,EAAGlqB,KAAKgD,KAAMmE,EAAEukB,OAAOpK,IAAK5R,EAAIyR,MAAMha,EAAEukB,OAAOpK,KAAMna,EAAEukB,OAAOI,MAAO3kB,EAAEukB,OAAOzC,YASpF,OANAjmB,KAAKiV,SAAS0T,IAAI,YAAaF,GAASD,GAAG,YAAaC,GAExDzoB,KAAK+oB,SAAS,WACZ/oB,KAAK2oB,IAAI,YAAaF,KAGjBzoB,KAAK4oB,cAGdR,KAAM,WACJ,OAAOpoB,KAAK+lB,WAAWzkB,OAAStB,KAAK+lB,WAAW/lB,KAAK+lB,WAAWzkB,OAAO,GAAKtB,KAAKimB,WAInFriB,IAAK,SAASqlB,EAAQC,EAAM3O,GAE1B,OADAva,KAAKooB,OAAO7N,GAAQ,cAAc0O,GAAUC,EACrClpB,KAAK4oB,cAOdvhB,KAAM,SAAS8hB,GAOX,IAAI/C,EAAQgD,EAAWC,EAJrBF,IAAYnpB,KAAKomB,OAASpmB,KAAKwmB,cAAc,IAAInB,QAGzB,IAAzBrlB,KAAKimB,UAAUR,OAIhBW,EAASxT,KAAK0W,IAAItpB,KAAKomB,OAAQ,GAC/BgD,EAAYxW,KAAK2W,MAAMnD,IAEK,IAAzBpmB,KAAKimB,UAAUR,OAAkB2D,EAAYppB,KAAKimB,UAAUR,OAC7DzlB,KAAKse,IAAM8H,EAASgD,EACpBC,EAAWrpB,KAAKimB,UAAUT,KAC1BxlB,KAAKimB,UAAUT,KAAO4D,IAEtBppB,KAAKomB,OAASpmB,KAAKimB,UAAUR,MAC7BzlB,KAAKse,IAAM,EAEX+K,EAAWrpB,KAAKimB,UAAUT,KAAO,EACjCxlB,KAAKimB,UAAUT,KAAOxlB,KAAKimB,UAAUR,OAGpCzlB,KAAKimB,UAAUf,YAEhBllB,KAAKimB,UAAUhB,SAAWjlB,KAAKimB,UAAUhB,UAAYuE,SAASxpB,KAAKimB,UAAUT,KAAO6D,GAAY,MAKlGrpB,KAAKomB,OAASxT,KAAK6W,IAAIzpB,KAAKomB,OAAQ,GACpCpmB,KAAKse,IAAMte,KAAKomB,QAIfpmB,KAAKse,IAAM,IAAGte,KAAKse,IAAM,GAEzBte,KAAKimB,UAAUhB,WAAUjlB,KAAKse,IAAM,EAAIte,KAAKse,KAIhD,IAAIwK,EAAQ9oB,KAAKimB,UAAUV,KAAKvlB,KAAKse,KAGrC,IAAI,IAAIzhB,KAAKmD,KAAKimB,UAAUL,KACvB/oB,EAAImD,KAAKmmB,SAAWtpB,GAAKisB,IAC1B9oB,KAAKimB,UAAUL,KAAK/oB,GAAGG,KAAKgD,KAAKiV,SAAUjV,KAAKse,IAAKwK,UAC9C9oB,KAAKimB,UAAUL,KAAK/oB,IAS/B,OAJGmD,KAAKgmB,QAAQhmB,KAAKiV,SAASyU,KAAK,SAAU,CAACpL,IAAKte,KAAKse,IAAKwK,MAAOA,EAAOa,GAAI3pB,KAAMimB,UAAWjmB,KAAKimB,YAIjGjmB,KAAKimB,WAKTjmB,KAAK4pB,SAGW,GAAZ5pB,KAAKse,MAAate,KAAKimB,UAAUhB,UAAcjlB,KAAKimB,UAAUhB,UAAwB,GAAZjlB,KAAKse,KAGjFte,KAAK4mB,gBAGL5mB,KAAKiV,SAASyU,KAAK,WAAY,CAACC,GAAG3pB,KAAMimB,UAAWjmB,KAAKimB,YAErDjmB,KAAK+lB,WAAWzkB,SAClBtB,KAAKiV,SAASyU,KAAK,eAGf1pB,KAAK+lB,WAAWzkB,SAClBtB,KAAKiV,SAAS0T,IAAI,OAClB3oB,KAAKgmB,QAAS,IAKfhmB,KAAKgmB,OAAQhmB,KAAKonB,UAChBpnB,KAAK0nB,iBAEF1nB,KAAKkmB,QAAUlmB,KAAKgmB,QAE5BhmB,KAAK2mB,iBAIP3mB,KAAKmmB,QAAU2C,EACR9oB,MApCEA,MAyCX4pB,OAAQ,WACN,IAAI/sB,EAAGsF,EAAKkc,EAAIwL,EAAO7pB,KAAMiV,EAASjV,KAAKiV,SAAUrW,EAAIoB,KAAKimB,UAG9D,IAAIppB,KAAK+B,EAAE8mB,WAETrH,EAAK,GAAG8C,OAAOviB,EAAE8mB,WAAW7oB,IAAI0G,IAAI,SAASgU,GAC3C,MAAqB,iBAAPA,GAAmBA,EAAG8G,GAAK9G,EAAG8G,GAAGzf,EAAE2mB,KAAKsE,EAAKvL,KAAMuL,EAAKvL,KAAO/G,IAG/EtC,EAAOpY,GAAGitB,MAAM7U,EAAQoJ,GAK1B,IAAIxhB,KAAK+B,EAAEse,MAETmB,EAAK,CAACxhB,GAAGskB,OAAOviB,EAAEse,MAAMrgB,IAAI0G,IAAI,SAASgU,GACvC,MAAqB,iBAAPA,GAAmBA,EAAG8G,GAAK9G,EAAG8G,GAAGzf,EAAE2mB,KAAKsE,EAAKvL,KAAMuL,EAAKvL,KAAO/G,IAG/EtC,EAAOvH,KAAKoc,MAAM7U,EAAQoJ,GAK5B,IAAIxhB,KAAK+B,EAAE+mB,OAETtH,EAAK,CAACxhB,GAAGskB,OAAOviB,EAAE+mB,OAAO9oB,IAAI0G,IAAI,SAASgU,GACxC,MAAqB,iBAAPA,GAAmBA,EAAG8G,GAAK9G,EAAG8G,GAAGzf,EAAE2mB,KAAKsE,EAAKvL,KAAMuL,EAAKvL,KAAO/G,IAG/EtC,EAAO8C,MAAM+R,MAAM7U,EAAQoJ,GAK7B,GAAGzf,EAAE6c,WAAWna,OAAO,CAIrB,IADA+c,EAAKzf,EAAE2oB,sBACH1qB,EAAI,EAAGsF,EAAMvD,EAAE6c,WAAWna,OAAQzE,EAAIsF,EAAKtF,IAAI,CAGjD,IAAI8C,EAAIf,EAAE6c,WAAW5e,GAGlB8C,aAAa+M,EAAIqd,OAGhB1L,EADC1e,EAAEoiB,SACE1D,EAAG2L,UAAS,IAAItd,EAAIqd,QAAS5L,MAAMxe,GAAG0e,GAAGzf,EAAE2mB,KAAKvlB,KAAKse,OAErDD,EAAGF,MAAMxe,GAAG0e,GAAGzf,EAAE2mB,KAAKvlB,KAAKse,OAMhC3e,EAAEoiB,UACJpiB,EAAEsqB,KAAK5L,EAAG6L,WAGZ7L,EAAKA,EAAG2L,SAASrqB,EAAE0e,GAAGzf,EAAE2mB,KAAKvlB,KAAKse,QAKpCrJ,EAAOkV,OAAO9L,GAGhB,OAAOre,MAMT4lB,KAAM,SAAStH,EAAK4I,EAAIkD,GACtB,IAAIltB,EAAI8C,KAAKooB,OAKb,OAJIgC,IAAS9L,EAAMphB,EAAEqoB,KAAKjH,IAE1BphB,EAAE0oB,KAAKtH,GAAO4I,EAEPlnB,MAGT4oB,WAAY,WAEV,OADAyB,WAAW,WAAWrqB,KAAKoR,SAAS/S,KAAK2B,MAAO,GACzCA,OAKX6Z,OAAQnN,EAAI4N,QAGZV,UAAW,CAET0M,QAAS,SAAShpB,EAAGioB,EAAMH,GACzB,OAAQplB,KAAK2pB,KAAO3pB,KAAK2pB,GAAK,IAAIjd,EAAImZ,GAAG7lB,QAAQsmB,QAAQhpB,EAAGioB,EAAMH,IAEpEA,MAAO,SAASA,GACd,OAAQplB,KAAK2pB,KAAO3pB,KAAK2pB,GAAK,IAAIjd,EAAImZ,GAAG7lB,QAAQolB,MAAMA,IAEzDiC,KAAM,SAASM,EAAWF,GAIxB,OAHIznB,KAAK2pB,IACP3pB,KAAK2pB,GAAGtC,KAAKM,EAAWF,GAEnBznB,MAETslB,OAAQ,WAIN,OAHItlB,KAAK2pB,IACP3pB,KAAK2pB,GAAGrE,SAEHtlB,MAGTmoB,MAAO,WAIL,OAHInoB,KAAK2pB,IACP3pB,KAAK2pB,GAAGxB,QAEHnoB,MAGTqoB,KAAM,WAIJ,OAHIroB,KAAK2pB,IACP3pB,KAAK2pB,GAAGtB,OAEHroB,MAGTkoB,MAAO,SAASA,GACd,GAAIloB,KAAK2pB,GACP,IAAa,MAATzB,EACF,OAAOloB,KAAK2pB,GAAGzB,QAEfloB,KAAK2pB,GAAGzB,MAAMA,GAElB,OAAOloB,SAOb0M,EAAIoY,SAAWpY,EAAI8M,OAAO,CAExBrb,OAAQ,SAAS0mB,EAAM/C,GAErB,OAAGpV,EAAI8Q,MAAMe,QAAQuD,GAAY,IAAIpV,EAAI8Q,MAAMqH,GAAM1G,MAAM2D,GAExDpV,EAAI0O,MAAMc,UAAUyB,KAAKkH,GAEvBnY,EAAI0O,MAAMgB,YAAYuB,KAAKkH,GAAc,IAAInY,EAAI8T,UAAUqE,GAAM1G,MAAM2D,GAE9D,IAAIpV,EAAI9H,MAAMigB,GAAM1G,MAAM2D,GAGrCpV,EAAI0O,MAAMC,cAAcsC,KAAKmE,GAAY,IAAIpV,EAAI2U,OAAOwD,GAAM1G,MAAM2D,IAGvE9hB,KAAKlC,MAAQ+mB,OACb7kB,KAAKoe,YAAc0D,KAGrB5I,OAAQ,CACNmF,GAAI,SAASC,EAAKgM,GAChB,OAAOA,EAAO,EAAItqB,KAAKlC,MAAQkC,KAAKoe,aAGtCK,QAAS,WACP,OAAOze,KAAKlC,UAMlB4O,EAAIwM,OAAOxM,EAAImZ,GAAI,CAEjBnY,KAAM,SAAS/N,EAAGH,EAAGuiB,GAEnB,GAAgB,iBAALpiB,EACT,IAAK,IAAIvB,KAAOuB,EACdK,KAAK0N,KAAKtP,EAAKuB,EAAEvB,SAGnB4B,KAAK4D,IAAIjE,EAAGH,EAAG,SAGjB,OAAOQ,MAGT+X,MAAO,SAASnZ,EAAGY,GACjB,GAAgB,iBAALZ,EACT,IAAK,IAAIR,KAAOQ,EACdoB,KAAK+X,MAAM3Z,EAAKQ,EAAER,SAGpB4B,KAAK4D,IAAIhF,EAAGY,EAAG,UAEjB,OAAOQ,MAGTuH,EAAG,SAASA,EAAGwa,GACb,GAAG/hB,KAAKiV,mBAAoBvI,EAAI6d,EAE9B,OADAvqB,KAAKgS,UAAU,CAACzK,EAAEA,GAAIwa,GACf/hB,KAGT,IAAIwqB,EAAM,IAAI9d,EAAI2U,OAAO9Z,GAEzB,OADAijB,EAAIzI,SAAWA,EACR/hB,KAAK4D,IAAI,IAAK4mB,IAGvB7c,EAAG,SAASA,EAAGoU,GACb,GAAG/hB,KAAKiV,mBAAoBvI,EAAI6d,EAE9B,OADAvqB,KAAKgS,UAAU,CAACrE,EAAEA,GAAIoU,GACf/hB,KAGT,IAAIwqB,EAAM,IAAI9d,EAAI2U,OAAO1T,GAEzB,OADA6c,EAAIzI,SAAWA,EACR/hB,KAAK4D,IAAI,IAAK4mB,IAGvBnb,GAAI,SAAS9H,GACX,OAAOvH,KAAK4D,IAAI,KAAM,IAAI8I,EAAI2U,OAAO9Z,KAGvC+H,GAAI,SAAS3B,GACX,OAAO3N,KAAK4D,IAAI,KAAM,IAAI8I,EAAI2U,OAAO1T,KAGvC+R,KAAM,SAASnY,EAAGoG,GAChB,OAAO3N,KAAKuH,EAAEA,GAAGoG,EAAEA,IAGrByB,OAAQ,SAAS7H,EAAGoG,GAClB,OAAO3N,KAAKqP,GAAG9H,GAAG+H,GAAG3B,IAGvBhB,KAAM,SAASU,EAAOD,GAOlB,IAAIuS,EAmBN,OAzBI3f,KAAKiV,mBAAoBvI,EAAI+d,KAE/BzqB,KAAK0N,KAAK,YAAaL,IAMnBA,GAAUD,IACZuS,EAAM3f,KAAKiV,SAAS2K,QAGlBvS,IACFA,EAAQsS,EAAItS,MAAQsS,EAAIvS,OAAUA,GAGhCA,IACFA,EAASuS,EAAIvS,OAASuS,EAAItS,MAASA,GAGrCrN,KAAK4D,IAAI,QAAU,IAAI8I,EAAI2U,OAAOhU,IAC7BzJ,IAAI,SAAU,IAAI8I,EAAI2U,OAAOjU,KAI7BpN,MAGTqN,MAAO,SAASA,GACd,OAAOrN,KAAK4D,IAAI,QAAS,IAAI8I,EAAI2U,OAAOhU,KAG1CD,OAAQ,SAASA,GACf,OAAOpN,KAAK4D,IAAI,SAAU,IAAI8I,EAAI2U,OAAOjU,KAG3CW,KAAM,SAASpO,EAAGqC,EAAG9E,EAAGC,GAEtB,OAAuB,GAApBkc,UAAU/X,OACJtB,KAAK+N,KAAK,CAACpO,EAAGqC,EAAG9E,EAAGC,IAGtB6C,KAAK4D,IAAI,OAAQ,IAAK5D,KAAKiV,SAAmB,YAAEtV,KAGzD+qB,QAAS,SAAS5sB,GAChB,OAAOkC,KAAKiV,SAASyV,QACnB1qB,KAAK4D,IAAI,UAAW,IAAI8I,EAAI2U,OAAOvjB,IACnCkC,MAGJ4M,QAAS,SAASrF,EAAGoG,EAAGN,EAAOD,GAK7B,OAJIpN,KAAKiV,mBAAoBvI,EAAIoN,WAC/B9Z,KAAK4D,IAAI,UAAW,IAAI8I,EAAIie,QAAQpjB,EAAGoG,EAAGN,EAAOD,IAG5CpN,MAET4qB,OAAQ,SAASttB,GACf,GAAI0C,KAAKiV,mBAAoBvI,EAAIme,KAAM,CACrC,GAAgB,iBAALvtB,GAAiBA,aAAaoP,EAAI2U,OAC3C,OAAOrhB,KAAK4qB,OAAO,CACjBjnB,OAAS0V,UAAU,GACnBvF,MAASuF,UAAU,GACnBgE,QAAShE,UAAU,KAIN,MAAb/b,EAAE+f,SAAiBrd,KAAK0N,KAAK,eAAgBpQ,EAAE+f,SAClC,MAAb/f,EAAEwW,OAAiB9T,KAAK0N,KAAK,aAAcpQ,EAAEwW,OAChC,MAAbxW,EAAEqG,QAAiB3D,KAAK0N,KAAK,SAAUpQ,EAAEqG,QAG/C,OAAO3D,QAIX0M,EAAIoe,IAAMpe,EAAI8M,OAAO,CACnBrb,OAAQ,SAASoJ,EAAGoG,EAAGN,EAAOD,GAC5B,KAAgB,iBAAL7F,GAAmBA,aAAamF,EAAI4N,SAE7C,OAAO5N,EAAIoe,IAAI9tB,KAAKgD,KAAgB,MAAVuH,EAAEwjB,KAAexjB,EAAEwjB,KAAOxjB,EAAEA,EAAa,MAATA,EAAEyjB,IAAczjB,EAAEyjB,IAAMzjB,EAAEoG,EAAGpG,EAAE8F,MAAO9F,EAAE6F,QACrE,GAApBiM,UAAU/X,SACnBtB,KAAKuH,EAAIA,EACTvH,KAAK2N,EAAIA,EACT3N,KAAKqN,MAAQA,EACbrN,KAAKoN,OAASA,GAIhB6d,EAAQjrB,OAEVkZ,OAAQ,CAENgS,MAAO,SAASvL,GACd,IAAI3d,EAAI,IAAIhC,KAAK2Z,YAQjB,OALA3X,EAAEuF,EAASqL,KAAK6W,IAAIzpB,KAAKuH,EAAGoY,EAAIpY,GAChCvF,EAAE2L,EAASiF,KAAK6W,IAAIzpB,KAAK2N,EAAGgS,EAAIhS,GAChC3L,EAAEqL,MAASuF,KAAK0W,IAAItpB,KAAKuH,EAAIvH,KAAKqN,MAAQsS,EAAIpY,EAAIoY,EAAItS,OAAUrL,EAAEuF,EAClEvF,EAAEoL,OAASwF,KAAK0W,IAAItpB,KAAK2N,EAAI3N,KAAKoN,OAAQuS,EAAIhS,EAAIgS,EAAIvS,QAAUpL,EAAE2L,EAE3Dsd,EAAQjpB,IAGjBgQ,UAAW,SAAS/U,GAClB,IAA6E2iB,EAAzEuL,EAAOC,IAAUC,GAAO,IAAWC,EAAOF,IAAUG,GAAO,IAyB/D,MAvBU,CACR,IAAI7e,EAAI0U,MAAMphB,KAAKuH,EAAGvH,KAAK2N,GAC3B,IAAIjB,EAAI0U,MAAMphB,KAAKgR,GAAIhR,KAAK2N,GAC5B,IAAIjB,EAAI0U,MAAMphB,KAAKuH,EAAGvH,KAAKsQ,IAC3B,IAAI5D,EAAI0U,MAAMphB,KAAKgR,GAAIhR,KAAKsQ,KAG1B3K,QAAQ,SAAShH,GACnBA,EAAIA,EAAEqT,UAAU/U,GAChBkuB,EAAOvY,KAAK6W,IAAI0B,EAAKxsB,EAAE4I,GACvB8jB,EAAOzY,KAAK0W,IAAI+B,EAAK1sB,EAAE4I,GACvB+jB,EAAO1Y,KAAK6W,IAAI6B,EAAK3sB,EAAEgP,GACvB4d,EAAO3Y,KAAK0W,IAAIiC,EAAK5sB,EAAEgP,MAGzBiS,EAAO,IAAI5f,KAAK2Z,aACXpS,EAAI4jB,EACTvL,EAAKvS,MAAQge,EAAKF,EAClBvL,EAAKjS,EAAI2d,EACT1L,EAAKxS,OAASme,EAAKD,EAEnBL,EAAQrL,GAEDA,MAKblT,EAAI8e,KAAO9e,EAAI8M,OAAO,CAEpBrb,OAAQ,SAASY,GAIf,GAHA2N,EAAIoe,IAAIhB,MAAM9pB,KAAM,GAAGoZ,MAAMpc,KAAKqc,YAG9Bta,aAAmB2N,EAAI4N,QAAS,CAClC,IAAIqF,EAGJ,IAEE,GAAK3gB,EAAS+b,gBAAgB0Q,UAS5B,IAAIzsB,EAAS+b,gBAAgB0Q,SAAS1sB,EAAQib,MAAO,MAAM,IAAI0R,UAAU,8BATpC,CAGrC,IADA,IAAIC,EAAY5sB,EAAQib,KACjB2R,EAAUzR,YACfyR,EAAYA,EAAUzR,WAExB,GAAIyR,GAAa3sB,EAAU,MAAM,IAAI0sB,UAAU,0BAOjD/L,EAAM5gB,EAAQib,KAAK8F,UACnB,MAAM3b,GACN,GAAGpF,aAAmB2N,EAAIkf,MAAM,CAC9B,IAAI1M,EAAQngB,EAAQmgB,MAAMxS,EAAI8L,OAAO/L,KAAKwN,UAAU6I,OACpDnD,EAAMT,EAAMlF,KAAK8F,UACjBZ,EAAM5V,cAENqW,EAAM,CACJpY,EAAQxI,EAAQib,KAAK6R,WACrBle,EAAQ5O,EAAQib,KAAK8R,UACrBze,MAAQtO,EAAQib,KAAK+R,YACrB3e,OAAQrO,EAAQib,KAAKgS,cAK3Btf,EAAIoe,IAAI9tB,KAAKgD,KAAM2f,KAMvBpG,QAAS7M,EAAIoe,IAGbjR,OAAQnN,EAAI4N,QAGZV,UAAW,CAETgG,KAAM,WACJ,OAAO,IAAIlT,EAAI8e,KAAKxrB,UAM1B0M,EAAI8e,KAAK/sB,UAAUkb,YAAcjN,EAAI8e,KAGrC9e,EAAIwM,OAAOxM,EAAI4N,QAAS,CACtB2R,KAAM,WAEJ,OADAhkB,QAAQC,KAAK,sEACNlI,KAAKoQ,KAAKpQ,KAAKsjB,UAI1B5W,EAAIwf,KAAOxf,EAAI8M,OAAO,CAEpBrb,OAAQ,SAASY,GACf2N,EAAIoe,IAAIhB,MAAM9pB,KAAM,GAAGoZ,MAAMpc,KAAKqc,YAE9Bta,aAAmB2N,EAAI4N,SACzB5N,EAAIoe,IAAI9tB,KAAKgD,KAAMjB,EAAQib,KAAKmS,0BAIpC5S,QAAS7M,EAAIoe,IAGbjR,OAAQnN,EAAI4N,QAEZpB,OAAQ,CACNkT,UAAW,WAIT,OAFApsB,KAAKuH,GAAK0C,EAAOoiB,YACjBrsB,KAAK2N,GAAK1D,EAAOqiB,YACVtsB,OAKX4Z,UAAW,CAETxJ,KAAM,SAASmH,GACb,OAAIA,EAAW,IAAI7K,EAAIwf,KAAKlsB,MAAMgS,UAAUuF,EAAGgV,YAAYzoB,WACpD,IAAI4I,EAAIwf,KAAKlsB,MAAMosB,gBAMhC1f,EAAIwf,KAAKztB,UAAUkb,YAAcjN,EAAIwf,KAErCxf,EAAIqd,OAASrd,EAAI8M,OAAO,CAEtBrb,OAAQ,SAASmpB,GACf,IAAIzqB,EAAG2vB,EAAOC,EAAc,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,IAe5C,IAZAnF,EAASA,aAAkB5a,EAAI4N,QAC7BgN,EAAOE,YACS,iBAAXF,EACLmF,EAAcnF,EAAOljB,MAAMsI,EAAI0O,MAAMc,WAAW3Y,IAAIyb,aAClC,GAApB3F,UAAU/X,OACRmrB,EAAc,GAAGrT,MAAMpc,KAAKqc,YAC9BzU,MAAMka,QAAQwI,GACZmF,EAAcnF,GACE,iBAAXA,EACLA,EAASkF,EAGN3vB,EAAI6vB,EAAOprB,OAAS,EAAGzE,GAAK,IAAKA,EACpCmD,KAAK0sB,EAAO7vB,IAA2B,MAArByqB,EAAOoF,EAAO7vB,IAC9ByqB,EAAOoF,EAAO7vB,IAAM2vB,EAAKE,EAAO7vB,KAItCqc,OAAQ,CAENgR,QAAS,WAEP,IAAIyC,EAAQC,EAAoB5sB,KAAM,EAAG,GACrC6sB,EAAQD,EAAoB5sB,KAAM,EAAG,GACrC8sB,EAAQ,IAAMla,KAAKkK,GAAKlK,KAAKma,MAAMJ,EAAGhf,EAAGgf,EAAGplB,GAAK,GAErD,MAAO,CAELA,EAAUvH,KAAKmE,EACfwJ,EAAU3N,KAAKgtB,EACfC,cAAcjtB,KAAKmE,EAAIyO,KAAK+R,IAAImI,EAAQla,KAAKkK,GAAK,KAAO9c,KAAKgtB,EAAIpa,KAAKgS,IAAIkI,EAAQla,KAAKkK,GAAK,MAAQlK,KAAKsa,KAAKltB,KAAKL,EAAIK,KAAKL,EAAIK,KAAKgC,EAAIhC,KAAKgC,GAC/ImrB,cAAcntB,KAAKgtB,EAAIpa,KAAK+R,IAAImI,EAAQla,KAAKkK,GAAK,KAAO9c,KAAKmE,EAAIyO,KAAKgS,KAAKkI,EAAQla,KAAKkK,GAAK,MAAQlK,KAAKsa,KAAKltB,KAAK9C,EAAI8C,KAAK9C,EAAI8C,KAAK7C,EAAI6C,KAAK7C,GAEhJ2vB,OAAWA,EACXM,MAAU,IAAMxa,KAAKkK,GAAKlK,KAAKma,MAAMF,EAAGlf,EAAGkf,EAAGtlB,GAE9C8lB,OAAUza,KAAKsa,KAAKltB,KAAKL,EAAIK,KAAKL,EAAIK,KAAKgC,EAAIhC,KAAKgC,GACpDsrB,OAAU1a,KAAKsa,KAAKltB,KAAK9C,EAAI8C,KAAK9C,EAAI8C,KAAK7C,EAAI6C,KAAK7C,GAEpD8U,SAAU6a,EACVntB,EAAGK,KAAKL,EACRqC,EAAGhC,KAAKgC,EACR9E,EAAG8C,KAAK9C,EACRC,EAAG6C,KAAK7C,EACRgH,EAAGnE,KAAKmE,EACR6oB,EAAGhtB,KAAKgtB,EACR7C,OAAQ,IAAIzd,EAAIqd,OAAO/pB,QAI3Bkf,MAAO,WACL,OAAO,IAAIxS,EAAIqd,OAAO/pB,OAGxBme,MAAO,SAASgM,GAId,OAFAnqB,KAAKoe,YAAc,IAAI1R,EAAIqd,OAAOI,GAE3BnqB,MAGTqe,GAAI,SAASC,GAEX,OAAKte,KAAKoe,YAGG,IAAI1R,EAAIqd,OAAO,CAC1BpqB,EAAGK,KAAKL,GAAKK,KAAKoe,YAAYze,EAAIK,KAAKL,GAAK2e,EAC5Ctc,EAAGhC,KAAKgC,GAAKhC,KAAKoe,YAAYpc,EAAIhC,KAAKgC,GAAKsc,EAC5CphB,EAAG8C,KAAK9C,GAAK8C,KAAKoe,YAAYlhB,EAAI8C,KAAK9C,GAAKohB,EAC5CnhB,EAAG6C,KAAK7C,GAAK6C,KAAKoe,YAAYjhB,EAAI6C,KAAK7C,GAAKmhB,EAC5Cna,EAAGnE,KAAKmE,GAAKnE,KAAKoe,YAAYja,EAAInE,KAAKmE,GAAKma,EAC5C0O,EAAGhtB,KAAKgtB,GAAKhtB,KAAKoe,YAAY4O,EAAIhtB,KAAKgtB,GAAK1O,IAThBte,MAehCgqB,SAAU,SAASG,GACjB,OAAO,IAAIzd,EAAIqd,OAAO/pB,KAAKmb,SAAS6O,SAw6F1C,SAAqBG,GAInB,OAHMA,aAAkBzd,EAAIqd,SAC1BI,EAAS,IAAIzd,EAAIqd,OAAOI,IAEnBA,EA56F0CoD,CAAYpD,GAAQhP,YAGnErX,QAAS,WACP,OAAO,IAAI4I,EAAIqd,OAAO/pB,KAAKmb,SAASrX,YAGtCiJ,UAAW,SAASxF,EAAGoG,GACrB,OAAO,IAAIjB,EAAIqd,OAAO/pB,KAAKmb,SAASpO,UAAUxF,GAAK,EAAGoG,GAAK,KAG7D6f,MAAO,SAASjmB,EAAGoG,EAAG0B,EAAIC,GAUxB,OARwB,GAApB+J,UAAU/X,OACZqM,EAAIpG,EACyB,GAApB8R,UAAU/X,SACnBgO,EAAKD,EACLA,EAAK1B,EACLA,EAAIpG,GAGCvH,KAAKytB,OAAOpe,EAAIC,EAAI,IAAI5C,EAAIqd,OAAOxiB,EAAG,EAAG,EAAGoG,EAAG,EAAG,KAG3D+f,OAAQ,SAAS/vB,EAAG0R,EAAIC,GAItB,OAFA3R,EAAI+O,EAAI8P,MAAMK,QAAQlf,GAEfqC,KAAKytB,OAAOpe,EAAIC,EAAI,IAAI5C,EAAIqd,OAAOnX,KAAK+R,IAAIhnB,GAAIiV,KAAKgS,IAAIjnB,IAAKiV,KAAKgS,IAAIjnB,GAAIiV,KAAK+R,IAAIhnB,GAAI,EAAG,KAGpGgwB,KAAM,SAAShuB,EAAGrC,GAChB,MAAY,KAALqC,EACHK,KAAKwtB,OAAO,EAAG,EAAGlwB,EAAG,GAClB,KAALqC,EACEK,KAAKwtB,MAAM,GAAI,EAAG,EAAGlwB,GACrB0C,KAAKwtB,OAAO,GAAI,EAAG7tB,EAAQ,MAALrC,EAAYA,EAAIqC,IAG5CiuB,KAAM,SAASrmB,EAAGoG,EAAG0B,EAAIC,GAcvB,OAZwB,GAApB+J,UAAU/X,OACZqM,EAAIpG,EACyB,GAApB8R,UAAU/X,SACnBgO,EAAKD,EACLA,EAAK1B,EACLA,EAAIpG,GAINA,EAAImF,EAAI8P,MAAMK,QAAQtV,GACtBoG,EAAIjB,EAAI8P,MAAMK,QAAQlP,GAEf3N,KAAKytB,OAAOpe,EAAIC,EAAI,IAAI5C,EAAIqd,OAAO,EAAGnX,KAAKib,IAAIlgB,GAAIiF,KAAKib,IAAItmB,GAAI,EAAG,EAAG,KAG/EulB,MAAO,SAASvlB,EAAG8H,EAAIC,GACrB,OAAOtP,KAAK4tB,KAAKrmB,EAAG,EAAG8H,EAAIC,IAG7B8d,MAAO,SAASzf,EAAG0B,EAAIC,GACrB,OAAOtP,KAAK4tB,KAAK,EAAGjgB,EAAG0B,EAAIC,IAG7Bme,OAAQ,SAASpe,EAAIC,EAAI6a,GACvB,OAAOnqB,KACJgqB,SAAS,IAAItd,EAAIqd,OAAO,EAAG,EAAG,EAAG,EAAG1a,GAAM,EAAGC,GAAM,IACnD0a,SAASG,GACTH,SAAS,IAAItd,EAAIqd,OAAO,EAAG,EAAG,EAAG,GAAI1a,GAAM,GAAIC,GAAM,KAG1D6L,OAAQ,WAKN,IAHA,IAAIgP,EAASzd,EAAI8L,OAAO2C,OAAO2S,kBAGtBjxB,EAAI6vB,EAAOprB,OAAS,EAAGzE,GAAK,EAAGA,IACtCstB,EAAOuC,EAAO7vB,IAAMmD,KAAK0sB,EAAO7vB,IAElC,OAAOstB,GAGTrM,SAAU,WAER,MAAO,UAAYiQ,EAAc/tB,KAAKL,GAAK,IAAMouB,EAAc/tB,KAAKgC,GAChE,IAAM+rB,EAAc/tB,KAAK9C,GAAK,IAAM6wB,EAAc/tB,KAAK7C,GACvD,IAAM4wB,EAAc/tB,KAAKmE,GAAK,IAAM4pB,EAAc/tB,KAAKgtB,GACvD,MAKRnT,OAAQnN,EAAI4N,QAGZV,UAAW,CAEToU,IAAK,WACH,OAAO,IAAIthB,EAAIqd,OAAO/pB,KAAKga,KAAKiU,WAGlC1B,UAAW,WAKT,GAAGvsB,gBAAgB0M,EAAI0N,OAAQ,CAC7B,IAAIhM,EAAOpO,KAAKoO,KAAK,EAAE,GACnBnR,EAAImR,EAAK4L,KAAKkU,eAElB,OADA9f,EAAK9E,SACE,IAAIoD,EAAIqd,OAAO9sB,GAExB,OAAO,IAAIyP,EAAIqd,OAAO/pB,KAAKga,KAAKkU,oBAOtCxhB,EAAI0U,MAAQ1U,EAAI8M,OAAO,CAErBrb,OAAQ,SAASoJ,EAAEoG,GACjB,IAAO2Z,EAGPA,EAAS1iB,MAAMka,QAAQvX,GACrB,CAACA,EAAEA,EAAE,GAAIoG,EAAEpG,EAAE,IACF,iBAANA,EACL,CAACA,EAAEA,EAAEA,EAAGoG,EAAEpG,EAAEoG,GACT,MAALpG,EACE,CAACA,EAAEA,EAAGoG,EAAQ,MAALA,EAAYA,EAAIpG,GARL,CAACA,EAAE,EAAGoG,EAAE,GAW9B3N,KAAKuH,EAAI+f,EAAO/f,EAChBvH,KAAK2N,EAAI2Z,EAAO3Z,GAIlBuL,OAAQ,CAENgG,MAAO,WACL,OAAO,IAAIxS,EAAI0U,MAAMphB,OAGvBme,MAAO,SAAS5W,EAAGoG,GAIjB,OAFA3N,KAAKoe,YAAc,IAAI1R,EAAI0U,MAAM7Z,EAAGoG,GAE7B3N,MAGTqe,GAAI,SAASC,GAEX,OAAKte,KAAKoe,YAGE,IAAI1R,EAAI0U,MAAM,CACxB7Z,EAAGvH,KAAKuH,GAAKvH,KAAKoe,YAAY7W,EAAIvH,KAAKuH,GAAK+W,EAC5C3Q,EAAG3N,KAAK2N,GAAK3N,KAAKoe,YAAYzQ,EAAI3N,KAAK2N,GAAK2Q,IALhBte,MAWhCmb,OAAQ,WAEN,IAAIgT,EAAQzhB,EAAI8L,OAAO2C,OAAOiT,iBAM9B,OAHAD,EAAM5mB,EAAIvH,KAAKuH,EACf4mB,EAAMxgB,EAAI3N,KAAK2N,EAERwgB,GAGTnc,UAAW,SAASmY,GAClB,OAAO,IAAIzd,EAAI0U,MAAMphB,KAAKmb,SAASkT,gBAAgBlE,EAAOhP,eAOhEzO,EAAIwM,OAAOxM,EAAI4N,QAAS,CAGtB6T,MAAO,SAAS5mB,EAAGoG,GACjB,OAAO,IAAIjB,EAAI0U,MAAM7Z,EAAEoG,GAAGqE,UAAUhS,KAAKusB,YAAYzoB,cAKzD4I,EAAIwM,OAAOxM,EAAI4N,QAAS,CAEtB5M,KAAM,SAAS/N,EAAGH,EAAGlB,GAEnB,GAAS,MAALqB,EAAW,CAIb,IAFAA,EAAI,GAECrB,GADLkB,EAAIQ,KAAKga,KAAKsU,YACHhtB,OAAS,EAAGhD,GAAK,EAAGA,IAC7BqB,EAAEH,EAAElB,GAAGuY,UAAYnK,EAAI0O,MAAMW,SAAS4B,KAAKne,EAAElB,GAAGiwB,WAAavP,WAAWxf,EAAElB,GAAGiwB,WAAa/uB,EAAElB,GAAGiwB,UAEjG,OAAO5uB,EAEF,GAAgB,iBAALA,EAEhB,IAAKH,KAAKG,EAAGK,KAAK0N,KAAKlO,EAAGG,EAAEH,SAEvB,GAAU,OAANA,EAEPQ,KAAKga,KAAKsK,gBAAgB3kB,OAEvB,IAAS,MAALH,EAGT,OAAY,OADZA,EAAIQ,KAAKga,KAAK1a,aAAaK,IAEzB+M,EAAI1L,SAASkc,MAAMvd,GACrB+M,EAAI0O,MAAMW,SAAS4B,KAAKne,GACtBwf,WAAWxf,GAAKA,EAIT,gBAALG,EACFK,KAAK0N,KAAK,SAAUsR,WAAWxf,GAAK,EAAIQ,KAAKgiB,QAAU,MAC3C,UAALriB,IACPK,KAAKgiB,QAAUxiB,GAGR,QAALG,GAAoB,UAALA,IACb+M,EAAI0O,MAAMa,QAAQ0B,KAAKne,KACzBA,EAAIQ,KAAKsjB,MAAM7I,OAAO+T,MAAMhvB,EAAG,EAAG,IAEhCA,aAAakN,EAAI+hB,QACnBjvB,EAAIQ,KAAKsjB,MAAM7I,OAAOiU,QAAQ,EAAG,EAAG,WAClC1uB,KAAK4D,IAAIpE,OAKE,iBAANA,EACTA,EAAI,IAAIkN,EAAI2U,OAAO7hB,GAGZkN,EAAI8Q,MAAMe,QAAQ/e,GACzBA,EAAI,IAAIkN,EAAI8Q,MAAMhe,GAGXoF,MAAMka,QAAQtf,KACrBA,EAAI,IAAIkN,EAAI9H,MAAMpF,IAGX,WAALG,EAEEK,KAAK0qB,SACP1qB,KAAK0qB,QAAQlrB,GAGF,iBAANlB,EACL0B,KAAKga,KAAK2U,eAAerwB,EAAGqB,EAAGH,EAAEse,YACjC9d,KAAKga,KAAKva,aAAaE,EAAGH,EAAEse,aAI5B9d,KAAK4uB,SAAiB,aAALjvB,GAAyB,KAALA,GACvCK,KAAK4uB,QAAQjvB,EAAGH,GAGpB,OAAOQ,QAGX0M,EAAIwM,OAAOxM,EAAI4N,QAAS,CAEtBtI,UAAW,SAAS1U,EAAGykB,GAErB,IACIoI,EAAQvK,EAGZ,GAAiB,iBAANtiB,EAIT,OAFA6sB,EAAS,IAAIzd,EAAIqd,OANN/pB,MAMqBkqB,UAEZ,iBAAN5sB,EAAiB6sB,EAAO7sB,GAAK6sB,EAU7C,GANAA,EAAS,IAAIzd,EAAIqd,OAZJ/pB,MAeb+hB,IAAaA,KAAczkB,EAAEykB,SAGlB,MAAPzkB,EAAEqC,EACJwqB,EAASpI,EAEPoI,EAAOH,SAAS,IAAItd,EAAIqd,OAAOzsB,IAE/B,IAAIoP,EAAIqd,OAAOzsB,QAGZ,GAAkB,MAAdA,EAAE2U,SAEX4c,EAAavxB,EA5BF0C,MA+BXmqB,EAASpI,EAEPoI,EAAOuD,OAAOpwB,EAAE2U,SAAU3U,EAAE+R,GAAI/R,EAAEgS,IAElC6a,EAAOuD,OAAOpwB,EAAE2U,SAAWkY,EAAOD,UAAUjY,SAAU3U,EAAE+R,GAAI/R,EAAEgS,SAG3D,GAAe,MAAXhS,EAAEkwB,OAA6B,MAAZlwB,EAAE+vB,QAA8B,MAAZ/vB,EAAEgwB,OAAgB,CAQlE,GANAuB,EAAavxB,EAxCF0C,MA2CX1C,EAAE+vB,OAAoB,MAAX/vB,EAAEkwB,MAAgBlwB,EAAEkwB,MAAoB,MAAZlwB,EAAE+vB,OAAiB/vB,EAAE+vB,OAAS,EACrE/vB,EAAEgwB,OAAoB,MAAXhwB,EAAEkwB,MAAgBlwB,EAAEkwB,MAAoB,MAAZlwB,EAAEgwB,OAAiBhwB,EAAEgwB,OAAS,GAEhEvL,EAAU,CAEb,IAAI5d,EAAIgmB,EAAOD,UACf5sB,EAAE+vB,OAAoB,EAAX/vB,EAAE+vB,OAAalpB,EAAEkpB,OAC5B/vB,EAAEgwB,OAAoB,EAAXhwB,EAAEgwB,OAAanpB,EAAEmpB,OAG9BnD,EAASA,EAAOqD,MAAMlwB,EAAE+vB,OAAQ/vB,EAAEgwB,OAAQhwB,EAAE+R,GAAI/R,EAAEgS,SAG/B,MAAVhS,EAAEswB,MAA2B,MAAXtwB,EAAEwvB,OAA4B,MAAXxvB,EAAE8vB,OAEhDyB,EAAavxB,EA1DF0C,MA6DX1C,EAAEwvB,MAAkB,MAAVxvB,EAAEswB,KAAetwB,EAAEswB,KAAkB,MAAXtwB,EAAEwvB,MAAgBxvB,EAAEwvB,MAAQ,EAChExvB,EAAE8vB,MAAkB,MAAV9vB,EAAEswB,KAAetwB,EAAEswB,KAAkB,MAAXtwB,EAAE8vB,MAAgB9vB,EAAE8vB,MAAQ,EAE3DrL,IAEC5d,EAAIgmB,EAAOD,UACfC,EAASA,EAAOH,UAAS,IAAItd,EAAIqd,QAAS6D,KAAKzpB,EAAE2oB,MAAO3oB,EAAEipB,MAAO9vB,EAAE+R,GAAI/R,EAAEgS,IAAIxL,YAG/EqmB,EAASA,EAAOyD,KAAKtwB,EAAEwvB,MAAOxvB,EAAE8vB,MAAO9vB,EAAE+R,GAAI/R,EAAEgS,KAGtChS,EAAEqwB,MACE,KAAVrwB,EAAEqwB,MAAyB,KAAVrwB,EAAEqwB,KACpBrwB,EAAEqG,OAAqB,MAAZrG,EAAEqG,OA3EJ3D,KA2E4B4f,OAAO,IAAMtiB,EAAEqwB,MAAQrwB,EAAEqG,OAE/C,MAAZrG,EAAEqG,QACHic,EA9EO5f,KA8EO4f,OACdtiB,EAAEqwB,KAAO/N,EAAKvQ,GACd/R,EAAEqG,OAASic,EAAKtQ,IAEhBhS,EAAEqwB,KAAOrwB,EAAEqG,OAIfwmB,GAAS,IAAIzd,EAAIqd,QAAS4D,KAAKrwB,EAAEqwB,KAAMrwB,EAAEqG,SAGzB,MAAPrG,EAAEiK,GAAoB,MAAPjK,EAAEqQ,IACtBoU,EAEFoI,EAASA,EAAOpd,UAAUzP,EAAEiK,EAAGjK,EAAEqQ,IAGtB,MAAPrQ,EAAEiK,IAAW4iB,EAAOhmB,EAAI7G,EAAEiK,GACnB,MAAPjK,EAAEqQ,IAAWwc,EAAO6C,EAAI1vB,EAAEqQ,KAIlC,OAAO3N,KAAK0N,KAAK,YAAayc,MAIlCzd,EAAIwM,OAAOxM,EAAImZ,GAAI,CACjB7T,UAAW,SAAS1U,EAAGykB,GAErB,IACIoI,EAAQvK,EADR3K,EAASjV,KAAKiV,SAIlB,MAAiB,iBAAN3X,GAET6sB,EAAS,IAAIzd,EAAIqd,OAAO9U,GAAQiV,UAEZ,iBAAN5sB,EAAiB6sB,EAAO7sB,GAAK6sB,IAI7CpI,IAAaA,KAAczkB,EAAEykB,SAGlB,MAAPzkB,EAAEqC,EACJwqB,EAAS,IAAIzd,EAAIqd,OAAOzsB,GAGD,MAAdA,EAAE2U,UAEX4c,EAAavxB,EAAG2X,GAGhBkV,EAAS,IAAIzd,EAAIoiB,OAAOxxB,EAAE2U,SAAU3U,EAAE+R,GAAI/R,EAAEgS,KAGxB,MAAXhS,EAAEkwB,OAA6B,MAAZlwB,EAAE+vB,QAA8B,MAAZ/vB,EAAEgwB,QAElDuB,EAAavxB,EAAG2X,GAGhB3X,EAAE+vB,OAAoB,MAAX/vB,EAAEkwB,MAAgBlwB,EAAEkwB,MAAoB,MAAZlwB,EAAE+vB,OAAiB/vB,EAAE+vB,OAAS,EACrE/vB,EAAEgwB,OAAoB,MAAXhwB,EAAEkwB,MAAgBlwB,EAAEkwB,MAAoB,MAAZlwB,EAAEgwB,OAAiBhwB,EAAEgwB,OAAS,EAErEnD,EAAS,IAAIzd,EAAIqiB,MAAMzxB,EAAE+vB,OAAQ/vB,EAAEgwB,OAAQhwB,EAAE+R,GAAI/R,EAAEgS,KAG/B,MAAXhS,EAAEwvB,OAA4B,MAAXxvB,EAAE8vB,OAE9ByB,EAAavxB,EAAG2X,GAGhB3X,EAAEwvB,MAAmB,MAAXxvB,EAAEwvB,MAAgBxvB,EAAEwvB,MAAQ,EACtCxvB,EAAE8vB,MAAmB,MAAX9vB,EAAE8vB,MAAgB9vB,EAAE8vB,MAAQ,EAEtCjD,EAAS,IAAIzd,EAAIsiB,KAAK1xB,EAAEwvB,MAAOxvB,EAAE8vB,MAAO9vB,EAAE+R,GAAI/R,EAAEgS,KAGvChS,EAAEqwB,MACE,KAAVrwB,EAAEqwB,MAAyB,KAAVrwB,EAAEqwB,KACpBrwB,EAAEqG,OAAqB,MAAZrG,EAAEqG,OAAiBsR,EAAO2K,OAAO,IAAMtiB,EAAEqwB,MAAQrwB,EAAEqG,OAE/C,MAAZrG,EAAEqG,QACHic,EAAO3K,EAAO2K,OACdtiB,EAAEqwB,KAAO/N,EAAKvQ,GACd/R,EAAEqG,OAASic,EAAKtQ,IAEhBhS,EAAEqwB,KAAOrwB,EAAEqG,OAIfwmB,GAAS,IAAIzd,EAAIqd,QAAS4D,KAAKrwB,EAAEqwB,KAAMrwB,EAAEqG,SAGzB,MAAPrG,EAAEiK,GAAoB,MAAPjK,EAAEqQ,IAC1Bwc,EAAS,IAAIzd,EAAIuiB,UAAU3xB,EAAEiK,EAAGjK,EAAEqQ,IAGhCwc,GAEJA,EAAOpI,SAAWA,EAElB/hB,KAAKooB,OAAO3M,WAAWvW,KAAKilB,GAErBnqB,KAAK4oB,cANO5oB,SAUvB0M,EAAIwM,OAAOxM,EAAI4N,QAAS,CAEtB4U,YAAa,WACX,OAAOlvB,KAAK0N,KAAK,YAAa,OAGhC8Z,UAAW,WAiBT,OAfcxnB,KAAK0N,KAAK,cAAgB,IAErCtJ,MAAMsI,EAAI0O,MAAMK,YAAYrC,MAAM,GAAG,GAAG7V,IAAI,SAAS4rB,GAEpD,IAAIC,EAAKD,EAAIpQ,OAAO3a,MAAM,KAC1B,MAAO,CAACgrB,EAAG,GAAIA,EAAG,GAAGhrB,MAAMsI,EAAI0O,MAAMc,WAAW3Y,IAAI,SAAS4rB,GAAM,OAAOnQ,WAAWmQ,QAGtFnO,OAAO,SAASmJ,EAAQnY,GAEvB,MAAmB,UAAhBA,EAAU,GAAuBmY,EAAOH,SAASyC,EAAcza,EAAU,KACrEmY,EAAOnY,EAAU,IAAI8X,MAAMK,EAAQnY,EAAU,KAEnD,IAAItF,EAAIqd,SAKfsF,SAAU,SAASxV,GACjB,GAAG7Z,MAAQ6Z,EAAQ,OAAO7Z,KAC1B,IAAIguB,EAAMhuB,KAAKusB,YACX+C,EAAOzV,EAAO0S,YAAYzoB,UAI9B,OAFA9D,KAAK0iB,MAAM7I,GAAQqV,cAAcld,UAAUsd,EAAKtF,SAASgE,IAElDhuB,MAGTuvB,MAAO,WACL,OAAOvvB,KAAKqvB,SAASrvB,KAAKsjB,UAK9B5W,EAAI8iB,eAAiB9iB,EAAI8M,OAAO,CAE9Brb,OAAQ,SAASmpB,EAAQmI,GAEvB,GAAGpW,UAAU/X,OAAS,GAAwB,kBAAZmuB,EAChC,OAAOzvB,KAAK2Z,YAAY3c,KAAKgD,KAAM,GAAGoZ,MAAMpc,KAAKqc,YAGnD,GAAGzU,MAAMka,QAAQwI,GACf,IAAI,IAAIzqB,EAAI,EAAGsF,EAAMnC,KAAKqZ,UAAU/X,OAAQzE,EAAIsF,IAAOtF,EACrDmD,KAAKA,KAAKqZ,UAAUxc,IAAMyqB,EAAOzqB,QAE9B,GAAoB,iBAAVyqB,EACf,IAAQzqB,EAAI,EAAGsF,EAAMnC,KAAKqZ,UAAU/X,OAAQzE,EAAIsF,IAAOtF,EACrDmD,KAAKA,KAAKqZ,UAAUxc,IAAMyqB,EAAOtnB,KAAKqZ,UAAUxc,IAIpDmD,KAAKyvB,UAAW,GAEA,IAAbA,IACDzvB,KAAKyvB,UAAW,IAKpBvW,OAAQ,CAENG,UAAW,GACX4P,OAAQ,GAER5K,GAAI,SAASC,GAIX,IAFA,IAAIoR,EAAS,GAEL7yB,EAAI,EAAGsF,EAAMnC,KAAKqZ,UAAU/X,OAAQzE,EAAIsF,IAAOtF,EACrD6yB,EAAOxqB,KAAKlF,KAAKA,KAAKqZ,UAAUxc,KAGlC,IAAII,EAAI+C,KAAK2vB,OAAS,IAAIjjB,EAAIqd,OAI9B,OAFA9sB,GAAI,IAAIyP,EAAIqd,QAAS5L,MAAMzR,EAAIqd,OAAOtrB,UAAUuB,KAAKipB,QAAQa,MAAM7sB,EAAGyyB,IAASrR,GAAGC,GAE3Ete,KAAKyvB,SAAWxyB,EAAE6G,UAAY7G,GAIvCgtB,KAAM,SAAS3sB,GACb,IAAI,IAAIT,EAAI,EAAGsF,EAAMnC,KAAKqZ,UAAU/X,OAAQzE,EAAIsF,IAAOtF,EACrDS,EAAE0C,KAAKqZ,UAAUxc,SAAwC,IAA3BmD,KAAKA,KAAKqZ,UAAUxc,IAAqB,EAAIS,EAAE0C,KAAKqZ,UAAUxc,IAW9F,OALAS,EAAE+R,GAAKrP,KAAKqP,GACZ/R,EAAEgS,GAAKtP,KAAKsP,GAEZtP,KAAK2vB,MAAQ,IAAIjjB,EAAIuM,EAAWjZ,KAAKipB,UAAS3rB,GAAG,GAAM+gB,GAAG,GAEnDre,SAOb0M,EAAIuiB,UAAYviB,EAAI8M,OAAO,CAEzBK,OAAQnN,EAAIqd,OACZxQ,QAAS7M,EAAI8iB,eAEbrxB,OAAQ,SAASmpB,EAAQmI,GACvBzvB,KAAK2Z,YAAYmQ,MAAM9pB,KAAM,GAAGoZ,MAAMpc,KAAKqc,aAG7CH,OAAQ,CACNG,UAAW,CAAC,eAAgB,gBAC5B4P,OAAQ,eAKZvc,EAAIoiB,OAASpiB,EAAI8M,OAAO,CAEtBK,OAAQnN,EAAIqd,OACZxQ,QAAS7M,EAAI8iB,eAEbrxB,OAAQ,SAASmpB,EAAQmI,GACvBzvB,KAAK2Z,YAAYmQ,MAAM9pB,KAAM,GAAGoZ,MAAMpc,KAAKqc,aAG7CH,OAAQ,CACNG,UAAW,CAAC,WAAY,KAAM,MAC9B4P,OAAQ,SACR5K,GAAI,SAASC,GACX,IAAIrhB,GAAI,IAAIyP,EAAIqd,QAAS2D,QAAO,IAAIhhB,EAAI2U,QAASlD,MAAMne,KAAKiS,UAAYjS,KAAK2vB,MAAQ3vB,KAAK2vB,MAAM1d,SAAW,IAAIoM,GAAGC,GAAMte,KAAKqP,GAAIrP,KAAKsP,IACtI,OAAOtP,KAAKyvB,SAAWxyB,EAAE6G,UAAY7G,GAEvCgtB,KAAM,SAAS3sB,GAEb,OADA0C,KAAK2vB,MAAQryB,EACN0C,SAMb0M,EAAIqiB,MAAQriB,EAAI8M,OAAO,CAErBK,OAAQnN,EAAIqd,OACZxQ,QAAS7M,EAAI8iB,eAEbrxB,OAAQ,SAASmpB,EAAQmI,GACvBzvB,KAAK2Z,YAAYmQ,MAAM9pB,KAAM,GAAGoZ,MAAMpc,KAAKqc,aAG7CH,OAAQ,CACNG,UAAW,CAAC,SAAU,SAAU,KAAM,MACtC4P,OAAQ,WAKZvc,EAAIsiB,KAAOtiB,EAAI8M,OAAO,CAEpBK,OAAQnN,EAAIqd,OACZxQ,QAAS7M,EAAI8iB,eAEbrxB,OAAQ,SAASmpB,EAAQmI,GACvBzvB,KAAK2Z,YAAYmQ,MAAM9pB,KAAM,GAAGoZ,MAAMpc,KAAKqc,aAG7CH,OAAQ,CACNG,UAAW,CAAC,QAAS,QAAS,KAAM,MACpC4P,OAAQ,UAKZvc,EAAIwM,OAAOxM,EAAI4N,QAAS,CAEtBvC,MAAO,SAASnZ,EAAGY,GACjB,GAAwB,GAApB6Z,UAAU/X,OAEZ,OAAOtB,KAAKga,KAAKjC,MAAM6X,SAAW,GAE7B,GAAIvW,UAAU/X,OAAS,EAE5B,GAAgB,iBAAL1C,EACT,IAAKY,KAAKZ,EAAGoB,KAAK+X,MAAMvY,EAAGZ,EAAEY,QAExB,KAAIkN,EAAI0O,MAAMS,MAAM8B,KAAK/e,GAa9B,OAAOoB,KAAKga,KAAKjC,MAAM8X,EAAUjxB,IALjC,IANAA,EAAIA,EAAEwF,MAAM,WAETwY,OAAO,SAASzY,GAAK,QAASA,IAC9BZ,IAAI,SAASY,GAAI,OAAOA,EAAEC,MAAM,aAG5B5E,EAAIZ,EAAE0a,OACXtZ,KAAK+X,MAAMvY,EAAE,GAAIA,EAAE,SAQvBQ,KAAKga,KAAKjC,MAAM8X,EAAUjxB,IAAY,OAANY,GAAckN,EAAI0O,MAAMU,QAAQ6B,KAAKne,GAAK,GAAKA,EAGjF,OAAOQ,QAGX0M,EAAIsX,OAAStX,EAAI8M,OAAO,CAEtBrb,OAAQ,SAASY,GACfiB,KAAK2Z,YAAY3c,KAAKgD,KAAMjB,IAI9Bwa,QAAS7M,EAAI4N,QAGbpB,OAAQ,CAEN4W,SAAU,WACR,OAAOpjB,EAAI8P,MAAMjZ,IAAImJ,EAAI8P,MAAMQ,kBAAkBhd,KAAKga,KAAKoK,YAAa,SAASpK,GAC/E,OAAOtN,EAAIqN,MAAMC,MAIrBpW,IAAK,SAAS7E,EAASlC,GAMrB,OALS,MAALA,EACFmD,KAAKga,KAAKiK,YAAYllB,EAAQib,MACvBjb,EAAQib,MAAQha,KAAKga,KAAKoK,WAAWvnB,IAC5CmD,KAAKga,KAAK+V,aAAahxB,EAAQib,KAAMha,KAAKga,KAAKoK,WAAWvnB,IAErDmD,MAGT2iB,IAAK,SAAS5jB,EAASlC,GAErB,OADAmD,KAAK4D,IAAI7E,EAASlC,GACXkC,GAGTqB,IAAK,SAASrB,GACZ,OAAOiB,KAAK4B,MAAM7C,IAAY,GAGhC6C,MAAO,SAAS7C,GACd,MAAO,GAAGqa,MAAMpc,KAAKgD,KAAKga,KAAKoK,YAAYniB,QAAQlD,EAAQib,OAG7Dtc,IAAK,SAASb,GACZ,OAAO6P,EAAIqN,MAAM/Z,KAAKga,KAAKoK,WAAWvnB,KAGxCmzB,MAAO,WACL,OAAOhwB,KAAKtC,IAAI,IAGlB0qB,KAAM,WACJ,OAAOpoB,KAAKtC,IAAIsC,KAAKga,KAAKoK,WAAW9iB,OAAS,IAGhDmM,KAAM,SAASiP,EAAOuT,GACpB,IAAIpzB,EAAG8f,EACHmT,EAAW9vB,KAAK8vB,WAEpB,IAAKjzB,EAAI,EAAG8f,EAAKmT,EAASxuB,OAAQzE,EAAI8f,EAAI9f,IACpCizB,EAASjzB,aAAc6P,EAAI4N,SAC7BoC,EAAMoN,MAAMgG,EAASjzB,GAAI,CAACA,EAAGizB,IAE3BG,GAASH,EAASjzB,aAAc6P,EAAIoN,WACtCgW,EAASjzB,GAAG4Q,KAAKiP,EAAOuT,GAG5B,OAAOjwB,MAGTyiB,cAAe,SAAS1jB,GAGtB,OAFAiB,KAAKga,KAAKkW,YAAYnxB,EAAQib,MAEvBha,MAGTmY,MAAO,WAEL,KAAMnY,KAAKga,KAAKmW,iBACdnwB,KAAKga,KAAKkW,YAAYlwB,KAAKga,KAAKoW,WAKlC,cAFOpwB,KAAKqwB,MAELrwB,MAGTya,KAAM,WACJ,OAAOza,KAAKsjB,MAAM7I,WAMxB/N,EAAIwM,OAAOxM,EAAIsX,OAAQ,CAErBsM,QAAS,SAASzW,EAAQ0W,GACxB,OAAa,IAAVA,GAAevwB,gBAAgB0M,EAAI8jB,MAAQxwB,KAAKga,MAAQtN,EAAI8L,OAAO/L,KAAazM,MAEnF6Z,EAASA,IAAW7Z,gBAAgB0M,EAAI6L,IAAMvY,KAAOA,KAAK6Z,OAAOnN,EAAIsX,SACrEuM,EAAQA,GAASnF,IAEjBprB,KAAKyN,KAAK,WACR,OAAGzN,gBAAgB0M,EAAI8jB,KAAaxwB,KACjCA,gBAAgB0M,EAAIsX,OAAehkB,KAAKswB,QAAQzW,EAAQ0W,EAAM,GAC1DvwB,KAAKqvB,SAASxV,KAGvB7Z,KAAKga,KAAKmK,YAAcnkB,KAAKsJ,SAEtBtJ,OAGTywB,QAAS,SAAS5W,EAAQ0W,GACxB,OAAOvwB,KAAKswB,QAAQzW,EAAQ0W,MAIhC7jB,EAAIoN,UAAYpN,EAAI8M,OAAO,CAEzBrb,OAAQ,SAASY,GACfiB,KAAK2Z,YAAY3c,KAAKgD,KAAMjB,IAI9Bwa,QAAS7M,EAAIsX,SAIftX,EAAIie,QAAUje,EAAI8M,OAAO,CAEvBrb,OAAQ,SAASmpB,GACf,IAEI/f,EAAGoG,EAAGN,EAAOD,EAAasjB,EAAMC,EAAIC,EAFjCpE,EAAO,CAAC,EAAG,EAAG,EAAG,GAGpBqE,EAAO,EACPC,EAAO,EACPC,EAAO,+CAEX,GAAGzJ,aAAkB5a,EAAI4N,QAAQ,CAY/B,IAVAqW,EAAKrJ,EACLsJ,EAAKtJ,EACLoJ,GAAQpJ,EAAO5Z,KAAK,YAAc,IAAI+P,MAAMsT,GACtCzJ,EAAO1H,KAGbvS,EAAS,IAAIX,EAAI2U,OAAOiG,EAAOja,SAC/BD,EAAS,IAAIV,EAAI2U,OAAOiG,EAAOla,UAGV,KAAdC,EAAMiU,MACXuP,GAAMxjB,EAAMvP,MACZuP,EAAQ,IAAIX,EAAI2U,OAAOsP,aAAcjkB,EAAI6L,IAAMoY,EAAG9W,SAASmX,YAAcL,EAAG9W,SAASxM,SACrFsjB,EAAKA,EAAG9W,SAEV,KAAsB,KAAfzM,EAAOkU,MACZwP,GAAM1jB,EAAOtP,MACbsP,EAAS,IAAIV,EAAI2U,OAAOuP,aAAclkB,EAAI6L,IAAMqY,EAAG/W,SAASoX,aAAeL,EAAG/W,SAASzM,UACvFwjB,EAAKA,EAAG/W,SAIV7Z,KAAKuH,EAAS,EACdvH,KAAK2N,EAAS,EACd3N,KAAKqN,MAASA,EAASwjB,EACvB7wB,KAAKoN,OAASA,EAAS0jB,EACvB9wB,KAAKkxB,KAAS,EAEVR,IAEFnpB,EAASyX,WAAW0R,EAAK,IACzB/iB,EAASqR,WAAW0R,EAAK,IACzBrjB,EAAS2R,WAAW0R,EAAK,IACzBtjB,EAAS4R,WAAW0R,EAAK,IAGzB1wB,KAAKkxB,KAASlxB,KAAKqN,MAAQrN,KAAKoN,OAAWC,EAAQD,EACjDpN,KAAKoN,OAASA,EACdpN,KAAKqN,MAASA,EAGhBrN,KAAKuH,EAASA,EACdvH,KAAK2N,EAASA,EACd3N,KAAKqN,MAASA,EACdrN,KAAKoN,OAASA,QAOhBka,EAA2B,iBAAXA,EACdA,EAAO7J,MAAMsT,GAAKxtB,IAAI,SAASgU,GAAK,OAAOyH,WAAWzH,KACxD3S,MAAMka,QAAQwI,GACZA,EACe,iBAAVA,EACL,CAACA,EAAO/f,EAAG+f,EAAO3Z,EAAG2Z,EAAOja,MAAOia,EAAOla,QACxB,GAApBiM,UAAU/X,OACR,GAAG8X,MAAMpc,KAAKqc,WACdmT,EAEFxsB,KAAKuH,EAAI+f,EAAO,GAChBtnB,KAAK2N,EAAI2Z,EAAO,GAChBtnB,KAAKqN,MAAQia,EAAO,GACpBtnB,KAAKoN,OAASka,EAAO,IAMzBpO,OAAQ,CAEN4E,SAAU,WACR,OAAO9d,KAAKuH,EAAI,IAAMvH,KAAK2N,EAAI,IAAM3N,KAAKqN,MAAQ,IAAMrN,KAAKoN,QAE/D+Q,MAAO,SAAS5W,EAAGoG,EAAGN,EAAOD,GAE3B,OADApN,KAAKoe,YAAc,IAAI1R,EAAIie,QAAQpjB,EAAGoG,EAAGN,EAAOD,GACzCpN,MAGTqe,GAAI,SAASC,GAEX,OAAIte,KAAKoe,YAEF,IAAI1R,EAAIie,QAAQ,CACnB3qB,KAAKuH,GAAKvH,KAAKoe,YAAY7W,EAAIvH,KAAKuH,GAAK+W,EACzCte,KAAK2N,GAAK3N,KAAKoe,YAAYzQ,EAAI3N,KAAK2N,GAAK2Q,EACzCte,KAAKqN,OAASrN,KAAKoe,YAAY/Q,MAAQrN,KAAKqN,OAASiR,EACrDte,KAAKoN,QAAUpN,KAAKoe,YAAYhR,OAASpN,KAAKoN,QAAUkR,IAN/Bte,OAcjC6Z,OAAQnN,EAAIoN,UAGZF,UAAW,CAGThN,QAAS,SAASrF,EAAGoG,EAAGN,EAAOD,GAC7B,OAAwB,GAApBiM,UAAU/X,OAEL,IAAIoL,EAAIie,QAAQ3qB,MAGlBA,KAAK0N,KAAK,UAAW,IAAIhB,EAAIie,QAAQpjB,EAAGoG,EAAGN,EAAOD,QAQ9D,CAAE,QACD,WACA,YACA,UACA,YACA,WACA,YACA,aACA,aACA,aACA,YACA,aACA,WACA,eAAgBzH,QAAQ,SAAUyD,GAEhCsD,EAAI4N,QAAQ7b,UAAU2K,GAAS,SAAU4jB,GAOvC,OALS,MAALA,EACFtgB,EAAIic,IAAI3oB,KAAMoJ,GAEdsD,EAAI8b,GAAGxoB,KAAMoJ,EAAO4jB,GAEfhtB,QAIb0M,EAAIykB,WAAa,EAGjBzkB,EAAI8b,GAAK,SAAUxO,EAAMoX,EAAQC,EAAUC,EAASC,GAClD,IAAIz0B,EAAIu0B,EAAShzB,KAAKizB,GAAWtX,GAC7B1b,EAAI0b,aAAgBtN,EAAI4N,QAAUN,EAAKA,KAAOA,EAGlD1b,EAAE2b,SAAW3b,EAAE2b,UAAY,CAACiI,QAAS,IAErC,IAAIsP,EAAMlzB,EAAE2b,SAASiI,QAGhBmP,EAASI,mBAAoBJ,EAASI,mBAAqB/kB,EAAIykB,YAEpEC,EAAOhtB,MAAMsI,EAAI0O,MAAMc,WAAWvW,QAAQ,SAAUyD,GAClD,IAAIsoB,EAAKtoB,EAAMhF,MAAM,KAAK,GACtBlG,EAAKkL,EAAMhF,MAAM,KAAK,IAAM,IAGhCotB,EAAIE,GAAMF,EAAIE,IAAO,GACrBF,EAAIE,GAAIxzB,GAAMszB,EAAIE,GAAIxzB,IAAO,GAG7BszB,EAAIE,GAAIxzB,GAAImzB,EAASI,kBAAoB30B,EAGzCwB,EAAEgM,iBAAiBonB,EAAI50B,EAAGy0B,IAAW,MAKzC7kB,EAAIic,IAAM,SAAU3O,EAAMoX,EAAQC,EAAUE,GAC1C,IAAIjzB,EAAI0b,aAAgBtN,EAAI4N,QAAUN,EAAKA,KAAOA,EAClD,GAAK1b,EAAE2b,WAGiB,mBAAboX,IACTA,EAAWA,EAASI,mBADtB,CAKA,IAAID,EAAMlzB,EAAE2b,SAASiI,SAEnBkP,GAAU,IAAIhtB,MAAMsI,EAAI0O,MAAMc,WAAWvW,QAAQ,SAAUyD,GAC3D,IAEIoR,EAAW1d,EAFX40B,EAAKtoB,GAASA,EAAMhF,MAAM,KAAK,GAC/BlG,EAAKkL,GAASA,EAAMhF,MAAM,KAAK,GAGnC,GAAIitB,EAEEG,EAAIE,IAAOF,EAAIE,GAAIxzB,GAAM,OAE3BI,EAAEqzB,oBAAoBD,EAAIF,EAAIE,GAAIxzB,GAAM,KAAKmzB,GAAWE,IAAW,UAE5DC,EAAIE,GAAIxzB,GAAM,KAAKmzB,SAEvB,GAAIK,GAAMxzB,GAEf,GAAIszB,EAAIE,IAAOF,EAAIE,GAAIxzB,GAAK,CAC1B,IAAKpB,KAAK00B,EAAIE,GAAIxzB,GAAOwO,EAAIic,IAAIrqB,EAAG,CAACozB,EAAIxzB,GAAIuG,KAAK,KAAM3H,UAEjD00B,EAAIE,GAAIxzB,SAEZ,GAAIA,EAET,IAAKkL,KAASooB,EACZ,IAAKhX,KAAagX,EAAIpoB,GAChBlL,IAAOsc,GAAa9N,EAAIic,IAAIrqB,EAAG,CAAC8K,EAAOlL,GAAIuG,KAAK,WAGnD,GAAIitB,GAET,GAAIF,EAAIE,GAAK,CACX,IAAKlX,KAAagX,EAAIE,GAAOhlB,EAAIic,IAAIrqB,EAAG,CAACozB,EAAIlX,GAAW/V,KAAK,aAEtD+sB,EAAIE,QAER,CAEL,IAAKtoB,KAASooB,EAAO9kB,EAAIic,IAAIrqB,EAAG8K,GAEhC9K,EAAE2b,SAASiI,QAAU,QAK3BxV,EAAIwM,OAAOxM,EAAI4N,QAAS,CAEtBkO,GAAI,SAAUpf,EAAOioB,EAAUC,EAASC,GAEtC,OADA7kB,EAAI8b,GAAGxoB,KAAMoJ,EAAOioB,EAAUC,EAASC,GAChCvxB,MAGT2oB,IAAK,SAAUvf,EAAOioB,GAEpB,OADA3kB,EAAIic,IAAI3oB,KAAKga,KAAM5Q,EAAOioB,GACnBrxB,MAET0pB,KAAM,SAAUtgB,EAAOwoB,GAQrB,OANIxoB,aAAiBa,EAAO4nB,MAC1B7xB,KAAKga,KAAK8X,cAAc1oB,GAExBpJ,KAAKga,KAAK8X,cAAc1oB,EAAQ,IAAIsD,EAAIqlB,YAAY3oB,EAAO,CAACsf,OAAQkJ,EAAMI,YAAY,KAExFhyB,KAAKiiB,OAAS7Y,EACPpJ,MAEToJ,MAAO,WACL,OAAOpJ,KAAKiiB,UAKhBvV,EAAI8jB,KAAO9jB,EAAI8M,OAAO,CAEpBrb,OAAQ,OAGRob,QAAS7M,EAAIoN,YAGfpN,EAAI6d,EAAI7d,EAAI8M,OAAO,CAEjBrb,OAAQ,IAGRob,QAAS7M,EAAIoN,UAGbZ,OAAQ,CAEN3R,EAAG,SAASA,GACV,OAAY,MAALA,EAAYvH,KAAKgS,UAAU,KAAOhS,KAAKgS,UAAU,CAAEzK,EAAGA,EAAIvH,KAAKuH,MAAO,IAG/EoG,EAAG,SAASA,GACV,OAAY,MAALA,EAAY3N,KAAKgS,UAAU,KAAOhS,KAAKgS,UAAU,CAAErE,EAAGA,EAAI3N,KAAK2N,MAAO,IAG/E0B,GAAI,SAAS9H,GACX,OAAY,MAALA,EAAYvH,KAAKiyB,OAAO5iB,GAAKrP,KAAKuH,EAAEA,EAAIvH,KAAKiyB,OAAO5kB,MAAQ,IAGrEiC,GAAI,SAAS3B,GACX,OAAY,MAALA,EAAY3N,KAAKiyB,OAAO3iB,GAAKtP,KAAK2N,EAAEA,EAAI3N,KAAKiyB,OAAO7kB,OAAS,IAEtE6kB,KAAM,WAEJ,IAAIrS,EAAQ5f,KAAK4f,OACbsS,EAAQlyB,KAAKgS,YAUjB,OARA4N,EAAKrY,GAAM2qB,EAAM3qB,EACjBqY,EAAK5O,IAAMkhB,EAAM3qB,EACjBqY,EAAKvQ,IAAM6iB,EAAM3qB,EAEjBqY,EAAKjS,GAAMukB,EAAMvkB,EACjBiS,EAAKtP,IAAM4hB,EAAMvkB,EACjBiS,EAAKtQ,IAAM4iB,EAAMvkB,EAEViS,IAKXhG,UAAW,CAET9M,MAAO,WACL,OAAO9M,KAAK2iB,IAAI,IAAIjW,EAAI6d,OAK9B7d,EAAI6L,IAAM7L,EAAI8M,OAAO,CAEnBrb,OAAQ,SAASY,GACXA,IAQsB,QANxBA,EAA4B,iBAAXA,EACfC,EAASC,eAAeF,GACxBA,GAIU8X,SACV7W,KAAK2Z,YAAY3c,KAAKgD,KAAMjB,IAE5BiB,KAAK2Z,YAAY3c,KAAKgD,KAAM0M,EAAIvO,OAAO,QACvCY,EAAQklB,YAAYjkB,KAAKga,MACzBha,KAAK2M,KAAK,OAAQ,SAIpB3M,KAAKwa,YAAYC,SAKrBlB,QAAS7M,EAAIoN,UAGbZ,OAAQ,CAENsB,UAAW,WACT,OAAOxa,KACJ0N,KAAK,CAAEgL,MAAOhM,EAAIxO,GAAIi0B,QAAS,QAC/BzkB,KAAK,cAAehB,EAAIiM,MAAOjM,EAAIgM,OACnChL,KAAK,cAAehB,EAAIkM,MAAOlM,EAAIgM,QAGxC+B,KAAM,WAEF,IAAIA,EAYN,OAbKza,KAAKqwB,SAIJ5V,EAAOza,KAAKga,KAAKc,qBAAqB,QAAQ,IAChD9a,KAAKqwB,MAAQ3jB,EAAIqN,MAAMU,GAEvBza,KAAKqwB,MAAQ,IAAI3jB,EAAI8jB,KAGvBxwB,KAAKga,KAAKiK,YAAYjkB,KAAKqwB,MAAMrW,OAG5Bha,KAAKqwB,OAGdxW,OAAQ,WACN,OAAI7Z,KAAKga,KAAKE,YAA+C,aAAjCla,KAAKga,KAAKE,WAAWrD,UAA4D,sBAAjC7W,KAAKga,KAAKE,WAAWrD,SAC1F7W,KAAKga,KAAKE,WADyH,MAK5IkY,KAAM,WACJ,IAAI9T,EAAMte,KAAKga,KAAKkU,eAOpB,OALI5P,GACFte,KACG+X,MAAM,QAAUuG,EAAIna,EAAI,EAAK,MAC7B4T,MAAM,OAAUuG,EAAI0O,EAAI,EAAK,MAE3BhtB,MAITsJ,OAAQ,WAKN,OAJGtJ,KAAK6Z,UACN7Z,KAAK6Z,SAASqW,YAAYlwB,KAAKga,MAG1Bha,MAETmY,MAAO,WAEL,KAAMnY,KAAKga,KAAKmW,iBACdnwB,KAAKga,KAAKkW,YAAYlwB,KAAKga,KAAKoW,WASlC,cANOpwB,KAAKqwB,MAGR3jB,EAAI8L,OAAO/L,KAAKyN,YAClBla,KAAKga,KAAKiK,YAAYvX,EAAI8L,OAAO/L,MAE5BzM,MAETkf,MAAO,SAAUrF,GAEf7Z,KAAKqiB,iBAGL,IAAIrI,EAAOha,KAAKga,KAGZkF,EAAQoD,EAAYtI,EAAKuI,WAAU,IASvC,OANG1I,GACAA,EAAOG,MAAQH,GAAQoK,YAAY/E,EAAMlF,MAE1CA,EAAKE,WAAW6V,aAAa7Q,EAAMlF,KAAMA,EAAKqY,aAGzCnT,MASbxS,EAAIwM,OAAOxM,EAAI4N,QAAS,CAEtBgY,SAAU,WACR,OAAOtyB,KAAK6Z,SAASiW,YAGvBrZ,SAAU,WACR,OAAOzW,KAAK6Z,SAASjY,MAAM5B,OAG7BuyB,KAAM,WACJ,OAAOvyB,KAAKsyB,WAAWtyB,KAAKyW,WAAa,IAG3C+b,SAAU,WACR,OAAOxyB,KAAKsyB,WAAWtyB,KAAKyW,WAAa,IAG3C5S,QAAS,WACP,IAAIhH,EAAImD,KAAKyW,WAAa,EACtB9X,EAAIqB,KAAK6Z,SASb,OANAlb,EAAE8jB,cAAcziB,MAAM4D,IAAI5D,KAAMnD,GAG5B8B,aAAa+N,EAAI6L,KACnB5Z,EAAEqb,KAAKiK,YAAYtlB,EAAE8b,OAAOT,MAEvBha,MAGTyyB,SAAU,WACR,IAAI51B,EAAImD,KAAKyW,WAKb,OAHI5Z,EAAI,GACNmD,KAAK6Z,SAAS4I,cAAcziB,MAAM4D,IAAI5D,KAAMnD,EAAI,GAE3CmD,MAGT0yB,MAAO,WACL,IAAI/zB,EAAIqB,KAAK6Z,SASb,OANAlb,EAAEqb,KAAKiK,YAAYjkB,KAAKga,MAGpBrb,aAAa+N,EAAI6L,KACnB5Z,EAAEqb,KAAKiK,YAAYtlB,EAAE8b,OAAOT,MAEvBha,MAGT+R,KAAM,WAIJ,OAHI/R,KAAKyW,WAAa,GACpBzW,KAAK6Z,SAAS4I,cAAcziB,MAAM4D,IAAI5D,KAAM,GAEvCA,MAGT2yB,OAAQ,SAAS5zB,GACfA,EAAQuK,SAER,IAAIzM,EAAImD,KAAKyW,WAIb,OAFAzW,KAAK6Z,SAASjW,IAAI7E,EAASlC,GAEpBmD,MAGTwiB,MAAO,SAASzjB,GACdA,EAAQuK,SAER,IAAIzM,EAAImD,KAAKyW,WAIb,OAFAzW,KAAK6Z,SAASjW,IAAI7E,EAASlC,EAAI,GAExBmD,QAIX0M,EAAIkmB,KAAOlmB,EAAI8M,OAAO,CAEpBrb,OAAQ,WACN6B,KAAK2Z,YAAY3c,KAAKgD,KAAM0M,EAAIvO,OAAO,SAGvC6B,KAAK6yB,QAAU,IAIjBtZ,QAAS7M,EAAIoN,UAGbZ,OAAQ,CAEN5P,OAAQ,WAEN,IAAK,IAAIzM,EAAImD,KAAK6yB,QAAQvxB,OAAS,EAAGzE,GAAK,EAAGA,IACxCmD,KAAK6yB,QAAQh2B,IACfmD,KAAK6yB,QAAQh2B,GAAGi2B,SAMpB,OALA9yB,KAAK6yB,QAAU,GAGfnmB,EAAI4N,QAAQ7b,UAAU6K,OAAOtM,KAAKgD,MAE3BA,OAKX4Z,UAAW,CAETmZ,KAAM,WACJ,OAAO/yB,KAAKya,OAAOkI,IAAI,IAAIjW,EAAIkmB,UAMrClmB,EAAIwM,OAAOxM,EAAI4N,QAAS,CAEtB0Y,SAAU,SAASj0B,GAQjB,OANAiB,KAAKizB,OAASl0B,aAAmB2N,EAAIkmB,KAAO7zB,EAAUiB,KAAK6Z,SAASkZ,OAAOnvB,IAAI7E,GAG/EiB,KAAKizB,OAAOJ,QAAQ3tB,KAAKlF,MAGlBA,KAAK0N,KAAK,OAAQ,SAAW1N,KAAKizB,OAAOvlB,KAAK,MAAQ,OAG/DolB,OAAQ,WAEN,cADO9yB,KAAKizB,OACLjzB,KAAK0N,KAAK,OAAQ,SAK7BhB,EAAIwmB,SAAWxmB,EAAI8M,OAAO,CAExBrb,OAAQ,WACN6B,KAAK2Z,YAAY3c,KAAKgD,KAAM0M,EAAIvO,OAAO,aAGvC6B,KAAK6yB,QAAU,IAIjBtZ,QAAS7M,EAAIoN,UAGbZ,OAAQ,CAEN5P,OAAQ,WAEN,IAAK,IAAIzM,EAAImD,KAAK6yB,QAAQvxB,OAAS,EAAGzE,GAAK,EAAGA,IACxCmD,KAAK6yB,QAAQh2B,IACfmD,KAAK6yB,QAAQh2B,GAAGs2B,SAMpB,OALAnzB,KAAK6yB,QAAU,GAGf7yB,KAAK6Z,SAAS4I,cAAcziB,MAErBA,OAKX4Z,UAAW,CAETwZ,KAAM,WACJ,OAAOpzB,KAAKya,OAAOkI,IAAI,IAAIjW,EAAIwmB,cAMrCxmB,EAAIwM,OAAOxM,EAAI4N,QAAS,CAEtB+Y,SAAU,SAASt0B,GAQjB,OANAiB,KAAKszB,QAAUv0B,aAAmB2N,EAAIwmB,SAAWn0B,EAAUiB,KAAK6Z,SAASuZ,OAAOxvB,IAAI7E,GAGpFiB,KAAKszB,QAAQT,QAAQ3tB,KAAKlF,MAGnBA,KAAK0N,KAAK,YAAa,SAAW1N,KAAKszB,QAAQ5lB,KAAK,MAAQ,OAGrEylB,OAAQ,WAEN,cADOnzB,KAAKszB,QACLtzB,KAAK0N,KAAK,YAAa,SAIlChB,EAAI2N,SAAW3N,EAAI8M,OAAO,CAExBrb,OAAQ,SAASoc,GACfva,KAAK2Z,YAAY3c,KAAKgD,KAAM0M,EAAIvO,OAAOoc,EAAO,aAG9Cva,KAAKua,KAAOA,GAIdhB,QAAS7M,EAAIoN,UAGbZ,OAAQ,CAENmF,GAAI,SAAS1a,EAAQmQ,EAAOuJ,GAC1B,OAAOrd,KAAK2iB,IAAI,IAAIjW,EAAIme,MAAMD,OAAOjnB,EAAQmQ,EAAOuJ,IAGtDuN,OAAQ,SAASlO,GAQf,OANA1c,KAAKmY,QAGe,mBAATuE,GACTA,EAAM1f,KAAKgD,KAAMA,MAEZA,MAGTmd,KAAM,WACJ,MAAO,QAAUnd,KAAKlB,KAAO,KAG/Bgf,SAAU,WACR,OAAO9d,KAAKmd,QAGdzP,KAAM,SAAS/N,EAAGqC,EAAG9E,GAEnB,MADQ,aAALyC,IAAkBA,EAAI,qBAClB+M,EAAIoN,UAAUrb,UAAUiP,KAAK1Q,KAAKgD,KAAML,EAAGqC,EAAG9E,KAKzD0c,UAAW,CAET2Z,SAAU,SAAShZ,EAAMmC,GACvB,OAAO1c,KAAKya,OAAO8Y,SAAShZ,EAAMmC,OAMxChQ,EAAIwM,OAAOxM,EAAI2N,SAAU3N,EAAImZ,GAAI,CAE/BhB,KAAM,SAAStd,EAAGoG,GAChB,MAAsC,WAA9B3N,KAAK8lB,SAAW9lB,MAAMua,KAC5Bva,KAAK0N,KAAK,CAAEic,GAAI,IAAIjd,EAAI2U,OAAO9Z,GAAIisB,GAAI,IAAI9mB,EAAI2U,OAAO1T,KACtD3N,KAAK0N,KAAK,CAAE6R,GAAI,IAAI7S,EAAI2U,OAAO9Z,GAAIiY,GAAI,IAAI9S,EAAI2U,OAAO1T,MAG1DmU,GAAI,SAASva,EAAGoG,GACd,MAAsC,WAA9B3N,KAAK8lB,SAAW9lB,MAAMua,KAC5Bva,KAAK0N,KAAK,CAAE2B,GAAI,IAAI3C,EAAI2U,OAAO9Z,GAAI+H,GAAI,IAAI5C,EAAI2U,OAAO1T,KACtD3N,KAAK0N,KAAK,CAAEsD,GAAI,IAAItE,EAAI2U,OAAO9Z,GAAI+I,GAAI,IAAI5D,EAAI2U,OAAO1T,QAK5DjB,EAAIwM,OAAOxM,EAAI8jB,KAAM,CAEnB+C,SAAU,SAAShZ,EAAMmC,GACvB,OAAO1c,KAAK2iB,IAAI,IAAIjW,EAAI2N,SAASE,IAAOqQ,OAAOlO,MAKnDhQ,EAAIme,KAAOne,EAAI8M,OAAO,CAEpBrb,OAAQ,OAGRob,QAAS7M,EAAI4N,QAGbpB,OAAQ,CAEN0R,OAAQ,SAASttB,GAcf,OAbgB,iBAALA,GAAiBA,aAAaoP,EAAI2U,UAC3C/jB,EAAI,CACFqG,OAAS0V,UAAU,GACnBvF,MAASuF,UAAU,GACnBgE,QAAShE,UAAU,KAKN,MAAb/b,EAAE+f,SAAiBrd,KAAK0N,KAAK,eAAgBpQ,EAAE+f,SAClC,MAAb/f,EAAEwW,OAAiB9T,KAAK0N,KAAK,aAAcpQ,EAAEwW,OAChC,MAAbxW,EAAEqG,QAAiB3D,KAAK0N,KAAK,SAAU,IAAIhB,EAAI2U,OAAO/jB,EAAEqG,SAErD3D,SAMb0M,EAAI+mB,QAAU/mB,EAAI8M,OAAO,CAEvBrb,OAAQ,UAGRob,QAAS7M,EAAIoN,UAGbZ,OAAQ,CAENiE,KAAM,WACJ,MAAO,QAAUnd,KAAKlB,KAAO,KAG/B8rB,OAAQ,SAASlO,GAQf,OANA1c,KAAKmY,QAGe,mBAATuE,GACTA,EAAM1f,KAAKgD,KAAMA,MAEZA,MAGT8d,SAAU,WACR,OAAO9d,KAAKmd,QAGdzP,KAAM,SAAS/N,EAAGqC,EAAG9E,GAEnB,MADQ,aAALyC,IAAkBA,EAAI,oBAClB+M,EAAIoN,UAAUrb,UAAUiP,KAAK1Q,KAAKgD,KAAML,EAAGqC,EAAG9E,KAMzD0c,UAAW,CAET8U,QAAS,SAASrhB,EAAOD,EAAQsP,GAC/B,OAAO1c,KAAKya,OAAOiU,QAAQrhB,EAAOD,EAAQsP,OAKhDhQ,EAAIwM,OAAOxM,EAAI8jB,KAAM,CAEnB9B,QAAS,SAASrhB,EAAOD,EAAQsP,GAC/B,OAAO1c,KAAK2iB,IAAI,IAAIjW,EAAI+mB,SAAS7I,OAAOlO,GAAOhP,KAAK,CAClDnG,EAAc,EACdoG,EAAc,EACdN,MAAcA,EACdD,OAAcA,EACdsmB,aAAc,sBAKpBhnB,EAAIkf,MAAQlf,EAAI8M,OAAO,CAErBrb,OAAQ,SAASY,GACfiB,KAAK2Z,YAAY3c,KAAKgD,KAAMjB,IAI9Bwa,QAAS7M,EAAI4N,UAIf5N,EAAIinB,KAAOjnB,EAAI8M,OAAO,CAEpBrb,OAAQ,SAASY,EAASwa,GAKxB,GAHAvZ,KAAK2Z,YAAY3c,KAAKgD,KAAM0M,EAAIvO,OAAOY,IAGnCwa,EACF,IAAK,IAAI0P,KAAU1P,EAAQ9a,UACgB,mBAA9B8a,EAAQ9a,UAAUwqB,KAC3BjpB,KAAKipB,GAAU1P,EAAQ9a,UAAUwqB,KAIzC1P,QAAS7M,EAAI4N,QAGbpB,OAAQ,CAEN0a,MAAO,SAASC,GAEd,KAAO7zB,KAAKga,KAAKmW,iBACfnwB,KAAKga,KAAKkW,YAAYlwB,KAAKga,KAAKoW,WAKlC,OAFApwB,KAAKga,KAAKiK,YAAYjlB,EAAS80B,eAAeD,IAEvC7zB,SAMb0M,EAAIwM,OAAOxM,EAAIsX,OAAQ,CAErBjlB,QAAS,SAASA,EAASwa,GACzB,OAAOvZ,KAAK2iB,IAAI,IAAIjW,EAAIinB,KAAK50B,EAASwa,OAI1C7M,EAAI9O,OAAS8O,EAAI8M,OAAO,CAEtBrb,OAAQ,SAGRob,QAAS7M,EAAIoN,UAEbF,UAAW,CAETma,OAAQ,WACN,OAAO/zB,KAAK2iB,IAAI,IAAIjW,EAAI9O,YAK9B8O,EAAIsnB,IAAMtnB,EAAI8M,OAAO,CAEnBrb,OAAQ,MAGRob,QAAS7M,EAAIkf,MAGb1S,OAAQ,CAENna,QAAS,SAASA,EAASk1B,GAEzB,OAAOj0B,KAAK0N,KAAK,QAASumB,GAAQ,IAAM,IAAMl1B,EAAS2N,EAAIiM,SAK/DiB,UAAW,CAETsa,IAAK,SAASn1B,EAASk1B,GACrB,OAAOj0B,KAAK2iB,IAAI,IAAIjW,EAAIsnB,KAAKj1B,QAAQA,EAASk1B,OAIpDvnB,EAAIynB,KAAOznB,EAAI8M,OAAO,CAEpBrb,OAAQ,OAGRob,QAAS7M,EAAIkf,MAGbhS,UAAW,CAETxL,KAAM,SAASf,EAAOD,GACpB,OAAOpN,KAAK2iB,IAAI,IAAIjW,EAAIynB,MAAQxnB,KAAKU,EAAOD,OAIlDV,EAAI0nB,OAAS1nB,EAAI8M,OAAO,CAEtBrb,OAAQ,SAGRob,QAAS7M,EAAIkf,MAGbhS,UAAW,CAETnK,OAAQ,SAAS9C,GACf,OAAO3M,KAAK2iB,IAAI,IAAIjW,EAAI0nB,QAAQ9W,GAAG,IAAI5Q,EAAI2U,OAAO1U,GAAMkV,OAAO,IAAInC,KAAK,EAAG,OAKjFhT,EAAIwM,OAAOxM,EAAI0nB,OAAQ1nB,EAAImZ,GAAI,CAE7BvI,GAAI,SAASA,GACX,OAAOtd,KAAK0N,KAAK,IAAK4P,IAGxBC,GAAI,SAASA,GACX,OAAOvd,KAAKsd,GAAGC,MAInB7Q,EAAI2nB,QAAU3nB,EAAI8M,OAAO,CAEvBrb,OAAQ,UAGRob,QAAS7M,EAAIkf,MAGbhS,UAAW,CAET0a,QAAS,SAASjnB,EAAOD,GACvB,OAAOpN,KAAK2iB,IAAI,IAAIjW,EAAI2nB,SAAS1nB,KAAKU,EAAOD,GAAQsS,KAAK,EAAG,OAKnEhT,EAAIwM,OAAOxM,EAAI2nB,QAAS3nB,EAAIynB,KAAMznB,EAAImZ,GAAI,CAExCvI,GAAI,SAASA,GACX,OAAOtd,KAAK0N,KAAK,KAAM4P,IAGzBC,GAAI,SAASA,GACX,OAAOvd,KAAK0N,KAAK,KAAM6P,MAK3B7Q,EAAIwM,OAAOxM,EAAI0nB,OAAQ1nB,EAAI2nB,QAAS,CAEhC9sB,EAAG,SAASA,GACV,OAAY,MAALA,EAAYvH,KAAKqP,KAAOrP,KAAKsd,KAAOtd,KAAKqP,GAAG9H,EAAIvH,KAAKsd,OAG9D3P,EAAG,SAASA,GACV,OAAY,MAALA,EAAY3N,KAAKsP,KAAOtP,KAAKud,KAAOvd,KAAKsP,GAAG3B,EAAI3N,KAAKud,OAG9DlO,GAAI,SAAS9H,GACX,OAAY,MAALA,EAAYvH,KAAK0N,KAAK,MAAQ1N,KAAK0N,KAAK,KAAMnG,IAGvD+H,GAAI,SAAS3B,GACX,OAAY,MAALA,EAAY3N,KAAK0N,KAAK,MAAQ1N,KAAK0N,KAAK,KAAMC,IAGvDN,MAAO,SAASA,GACd,OAAgB,MAATA,EAA4B,EAAZrN,KAAKsd,KAAWtd,KAAKsd,GAAG,IAAI5Q,EAAI2U,OAAOhU,GAAOwU,OAAO,KAG9EzU,OAAQ,SAASA,GACf,OAAiB,MAAVA,EAA6B,EAAZpN,KAAKud,KAAWvd,KAAKud,GAAG,IAAI7Q,EAAI2U,OAAOjU,GAAQyU,OAAO,KAGhFlV,KAAM,SAASU,EAAOD,GACpB,IAAIzO,EAAIyjB,EAAiBpiB,KAAMqN,EAAOD,GAEtC,OAAOpN,KACJsd,GAAG,IAAI5Q,EAAI2U,OAAO1iB,EAAE0O,OAAOwU,OAAO,IAClCtE,GAAG,IAAI7Q,EAAI2U,OAAO1iB,EAAEyO,QAAQyU,OAAO,OAG5CnV,EAAI6nB,KAAO7nB,EAAI8M,OAAO,CAEpBrb,OAAQ,OAGRob,QAAS7M,EAAIkf,MAGb1S,OAAQ,CAENuD,MAAO,WACL,OAAO,IAAI/P,EAAI2S,WAAW,CACxB,CAAErf,KAAK0N,KAAK,MAAO1N,KAAK0N,KAAK,OAC7B,CAAE1N,KAAK0N,KAAK,MAAO1N,KAAK0N,KAAK,UAIjCK,KAAM,SAASwR,EAAIC,EAAIxO,EAAIV,GACzB,OAAU,MAANiP,EACKvf,KAAKyc,SAEZ8C,OADqB,IAAPC,EACT,CAAED,GAAIA,EAAIC,GAAIA,EAAIxO,GAAIA,EAAIV,GAAIA,GAE9B,IAAI5D,EAAI2S,WAAWE,GAAID,SAEvBtf,KAAK0N,KAAK6R,KAGnBG,KAAM,SAASnY,EAAGoG,GAChB,OAAO3N,KAAK0N,KAAK1N,KAAKyc,QAAQiD,KAAKnY,EAAGoG,GAAG2R,WAG3C3S,KAAM,SAASU,EAAOD,GACpB,IAAIzO,EAAIyjB,EAAiBpiB,KAAMqN,EAAOD,GAEtC,OAAOpN,KAAK0N,KAAK1N,KAAKyc,QAAQ9P,KAAKhO,EAAE0O,MAAO1O,EAAEyO,QAAQkS,YAK1D1F,UAAW,CAET1J,KAAM,SAASqP,EAAIC,EAAIxO,EAAIV,GAGzB,OAAO5D,EAAI6nB,KAAK91B,UAAUsP,KAAK+b,MAC7B9pB,KAAK2iB,IAAI,IAAIjW,EAAI6nB,MACX,MAANhV,EAAa,CAACA,EAAIC,EAAIxO,EAAIV,GAAM,CAAC,EAAG,EAAG,EAAG,QAMlD5D,EAAI8nB,SAAW9nB,EAAI8M,OAAO,CAExBrb,OAAQ,WAGRob,QAAS7M,EAAIkf,MAGbhS,UAAW,CAETsB,SAAU,SAASvc,GAEjB,OAAOqB,KAAK2iB,IAAI,IAAIjW,EAAI8nB,UAAUzmB,KAAKpP,GAAK,IAAI+N,EAAI2S,gBAK1D3S,EAAI+nB,QAAU/nB,EAAI8M,OAAO,CAEvBrb,OAAQ,UAGRob,QAAS7M,EAAIkf,MAGbhS,UAAW,CAET8a,QAAS,SAAS/1B,GAEhB,OAAOqB,KAAK2iB,IAAI,IAAIjW,EAAI+nB,SAAS1mB,KAAKpP,GAAK,IAAI+N,EAAI2S,gBAMzD3S,EAAIwM,OAAOxM,EAAI8nB,SAAU9nB,EAAI+nB,QAAS,CAEpChY,MAAO,WACL,OAAOzc,KAAK20B,SAAW30B,KAAK20B,OAAS,IAAIjoB,EAAI2S,WAAWrf,KAAK0N,KAAK,aAGpEK,KAAM,SAASpP,GACb,OAAa,MAALA,EACNqB,KAAKyc,QACLzc,KAAKmY,QAAQzK,KAAK,SAAsB,iBAAL/O,EAAgBA,EAAKqB,KAAK20B,OAAS,IAAIjoB,EAAI2S,WAAW1gB,KAG7FwZ,MAAO,WAEL,cADOnY,KAAK20B,OACL30B,MAGT0f,KAAM,SAASnY,EAAGoG,GAChB,OAAO3N,KAAK0N,KAAK,SAAU1N,KAAKyc,QAAQiD,KAAKnY,EAAGoG,KAGlDhB,KAAM,SAASU,EAAOD,GACpB,IAAIzO,EAAIyjB,EAAiBpiB,KAAMqN,EAAOD,GAEtC,OAAOpN,KAAK0N,KAAK,SAAU1N,KAAKyc,QAAQ9P,KAAKhO,EAAE0O,MAAO1O,EAAEyO,YAM5DV,EAAIwM,OAAOxM,EAAI6nB,KAAM7nB,EAAI8nB,SAAU9nB,EAAI+nB,QAAS,CAE9CG,WAAaloB,EAAI2S,WAEjB9X,EAAG,SAASA,GACV,OAAY,MAALA,EAAYvH,KAAK4f,OAAOrY,EAAIvH,KAAK0f,KAAKnY,EAAGvH,KAAK4f,OAAOjS,IAG9DA,EAAG,SAASA,GACV,OAAY,MAALA,EAAY3N,KAAK4f,OAAOjS,EAAI3N,KAAK0f,KAAK1f,KAAK4f,OAAOrY,EAAGoG,IAG9DN,MAAO,SAASA,GACd,IAAIrL,EAAIhC,KAAK4f,OAEb,OAAgB,MAATvS,EAAgBrL,EAAEqL,MAAQrN,KAAK2M,KAAKU,EAAOrL,EAAEoL,SAGtDA,OAAQ,SAASA,GACf,IAAIpL,EAAIhC,KAAK4f,OAEb,OAAiB,MAAVxS,EAAiBpL,EAAEoL,OAASpN,KAAK2M,KAAK3K,EAAEqL,MAAOD,MAG1DV,EAAImoB,KAAOnoB,EAAI8M,OAAO,CAEpBrb,OAAQ,OAGRob,QAAS7M,EAAIkf,MAGb1S,OAAQ,CAEN0b,WAAaloB,EAAI8T,UAEjB/D,MAAO,WACL,OAAOzc,KAAK20B,SAAW30B,KAAK20B,OAAS,IAAIjoB,EAAI8T,UAAUxgB,KAAK0N,KAAK,QAGnEK,KAAM,SAAS5Q,GACb,OAAa,MAALA,EACN6C,KAAKyc,QACLzc,KAAKmY,QAAQzK,KAAK,IAAiB,iBAALvQ,EAAgBA,EAAK6C,KAAK20B,OAAS,IAAIjoB,EAAI8T,UAAUrjB,KAGvFgb,MAAO,WAEL,cADOnY,KAAK20B,OACL30B,MAGT0f,KAAM,SAASnY,EAAGoG,GAChB,OAAO3N,KAAK0N,KAAK,IAAK1N,KAAKyc,QAAQiD,KAAKnY,EAAGoG,KAG7CpG,EAAG,SAASA,GACV,OAAY,MAALA,EAAYvH,KAAK4f,OAAOrY,EAAIvH,KAAK0f,KAAKnY,EAAGvH,KAAK4f,OAAOjS,IAG9DA,EAAG,SAASA,GACV,OAAY,MAALA,EAAY3N,KAAK4f,OAAOjS,EAAI3N,KAAK0f,KAAK1f,KAAK4f,OAAOrY,EAAGoG,IAG9DhB,KAAM,SAASU,EAAOD,GACpB,IAAIzO,EAAIyjB,EAAiBpiB,KAAMqN,EAAOD,GAEtC,OAAOpN,KAAK0N,KAAK,IAAK1N,KAAKyc,QAAQ9P,KAAKhO,EAAE0O,MAAO1O,EAAEyO,UAGrDC,MAAO,SAASA,GACd,OAAgB,MAATA,EAAgBrN,KAAK4f,OAAOvS,MAAQrN,KAAK2M,KAAKU,EAAOrN,KAAK4f,OAAOxS,SAG1EA,OAAQ,SAASA,GACf,OAAiB,MAAVA,EAAiBpN,KAAK4f,OAAOxS,OAASpN,KAAK2M,KAAK3M,KAAK4f,OAAOvS,MAAOD,KAM9EwM,UAAW,CAET9L,KAAM,SAAS3Q,GAEb,OAAO6C,KAAK2iB,IAAI,IAAIjW,EAAImoB,MAAM9mB,KAAK5Q,GAAK,IAAIuP,EAAI8T,eAKtD9T,EAAI+hB,MAAQ/hB,EAAI8M,OAAO,CAErBrb,OAAQ,QAGRob,QAAS7M,EAAIkf,MAGb1S,OAAQ,CAEN4b,KAAM,SAASC,GACb,IAAKA,EAAK,OAAO/0B,KAEjB,IAAI6pB,EAAO7pB,KACPg1B,EAAO,IAAI/qB,EAAOwkB,MAoCtB,OAjCA/hB,EAAI8b,GAAGwM,EAAK,OAAQ,WAClBtoB,EAAIic,IAAIqM,GAER,IAAIr2B,EAAIkrB,EAAKhQ,OAAOnN,EAAI+mB,SAEf,OAAN90B,IAGiB,GAAhBkrB,EAAKxc,SAAiC,GAAjBwc,EAAKzc,UAC5Byc,EAAKld,KAAKqoB,EAAI3nB,MAAO2nB,EAAI5nB,QAGvBzO,GAAkB,GAAbA,EAAE0O,SAA8B,GAAd1O,EAAEyO,UAC3BzO,EAAEgO,KAAKkd,EAAKxc,QAASwc,EAAKzc,UAGA,mBAAjByc,EAAKoL,SACdpL,EAAKoL,QAAQj4B,KAAK6sB,EAAM,CACtBxc,MAAQ2nB,EAAI3nB,MACZD,OAAQ4nB,EAAI5nB,OACZ8nB,MAAQF,EAAI3nB,MAAQ2nB,EAAI5nB,OACxB2nB,IAAQA,OAIdroB,EAAI8b,GAAGwM,EAAK,QAAS,SAAS7wB,GAC5BuI,EAAIic,IAAIqM,GAEmB,mBAAhBnL,EAAKsL,QACZtL,EAAKsL,OAAOn4B,KAAK6sB,EAAM1lB,KAItBnE,KAAK0N,KAAK,OAASsnB,EAAII,IAAMp1B,KAAKo1B,IAAML,EAAMroB,EAAIiM,QAG3D0c,OAAQ,SAASA,GAEf,OADAr1B,KAAKi1B,QAAUI,EACRr1B,MAGTsF,MAAO,SAASA,GAEd,OADAtF,KAAKm1B,OAAS7vB,EACPtF,OAKX4Z,UAAW,CAET4U,MAAO,SAASlH,EAAQja,EAAOD,GAC7B,OAAOpN,KAAK2iB,IAAI,IAAIjW,EAAI+hB,OAAOqG,KAAKxN,GAAQ3a,KAAKU,GAAS,EAAGD,GAAUC,GAAS,OAKtFX,EAAI+d,KAAO/d,EAAI8M,OAAO,CAEpBrb,OAAQ,WACN6B,KAAK2Z,YAAY3c,KAAKgD,KAAM0M,EAAIvO,OAAO,SAEvC6B,KAAKmiB,IAAIuI,QAAU,IAAIhe,EAAI2U,OAAO,KAClCrhB,KAAKs1B,UAAW,EAChBt1B,KAAKu1B,QAAW,EAGhBv1B,KAAK0N,KAAK,cAAehB,EAAI1L,SAASkc,MAAM,iBAI9C3D,QAAS7M,EAAIkf,MAGb1S,OAAQ,CAEN3R,EAAG,SAASA,GAEV,OAAS,MAALA,EACKvH,KAAK0N,KAAK,KAEZ1N,KAAK0N,KAAK,IAAKnG,IAGxBoG,EAAG,SAASA,GACV,IAAI6nB,EAAKx1B,KAAK0N,KAAK,KACfpQ,EAAmB,iBAAPk4B,EAAkBA,EAAKx1B,KAAK4f,OAAOjS,EAAI,EAGvD,OAAS,MAALA,EACmB,iBAAP6nB,EAAkBA,EAAKl4B,EAAIk4B,EAEpCx1B,KAAK0N,KAAK,IAA4B,iBAAhBC,EAAE8Q,UAAyB9Q,EAAIrQ,EAAIqQ,IAGlE0B,GAAI,SAAS9H,GACX,OAAY,MAALA,EAAYvH,KAAK4f,OAAOvQ,GAAKrP,KAAKuH,EAAEA,EAAIvH,KAAK4f,OAAOvS,MAAQ,IAGrEiC,GAAI,SAAS3B,GACX,OAAY,MAALA,EAAY3N,KAAK4f,OAAOtQ,GAAKtP,KAAK2N,EAAEA,EAAI3N,KAAK4f,OAAOxS,OAAS,IAGtEymB,KAAM,SAASA,GAEb,QAAoB,IAATA,EAAqB,CAC1BA,EAAO,GAEX,IAFA,IACI/D,EAAW9vB,KAAKga,KAAKoK,WACjBvnB,EAAI,EAAGsF,EAAM2tB,EAASxuB,OAAQzE,EAAIsF,IAAOtF,EAGvC,GAALA,GAAkC,GAAxBizB,EAASjzB,GAAG44B,UAAwD,GAAvC/oB,EAAIqN,MAAM+V,EAASjzB,IAAIslB,IAAIuT,WACnE7B,GAAQ,MAIVA,GAAQ/D,EAASjzB,GAAG84B,YAGtB,OAAO9B,EAMT,GAFA7zB,KAAKmY,QAAQhK,OAAM,GAEC,mBAAT0lB,EAETA,EAAK72B,KAAKgD,KAAMA,UAOX,CAAInD,EAAI,EAAb,IAAK,IAAW8f,GAHhBkX,EAAOA,EAAKzvB,MAAM,OAGQ9C,OAAQzE,EAAI8f,EAAI9f,IACxCmD,KAAK41B,MAAM/B,EAAKh3B,IAAIg5B,UAIxB,OAAO71B,KAAKmO,OAAM,GAAOygB,WAG3BjiB,KAAM,SAASA,GACb,OAAO3M,KAAK0N,KAAK,YAAaf,GAAMiiB,WAGtClE,QAAS,SAAS5sB,GAEhB,OAAa,MAATA,EACKkC,KAAKmiB,IAAIuI,SAGlB1qB,KAAKmiB,IAAIuI,QAAU,IAAIhe,EAAI2U,OAAOvjB,GAE3BkC,KAAK4uB,YAGdvK,MAAO,WACL,IAAIrK,GAAQha,KAAK81B,UAAY91B,KAAK81B,YAAc91B,MAAMga,KAGlDqK,EAAQ3X,EAAI8P,MAAMjZ,IAAImJ,EAAI8P,MAAMQ,kBAAkBhD,EAAKoK,YAAa,SAAS7M,GAC/E,OAAO7K,EAAIqN,MAAMxC,KAInB,OAAO,IAAI7K,EAAIpJ,IAAI+gB,IAGrBuK,QAAS,SAASA,GAMhB,GAJsB,kBAAXA,IACT5uB,KAAKs1B,SAAW1G,GAGd5uB,KAAKs1B,SAAU,CACjB,IAAIzL,EAAO7pB,KACP+1B,EAAkB,EAClB/gB,EAAKhV,KAAKmiB,IAAIuI,QAAU,IAAIhe,EAAI2U,OAAOrhB,KAAK0N,KAAK,cAErD1N,KAAKqkB,QAAQ5W,KAAK,WACZzN,KAAKmiB,IAAIuT,WACN7L,EAAKiM,YACR91B,KAAK0N,KAAK,IAAKmc,EAAKnc,KAAK,MACT,MAAf1N,KAAK6zB,OACNkC,GAAmB/gB,GAEnBhV,KAAK0N,KAAK,KAAMsH,EAAK+gB,GACrBA,EAAkB,MAKxB/1B,KAAK0pB,KAAK,WAGZ,OAAO1pB,MAGTmO,MAAO,SAASA,GAEd,OADAnO,KAAKu1B,SAAWpnB,EACTnO,MAGT0a,QAAS,SAASpd,GAGhB,OAFA0C,KAAKmiB,IAAM7kB,EACX0C,KAAKmiB,IAAIuI,QAAU,IAAIhe,EAAI2U,OAAO/jB,EAAEotB,SAAW,KACxC1qB,OAKX4Z,UAAW,CAETia,KAAM,SAASA,GACb,OAAO7zB,KAAK2iB,IAAI,IAAIjW,EAAI+d,MAAMoJ,KAAKA,IAGrC7wB,MAAO,SAAS6wB,GACd,OAAO7zB,KAAK2iB,IAAI,IAAIjW,EAAI+d,MAAMznB,MAAM6wB,OAM1CnnB,EAAIspB,MAAQtpB,EAAI8M,OAAO,CAErBrb,OAAQ,QAGRob,QAAS7M,EAAIkf,MAGb1S,OAAQ,CAEN2a,KAAM,SAASA,GACb,OAAW,MAARA,EAAqB7zB,KAAKga,KAAK2b,aAAe31B,KAAKmiB,IAAIuT,SAAW,KAAO,KAE5D,mBAAT7B,EAAsBA,EAAK72B,KAAKgD,KAAMA,MAAQA,KAAKgD,MAAM6wB,GAEzD7zB,OAGT6U,GAAI,SAASA,GACX,OAAO7U,KAAK0N,KAAK,KAAMmH,IAGzBG,GAAI,SAASA,GACX,OAAOhV,KAAK0N,KAAK,KAAMsH,IAGzB6gB,QAAS,WAEP,IAAI93B,EAAIiC,KAAK6Z,OAAOnN,EAAI+d,MAMxB,OAHAzqB,KAAKmiB,IAAIuT,UAAW,EAGb11B,KAAKgV,GAAGjX,EAAEokB,IAAIuI,QAAU3sB,EAAE2P,KAAK,cAAcA,KAAK,IAAK3P,EAAEwJ,SAMtEmF,EAAIwM,OAAOxM,EAAI+d,KAAM/d,EAAIspB,MAAO,CAE9BhzB,MAAO,SAAS6wB,GAQd,OANoB,IAAhB7zB,KAAKu1B,QACPv1B,KAAKmY,QAGPnY,KAAKga,KAAKiK,YAAYjlB,EAAS80B,eAAeD,IAEvC7zB,MAGT41B,MAAO,SAAS/B,GACd,IAAI7Z,GAASha,KAAK81B,UAAY91B,KAAK81B,YAAc91B,MAAMga,KACnD4b,EAAQ,IAAIlpB,EAAIspB,MASpB,OANoB,IAAhBh2B,KAAKu1B,QACPv1B,KAAKmY,QAGP6B,EAAKiK,YAAY2R,EAAM5b,MAEhB4b,EAAM/B,KAAKA,IAGpB1b,MAAO,WAIL,IAHA,IAAI6B,GAAQha,KAAK81B,UAAY91B,KAAK81B,YAAc91B,MAAMga,KAG/CA,EAAKmW,iBACVnW,EAAKkW,YAAYlW,EAAKoW,WAExB,OAAOpwB,MAGTsB,OAAQ,WACN,OAAOtB,KAAKga,KAAKic,2BAIrBvpB,EAAIwpB,SAAWxpB,EAAI8M,OAAO,CAExBrb,OAAQ,WAGRob,QAAS7M,EAAIsX,OAGbnK,OAAQnN,EAAI+d,KAGZ7Q,UAAW,CACTgb,WAAYloB,EAAI8T,UAEhB1S,KAAM,SAAS3Q,GAMb,IAJA,IAAI2Q,EAAQ,IAAIpB,EAAIwpB,SAChBC,EAAQn2B,KAAKsjB,MAAM7I,OAAO3M,KAAK3Q,GAG5B6C,KAAKga,KAAKmW,iBACfriB,EAAKkM,KAAKiK,YAAYjkB,KAAKga,KAAKmK,YAQlC,OALAnkB,KAAKga,KAAKiK,YAAYnW,EAAKkM,MAG3BlM,EAAKJ,KAAK,OAAQ,IAAMyoB,EAAOzpB,EAAIiM,OAE5B3Y,MAGTyc,MAAO,WACL,IAAI0Z,EAAQn2B,KAAKm2B,QAEjB,OAAOA,EAAQA,EAAM1Z,QAAU,MAGjC1O,KAAM,SAAS5Q,GACb,IAAIg5B,EAAQn2B,KAAKm2B,QACbxV,EAAY,KAMhB,OAJIwV,IACFxV,EAAYwV,EAAMpoB,KAAK5Q,IAGZ,MAALA,EAAawjB,EAAY3gB,MAGnCm2B,MAAO,WACL,IAAIroB,EAAO9N,KAAK81B,WAEhB,GAAIhoB,EACF,OAAOA,EAAK0N,UAAU,SAG1Bsa,SAAU,WACR,GAAI91B,KAAKga,KAAKmK,YAA+C,YAAjCnkB,KAAKga,KAAKmK,WAAWtN,SAC/C,OAAOnK,EAAIqN,MAAM/Z,KAAKga,KAAKmK,gBAKnCzX,EAAI0N,OAAS1N,EAAI8M,OAAO,CAEtBrb,OAAQ,WACN6B,KAAK2Z,YAAY3c,KAAKgD,KAAM0M,EAAIvO,OAAO,QAEvC6B,KAAK+X,MAAM,WAAY,YAIzBwB,QAAS7M,EAAIoN,UAGbF,UAAW,CAEToB,OAAQ,WACN,OAAOhb,KAAK2iB,IAAI,IAAIjW,EAAI0N,YAI9B1N,EAAI2T,EAAI3T,EAAI8M,OAAO,CAEjBrb,OAAQ,IAGRob,QAAS7M,EAAIoN,UAGbZ,OAAQ,CAEN4I,GAAI,SAASiT,GACX,OAAO/0B,KAAK0N,KAAK,OAAQqnB,EAAKroB,EAAIiM,QAGpCmK,KAAM,SAAS7N,GACb,OAAOjV,KAAK0N,KAAK,OAAQuH,EAAQvI,EAAIiM,QAGvC1D,OAAQ,SAASA,GACf,OAAOjV,KAAK0N,KAAK,SAAUuH,KAK/B2E,UAAW,CAETwc,KAAM,SAASrB,GACb,OAAO/0B,KAAK2iB,IAAI,IAAIjW,EAAI2T,GAAGyB,GAAGiT,OAKpCroB,EAAIwM,OAAOxM,EAAI4N,QAAS,CAEtB+b,OAAQ,SAAStB,GACf,IAAIqB,EAAO,IAAI1pB,EAAI2T,EAOnB,MALkB,mBAAP0U,EACTA,EAAI/3B,KAAKo5B,EAAMA,GAEfA,EAAKtU,GAAGiT,GAEH/0B,KAAK6Z,SAAS8I,IAAIyT,GAAMzT,IAAI3iB,SAIvC0M,EAAI4pB,OAAS5pB,EAAI8M,OAAO,CAEtBrb,OAAQ,SAGRob,QAAS7M,EAAIoN,UAGbZ,OAAQ,CAEN7L,MAAO,SAASA,GACd,OAAOrN,KAAK0N,KAAK,cAAeL,IAGlCD,OAAQ,SAASA,GACf,OAAOpN,KAAK0N,KAAK,eAAgBN,IAGnCmpB,IAAK,SAAShvB,EAAGoG,GACf,OAAO3N,KAAK0N,KAAK,OAAQnG,GAAGmG,KAAK,OAAQC,IAG3Cid,OAAQ,SAASlO,GAQf,OANA1c,KAAKmY,QAGe,mBAATuE,GACTA,EAAM1f,KAAKgD,KAAMA,MAEZA,MAGT8d,SAAU,WACR,MAAO,QAAU9d,KAAKlB,KAAO,MAKjC8a,UAAW,CACT4c,OAAQ,SAASnpB,EAAOD,EAAQsP,GAE9B,OAAO1c,KAAKya,OAAO+b,OAAOnpB,EAAOD,EAAQsP,OAM/ChQ,EAAIwM,OAAOxM,EAAI8jB,KAAM,CAEnBgG,OAAQ,SAASnpB,EAAOD,EAAQsP,GAE9B,OAAO1c,KAAK2iB,IAAI,IAAIjW,EAAI4pB,QACrB3pB,KAAKU,EAAOD,GACZmpB,IAAIlpB,EAAQ,EAAGD,EAAS,GACxBR,QAAQ,EAAG,EAAGS,EAAOD,GACrBM,KAAK,SAAU,QACfkd,OAAOlO,MAKdhQ,EAAIwM,OAAOxM,EAAI6nB,KAAM7nB,EAAI8nB,SAAU9nB,EAAI+nB,QAAS/nB,EAAImoB,KAAM,CAExD2B,OAAQ,SAASA,EAAQnpB,EAAOD,EAAQsP,GACtC,IAAIhP,EAAO,CAAC,UAWZ,MARc,OAAV8oB,GAAiB9oB,EAAKxI,KAAKsxB,GAC/B9oB,EAAOA,EAAKjJ,KAAK,KAGjB+xB,EAASnd,UAAU,aAAc3M,EAAI4pB,OACnCjd,UAAU,GACVrZ,KAAKsjB,MAAMkT,OAAOnpB,EAAOD,EAAQsP,GAE5B1c,KAAK0N,KAAKA,EAAM8oB,MAK3B,IAAIC,EAAQ,CACVrZ,OAAQ,CAAC,QAAS,QAAS,UAAW,UAAW,WAAY,aAAc,YAAa,cACxFD,KAAQ,CAAC,QAAS,UAAW,QAC7BuZ,OAAQ,SAAS34B,EAAG4B,GAClB,MAAY,SAALA,EAAe5B,EAAIA,EAAI,IAAM4B,IA6VxC,SAASohB,EAAephB,EAAGqC,EAAG9E,EAAGC,GAC/B,OAAOD,EAAIC,EAAEoC,QAAQmN,EAAI0O,MAAMmB,KAAM,MAyBvC,SAASsT,EAAUjxB,GACjB,OAAOA,EAAE8C,cAAcnC,QAAQ,QAAS,SAAStC,EAAGygB,GAClD,OAAOA,EAAErc,gBAKb,SAAS4X,EAAWra,GAClB,OAAOA,EAAEwD,OAAO,GAAGf,cAAgBzC,EAAEwa,MAAM,GAc7C,SAAS4E,EAAU2Y,GACjB,IAAIrb,EAAMqb,EAAK7Y,SAAS,IACxB,OAAqB,GAAdxC,EAAIha,OAAc,IAAMga,EAAMA,EAIvC,SAAS8G,EAAiBrjB,EAASsO,EAAOD,GACxC,GAAa,MAATC,GAA2B,MAAVD,EAAgB,CACnC,IAAIuS,EAAM5gB,EAAQ6gB,OAEL,MAATvS,EACFA,EAAQsS,EAAItS,MAAQsS,EAAIvS,OAASA,EAChB,MAAVA,IACPA,EAASuS,EAAIvS,OAASuS,EAAItS,MAAQA,GAGtC,MAAO,CACLA,MAAQA,EACRD,OAAQA,GAKZ,SAASwf,EAAoBzC,EAAQ5iB,EAAGoG,GACtC,MAAO,CACLpG,EAAGA,EAAI4iB,EAAOxqB,EAAIgO,EAAIwc,EAAOjtB,EAAI,EACjCyQ,EAAGpG,EAAI4iB,EAAOnoB,EAAI2L,EAAIwc,EAAOhtB,EAAI,GAKrC,SAASsvB,EAAc9sB,GACrB,MAAO,CAAEA,EAAGA,EAAE,GAAIqC,EAAGrC,EAAE,GAAIzC,EAAGyC,EAAE,GAAIxC,EAAGwC,EAAE,GAAIwE,EAAGxE,EAAE,GAAIqtB,EAAGrtB,EAAE,IAY7D,SAASkvB,EAAavxB,EAAG2X,GACvB3X,EAAE+R,GAAa,MAAR/R,EAAE+R,GAAa4F,EAAO2K,OAAOvQ,GAAK/R,EAAE+R,GAC3C/R,EAAEgS,GAAa,MAARhS,EAAEgS,GAAa2F,EAAO2K,OAAOtQ,GAAKhS,EAAEgS,GAyC7C,SAASgT,EAAYtI,GAEnB,IAAK,IAAInd,EAAImd,EAAKoK,WAAW9iB,OAAS,EAAGzE,GAAK,EAAGA,IAC3Cmd,EAAKoK,WAAWvnB,aAAcoN,EAAOkQ,YACvCmI,EAAYtI,EAAKoK,WAAWvnB,IAEhC,OAAO6P,EAAIqN,MAAMC,GAAMlb,GAAG4N,EAAIsM,IAAIgB,EAAKnD,WAIzC,SAASoU,EAAQjpB,GAef,OAdW,MAAPA,EAAEuF,IACJvF,EAAEuF,EAAS,EACXvF,EAAE2L,EAAS,EACX3L,EAAEqL,MAAS,EACXrL,EAAEoL,OAAS,GAGbpL,EAAE40B,EAAK50B,EAAEqL,MACTrL,EAAEqM,EAAKrM,EAAEoL,OACTpL,EAAEgP,GAAKhP,EAAEuF,EAAIvF,EAAEqL,MACfrL,EAAEsO,GAAKtO,EAAE2L,EAAI3L,EAAEoL,OACfpL,EAAEqN,GAAKrN,EAAEuF,EAAIvF,EAAEqL,MAAQ,EACvBrL,EAAEsN,GAAKtN,EAAE2L,EAAI3L,EAAEoL,OAAS,EAEjBpL,EAYT,SAAS+rB,EAAcvuB,GACrB,OAAOoT,KAAKa,IAAIjU,GAAK,MAAQA,EAAI,EArgBlC,CAAC,OAAQ,UAAUmG,QAAQ,SAAS1I,GACnC,IAAIJ,EAAGg6B,EAAY,GAEnBA,EAAU55B,GAAK,SAASK,GACtB,QAAgB,IAALA,EACT,OAAO0C,KACT,GAAgB,iBAAL1C,GAAiBoP,EAAI8Q,MAAM5B,MAAMte,IAAOA,GAAuB,mBAAXA,EAAE6f,KAC/Dnd,KAAK0N,KAAKzQ,EAAGK,QAIb,IAAKT,EAAI45B,EAAMx5B,GAAGqE,OAAS,EAAGzE,GAAK,EAAGA,IACd,MAAlBS,EAAEm5B,EAAMx5B,GAAGJ,KACbmD,KAAK0N,KAAK+oB,EAAMC,OAAOz5B,EAAGw5B,EAAMx5B,GAAGJ,IAAKS,EAAEm5B,EAAMx5B,GAAGJ,KAEzD,OAAOmD,MAGT0M,EAAIwM,OAAOxM,EAAI4N,QAAS5N,EAAImZ,GAAIgR,KAIlCnqB,EAAIwM,OAAOxM,EAAI4N,QAAS5N,EAAImZ,GAAI,CAE9B6H,OAAQ,SAASvwB,EAAGkS,EAAIC,GACtB,OAAOtP,KAAKgS,UAAU,CAAEC,SAAU9U,EAAGkS,GAAIA,EAAIC,GAAIA,KAGnDse,KAAM,SAASrmB,EAAGoG,EAAG0B,EAAIC,GACvB,OAA2B,GAApB+J,UAAU/X,QAAoC,GAApB+X,UAAU/X,OACzCtB,KAAKgS,UAAU,CAAE4b,KAAMrmB,EAAG8H,GAAI1B,EAAG2B,GAAID,IACrCrP,KAAKgS,UAAU,CAAE8a,MAAOvlB,EAAG6lB,MAAOzf,EAAG0B,GAAIA,EAAIC,GAAIA,KAGrDke,MAAO,SAASjmB,EAAGoG,EAAG0B,EAAIC,GACxB,OAA2B,GAApB+J,UAAU/X,QAAoC,GAApB+X,UAAU/X,OACzCtB,KAAKgS,UAAU,CAAEwb,MAAOjmB,EAAG8H,GAAI1B,EAAG2B,GAAID,IACtCrP,KAAKgS,UAAU,CAAEqb,OAAQ9lB,EAAG+lB,OAAQ3f,EAAG0B,GAAIA,EAAIC,GAAIA,KAGvDvC,UAAW,SAASxF,EAAGoG,GACrB,OAAO3N,KAAKgS,UAAU,CAAEzK,EAAGA,EAAGoG,EAAGA,KAGnCggB,KAAM,SAAShuB,EAAGrC,GAEhB,OADAA,EAAgB,iBAALqC,EAAgBA,EAAIrC,EACxB0C,KAAKgS,UAAU,CAAE2b,KAAMhuB,GAAK,OAAQgE,OAAQrG,KAGrD6sB,OAAQ,SAASltB,GACf,OAAO+C,KAAK0N,KAAK,YAAa,IAAIhB,EAAIqd,OAA2B,GAApB1Q,UAAU/X,OAAc,GAAG8X,MAAMpc,KAAKqc,WAAapc,KAGlGogB,QAAS,SAASvf,GAChB,OAAOkC,KAAK0N,KAAK,UAAW5P,IAG9B+W,GAAI,SAAStN,GACX,OAAOvH,KAAKuH,EAAE,IAAImF,EAAI2U,OAAO9Z,GAAGka,KAAKzhB,gBAAgB0M,EAAImZ,GAAK,EAAI7lB,KAAKuH,MAAM,IAG/EyN,GAAI,SAASrH,GACX,OAAO3N,KAAK2N,EAAE,IAAIjB,EAAI2U,OAAO1T,GAAG8T,KAAKzhB,gBAAgB0M,EAAImZ,GAAK,EAAI7lB,KAAK2N,MAAM,IAG/EmpB,MAAO,SAASvvB,EAAGoG,GACjB,OAAO3N,KAAK6U,GAAGtN,GAAGyN,GAAGrH,MAIzBjB,EAAIwM,OAAOxM,EAAIynB,KAAMznB,EAAI2nB,QAAS3nB,EAAI0nB,OAAQ1nB,EAAI2N,SAAU3N,EAAImZ,GAAI,CAElEnW,OAAQ,SAASnI,EAAGoG,GAClB,IAAI4M,GAAQva,KAAK8lB,SAAW9lB,MAAMua,KAClC,MAAe,UAARA,GAA4B,UAARA,EACzBva,KAAK0N,KAAK,IAAK,IAAIhB,EAAI2U,OAAO9Z,IAC9BvH,KAAKsd,GAAG/V,GAAGgW,GAAQ,MAAL5P,EAAYpG,EAAIoG,MAIpCjB,EAAIwM,OAAOxM,EAAImoB,KAAM,CAEnBvzB,OAAQ,WACN,OAAOtB,KAAKga,KAAK+c,kBAGnBC,QAAS,SAAS11B,GAChB,OAAOtB,KAAKga,KAAKid,iBAAiB31B,MAItCoL,EAAIwM,OAAOxM,EAAIsX,OAAQtX,EAAI+d,KAAM/d,EAAIspB,MAAOtpB,EAAImZ,GAAI,CAElDqR,KAAM,SAASv3B,EAAGH,GAChB,GAAgB,iBAALG,EACT,IAAKH,KAAKG,EAAGK,KAAKk3B,KAAK13B,EAAGG,EAAEH,IAG9B,MAAY,WAALG,EACHK,KAAK0qB,QAAQlrB,GACV,UAALG,EACEK,KAAK0N,KAAK,cAAelO,GACtB,QAALG,GAAoB,UAALA,GAAsB,UAALA,GAAsB,WAALA,GAAuB,WAALA,GAAuB,SAALA,EACnFK,KAAK0N,KAAK,QAAS/N,EAAGH,GACtBQ,KAAK0N,KAAK/N,EAAGH,MAIrBkN,EAAIpJ,IAAMoJ,EAAI8M,OAAO,CAEnBrb,OAAQ,SAASg5B,GACXA,aAAmBzqB,EAAIpJ,IACzBtD,KAAKm3B,QAAUA,EAAQA,QAAQ/d,QAE/BxU,MAAMka,QAAQqY,GAAWn3B,KAAKm3B,QAAUA,EAAUn3B,KAAKmY,SAK3De,OAAQ,CAENtV,IAAK,WACH,IAAI/G,EAAG8f,EAAIya,EAAW,GAAGhe,MAAMpc,KAAKqc,WAEpC,IAAKxc,EAAI,EAAG8f,EAAKya,EAAS91B,OAAQzE,EAAI8f,EAAI9f,IACxCmD,KAAKm3B,QAAQjyB,KAAKkyB,EAASv6B,IAE7B,OAAOmD,MAGTsJ,OAAQ,SAASvK,GACf,IAAIlC,EAAImD,KAAK4B,MAAM7C,GAMnB,OAHIlC,GAAK,GACPmD,KAAKm3B,QAAQE,OAAOx6B,EAAG,GAElBmD,MAGTyN,KAAM,SAASiP,GACb,IAAK,IAAI7f,EAAI,EAAG8f,EAAK3c,KAAKm3B,QAAQ71B,OAAQzE,EAAI8f,EAAI9f,IAChD6f,EAAMoN,MAAM9pB,KAAKm3B,QAAQt6B,GAAI,CAACA,EAAGmD,KAAKm3B,UAExC,OAAOn3B,MAGTmY,MAAO,WAIL,OAFAnY,KAAKm3B,QAAU,GAERn3B,MAGTsB,OAAQ,WACN,OAAOtB,KAAKm3B,QAAQ71B,QAGtBlB,IAAK,SAASrB,GACZ,OAAOiB,KAAK4B,MAAM7C,IAAY,GAGhC6C,MAAO,SAAS7C,GACd,OAAOiB,KAAKm3B,QAAQl1B,QAAQlD,IAG9BrB,IAAK,SAASb,GACZ,OAAOmD,KAAKm3B,QAAQt6B,IAGtBmzB,MAAO,WACL,OAAOhwB,KAAKtC,IAAI,IAGlB0qB,KAAM,WACJ,OAAOpoB,KAAKtC,IAAIsC,KAAKm3B,QAAQ71B,OAAS,IAGxCmd,QAAS,WACP,OAAOze,KAAKm3B,SAGdvX,KAAM,WAEJ,GAA2B,GAAvB5f,KAAKm3B,QAAQ71B,OACf,OAAO,IAAIoL,EAAIwf,KAGjB,IAAI9b,EAAOpQ,KAAKm3B,QAAQ,GAAG/mB,KAAKpQ,KAAKm3B,QAAQ,GAAG7T,OAOhD,OALAtjB,KAAKyN,KAAK,WAER2C,EAAOA,EAAK8a,MAAMlrB,KAAKoQ,KAAKpQ,KAAKsjB,UAG5BlT,IAKXwJ,UAAW,CAETnY,IAAK,SAAS01B,GACZ,OAAO,IAAIzqB,EAAIpJ,IAAI6zB,OAKzBzqB,EAAImZ,GAAGviB,IAAMoJ,EAAI8M,OAAO,CAEtBrb,OAAQ,SAASsD,GAEfzB,KAAKyB,IAAMA,KAMfiL,EAAIpJ,IAAIiW,QAAU,WAChB,IACIJ,EAAU,GAGd,IAAI,IAAIlc,KAAKyP,EAAIkf,MAAMntB,UACgB,mBAA1BiO,EAAIkf,MAAMntB,UAAUxB,IAAmD,mBAAxByP,EAAIpJ,IAAI7E,UAAUxB,IAC1Ekc,EAAQjU,KAAKjI,GAiBjB,IAAI,IAAIA,KAdRkc,EAAQxT,QAAQ,SAASsjB,GACvBvc,EAAIpJ,IAAI7E,UAAUwqB,GAAU,WAC1B,IAAK,IAAIpsB,EAAI,EAAG8f,EAAK3c,KAAKm3B,QAAQ71B,OAAQzE,EAAI8f,EAAI9f,IAC5CmD,KAAKm3B,QAAQt6B,IAAwC,mBAA3BmD,KAAKm3B,QAAQt6B,GAAGosB,IAC5CjpB,KAAKm3B,QAAQt6B,GAAGosB,GAAQa,MAAM9pB,KAAKm3B,QAAQt6B,GAAIwc,WAEnD,MAAiB,WAAV4P,EAAuBjpB,KAAK2pB,KAAO3pB,KAAK2pB,GAAK,IAAIjd,EAAImZ,GAAGviB,IAAItD,OAAUA,QAKjFmZ,EAAU,GAGGzM,EAAImZ,GAAGpnB,UACgB,mBAAvBiO,EAAImZ,GAAGpnB,UAAUxB,IAAsD,mBAA3ByP,EAAImZ,GAAGviB,IAAI7E,UAAUxB,IAC1Ekc,EAAQjU,KAAKjI,GAGjBkc,EAAQxT,QAAQ,SAASsjB,GACvBvc,EAAImZ,GAAGviB,IAAI7E,UAAUwqB,GAAU,WAC7B,IAAK,IAAIpsB,EAAI,EAAG8f,EAAK3c,KAAKyB,IAAI01B,QAAQ71B,OAAQzE,EAAI8f,EAAI9f,IACpDmD,KAAKyB,IAAI01B,QAAQt6B,GAAG8sB,GAAGV,GAAQa,MAAM9pB,KAAKyB,IAAI01B,QAAQt6B,GAAG8sB,GAAItQ,WAE/D,OAAOrZ,SAMb0M,EAAIwM,OAAOxM,EAAI4N,QAAS,CAEtBsX,KAAM,SAASjyB,EAAGH,EAAG7B,GACnB,GAAgB,iBAALgC,EACT,IAAKH,KAAKG,EACRK,KAAK4xB,KAAKpyB,EAAGG,EAAEH,SAEZ,GAAI6Z,UAAU/X,OAAS,EAC5B,IACE,OAAOqZ,KAAKC,MAAM5a,KAAK0N,KAAK,QAAU/N,IACtC,MAAMwE,GACN,OAAOnE,KAAK0N,KAAK,QAAU/N,QAI7BK,KAAK0N,KACH,QAAU/N,EACJ,OAANH,EACE,MACI,IAAN7B,GAA2B,iBAAN6B,GAA+B,iBAANA,EAC5CA,EACAmb,KAAK4J,UAAU/kB,IAIrB,OAAOQ,QAGX0M,EAAIwM,OAAOxM,EAAI4N,QAAS,CAEtBgd,SAAU,SAASC,EAAG/3B,GAEpB,GAA2B,iBAAhB6Z,UAAU,GACnB,IAAK,IAAI7Z,KAAK+3B,EACZv3B,KAAKs3B,SAAS93B,EAAG+3B,EAAE/3B,QAGlB,IAAwB,GAApB6Z,UAAU/X,OACjB,OAAOtB,KAAKw3B,SAASD,GAIrBv3B,KAAKw3B,SAASD,GAAK/3B,EAErB,OAAOQ,MAITy3B,OAAQ,WACN,GAAwB,GAApBpe,UAAU/X,OACZtB,KAAK03B,QAAU,QAEf,IAAK,IAAI76B,EAAIwc,UAAU/X,OAAS,EAAGzE,GAAK,EAAGA,WAClCmD,KAAKw3B,SAASne,UAAUxc,IAEnC,OAAOmD,MAITw3B,OAAQ,WACN,OAAOx3B,KAAK03B,UAAY13B,KAAK03B,QAAU,OAK3ChrB,EAAIhP,IAAM,SAASoB,GACjB,IAAIkb,EAAOhb,EAASC,eAwLtB,SAAyB81B,GACvB,IAAI93B,GAAK83B,GAAO,IAAIjX,WAAWL,MAAM/Q,EAAI0O,MAAMI,WAE/C,GAAIve,EAAG,OAAOA,EAAE,GA3LmB06B,CAAgB74B,IAAOA,GAC1D,OAAO4N,EAAIqN,MAAMC,IAInBtN,EAAIkrB,OAAS,SAASC,EAAOhe,GAC3B,OAAO,IAAInN,EAAIpJ,IACboJ,EAAI8P,MAAMjZ,KAAKsW,GAAU7a,GAAU84B,iBAAiBD,GAAQ,SAAS7d,GACnE,OAAOtN,EAAIqN,MAAMC,OAKvBtN,EAAIwM,OAAOxM,EAAIsX,OAAQ,CAErB4T,OAAQ,SAASC,GACf,OAAOnrB,EAAIkrB,OAAOC,EAAO73B,KAAKga,SAqLlC,IAAI0S,EAAS,SAAStoB,MAAM,IAG5B,GAAkC,mBAAvB6F,EAAO8nB,YAA4B,CAE5C,IAAIgG,EAAkB,SAAS3uB,EAAOmoB,GACpCA,EAAUA,GAAW,CAAEyG,SAAS,EAAOhG,YAAY,EAAOtJ,YAAQroB,GAClE,IAAI8D,EAAInF,EAASi5B,YAAY,eAE7B,OADA9zB,EAAE+zB,gBAAgB9uB,EAAOmoB,EAAQyG,QAASzG,EAAQS,WAAYT,EAAQ7I,QAC/DvkB,GAGT4zB,EAAgBt5B,UAAYwL,EAAO4nB,MAAMpzB,UAEzCiO,EAAIqlB,YAAcgG,OAElBrrB,EAAIqlB,YAAc9nB,EAAO8nB,YA+B3B,OA3BC,SAAS6E,GAIR,IAHA,IAAIuB,EAAW,EACXC,EAAU,CAAC,MAAO,UAEd7wB,EAAI,EAAGA,EAAI6wB,EAAQ92B,SAAW2I,EAAO6c,wBAAyBvf,EACpEqvB,EAAE9P,sBAAwB8P,EAAEwB,EAAQ7wB,GAAK,yBACzCqvB,EAAE7P,qBAAwB6P,EAAEwB,EAAQ7wB,GAAK,yBACfqvB,EAAEwB,EAAQ7wB,GAAK,+BAG3CqvB,EAAE9P,sBAAwB8P,EAAE9P,uBAC1B,SAAS5kB,GACP,IAAIm2B,GAAW,IAAIhT,MAAOiT,UACtBC,EAAa3lB,KAAK0W,IAAI,EAAG,IAAM+O,EAAWF,IAE1Cr5B,EAAK83B,EAAEvM,WAAW,WACpBnoB,EAASm2B,EAAWE,IACnBA,GAGH,OADAJ,EAAWE,EAAWE,EACfz5B,GAGX83B,EAAE7P,qBAAuB6P,EAAE7P,sBAAwB6P,EAAE4B,aAvBvD,CAyBEvuB,GAEKyC,EAh9KM+rB,CAAQpgB,EAAMA,EAAKrZ,WAC3B,+B,8ECbL,MAAaoiB,EACX,YAAqB7Z,EAAoBoG,GAApB,KAAApG,IAAoB,KAAAoG,IAGlC,UAAU+qB,GAEf,OAAiB,IADD9lB,KAAKma,MAAM2L,EAAM/qB,EAAI3N,KAAK2N,EAAG+qB,EAAMnxB,EAAIvH,KAAKuH,GACrCqL,KAAKkK,IANhC,UA0BA,qBAA0B4S,GACxB,IAAI9nB,EAAwB,KAC5B,MAAM4E,EACFkjB,EAAO3wB,QAAQ45B,iBAAmBjJ,EAAO3wB,QAGvC65B,EAAiB75B,IACrB,MAAMqP,EAAOrP,EAAQotB,wBACf9c,EAAKjB,EAAK2c,KAAO3c,EAAKf,MAAQ,EAAIpD,OAAO4uB,QACzCvpB,EAAKlB,EAAK4c,IAAM5c,EAAKhB,OAAS,EAAInD,OAAO6uB,QAC/C,OAAO,IAAI1X,EAAM/R,EAAIC,IAIjBypB,EAAkB3vB,IACtB,MAAM+kB,EAAQ3hB,EAAI4hB,iBAClBD,EAAM5mB,EAAI6B,EAAM4vB,QAChB7K,EAAMxgB,EAAIvE,EAAM6vB,QAChB,MAAMt6B,EAAIwvB,EAAME,gBAAgB7hB,EAAI0hB,eAAgBpqB,WACpD,OAAO,IAAIsd,EAAMziB,EAAE4I,EAAG5I,EAAEgP,IAuBpBurB,EAAoB9vB,IACV,OAAVxB,IAIJA,EAAMqN,OAAOF,QAAU6jB,EAAclJ,EAAO3wB,SAC5C6I,EAAMkN,MAAMC,QAAUgkB,EAAe3vB,GACjCsmB,EAAOja,QACTia,EAAOja,OAAO7N,KAkBlBqC,OAAOK,iBAAiB,UAdAlB,IACR,OAAVxB,IAIJqC,OAAO0nB,oBAAoB,YAAauH,GAAkB,GAC1DtxB,EAAMqN,OAAOF,QAAU6jB,EAAclJ,EAAO3wB,SAC5C6I,EAAMkN,MAAMC,QAAUgkB,EAAe3vB,GACjCsmB,EAAO/Z,UACT+Z,EAAO/Z,SAAS/N,GAElBA,EAAQ,QAGyC,GACnD8nB,EAAO3wB,QAAQuL,iBAAiB,YA/CNlB,IACxB,MAAMgG,EAASwpB,EAAclJ,EAAO3wB,SAC9B+V,EAAQikB,EAAe3vB,GAC7BxB,EAAQ,CACNkN,MAAO,CACL1D,MAAO0D,EACPC,QAASD,GAEXG,OAAQ,CACN7D,MAAOhC,EACP2F,QAAS3F,EACTrQ,QAAS2wB,EAAO3wB,UAGhB2wB,EAAOna,SACTma,EAAOna,QAAQ3N,GAEjBqC,OAAOK,iBAAiB,YAAa4uB,GAAkB,KA8BM,K,8ECpEjE,sBAA0B,EAACv7B,EAAD,IAAI8T,IAC5B,MAAMoL,EAAUpL,EAAMmB,KAAKkK,GAAK,IAChC,MAAO,CAACvV,EAAG5J,EAAIiV,KAAK+R,IAAI9H,GAAUlP,EAAGhQ,EAAIiV,KAAKgS,IAAI/H,KAGpD,qBAA0Bld,EAAOqC,GAC/B,MAAO,CAACuF,EAAG5H,EAAE4H,EAAIvF,EAAEuF,EAAGoG,EAAGhO,EAAEgO,EAAI3L,EAAE2L,IAMnC,MAAaK,EAGX,cAAgBhO,KAAKo3B,SAAW,GAEzB,QAAkB,OAAOp3B,KAAKo3B,SAAS3yB,KAAK,KAE5C,QAAU,OAAOzE,KAAKogB,IACtB,OAAOzhB,GAAS,OAAOqB,KAAKiO,EAAEtP,EAAE4I,EAAG5I,EAAEgP,GACrC,OAAOhP,GAAS,OAAOqB,KAAKkO,EAAEvP,EAAE4I,EAAG5I,EAAEgP,GACrC,iBAAiBzQ,EAAOyB,GAAS,OAAOqB,KAAKkgB,EAAEhjB,EAAEqK,EAAGrK,EAAEyQ,EAAGhP,EAAE4I,EAAG5I,EAAEgP,GAChE,aAAawrB,EAAQC,EAAQz6B,GAClC,OAAOqB,KAAK4Q,EAAEuoB,EAAG5xB,EAAG4xB,EAAGxrB,EAAGyrB,EAAG7xB,EAAG6xB,EAAGzrB,EAAGhP,EAAE4I,EAAG5I,EAAEgP,GAExC,MAAMrQ,EAAeqB,GAC1B,OA/BJ,SAAuBrB,GACrB,MAAO,MAAOA,EA8BR+7B,CAAc/7B,GACT0C,KAAKqgB,EAAE/iB,EAAEK,EAAGL,EAAEK,EAAG,EAAGL,EAAEg8B,WAAY,EAAOh8B,EAAEqW,QAAS,EAAOhV,EAAE4I,EACtD5I,EAAEgP,GAET3N,KAAKqgB,EAAE/iB,EAAEggB,GAAIhgB,EAAEigB,GAAIjgB,EAAE2U,UAAY,EAAG3U,EAAEg8B,WAAY,EAC3Ch8B,EAAEqW,QAAS,EAAOhV,EAAE4I,EAAG5I,EAAEgP,GAIpC,EAAEpG,EAAWoG,GAAa,OAAO3N,KAAKkF,SAASqC,KAAKoG,KACpD,EAAEkH,EAAYG,GAAc,OAAOhV,KAAKkF,SAAS2P,KAAMG,KACvD,IAAM,OAAOhV,KAAKkF,KAAK,KACvB,IAAM,OAAOlF,KAAKkF,KAAK,KACvB,EAAEqC,EAAWoG,GAAa,OAAO3N,KAAKkF,SAASqC,KAAKoG,KACpD,EAAEkH,EAAYG,GAAc,OAAOhV,KAAKkF,SAAS2P,KAAMG,KACvD,EAAEzN,GAAa,OAAOvH,KAAKkF,SAASqC,KACpC,EAAEsN,GAAc,OAAO7U,KAAKkF,SAAS2P,KACrC,EAAElH,GAAa,OAAO3N,KAAKkF,SAASyI,KACpC,EAAEqH,GAAc,OAAOhV,KAAKkF,SAAS8P,KACrC,EAAEukB,EAAaC,EAAaC,EAAaC,EAAanyB,EACpDoG,GACP,OAAO3N,KAAKkF,SAASq0B,KAAOC,KAAOC,KAAOC,KAAOnyB,KAAKoG,KAEjD,EAAEgsB,EAAcC,EAAcC,EAAcC,EAAcjlB,EACxDG,GACP,OAAOhV,KAAKkF,SAASy0B,KAAQC,KAAQC,KAAQC,KAAQjlB,KAAMG,KAEtD,EAAEykB,EAAaC,EAAanyB,EAAWoG,GAC5C,OAAO3N,KAAKkF,SAASu0B,KAAOC,KAAOnyB,KAAKoG,KAEnC,EAAEksB,EAAcC,EAAcjlB,EAAYG,GAC/C,OAAOhV,KAAKkF,SAAS20B,KAAQC,KAAQjlB,KAAMG,KAEtC,EAAE3F,EAAYC,EAAY/H,EAAWoG,GAC1C,OAAO3N,KAAKkF,SAASmK,KAAMC,KAAM/H,KAAKoG,KAEjC,EAAEosB,EAAaC,EAAanlB,EAAYG,GAC7C,OAAOhV,KAAKkF,SAAS60B,KAAOC,KAAOnlB,KAAMG,KAEpC,EAAEzN,EAAWoG,GAAa,OAAO3N,KAAKkF,SAASqC,KAAKoG,KACpD,EAAEkH,EAAYG,GAAc,OAAOhV,KAAKkF,SAAS2P,KAAMG,KACvD,EAAEsI,EAAYC,EAAY0c,EACxBX,EAA0B3lB,EAAuBpM,EACjDoG,GACP,MAAMusB,EAAMZ,EAAW,EAAI,EACrBa,EAAKxmB,EAAQ,EAAI,EACvB,OAAO3T,KAAKkF,SAASoY,KAAMC,KAAM0c,KAAeC,KAAOC,KAAM5yB,KAAKoG,KAE7D,EAAEysB,EAAaC,EAAaJ,EAC1BX,EAA0B3lB,EAAuBkB,EACjDG,GACP,MAAMklB,EAAMZ,EAAW,EAAI,EACrBa,EAAKxmB,EAAQ,EAAI,EACvB,OAAO3T,KAAKkF,SAASk1B,KAAOC,KAAOJ,KAAeC,KAAOC,KAAMtlB,KAAMG,KAG/D,KAAKpW,GAEX,OADAoB,KAAKo3B,SAASlyB,KAAKtG,GACZoB,MAzEX,mBA8EA,iBAAsB0O,EAAsBrB,GAC1C,MAAMmC,EAAed,EAAerB,EACpC,OAAO,IAAIW,GACN2D,OAAO,CAACpK,EAAG,EAAGoG,EAAGe,IACjBgF,MAAM,CAAC/V,EAAG+Q,EAAc4qB,UAAU,EAAM3lB,OAAO,GACzC,CAACpM,EAAG,EAAGoG,GAAIe,IACjBgF,MAAM,CAAC/V,EAAG+Q,EAAc4qB,UAAU,EAAM3lB,OAAO,GACzC,CAACpM,EAAG,EAAGoG,EAAGe,IAChB4rB,QACA3oB,OAAO,CAACpK,EAAG,EAAGoG,EAAG6B,IACjBkE,MAAM,CAAC/V,EAAG6R,EAAc8pB,UAAU,EAAM3lB,OAAO,GACzC,CAACpM,EAAG,EAAGoG,GAAI6B,IACjBkE,MAAM,CAAC/V,EAAG6R,EAAc8pB,UAAU,EAAM3lB,OAAO,GACzC,CAACpM,EAAG,EAAGoG,EAAG6B,IAChB8qB,QACAnsB,U","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","'use strict';\n\n// Returns the given HTML or SVG element by id, throwing an error if not found.\nexport function getElementByIdOrThrow(id: string): HTMLElement {\n  const element = document.getElementById(id);\n  if (!element) {\n    throw Error('no such DOM element: ' + id);\n  }\n  return element;\n}\n\n// Same as getElementByIdOrThrow, but doing the type casting for you to SVG.\nexport function getSVGGraphicsElementByIdOrThrow(id: string):\n    SVGGraphicsElement {\n  return (getElementByIdOrThrow(id) as unknown) as SVGGraphicsElement;\n}\n\n// Adds class \"{key}-{value}\" and removes any other \"{key}-*\". If `value` is an\n// array, adds one class for each value.\nexport function setClassKeyValue(element: HTMLElement, key: string,\n                                 value: string|string[]) {\n  const regexp = new RegExp('(?:^|\\\\s)' + key + '-\\\\S*', 'g');\n  // Note: We can't use .className because SVGElement.className does not return\n  // a string.\n  let klass = (element.getAttribute('class') || '').replace(regexp, '');\n  if (typeof value === 'string') {\n    klass += ` ${key}-${value}`;\n  } else {\n    for (const v of value) {\n      klass += ` ${key}-${v}`;\n    }\n  }\n  element.setAttribute('class', klass);\n}\n\n// Removes any class \"{key}-*\".\nexport function clearClassKey(element: HTMLElement, key: string) {\n  const regexp = new RegExp('(?:^|\\\\s)' + key + '-\\\\S*', 'g');\n  // Note: We can't use .className because SVGElement.className does not return\n  // a string.\n  const klass = (element.getAttribute('class') || '').replace(regexp, '');\n  element.setAttribute('class', klass);\n}\n","// Miscellaneous helper functions.\n\n'use strict';\n\n// ----------------------------------------------------------------------------\n//                                 Functions\n// ----------------------------------------------------------------------------\n\n// Given the difference between two points on a circle, returns the shortest\n// distance between them, either positive or negative.\nexport function circularDistance(difference: number, divisor: number): number {\n  let d = mod(difference, divisor);\n  if (d > divisor / 2) {\n    d -= divisor;\n  }\n  return d;\n}\n\n// Returns a % n, ensuring the result is always positive.\nexport function mod(a: number, n: number): number {\n  let result = a % n;\n  if (result < 0) {\n    result += n;\n  }\n  return result;\n}\n\n// ----------------------------------------------------------------------------\n//                                 Dictionary\n// ----------------------------------------------------------------------------\n\n// An Object that throws an error if a key does not exist.\nexport class Dictionary<T> {\n  private _map: {[key: string]: T};\n  private _message: string;\n\n  constructor(message: string = 'Key not found') {\n    this._map = {};\n    this._message = message;\n  }\n\n  public set(key: string, value: T): void { this._map[key] = value; }\n  public has(key: string): boolean { return this._map.hasOwnProperty(key); }\n  public get(key: string, default_value?: T): T {\n    if (this.has(key)) return this._map[key];\n    if (default_value !== undefined) return default_value;\n    throw Error(this._message + ': ' + key);\n  }\n}\n\n// ----------------------------------------------------------------------------\n//                            UnreachableCaseError\n// ----------------------------------------------------------------------------\n\nexport class UnreachableCaseError extends Error {\n  constructor(val: never) { super(`Unreachable case: ${val}`); }\n}\n\n// vim: set sw=2:\n","// Logic of the Enigma Machine (no graphics).\n\n'use strict';\n\nimport helpers = require('./helpers');\n\nconst mod = helpers.mod;\nconst Dictionary = helpers.Dictionary;\n\n// ----------------------------------------------------------------------------\n//                                 Interfaces\n// ----------------------------------------------------------------------------\n\nexport interface Spec {\n  alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n  rotors: {[name: string]: {permutation: string, notch: string}};\n  reflectors: {[name: string]: string};\n  defaults: {rotor_order: string, reflector: string};\n}\n\nexport interface LastValue {\n  input: string;\n  output: string;\n}\n\nexport interface LastValueBidi {\n  forward: LastValue;\n  inverse: LastValue;\n}\n\nexport interface LastValueFullEnigma {\n  plugboard: LastValueBidi;\n  rotors: LastValueBidi[];\n  reflector: LastValue;\n}\n\nexport type RotorPosition = 'l'|'m'|'r';\n\nexport interface EnigmaOnUpdateCallback {\n  onPlugboardChange(permutation: Permutation, setting: string): void;\n  onReflectorChange(name: string): void;\n  onRotorOrderChange(order: string): void;\n  onRotorChange(position: RotorPosition, name: string): void;\n  onRingSettingChange(value: string): void;\n  onIndicatorChange(value: string): void;\n  onRingLocked(value: boolean): void;\n  onEncrypt(values: LastValueFullEnigma): void;\n}\n\n// ----------------------------------------------------------------------------\n//                           Standard Enigma Specs\n// ----------------------------------------------------------------------------\n\n// Source: http://www.cryptomuseum.com/crypto/enigma/wiring.htm\nexport let M3_DEF: Spec = {\n  alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',\n  rotors: {\n    'I': {permutation: 'EKMFLGDQVZNTOWYHXUSPAIBRCJ', notch: 'Q'},\n    'II': {permutation: 'AJDKSIRUXBLHWTMCQGZNPYFVOE', notch: 'E'},\n    'III': {permutation: 'BDFHJLCPRTXVZNYEIWGAKMUSQO', notch: 'V'},\n    'IV': {permutation: 'ESOVPZJAYQUIRHXLNFTGKDCMWB', notch: 'J'},\n    'V': {permutation: 'VZBRGITYUPSDNHLXAWMJQOFECK', notch: 'Z'},\n    'VI': {permutation: 'JPGVOUMFYQBENHZRDKASXLICTW', notch: 'ZM'},\n    'VII': {permutation: 'NZJHGRCXMYSWBOUFAIVLPEKQDT', notch: 'ZM'},\n    'VIII': {permutation: 'FKQHTLXOCBJSPDZRAMEWNIUYGV', notch: 'ZM'},\n  },\n  reflectors: {\n    'A': 'EJMZALYXVBWFCRQUONTSPIKHGD',\n    'B': 'YRUHQSLDPXNGOKMIEBFZCWVJAT',\n    'C': 'FVPJIAOYEDRZXWGCTKUQSBNMHL',\n  },\n  defaults: {\n    rotor_order: 'I-II-III',\n    reflector: 'B',\n  },\n};\n\n// ----------------------------------------------------------------------------\n//                                  Alphabet\n// ----------------------------------------------------------------------------\n\n// A wrapper around an alphabet that ignores case (always uses uppercase) and\n// has handy methods.\nexport class Alphabet {\n  public readonly string: string;\n  public readonly length: number;\n\n  private readonly _to_index: helpers.Dictionary<number>;\n\n  constructor(alphabet: string) {\n    this.string = alphabet.toUpperCase();\n    this.length = alphabet.length;\n    this._to_index = new Dictionary<number>('Invalid letter');\n    for (let i = 0; i < this.string.length; i++) {\n      const letter = this.string[i];\n      this._to_index.set(letter, i);\n      this._to_index.set(letter.toLowerCase(), i);\n    }\n  }\n\n  // Returns true if letter is valid.\n  public valid(letter: string): boolean { return this._to_index.has(letter); }\n\n  // Returns true if all elements in s are valid characters.\n  public allValid(s: string): boolean {\n    for (const character of s) {\n      if (!this._to_index.has(character)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  // Returns the 0-based index of the given letter or throws an error if letter\n  // is not valid.\n  public indexOf(letter: string): number { return this._to_index.get(letter); }\n\n  // Returns the letter at the given 0-based index.\n  public fromIndex(index: number): string { return this.string[index]; }\n\n  // Converts an array of indices into a string.\n  public fromIndices(...indices: number[]): string {\n    let out = '';\n    for (const idx of indices) {\n      out += this.string[idx];\n    }\n    return out;\n  }\n\n  // Adds two letters by their indices, mod the alphabet length.\n  public add(a: string|number, b: string|number): string {\n    if (typeof a !== 'number') a = this.indexOf(a);\n    if (typeof b !== 'number') b = this.indexOf(b);\n    return this.string[mod(a + b, this.length)];\n  }\n\n  // Calls callback(letter, index) for each letter in the alphabet.\n  public each(callback: (letter: string, index: number) => void) {\n    for (let i = 0, len = this.string.length; i < len; i++) {\n      callback(this.string.charAt(i), i);\n    }\n  }\n}\n\n// ----------------------------------------------------------------------------\n//                                Permutation\n// ----------------------------------------------------------------------------\n\n// A permutation (aka simple substitution) of alphabet.\nexport class Permutation {\n  public alphabet: Alphabet;\n  public last_forward: LastValue = {input: '', output: ''};\n  public last_inverse: LastValue = {input: '', output: ''};\n  public string!: string;\n\n  private _forward_table!: helpers.Dictionary<string>;\n  private _inverse_table!: helpers.Dictionary<string>;\n\n  constructor(permutation_string: string, alphabet: Alphabet) {\n    this.alphabet = alphabet;\n    this.setTo(permutation_string);\n  }\n\n  // Applies the permutation to the given letter.\n  public forward(letter: string): string {\n    letter = letter.toUpperCase();\n    const output = this._forward_table.get(letter);\n    this.last_forward = {input: letter, output: output};\n    return output;\n  }\n\n  // Applies the inverse of the permutation to the given letter.\n  public inverse(letter: string): string {\n    letter = letter.toUpperCase();\n    const output = this._inverse_table.get(letter);\n    this.last_inverse = {input: letter, output: output};\n    return output;\n  }\n\n  // Updates the permutation.  On error the permutation is unchanged.\n  public setTo(permutation_string: string): void {\n    permutation_string = permutation_string.toUpperCase();\n    if (permutation_string.length !== this.alphabet.length) {\n      throw Error('Invalid permutation: length ' + permutation_string.length +\n                  ', expected ' + this.alphabet.length);\n    }\n    const forward_table = new Dictionary<string>('Invalid letter');\n    const inverse_table = new Dictionary<string>('Invalid letter');\n    for (let i = 0; i < this.alphabet.length; i++) {\n      const plain = this.alphabet.fromIndex(i);\n      const cipher = permutation_string[i];\n      this.alphabet.indexOf(cipher);  // throws error if cipher invalid\n      if (inverse_table.has(cipher)) {\n        throw Error('Invalid permutation: letter ' + cipher +\n                    ' used more than once');\n      }\n      forward_table.set(plain, cipher);\n      inverse_table.set(cipher, plain);\n    }\n\n    this.string = permutation_string;\n    this._forward_table = forward_table;\n    this._inverse_table = inverse_table;\n  }\n\n  // Calls callback(plain_letter, cipher_letter) for each letter in the\n  // alphabet.\n  public eachPair(callback: (plain_letter: string,\n                             cipher_letter: string) => void) {\n    for (let i = 0; i < this.string.length; i++) {\n      callback(this.alphabet.string[i], this.string[i]);\n    }\n  }\n}\n\n// ----------------------------------------------------------------------------\n//                                   Rotor\n// ----------------------------------------------------------------------------\n\n// An Enigma machine rotor.\nexport class Rotor {\n  public permutation: Permutation;\n  public notch_string: string;\n\n  private _notches: Set<number>;\n  private _alphabet: Alphabet;\n  private _indicator: number;\n  private _ring_setting: number;\n\n  constructor(permutation_string: string, notch_string: string,\n              alphabet: Alphabet) {\n    this.permutation = new Permutation(permutation_string, alphabet);\n    this.notch_string = notch_string;\n    this._notches = new Set<number>(\n        [...notch_string].map((letter) => alphabet.indexOf(letter)));\n    this._alphabet = alphabet;\n    this._indicator = 0;\n    this._ring_setting = 0;\n  }\n\n  get indicator(): number { return this._indicator; }\n  set indicator(value: number) {\n    this._indicator = mod(value, this._alphabet.length);\n  }\n\n  get ring_setting(): number { return this._ring_setting; }\n  set ring_setting(value: number) {\n    this._ring_setting = mod(value, this._alphabet.length);\n  }\n\n  public forward(letter: string): string {\n    const offset = this._indicator - this._ring_setting;\n    letter = this._alphabet.add(offset, letter);\n    letter = this.permutation.forward(letter);\n    return this._alphabet.add(-offset, letter);\n  }\n\n  public inverse(letter: string): string {\n    const offset = this._indicator - this._ring_setting;\n    letter = this._alphabet.add(offset, letter);\n    letter = this.permutation.inverse(letter);\n    return this._alphabet.add(-offset, letter);\n  }\n\n  public step(): void { this.indicator += 1; }\n\n  public isOnNotch(): boolean { return this._notches.has(this._indicator); }\n}\n\n// ----------------------------------------------------------------------------\n//                                 Plugboard\n// ----------------------------------------------------------------------------\n\nexport class Plugboard {\n  public permutation: Permutation;\n  public string: string;\n\n  private _alphabet: Alphabet;\n\n  constructor(alphabet: Alphabet) {\n    this._alphabet = alphabet;\n    this.permutation = new Permutation(this._alphabet.string, this._alphabet);\n    this.string = '';\n  }\n\n  public forward(letter: string): string {\n    return this.permutation.forward(letter);\n  }\n  public inverse(letter: string): string {\n    return this.permutation.inverse(letter);\n  }\n\n  // Sets the plugboard to the given value, e.g. 'AB FX'.\n  public setTo(pair_string: string): void {\n    pair_string = pair_string.toUpperCase();\n    this.permutation.setTo(this._toPermutationString(pair_string));\n    this.string = pair_string;\n  }\n\n  // Returns '' if pair_string is valid, else the error message.\n  public validate(pair_string: string): string {\n    try {\n      this._toPermutationString(pair_string.toUpperCase());\n      return '';\n    } catch (e) {\n      return e.message;\n    }\n  }\n\n  // Returns a permutation string for the given pair string, or throws an error\n  // if the input is invalid.  Example: 'AB DF' -> 'BACFEDG...Z'\n  private _toPermutationString(pair_string: string): string {\n    const out = this._alphabet.string.split('');\n    const pairs = pair_string.toUpperCase().split(/\\s+/);\n    for (const pair of pairs) {\n      if (pair === '') continue;\n      if (pair.length !== 2 || pair[0] === pair[1]) {\n        throw Error('Invalid plugboard pair: \"' + pair + '\"');\n      }\n      const i = this._alphabet.indexOf(pair[0]);\n      const j = this._alphabet.indexOf(pair[1]);\n      if (out[i] !== pair[0]) {\n        throw Error('Plugboard value \"' + pair[0] + '\" used more than once');\n      }\n      if (out[j] !== pair[1]) {\n        throw Error('Plugboard value \"' + pair[1] + '\" used more than once');\n      }\n      const tmp = out[i];\n      out[i] = out[j];\n      out[j] = tmp;\n    }\n    return out.join('');\n  }\n}\n\n// ----------------------------------------------------------------------------\n//                                   Enigma\n// ----------------------------------------------------------------------------\n\nexport class Enigma {\n  private _spec: Spec;\n  private _alphabet: Alphabet;\n  private _plugboard: Plugboard;\n  private _rotors!: Rotor[];\n  private _reflector!: Rotor;\n  private _rotor_order!: string;\n  private _reflector_name!: string;\n  private _ring_locked: boolean;  // only exists for callbacks\n  private readonly _onUpdateCallbacks: EnigmaOnUpdateCallback[];\n\n  constructor(spec: Spec) {\n    this._onUpdateCallbacks = new Array<EnigmaOnUpdateCallback>();\n    this._spec = spec;\n    this._alphabet = new Alphabet(spec.alphabet);\n    this._plugboard = new Plugboard(this._alphabet);\n    this.setRotorOrder(spec.defaults.rotor_order);\n    this.setReflector(spec.defaults.reflector);\n    this._ring_locked = true;\n  }\n\n  public registerOnUpdateCallback(callback: EnigmaOnUpdateCallback) {\n    this._onUpdateCallbacks.push(callback);\n  }\n\n  private _getRotorField(field: 'indicator'|'ring_setting') {\n    return this._alphabet.fromIndices(\n        this._rotors[0][field], this._rotors[1][field], this._rotors[2][field]);\n  }\n\n  private _setRotorField(field: 'indicator'|'ring_setting', value: string) {\n    const error = this._validateRotorField(field, value);\n    if (error) throw new Error(error);\n    for (let i = 0; i < value.length; i++) {\n      this._rotors[i][field] = this._alphabet.indexOf(value[i]);\n    }\n    this._callRotorUpdate(field);\n  }\n\n  private _validateRotorField(field: 'indicator'|'ring_setting',\n                              value: string) {\n    value = value.toUpperCase();\n    if (value.length !== 3) {\n      return field + ' length must be 3';\n    }\n    if (!this._alphabet.allValid(value)) {\n      return 'invalid ' + field + ' letter: ' + value;\n    }\n    return '';\n  }\n\n  private _setRotorFieldAtIndex(index: number,\n                                field: 'indicator'|'ring_setting',\n                                value: string) {\n    if (index < 0 || index > 3) {\n      throw new Error('invalid Rotor index: ' + index);\n    }\n    if (!this._alphabet.valid(value)) {\n      throw new Error('invalid letter: ' + value);\n    }\n    this._rotors[index][field] = this._alphabet.indexOf(value);\n    this._callRotorUpdate(field);\n  }\n\n  private _callRotorUpdate(field: 'indicator'|'ring_setting') {\n    if (field === 'indicator') {\n      this._onUpdateCallbacks.forEach(\n          c => c.onIndicatorChange(this.getIndicator()));\n    } else {\n      this._onUpdateCallbacks.forEach(\n          c => c.onRingSettingChange(this.getRingSetting()));\n    }\n  }\n\n  public getIndicator(): string { return this._getRotorField('indicator'); }\n  public setIndicator(value: string): void {\n    this._setRotorField('indicator', value);\n  }\n  public setIndicatorAtIndex(index: number, value: string): void {\n    this._setRotorFieldAtIndex(index, 'indicator', value);\n  }\n  public validateIndicator(value: string): string {\n    return this._validateRotorField('indicator', value);\n  }\n\n  public getRingSetting(): string {\n    return this._getRotorField('ring_setting');\n  }\n  public setRingSetting(value: string): void {\n    this._setRotorField('ring_setting', value);\n  }\n  public setRingSettingAtIndex(index: number, value: string): void {\n    this._setRotorFieldAtIndex(index, 'ring_setting', value);\n  }\n  public validateRingSetting(value: string): string {\n    return this._validateRotorField('ring_setting', value);\n  }\n\n  public getRotorOrder(): string { return this._rotor_order; }\n  public setRotorOrder(value: string, validate_only = false): void {\n    value = value.toUpperCase();\n    const a = value.split('-');\n    if (a.length !== 3) {\n      throw new Error('Rotor order must be specified as I-II-III');\n    }\n    const new_rotors: Rotor[] = [];\n    for (const rotor_name of a) {\n      const rotor_spec = this._spec.rotors[rotor_name];\n      if (rotor_spec === undefined) {\n        throw Error('Invalid rotor name: ' + rotor_name);\n      }\n      new_rotors.push(\n          new Rotor(rotor_spec.permutation, rotor_spec.notch, this._alphabet));\n    }\n    if (!validate_only) {\n      const old_rotors = this._rotors;\n      if (old_rotors) {\n        for (let i = 0; i < new_rotors.length; i++) {\n          new_rotors[i].indicator = old_rotors[i].indicator;\n          new_rotors[i].ring_setting = old_rotors[i].ring_setting;\n        }\n      }\n      this._rotors = new_rotors;\n      this._rotor_order = value;\n      this._onUpdateCallbacks.forEach(\n          c => c.onRotorOrderChange(this._rotor_order));\n      this._onUpdateCallbacks.forEach(c => c.onRotorChange('l', a[0]));\n      this._onUpdateCallbacks.forEach(c => c.onRotorChange('m', a[1]));\n      this._onUpdateCallbacks.forEach(c => c.onRotorChange('r', a[2]));\n    }\n  }\n  public validateRotorOrder(value: string): string {\n    try {\n      this.setRotorOrder(value, true);\n    } catch (e) {\n      return e.message;\n    }\n    return '';\n  }\n\n  public getReflector(): string { return this._reflector_name; }\n  public setReflector(name: string, validate_only = false): void {\n    const _permutation = this._spec.reflectors[name];\n    if (_permutation === undefined) {\n      throw Error('Invalid reflector name: ' + name);\n    }\n    if (!validate_only) {\n      this._reflector = new Rotor(_permutation, '', this._alphabet);\n      this._reflector_name = name;\n      this._onUpdateCallbacks.forEach(c => c.onReflectorChange(name));\n    }\n  }\n  public validateReflector(name: string): string {\n    try {\n      this.setReflector(name, true);\n    } catch (e) {\n      return e.message;\n    }\n    return '';\n  }\n  public getReflectorPermutation(): Permutation {\n    return this._reflector.permutation;\n  }\n\n  public getPlugboard(): string { return this._plugboard.string; }\n  public setPlugboard(value: string): void {\n    this._plugboard.setTo(value);\n    this._onUpdateCallbacks.forEach(\n        c => c.onPlugboardChange(this._plugboard.permutation,\n                                 this._plugboard.string));\n  }\n  public validatePlugboard(value: string): string {\n    return this._plugboard.validate(value);\n  }\n  public getPlugboardPermutation(): Permutation {\n    return this._plugboard.permutation;\n  }\n\n  public setRingLocked(value: boolean): void {\n    this._ring_locked = value;\n    this._onUpdateCallbacks.forEach(c => c.onRingLocked(value));\n  }\n\n  // TODO test and document\n  public getLastValues(): LastValueFullEnigma {\n    return {\n      plugboard: {\n        forward: this._plugboard.permutation.last_forward,\n        inverse: this._plugboard.permutation.last_inverse,\n      },\n      rotors: [\n        {\n          forward: this._rotors[0].permutation.last_forward,\n          inverse: this._rotors[0].permutation.last_inverse,\n        },\n        {\n          forward: this._rotors[1].permutation.last_forward,\n          inverse: this._rotors[1].permutation.last_inverse,\n        },\n        {\n          forward: this._rotors[2].permutation.last_forward,\n          inverse: this._rotors[2].permutation.last_inverse,\n        },\n      ],\n      reflector: this._reflector.permutation.last_forward,\n    };\n  }\n\n  public isValidLetter(letter: string): boolean {\n    return this._alphabet.valid(letter);\n  }\n\n  // Encrypts an entire message, stepping on each letter.\n  public encryptMessage(message: string): string {\n    let out = '';\n    for (const character of message) {\n      out += this.stepAndEncryptSingle(character);\n    }\n    return out;\n  }\n\n  // Steps the machine and encrypts a single letter, just like pushing\n  // a keyboard button.\n  public stepAndEncryptSingle(letter: string): string {\n    this.step(true);\n    return this.encryptSingleNoStep(letter);\n  }\n\n  // Encrypts a single letter without stepping.\n  public encryptSingleNoStep(letter: string): string {\n    let x = letter;\n    x = this._plugboard.forward(x);\n    x = this._rotors[2].forward(x);\n    x = this._rotors[1].forward(x);\n    x = this._rotors[0].forward(x);\n    x = this._reflector.forward(x);\n    x = this._rotors[0].inverse(x);\n    x = this._rotors[1].inverse(x);\n    x = this._rotors[2].inverse(x);\n    x = this._plugboard.inverse(x);\n    this._onUpdateCallbacks.forEach(c => c.onEncrypt(this.getLastValues()));\n    return x;\n  }\n\n  // Steps the scrambler one position.\n  public step(suppress_on_update: boolean): void {\n    if (this._rotors[1].isOnNotch()) {\n      this._rotors[0].step();\n    }\n    if (this._rotors[1].isOnNotch() || this._rotors[2].isOnNotch()) {\n      this._rotors[1].step();\n    }\n    this._rotors[2].step();\n    this._onUpdateCallbacks.forEach(\n        c => c.onIndicatorChange(this.getIndicator()));\n  }\n\n  public saveState(state: URLSearchParams): void {\n    state.set('rotor_order', this.getRotorOrder());\n    state.set('ring_setting', this.getRingSetting());\n    state.set('indicator', this.getIndicator());\n    state.set('plugboard', this.getPlugboard());\n    state.set('locked', this._ring_locked ? '1' : '0');\n  }\n\n  public loadState(state: URLSearchParams): void {\n    function setIfValid(query_param: string, set: (value: string) => void) {\n      const value = state.get(query_param);\n      if (value === null) {\n        return;\n      }\n      try {\n        set(value);\n      } catch (e) {\n        console.warn('Invalid state value: %s=%s (%s)', query_param, value, e);\n      }\n    }\n    function setBooleanIfValid(query_param: string,\n                               set: (value: boolean) => void) {\n      const value = state.get(query_param);\n      if (value === null) {\n        return;\n      }\n      if (value === '1') {\n        set(true);\n      } else if (value === '0') {\n        set(false);\n      } else {\n        console.warn('Invalid state value: %s=%s (must be \"0\" or \"1\")',\n                     query_param, value);\n      }\n    }\n    setIfValid('rotor_order', (v) => this.setRotorOrder(v));\n    setIfValid('ring_setting', (v) => this.setRingSetting(v));\n    setIfValid('indicator', (v) => this.setIndicator(v));\n    setIfValid('plugboard', (v) => this.setPlugboard(v));\n    setBooleanIfValid('ring_locked', (v) => this.setRingLocked(v));\n  }\n}\n\n// vim: set sw=2:\n","// Top level JavaScript for the Enigma simulator.\n\n'use strict';\n\nimport {getElementByIdOrThrow} from './dom';\nimport {EnigmaGraphics} from './graphics';\nimport {Enigma, EnigmaOnUpdateCallback, M3_DEF, Permutation} from './logic';\n\nfunction main() {\n  const graphics = new EnigmaGraphics('drawing', M3_DEF);\n  const enigma = new Enigma(M3_DEF);\n  enigma.registerOnUpdateCallback(graphics);\n  graphics.addEventListeners(enigma);\n  const html_interface = new HtmlInterface(enigma);\n  SetupOnHashChange(enigma);\n\n  // TODO remove this?\n  enigma.encryptSingleNoStep('A');\n}\n\nfunction getInputElementByIdOrThrow(id: string): HTMLInputElement {\n  return getElementByIdOrThrow(id) as HTMLInputElement;\n}\n\nfunction SetupOnHashChange(enigma: Enigma) {\n  function onHashChange() {\n    const state = new URLSearchParams(window.location.hash.substring(1));\n    enigma.loadState(state);\n  }\n  onHashChange();\n  window.addEventListener('hashchange', onHashChange, false);\n}\n\nclass HtmlInterface implements EnigmaOnUpdateCallback {\n  private readonly _enigma: Enigma;\n  private readonly _rotor_order: HTMLInputElement;\n  private readonly _ring_setting: HTMLInputElement;\n  private readonly _indicator: HTMLInputElement;\n  private readonly _plugboard: HTMLInputElement;\n  private readonly _ring_locked: HTMLInputElement;\n\n  constructor(enigma: Enigma) {\n    this._enigma = enigma;\n    this._rotor_order =\n        this.SetupInputHandler('rotor_order',                        //\n                               (v) => enigma.validateRotorOrder(v),  //\n                               (v) => enigma.setRotorOrder(v));\n    this._ring_setting =\n        this.SetupInputHandler('ring_setting',                        //\n                               (v) => enigma.validateRingSetting(v),  //\n                               (v) => enigma.setRingSetting(v));\n    this._indicator =\n        this.SetupInputHandler('indicator',                         //\n                               (v) => enigma.validateIndicator(v),  //\n                               (v) => enigma.setIndicator(v));\n    this._plugboard =\n        this.SetupInputHandler('plugboard',                         //\n                               (v) => enigma.validatePlugboard(v),  //\n                               (v) => enigma.setPlugboard(v));\n    this._ring_locked =\n        this.SetupCheckbox('ring_locked', (v) => enigma.setRingLocked(v));\n    this._enigma.registerOnUpdateCallback(this);\n  }\n\n  private SetupInputHandler(id: string, validate: (value: string) => string,\n                            set: (value: string) => void): HTMLInputElement {\n    const element = getInputElementByIdOrThrow(id);\n    element.oninput = (event) => {\n      if (validate(element.value) === '') {\n        element.classList.remove('bad');\n      } else {\n        element.classList.add('bad');\n      }\n    };\n    element.onchange = (event) => {\n      try {\n        set(element.value);\n        element.classList.remove('bad');\n      } catch (e) {\n        element.classList.add('bad');\n      }\n    };\n    return element;\n  }\n\n\n  private SetupCheckbox(id: string,\n                        set: (value: boolean) => void): HTMLInputElement {\n    const element = getInputElementByIdOrThrow(id);\n    element.onchange = (event) => { set(element.checked); };\n    return element;\n  }\n\n  public onPlugboardChange(permutation: Permutation, setting: string): void {\n    this._plugboard.value = setting;\n  }\n  public onRotorOrderChange(order: string): void {\n    this._rotor_order.value = order;\n  }\n  public onRingSettingChange(value: string): void {\n    this._ring_setting.value = value;\n  }\n  public onIndicatorChange(value: string): void {\n    this._indicator.value = value;\n  }\n  public onRingLocked(value: boolean): void {\n    this._ring_locked.checked = value;\n  }\n  // Things that aren't HTML options:\n  public onReflectorChange(): void {}\n  public onRotorChange(): void {}\n  public onEncrypt(): void {}\n}\n\nmain();\n","// Graphics of the Enigma Machine.\n//\n// TODO: Fix bug where drawing is incorrect when scroll is not at top.\n\n'use strict';\n\nimport SVG = require('svg.js');\nimport {clearClassKey, getElementByIdOrThrow, getSVGGraphicsElementByIdOrThrow, setClassKeyValue} from './dom';\nimport {draggable, DragState} from './drag';\nimport {circularDistance, mod, UnreachableCaseError} from './helpers';\nimport logic = require('./logic');\nimport {addPoints, donut, fromPolar, SvgPathBuilder} from './svg';\n\nconst Alphabet = logic.Alphabet;\n\n// ----------------------------------------------------------------------------\n//                                 Constants\n// ----------------------------------------------------------------------------\n\nconst ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\nconst KEYBOARD_ORDER = 'PQAYWSXEDCRFVTGBZHNUJMIKLO';\n\nconst KEYBOARD_X = 50;\nconst KEYBOARD_Y = 350;\nconst DISPLAY_Y = 125;\n\nconst KEY_RADIUS = 20;\nconst KEY_ROW_SPACING = KEY_RADIUS * 3;\nconst KEY_COL_SPACING = KEY_RADIUS * 1.11;\nconst KEY_FONT_SIZE = 20;\n\nconst ROTOR_CX = 1175;\nconst ROTOR_CY = 450;\nconst REFLECTOR_RADIUS = 50;\nconst REFLECTOR_RING_WIDTH = 15;\nconst REFLECTOR_FONT_SIZE = 11;\nconst ROTOR_WIDTH = 110;\nconst RING_WIDTH = 20;\nconst RING_FONT_SIZE = 15;\nconst WINDOW_THICKNESS = 5;\nconst A_DOT_RADIUS = 5;\n\nconst PLUGBOARD_TOP = 600;\nconst PLUGBOARD_HEIGHT = 150;\nconst PLUGBOARD_LETTER_HEIGHT = 20;\nconst PLUGBOARD_FONT_SIZE = 15;\nconst PLUGBOARD_HANDLE_WIDTH = 10;\nconst PLUGBOARD_HANDLE_HEIGHT = 10;\nconst PLUGBOARD_MAX_DRAG_Y_OFFSET = PLUGBOARD_HEIGHT / 2;\n\nconst ETW_HEIGHT = 140;\nconst ETW_X_OFFSET = 50;\nconst WIRE_TOP = 30;\nconst ROTOR_IN_LENGTH = 10;\n\nconst HIGHLIGHT_STROKE_WIDTH = 5;\n\nconst FONT_VERTICAL_OFFSET = 0.35;\n\nconst ANIMATION_MS = 250;\n\n// ----------------------------------------------------------------------------\n//                          TypeScript declarations\n// ----------------------------------------------------------------------------\n\n// NOTE: dataset is not yet standardized for SVG so it's not in TypeScript.\n// It is however supported in all browsers by IE/Edge.\ndeclare global {\n  interface SVGElement {\n    readonly dataset: DOMStringMap;\n  }\n}\n\n// ----------------------------------------------------------------------------\n//                              Helper Functions\n// ----------------------------------------------------------------------------\n\nconst kAlphabet = new Alphabet(ALPHABET);\nconst kKeyboardOrder = new Alphabet(KEYBOARD_ORDER);\n\nfunction keyX(column: number): number {\n  return KEY_RADIUS + column * KEY_COL_SPACING;\n}\n\nfunction keyY(column: number): number {\n  const row = (column + 2) % 3;\n  return KEY_RADIUS + row * KEY_ROW_SPACING;\n}\n\n// Converts a keyboard x-offset to a numerical letter offset.\nfunction keyXOffsetToLetterOffset(dx: number): number {\n  return Math.round(dx / KEY_COL_SPACING);\n}\n\n// Permutes the integers mod n such that adjacent elements are far apart.\nfunction spread(i: number, n: number): number {\n  // The following multipliers were selected by hand.  n and mult must be\n  // relatively prime, and computing this for an arbitrary n is more work than\n  // I cared to figure out.\n  // https://en.wikipedia.org/wiki/Polygram_(geometry)\n  const table: {[n: number]: number} =\n      {5: 2, 7: 3, 8: 3, 9: 4, 10: 2, 11: 4, 12: 5, 13: 5, 26: 11};\n  const mult = table[n] || 1;\n  return (i * mult) % n;\n}\n\n// ----------------------------------------------------------------------------\n//                             Drawing Functions\n// ----------------------------------------------------------------------------\n\n// We keep all of the drawing functions separate so that we could eventually use\n// a static SVG image if desired.\nfunction drawEverything(svg: HTMLElement, spec: logic.Spec) {\n  const draw = SVG(svg);\n\n  // TODO make 1600x900 parameterized or dynamic or something\n  draw.size(1600, 900).viewbox(0, 0, 1600, 900);\n\n  const keyboardEnclosure =\n      draw.group().id('g-keyboard-enclosure').translate(KEYBOARD_X, DISPLAY_Y);\n  const display = drawKeyboardLike(keyboardEnclosure.group().id('g-display'));\n  const keyboard = drawKeyboardLike(keyboardEnclosure.group()\n                                        .id('g-keyboard')\n                                        .translate(0, KEYBOARD_Y - DISPLAY_Y));\n  const plugboard = drawPlugboard(keyboardEnclosure.group()\n                                      .id('g-plugboard')\n                                      .translate(0, PLUGBOARD_TOP - DISPLAY_Y));\n\n  const rotorEnclosure =\n      draw.group().id('g-rotor-enclosure').translate(ROTOR_CX, ROTOR_CY);\n  drawRotor(rotorEnclosure.group().id('g-rotor-r'),\n            REFLECTOR_RADIUS + 3 * ROTOR_WIDTH, spec);\n  drawRotor(rotorEnclosure.group().id('g-rotor-m'),\n            REFLECTOR_RADIUS + 2 * ROTOR_WIDTH, spec);\n  drawRotor(rotorEnclosure.group().id('g-rotor-l'),\n            REFLECTOR_RADIUS + 1 * ROTOR_WIDTH, spec);\n  drawReflector(rotorEnclosure.group().id('g-reflector'), REFLECTOR_RADIUS,\n                spec);\n  drawRotorFrame(rotorEnclosure.group().id('g-rotor-frame'), REFLECTOR_RADIUS,\n                 ROTOR_WIDTH);\n  drawRotorHotspots(rotorEnclosure.group().id('g-rotor-hotspots'),\n                    REFLECTOR_RADIUS, ROTOR_WIDTH);\n\n  const connectorEnclosure = draw.group().id('g-connectors');\n  drawDisplayKeyboardConnector(\n      connectorEnclosure.group().id('g-display-to-keyboard'), display.rbox(),\n      keyboard.rbox());\n  drawKeyboardPlugboardConnector(\n      connectorEnclosure.group().id('g-keyboard-to-plugboard'), keyboard.rbox(),\n      plugboard.rbox());\n  drawPlugboardRotorConnector(\n      connectorEnclosure.group().id('g-plugboard-to-rotor'), plugboard.rbox(),\n      {cx: ROTOR_CX, cy: ROTOR_CY, r: REFLECTOR_RADIUS + 3 * ROTOR_WIDTH});\n  connectorEnclosure.back();\n}\n\nfunction drawKeyboardLike(container: SVG.Container): SVG.Container {\n  const name = container.id();\n  container.addClass('keyboard-like');\n  kKeyboardOrder.each((letter, column) => {\n    const key = container.group()\n                    .center(keyX(column), keyY(column))\n                    .id(`${name}-key-${letter}`)\n                    .addClass('keyboard-key')\n                    .addClass(`letter-${letter}`);\n    key.circle(2 * KEY_RADIUS).center(0, 0);\n    key.plain(letter);\n  });\n  return container;\n}\n\nfunction drawPlugboard(container: SVG.Container): SVG.Container {\n  const name = container.id();\n  const height = PLUGBOARD_HEIGHT;\n  const width = KEY_RADIUS + kAlphabet.length * KEY_COL_SPACING;\n\n  const topBox = container.group().id(`${name}-top`);\n  const bottomBox = container.group().id(`${name}-bottom`);\n  const wires = container.group().id(`${name}-wires`);\n  kAlphabet.each((letter, column) => {\n    const x = keyX(column);\n    topBox.plain(letter).attr({x: x, y: PLUGBOARD_LETTER_HEIGHT / 2});\n    bottomBox.plain(letter).attr(\n        {x: x, y: height - PLUGBOARD_LETTER_HEIGHT / 2});\n    const wireGroup = wires.group().addClass(`color-${letter}`);\n    wireGroup.path()\n        .id(`${name}-${letter}`)\n        .addClass(`wire-${letter}`)\n        .addClass(`offset-0`)\n        .addClass('wire')\n        // We use a path here so that we can animate it via CSS. We also\n        // translate first so that the path can start at 0,0.\n        .translate(x, PLUGBOARD_LETTER_HEIGHT)\n        .plot(new SvgPathBuilder()\n                  .M(0, 0)\n                  .L(0, height - 2 * PLUGBOARD_LETTER_HEIGHT)\n                  .build());\n    wireGroup.rect(PLUGBOARD_HANDLE_WIDTH, PLUGBOARD_HANDLE_HEIGHT)\n        .id(`${name}-${letter}-drag-cipher`)\n        .attr({\n          x: x - PLUGBOARD_HANDLE_WIDTH / 2,\n          y: height - PLUGBOARD_LETTER_HEIGHT - PLUGBOARD_HANDLE_HEIGHT,\n        })\n        .addClass(`fill-color-${letter}`)\n        .addClass(`plugboard-hotspot`);\n  });\n\n  container.path().addClass('box').plot(\n      new SvgPathBuilder()\n          .M(0, 0)\n          .h(width)\n          .v(height)\n          .h(-width)\n          .z()\n          .m(0, PLUGBOARD_LETTER_HEIGHT)\n          .h(width)\n          .m(0, height - 2 * PLUGBOARD_LETTER_HEIGHT)\n          .h(-width)\n          .build());\n\n  return container;\n}\n\n// Draw the circles and the window, all of which does not rotate.\nfunction drawRotorFrame(container: SVG.Container, reflectorRadius: number,\n                        rotorWidth: number): SVG.Container {\n  const center = {cx: 0, cy: 0};\n  for (let i = 0; i <= 3; i++) {\n    const outer_radius = reflectorRadius + i * rotorWidth;\n    const ring_width = i === 0 ? REFLECTOR_RING_WIDTH : RING_WIDTH;\n    const inner_radius = outer_radius - ring_width;\n    container.circle(outer_radius * 2).attr(center).addClass('ring-line');\n    container.circle(inner_radius * 2).attr(center).addClass('ring-line');\n    if (i >= 1) {\n      const width = ring_width + WINDOW_THICKNESS;\n      container.rect(width, width)\n          .addClass('ring-window')\n          .radius(WINDOW_THICKNESS)\n          .cx(inner_radius + ring_width / 2)\n          .cy(0);\n    }\n  }\n  return container;\n}\n\n// Draw invisible hotspots for dragging the rotors.\nfunction drawRotorHotspots(container: SVG.Container, reflectorRadius: number,\n                           rotorWidth: number): SVG.Container {\n  function draw(idPrefix: string, outer_radius: number) {\n    container.path()\n        .id(`${idPrefix}-ring`)\n        .addClass('rotor-hotspot')\n        .plot(donut(outer_radius, RING_WIDTH));\n    container.path()\n        .id(`${idPrefix}-wires`)\n        .addClass('rotor-hotspot')\n        .plot(donut(outer_radius - RING_WIDTH, rotorWidth - RING_WIDTH));\n  }\n  draw('g-rotor-r-hotspot', reflectorRadius + 3 * rotorWidth);\n  draw('g-rotor-m-hotspot', reflectorRadius + 2 * rotorWidth);\n  draw('g-rotor-l-hotspot', reflectorRadius + 1 * rotorWidth);\n  return container;\n}\n\n// Draw the letters within the ring (but not the circles or the window, since\n// those don't rotate).\nfunction drawRingLetters(container: SVG.Container, outer_radius: number,\n                         ring_width: number): SVG.Container {\n  const name = container.id();\n  const inner_radius = outer_radius - ring_width;\n  kAlphabet.each((letter, i) => {\n    container.plain(letter)\n        .attr({x: inner_radius + ring_width / 2, y: 0})\n        .transform({cx: 0, cy: 0, rotation: i * 360 / kAlphabet.length})\n        .addClass('ring-letter')\n        .id(`${name}-letter-${letter}`);\n  });\n  return container;\n}\n\n// Draw the wires within a rotor.\nfunction drawRotorWires(container: SVG.Container, outer_radius: number,\n                        permutation: logic.Permutation): SVG.Container {\n  container.addClass('rotor-wires-instance');\n  const name = container.id();\n  const N = kAlphabet.length;\n  const r_outer = outer_radius - RING_WIDTH;\n  const r_inner = outer_radius - ROTOR_WIDTH;\n  const kGap = 0.05 * (ROTOR_WIDTH - RING_WIDTH);\n  const kBand = 0.9 * (ROTOR_WIDTH - RING_WIDTH);\n  permutation.eachPair((plain, cipher) => {\n    const i = kAlphabet.indexOf(plain);\n    const j = kAlphabet.indexOf(cipher);\n    const i_angle = 360 * i / N;\n    const j_angle = 360 * j / N;\n    const d = circularDistance(j - i, N);\n    const half_angle = 360 * 0.5 / N * Math.sign(d);\n    const r = r_outer - kGap - spread(i, N) * kBand / N;\n\n    const path = new SvgPathBuilder();\n    path.moveTo(fromPolar({deg: i_angle, r: r_outer}));\n    // Really we should use a cubic curve such that handle1 is orthogonal to\n    // the ring and handle2 is tangent to the ring at the second point.  This\n    // cubic satisfies the first property but is slightly off on the second,\n    // resulting in a very slight kink.\n    path.quadraticCurveTo(fromPolar({deg: i_angle, r: r}),\n                          fromPolar({deg: i_angle + half_angle, r: r}));\n    if (Math.abs(d) > 1) {\n      path.arcTo({r: r, sweep: d > 0},\n                 fromPolar({deg: j_angle - half_angle, r: r}));\n    }\n    path.quadraticCurveTo(fromPolar({deg: j_angle, r: r}),\n                          fromPolar({deg: j_angle, r: r_inner}));\n\n    container.path()\n        .addClass(`wire-${plain}`)\n        .addClass(`color-${plain}`)\n        .addClass('wire')\n        .plot(path.build());\n  });\n  return container;\n}\n\nfunction drawReflectorWires(container: SVG.Container, outer_radius: number,\n                            permutation: logic.Permutation): SVG.Container {\n  container.addClass('rotor-wires-instance');\n  const name = container.id();\n  const N = kAlphabet.length;\n  const radius = outer_radius - REFLECTOR_RING_WIDTH;\n  const handle = 0.6 * radius;\n  let color_index = 0;\n  permutation.eachPair((plain, cipher) => {\n    const i = kAlphabet.indexOf(plain);\n    const j = kAlphabet.indexOf(cipher);\n    if (i <= j) {\n      const color = kAlphabet.fromIndex(color_index);\n      const i_angle = 360 * i / N;\n      const j_angle = 360 * j / N;\n      const path = new SvgPathBuilder();\n      path.moveTo(fromPolar({deg: i_angle, r: radius}));\n      path.cubicCurveTo(fromPolar({deg: i_angle, r: handle}),\n                        fromPolar({deg: j_angle, r: handle}),\n                        fromPolar({deg: j_angle, r: radius}));\n      container.path()\n          .addClass(`wire-${plain}`)\n          .addClass(`wire-${cipher}`)\n          .addClass(`color-${color}`)\n          .addClass('wire')\n          .plot(path.build());\n      color_index += 2;\n    }\n  });\n  return container;\n}\n\nfunction drawRotor(container: SVG.Container, outer_radius: number,\n                   spec: logic.Spec): SVG.Container {\n  const name = container.id();\n  container.addClass('rotor');\n\n  const wires = container.group().id(`${name}-wires`).addClass('rotor-wires');\n  for (const rotor_name of Object.keys(spec.rotors)) {\n    const def = spec.rotors[rotor_name];\n    const perm = new logic.Permutation(def.permutation, kAlphabet);\n    drawRotorWires(wires.group().id(`${name}-wires-${rotor_name}`),\n                   outer_radius, perm);\n  }\n  // Draw a dot to show where the A wire is; used to indicate ring setting.\n  // This rotates with the wires.\n  wires.circle(A_DOT_RADIUS * 2).id(`${name}-dot`).addClass('ring-dot').attr({\n    cx: outer_radius - RING_WIDTH - A_DOT_RADIUS,\n    cy: 0,\n  });\n\n  // Draw the ring in a separate group so that it can be rotated separately when\n  // the ring setting is changed.\n  drawRingLetters(container.group().id(`${name}-ring`), outer_radius,\n                  RING_WIDTH);\n\n  return container;\n}\n\nfunction drawReflector(container: SVG.Container, outer_radius: number,\n                       spec: logic.Spec): SVG.Container {\n  const name = container.id();\n\n  const wires = container.group().id(`${name}-wires`);\n  for (const reflector_name of Object.keys(spec.reflectors)) {\n    const def = spec.reflectors[reflector_name];\n    const perm = new logic.Permutation(def, kAlphabet);\n    drawReflectorWires(wires.group().id(`${name}-wires-${reflector_name}`),\n                       outer_radius, perm);\n  }\n\n  // For consistency with drawRotor, we separate the ring, even though the ring\n  // of the reflector never rotates.\n  drawRingLetters(container.group().id(`${name}-ring`), outer_radius,\n                  REFLECTOR_RING_WIDTH);\n\n  return container;\n}\n\nfunction drawDisplayKeyboardConnector(container: SVG.Container,\n                                      display: SVG.Box,\n                                      keyboard: SVG.Box): SVG.Container {\n  const name = container.id();\n  kKeyboardOrder.each((letter, column) => {\n    const xOffset = keyX(column);\n    const yOffset = keyY(column);\n    container\n        .line(display.x + xOffset, display.y + yOffset,  // (line break)\n              keyboard.x + xOffset, keyboard.y + yOffset)\n        .addClass(`wire-${letter}`)\n        .addClass(`color-${letter}`)\n        .addClass('wire');\n  });\n  return container;\n}\n\nfunction drawKeyboardPlugboardConnector(container: SVG.Container,\n                                        keyboard: SVG.Box,\n                                        plugboard: SVG.Box): SVG.Container {\n  const name = container.id();\n  const yBreak = keyboard.y2;\n  const yDest = plugboard.y;\n  const yOffset = yDest - yBreak;\n  kKeyboardOrder.each((letter, column) => {\n    const xStart = keyboard.x + keyX(column);\n    const xDest = plugboard.x + keyX(kAlphabet.indexOf(letter));\n    const yStart = keyboard.y + keyY(column);\n    container.path()\n        .addClass(`wire-${letter}`)\n        .addClass(`color-${letter}`)\n        .addClass('wire')\n        .plot(new SvgPathBuilder()\n                  .M(xStart, yStart)\n                  .V(yBreak)\n                  .C(xStart, yBreak + yOffset / 3,  // (line break)\n                     xDest, yDest - yOffset / 3,    // (line break)\n                     xDest, yDest)\n                  .build());\n  });\n  return container;\n}\n\nfunction drawPlugboardRotorConnector(\n    container: SVG.Container, plugboard: SVG.Box,\n    rotor: {cx: number, cy: number, r: number}): SVG.Container {\n  const etw_top = {x: plugboard.x2 + ETW_X_OFFSET, y: plugboard.y2};\n  const etw_delta = ETW_HEIGHT / kAlphabet.length;\n  const N = kAlphabet.length;\n  const rotor_center = {x: rotor.cx, y: rotor.cy};\n  const r = rotor.r;\n  kAlphabet.each((letter, i) => {\n    const start = {x: plugboard.x + keyX(i), y: plugboard.y2};\n    const angle = 360 * i / N;\n    const end = addPoints(rotor_center, fromPolar({deg: angle, r: r}));\n    const end_in = addPoints(end, fromPolar({deg: angle, r: ROTOR_IN_LENGTH}));\n    const path = new SvgPathBuilder();\n    path.moveTo(start);\n    path.v(ETW_HEIGHT - i * etw_delta);\n    if (angle > 180) {\n      const offset = (N - 1 - i) * etw_delta;\n      path.H(etw_top.x + offset);\n      path.V(WIRE_TOP + offset);\n    }\n    path.H(end_in.x);\n    path.V(end_in.y);\n    path.lineTo(end);\n    container.path()\n        .addClass(`wire-${letter}`)\n        .addClass(`color-${letter}`)\n        .addClass('wire')\n        .plot(path.build());\n  });\n\n  return container;\n}\n\n// ----------------------------------------------------------------------------\n//                               EnigmaGraphics\n// ----------------------------------------------------------------------------\n\nexport class EnigmaGraphics implements logic.EnigmaOnUpdateCallback {\n  private readonly _svg: HTMLElement;\n  private readonly _spec: logic.Spec;\n  private _ring_locked: boolean;\n\n  constructor(id: string, spec: logic.Spec) {\n    this._svg = getElementByIdOrThrow(id);\n    this._spec = spec;\n    this._ring_locked = true;\n\n    // Draw the SVG.\n    drawEverything(this._svg, spec);\n\n    // Enable the default settings.\n    const rotor_order = spec.defaults.rotor_order.split('-');\n    this.onRotorChange('l', rotor_order[0]);\n    this.onRotorChange('m', rotor_order[1]);\n    this.onRotorChange('r', rotor_order[2]);\n    this.onReflectorChange(spec.defaults.reflector);\n\n    // Turn on animation after all drawing is finished.\n    this._enableAnimation();\n  }\n\n  private _enableAnimation() { this._svg.classList.add('animated'); }\n\n  private _disableAnimation() { this._svg.classList.remove('animated'); }\n\n  // Must be called exactly once!\n  public addEventListeners(enigma: logic.Enigma) {\n    kAlphabet.each((letter) => {\n      this.setupKeyboardClick(enigma, letter);\n      this.setupPlugboardDrag(enigma, letter);\n    });\n\n    this.setupRotorDrag(enigma, 'g-rotor-r', 2);\n    this.setupRotorDrag(enigma, 'g-rotor-m', 1);\n    this.setupRotorDrag(enigma, 'g-rotor-l', 0);\n\n    this.setupWindowKeyboardListener(enigma);\n  }\n\n  private setupKeyboardClick(enigma: logic.Enigma, letter: string) {\n    getElementByIdOrThrow(`g-keyboard-key-${letter}`)\n        .addEventListener('click',\n                          () => { enigma.stepAndEncryptSingle(letter); });\n  }\n\n  private setupPlugboardDrag(enigma: logic.Enigma, plain: string) {\n    const hotspot =\n        getSVGGraphicsElementByIdOrThrow(`g-plugboard-${plain}-drag-cipher`);\n    const plainIndex = kAlphabet.indexOf(plain);\n    const plainX = KEYBOARD_X + keyX(plainIndex);\n    const fakePlugboard = new logic.Plugboard(kAlphabet);\n    let origPlugboardSetting: string;\n    const computePlugboard = (state: DragState) => {\n      const dx = state.mouse.current.x - plainX;\n      const dy = state.mouse.current.y - state.target.start.y;\n      const offset = keyXOffsetToLetterOffset(dx);\n      const cipherIndex = plainIndex + offset;\n      if (Math.abs(dy) > PLUGBOARD_MAX_DRAG_Y_OFFSET || cipherIndex < 0 ||\n          cipherIndex >= kAlphabet.length) {\n        return null;\n      }\n      const cipher = kAlphabet.fromIndex(cipherIndex);\n      const out = new Array<string>();\n      if (plain !== cipher) {\n        out.push(plain + cipher);\n      }\n      for (const pair of origPlugboardSetting.toUpperCase().split(/\\s+/)) {\n        if (pair !== '' && pair.indexOf(plain) < 0 &&\n            pair.indexOf(cipher) < 0) {\n          out.push(pair);\n        }\n      }\n      // Normalize the plugboard setting.\n      for (let i = 0; i < out.length; i++) {\n        out[i] = out[i].split('').sort().join('');\n      }\n      out.sort();\n      return out.join(' ');\n    };\n    draggable({\n      element: hotspot,\n      onStart: () => {\n        // TODO Animate but make it much more responsive. Maybe add a class to\n        // this particular element to speed it up but have the other wires still\n        // go slow?\n        this._disableAnimation();\n        origPlugboardSetting = enigma.getPlugboard();\n      },\n      onMove: (state: DragState) => {\n        let newPlugboardSetting = computePlugboard(state);\n        if (newPlugboardSetting === null) {\n          newPlugboardSetting = origPlugboardSetting;\n        }\n        fakePlugboard.setTo(newPlugboardSetting);\n        this.onPlugboardChange(fakePlugboard.permutation, newPlugboardSetting);\n      },\n      onFinish: (state: DragState) => {\n        const newPlugboardSetting = computePlugboard(state);\n        if (newPlugboardSetting !== null) {\n          enigma.setPlugboard(newPlugboardSetting);\n        } else {\n          this.onPlugboardChange(enigma.getPlugboardPermutation(),\n                                 enigma.getPlugboard());\n        }\n        this._enableAnimation();\n      },\n    });\n  }\n\n  private setupRotorDrag(enigma: logic.Enigma, id: string, rotorIndex: number) {\n    const rotor = getSVGGraphicsElementByIdOrThrow(id);\n    const wires = getSVGGraphicsElementByIdOrThrow(`${id}-wires`);\n    const ring = getSVGGraphicsElementByIdOrThrow(`${id}-ring`);\n    const wireHotspot = getSVGGraphicsElementByIdOrThrow(`${id}-hotspot-wires`);\n    const ringHotspot = getSVGGraphicsElementByIdOrThrow(`${id}-hotspot-ring`);\n    // Explanation:\n    //   'locked' = Whole rotor rotates as a unit, only indicator changes.\n    //   'wires' = Only wires rotate, only ring setting changes.\n    //   'ring' = Only ring rotates, both indicator and ring setting change.\n    //            This is implemented by rotating the rotor and anti-rotating\n    //            the wires.\n    let mode: 'locked'|'wires'|'ring';\n    let rotorStartPosition = 0;\n    let wiresStartPosition = 0;\n    const setupHotspot = (element: SVGGraphicsElement) => {\n      draggable({\n        element: element,\n        onStart: () => {\n          this._disableAnimation();\n          mode = this._ring_locked ? 'locked' :\n                                     element === wireHotspot ? 'wires' : 'ring';\n          rotorStartPosition = this._rotorPosition(rotor);\n          wiresStartPosition = this._rotorPosition(wires);\n        },\n        onMove: (state: DragState) => {\n          const degrees = state.target.start.degreesTo(state.mouse.current) -\n              state.target.start.degreesTo(state.mouse.start);\n          // Negative since positive degrees means clockwise but we need\n          // positive to mean counter-clockwise.\n          const deltaPosition = -degrees / 360 * kAlphabet.length;\n          switch (mode) {\n            case 'locked':\n              this._rotateRotor(rotor, rotorStartPosition + deltaPosition,\n                                'counter-clockwise');\n              break;\n            case 'ring':\n              this._rotateRotor(rotor, rotorStartPosition + deltaPosition,\n                                'counter-clockwise');\n              this._rotateRotor(wires, wiresStartPosition + deltaPosition,\n                                'clockwise');\n              break;\n            case 'wires':\n              this._rotateRotor(wires, wiresStartPosition - deltaPosition,\n                                'clockwise');\n              break;\n            default:\n              throw new UnreachableCaseError(mode);\n          }\n        },\n        onFinish: (state: DragState) => {\n          const degrees = state.target.start.degreesTo(state.mouse.current) -\n              state.target.start.degreesTo(state.mouse.start);\n          function roundToLetter(position: number) {\n            return kAlphabet.fromIndex(\n                mod(Math.round(position), kAlphabet.length));\n          }\n          const deltaPosition = -degrees / 360 * kAlphabet.length;\n          this._enableAnimation();\n          switch (mode) {\n            case 'locked':\n              enigma.setIndicatorAtIndex(\n                  rotorIndex,\n                  roundToLetter(rotorStartPosition + deltaPosition));\n              break;\n            case 'ring':\n              enigma.setIndicatorAtIndex(\n                  rotorIndex,\n                  roundToLetter(rotorStartPosition + deltaPosition));\n              enigma.setRingSettingAtIndex(\n                  rotorIndex,\n                  roundToLetter(wiresStartPosition + deltaPosition));\n              break;\n            case 'wires':\n              enigma.setRingSettingAtIndex(\n                  rotorIndex,\n                  roundToLetter(wiresStartPosition - deltaPosition));\n              break;\n            default:\n              throw new UnreachableCaseError(mode);\n          }\n        },\n      });\n    };\n    setupHotspot(wireHotspot);\n    setupHotspot(ringHotspot);\n  }\n\n  private setupWindowKeyboardListener(enigma: logic.Enigma) {\n    document.addEventListener('keydown', (event) => {\n      // Ignore key presses on input boxes, or if CTRL or ALT is used (e.g.\n      // CTRL-F).\n      if (event.defaultPrevented || !event.target ||\n          (event.target as Element).nodeName === 'INPUT' ||\n          (event.target as Element).nodeName === 'TEXTAREA' ||\n          event.getModifierState('Control') || event.getModifierState('Alt') ||\n          event.getModifierState('Meta')) {\n        return;\n      }\n\n      if (enigma.isValidLetter(event.key)) {\n        enigma.stepAndEncryptSingle(event.key);\n      } else if (event.key === 'Backspace') {\n        // TODO Backup to previous position and key press. Probably need to keep\n        // a stack of previous history, which gets erased whenever the settings\n        // are changed manually.\n      }\n    }, true);\n  }\n\n  // --- EnigmaOnUpdateCallback ---\n\n  public onPlugboardChange(permutation: logic.Permutation, setting: string) {\n    this._clear();\n    // Note: the css 'd' property is Chrome-only as of March 2018. It might be\n    // good to add a non-animated fallback for other browsers.\n    permutation.eachPair((plain, cipher) => {\n      const offset = kAlphabet.indexOf(cipher) - kAlphabet.indexOf(plain);\n      setClassKeyValue(getElementByIdOrThrow(`g-plugboard-${plain}`), 'offset',\n                       '' + offset);\n    });\n  }\n\n  public onReflectorChange(selectedName: string) {\n    this._clear();\n    this._setWires(`g-reflector-wires`, Object.keys(this._spec.reflectors),\n                   selectedName);\n  }\n\n  public onRotorOrderChange(order: string) {}\n\n  public onRotorChange(position: logic.RotorPosition, selectedName: string) {\n    this._clear();\n    this._setWires(`g-rotor-${position}-wires`, Object.keys(this._spec.rotors),\n                   selectedName);\n    this._setNotches(`g-rotor-${position}-ring-letter`,\n                     this._spec.rotors[selectedName].notch);\n  }\n\n  private _setWires(idPrefix: string, allNames: string[],\n                    selectedName: string) {\n    let found = false;\n    for (const name of allNames) {\n      const el = getElementByIdOrThrow(`${idPrefix}-${name}`);\n      if (name === selectedName) {\n        // TODO It would be nice to raise the selected wire to the front. But\n        // sadly SVG does not have a z-index so we'd need to remove the element\n        // and re-add it to the end of its sibling list. And this won't raise it\n        // above any other container, such as the keyboard keys. Given this\n        // challenge, it's probably not worth fixing.\n        el.classList.add('selected');\n        found = true;\n      } else {\n        el.classList.remove('selected');\n      }\n    }\n    if (!found) {\n      console.error(`element ${name} not found in array ${allNames}`);\n    }\n  }\n\n  private _setNotches(idPrefix: string, notch: string) {\n    kAlphabet.each((letter) => {\n      const el = getElementByIdOrThrow(`${idPrefix}-${letter}`);\n      if (notch.indexOf(letter) >= 0) {\n        el.classList.add('notch');\n      } else {\n        el.classList.remove('notch');\n      }\n    });\n  }\n\n  public onRingSettingChange(value: string) {\n    console.assert(value.length === 3, 'expected length 3, got', value);\n    this._clear();\n    this._rotateRotor('g-rotor-l-wires', value[0], 'clockwise');\n    this._rotateRotor('g-rotor-m-wires', value[1], 'clockwise');\n    this._rotateRotor('g-rotor-r-wires', value[2], 'clockwise');\n  }\n\n  public onIndicatorChange(value: string) {\n    console.assert(value.length === 3, 'expected length 3, got', value);\n    this._clear();\n    this._rotateRotor('g-rotor-l', value[0], 'counter-clockwise');\n    this._rotateRotor('g-rotor-m', value[1], 'counter-clockwise');\n    this._rotateRotor('g-rotor-r', value[2], 'counter-clockwise');\n  }\n\n  public onRingLocked(value: boolean): void { this._ring_locked = value; }\n\n  private _rotateRotor(id_or_el: string|SVGElement, position: string|number,\n                       direction: 'clockwise'|'counter-clockwise') {\n    const el = (typeof id_or_el === 'string') ?\n        getSVGGraphicsElementByIdOrThrow(id_or_el) :\n        id_or_el;\n    position = (typeof position === 'string') ? kAlphabet.indexOf(position) :\n                                                mod(position, kAlphabet.length);\n    // If we just set the rotation directly, there would be a jarring jump from\n    // Z->A, spinning all the way backward. So instead we keep track of current\n    // rotation and keep going past 360 degrees as necessary to keep the\n    // animation smooth. We store the position as an index (0..25) as a data\n    // attribute so we can retrieve it next time.\n    const old_position = this._rotorPosition(el);\n    const delta = circularDistance(position - old_position, kAlphabet.length);\n    const new_position = old_position + delta;\n    const tick = (direction === 'clockwise' ? 1 : -1) * 360 / kAlphabet.length;\n    el.dataset.position = '' + new_position;\n    el.style.transform = `rotate(${tick * new_position}deg)`;\n  }\n\n  private _rotorPosition(el: SVGElement): number {\n    return +(el.dataset.position || 0);\n  }\n\n  public onEncrypt(values: logic.LastValueFullEnigma) {\n    function highlight(id: string, letter: string|logic.LastValueBidi,\n                       showOutput?: boolean) {\n      if (typeof letter === 'string') {\n        setClassKeyValue(getElementByIdOrThrow(id), 'selected-letter', letter);\n      } else if (showOutput) {\n        setClassKeyValue(getElementByIdOrThrow(id), 'selected-letter',\n                         [letter.forward.output, letter.inverse.input]);\n      } else {\n        setClassKeyValue(getElementByIdOrThrow(id), 'selected-letter',\n                         [letter.forward.input, letter.inverse.output]);\n      }\n    }\n    highlight('g-display', values.plugboard.inverse.output);\n    highlight('g-display-to-keyboard', values.plugboard.inverse.output);\n    highlight('g-keyboard', values.plugboard.forward.input);\n    highlight('g-keyboard-to-plugboard', values.plugboard);\n    highlight('g-plugboard', values.plugboard);\n    highlight('g-plugboard-to-rotor', values.plugboard, true);\n    highlight('g-rotor-r', values.rotors[2]);\n    highlight('g-rotor-m', values.rotors[1]);\n    highlight('g-rotor-l', values.rotors[0]);\n    highlight('g-reflector', values.reflector.input);\n  }\n\n  private _clear() {\n    function clear(id: string) {\n      clearClassKey(getElementByIdOrThrow(id), 'selected-letter');\n    }\n    clear('g-display');\n    clear('g-display-to-keyboard');\n    clear('g-keyboard');\n    clear('g-keyboard-to-plugboard');\n    clear('g-plugboard');\n    clear('g-plugboard-to-rotor');\n    clear('g-rotor-r');\n    clear('g-rotor-m');\n    clear('g-rotor-l');\n    clear('g-reflector');\n  }\n}\n\n// vim: set sw=2:\n","/*!\n* svg.js - A lightweight library for manipulating and animating SVG.\n* @version 2.7.1\n* https://svgdotjs.github.io/\n*\n* @copyright Wout Fierens <wout@mick-wout.com>\n* @license MIT\n*\n* BUILT: Fri Nov 30 2018 10:01:55 GMT+0100 (GMT+01:00)\n*/;\n(function(root, factory) {\r\n  /* istanbul ignore next */\r\n  if (typeof define === 'function' && define.amd) {\r\n    define(function(){\r\n      return factory(root, root.document)\r\n    })\r\n  } else if (typeof exports === 'object') {\r\n    module.exports = root.document ? factory(root, root.document) : function(w){ return factory(w, w.document) }\r\n  } else {\r\n    root.SVG = factory(root, root.document)\r\n  }\r\n}(typeof window !== \"undefined\" ? window : this, function(window, document) {\r\n\r\n// Find global reference - uses 'this' by default when available,\r\n// falls back to 'window' otherwise (for bundlers like Webpack)\r\nvar globalRef = (typeof this !== \"undefined\") ? this : window;\r\n\r\n// The main wrapping element\r\nvar SVG = globalRef.SVG = function(element) {\r\n  if (SVG.supported) {\r\n    element = new SVG.Doc(element)\r\n\r\n    if(!SVG.parser.draw)\r\n      SVG.prepare()\r\n\r\n    return element\r\n  }\r\n}\r\n\r\n// Default namespaces\r\nSVG.ns    = 'http://www.w3.org/2000/svg'\r\nSVG.xmlns = 'http://www.w3.org/2000/xmlns/'\r\nSVG.xlink = 'http://www.w3.org/1999/xlink'\r\nSVG.svgjs = 'http://svgjs.com/svgjs'\r\n\r\n// Svg support test\r\nSVG.supported = (function() {\r\n  return !! document.createElementNS &&\r\n         !! document.createElementNS(SVG.ns,'svg').createSVGRect\r\n})()\r\n\r\n// Don't bother to continue if SVG is not supported\r\nif (!SVG.supported) return false\r\n\r\n// Element id sequence\r\nSVG.did  = 1000\r\n\r\n// Get next named element id\r\nSVG.eid = function(name) {\r\n  return 'Svgjs' + capitalize(name) + (SVG.did++)\r\n}\r\n\r\n// Method for element creation\r\nSVG.create = function(name) {\r\n  // create element\r\n  var element = document.createElementNS(this.ns, name)\r\n\r\n  // apply unique id\r\n  element.setAttribute('id', this.eid(name))\r\n\r\n  return element\r\n}\r\n\r\n// Method for extending objects\r\nSVG.extend = function() {\r\n  var modules, methods, key, i\r\n\r\n  // Get list of modules\r\n  modules = [].slice.call(arguments)\r\n\r\n  // Get object with extensions\r\n  methods = modules.pop()\r\n\r\n  for (i = modules.length - 1; i >= 0; i--)\r\n    if (modules[i])\r\n      for (key in methods)\r\n        modules[i].prototype[key] = methods[key]\r\n\r\n  // Make sure SVG.Set inherits any newly added methods\r\n  if (SVG.Set && SVG.Set.inherit)\r\n    SVG.Set.inherit()\r\n}\r\n\r\n// Invent new element\r\nSVG.invent = function(config) {\r\n  // Create element initializer\r\n  var initializer = typeof config.create == 'function' ?\r\n    config.create :\r\n    function() {\r\n      this.constructor.call(this, SVG.create(config.create))\r\n    }\r\n\r\n  // Inherit prototype\r\n  if (config.inherit)\r\n    initializer.prototype = new config.inherit\r\n\r\n  // Extend with methods\r\n  if (config.extend)\r\n    SVG.extend(initializer, config.extend)\r\n\r\n  // Attach construct method to parent\r\n  if (config.construct)\r\n    SVG.extend(config.parent || SVG.Container, config.construct)\r\n\r\n  return initializer\r\n}\r\n\r\n// Adopt existing svg elements\r\nSVG.adopt = function(node) {\r\n  // check for presence of node\r\n  if (!node) return null\r\n\r\n  // make sure a node isn't already adopted\r\n  if (node.instance) return node.instance\r\n\r\n  // initialize variables\r\n  var element\r\n\r\n  // adopt with element-specific settings\r\n  if (node.nodeName == 'svg')\r\n    element = node.parentNode instanceof window.SVGElement ? new SVG.Nested : new SVG.Doc\r\n  else if (node.nodeName == 'linearGradient')\r\n    element = new SVG.Gradient('linear')\r\n  else if (node.nodeName == 'radialGradient')\r\n    element = new SVG.Gradient('radial')\r\n  else if (SVG[capitalize(node.nodeName)])\r\n    element = new SVG[capitalize(node.nodeName)]\r\n  else\r\n    element = new SVG.Element(node)\r\n\r\n  // ensure references\r\n  element.type  = node.nodeName\r\n  element.node  = node\r\n  node.instance = element\r\n\r\n  // SVG.Class specific preparations\r\n  if (element instanceof SVG.Doc)\r\n    element.namespace().defs()\r\n\r\n  // pull svgjs data from the dom (getAttributeNS doesn't work in html5)\r\n  element.setData(JSON.parse(node.getAttribute('svgjs:data')) || {})\r\n\r\n  return element\r\n}\r\n\r\n// Initialize parsing element\r\nSVG.prepare = function() {\r\n  // Select document body and create invisible svg element\r\n  var body = document.getElementsByTagName('body')[0]\r\n    , draw = (body ? new SVG.Doc(body) : SVG.adopt(document.documentElement).nested()).size(2, 0)\r\n\r\n  // Create parser object\r\n  SVG.parser = {\r\n    body: body || document.documentElement\r\n  , draw: draw.style('opacity:0;position:absolute;left:-100%;top:-100%;overflow:hidden').attr('focusable', 'false').node\r\n  , poly: draw.polyline().node\r\n  , path: draw.path().node\r\n  , native: SVG.create('svg')\r\n  }\r\n}\r\n\r\nSVG.parser = {\r\n  native: SVG.create('svg')\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n  if(!SVG.parser.draw)\r\n    SVG.prepare()\r\n}, false)\r\n\n// Storage for regular expressions\r\nSVG.regex = {\r\n  // Parse unit value\r\n  numberAndUnit:    /^([+-]?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?)([a-z%]*)$/i\r\n\r\n  // Parse hex value\r\n, hex:              /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i\r\n\r\n  // Parse rgb value\r\n, rgb:              /rgb\\((\\d+),(\\d+),(\\d+)\\)/\r\n\r\n  // Parse reference id\r\n, reference:        /#([a-z0-9\\-_]+)/i\r\n\r\n  // splits a transformation chain\r\n, transforms:       /\\)\\s*,?\\s*/\r\n\r\n  // Whitespace\r\n, whitespace:       /\\s/g\r\n\r\n  // Test hex value\r\n, isHex:            /^#[a-f0-9]{3,6}$/i\r\n\r\n  // Test rgb value\r\n, isRgb:            /^rgb\\(/\r\n\r\n  // Test css declaration\r\n, isCss:            /[^:]+:[^;]+;?/\r\n\r\n  // Test for blank string\r\n, isBlank:          /^(\\s+)?$/\r\n\r\n  // Test for numeric string\r\n, isNumber:         /^[+-]?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?$/i\r\n\r\n  // Test for percent value\r\n, isPercent:        /^-?[\\d\\.]+%$/\r\n\r\n  // Test for image url\r\n, isImage:          /\\.(jpg|jpeg|png|gif|svg)(\\?[^=]+.*)?/i\r\n\r\n  // split at whitespace and comma\r\n, delimiter:        /[\\s,]+/\r\n\r\n  // The following regex are used to parse the d attribute of a path\r\n\r\n  // Matches all hyphens which are not after an exponent\r\n, hyphen:           /([^e])\\-/gi\r\n\r\n  // Replaces and tests for all path letters\r\n, pathLetters:      /[MLHVCSQTAZ]/gi\r\n\r\n  // yes we need this one, too\r\n, isPathLetter:     /[MLHVCSQTAZ]/i\r\n\r\n  // matches 0.154.23.45\r\n, numbersWithDots:  /((\\d?\\.\\d+(?:e[+-]?\\d+)?)((?:\\.\\d+(?:e[+-]?\\d+)?)+))+/gi\r\n\r\n  // matches .\r\n, dots:             /\\./g\r\n}\r\n\nSVG.utils = {\r\n  // Map function\r\n  map: function(array, block) {\r\n    var i\r\n      , il = array.length\r\n      , result = []\r\n\r\n    for (i = 0; i < il; i++)\r\n      result.push(block(array[i]))\r\n\r\n    return result\r\n  }\r\n\r\n  // Filter function\r\n, filter: function(array, block) {\r\n    var i\r\n      , il = array.length\r\n      , result = []\r\n\r\n    for (i = 0; i < il; i++)\r\n      if (block(array[i]))\r\n        result.push(array[i])\r\n\r\n    return result\r\n  }\r\n\r\n  // Degrees to radians\r\n, radians: function(d) {\r\n    return d % 360 * Math.PI / 180\r\n  }\r\n\r\n  // Radians to degrees\r\n, degrees: function(r) {\r\n    return r * 180 / Math.PI % 360\r\n  }\r\n\r\n, filterSVGElements: function(nodes) {\r\n    return this.filter( nodes, function(el) { return el instanceof window.SVGElement })\r\n  }\r\n\r\n}\n\r\nSVG.defaults = {\r\n  // Default attribute values\r\n  attrs: {\r\n    // fill and stroke\r\n    'fill-opacity':     1\r\n  , 'stroke-opacity':   1\r\n  , 'stroke-width':     0\r\n  , 'stroke-linejoin':  'miter'\r\n  , 'stroke-linecap':   'butt'\r\n  , fill:               '#000000'\r\n  , stroke:             '#000000'\r\n  , opacity:            1\r\n    // position\r\n  , x:                  0\r\n  , y:                  0\r\n  , cx:                 0\r\n  , cy:                 0\r\n    // size\r\n  , width:              0\r\n  , height:             0\r\n    // radius\r\n  , r:                  0\r\n  , rx:                 0\r\n  , ry:                 0\r\n    // gradient\r\n  , offset:             0\r\n  , 'stop-opacity':     1\r\n  , 'stop-color':       '#000000'\r\n    // text\r\n  , 'font-size':        16\r\n  , 'font-family':      'Helvetica, Arial, sans-serif'\r\n  , 'text-anchor':      'start'\r\n  }\r\n\r\n}\n// Module for color convertions\r\nSVG.Color = function(color) {\r\n  var match\r\n\r\n  // initialize defaults\r\n  this.r = 0\r\n  this.g = 0\r\n  this.b = 0\r\n\r\n  if(!color) return\r\n\r\n  // parse color\r\n  if (typeof color === 'string') {\r\n    if (SVG.regex.isRgb.test(color)) {\r\n      // get rgb values\r\n      match = SVG.regex.rgb.exec(color.replace(SVG.regex.whitespace,''))\r\n\r\n      // parse numeric values\r\n      this.r = parseInt(match[1])\r\n      this.g = parseInt(match[2])\r\n      this.b = parseInt(match[3])\r\n\r\n    } else if (SVG.regex.isHex.test(color)) {\r\n      // get hex values\r\n      match = SVG.regex.hex.exec(fullHex(color))\r\n\r\n      // parse numeric values\r\n      this.r = parseInt(match[1], 16)\r\n      this.g = parseInt(match[2], 16)\r\n      this.b = parseInt(match[3], 16)\r\n\r\n    }\r\n\r\n  } else if (typeof color === 'object') {\r\n    this.r = color.r\r\n    this.g = color.g\r\n    this.b = color.b\r\n\r\n  }\r\n\r\n}\r\n\r\nSVG.extend(SVG.Color, {\r\n  // Default to hex conversion\r\n  toString: function() {\r\n    return this.toHex()\r\n  }\r\n  // Build hex value\r\n, toHex: function() {\r\n    return '#'\r\n      + compToHex(this.r)\r\n      + compToHex(this.g)\r\n      + compToHex(this.b)\r\n  }\r\n  // Build rgb value\r\n, toRgb: function() {\r\n    return 'rgb(' + [this.r, this.g, this.b].join() + ')'\r\n  }\r\n  // Calculate true brightness\r\n, brightness: function() {\r\n    return (this.r / 255 * 0.30)\r\n         + (this.g / 255 * 0.59)\r\n         + (this.b / 255 * 0.11)\r\n  }\r\n  // Make color morphable\r\n, morph: function(color) {\r\n    this.destination = new SVG.Color(color)\r\n\r\n    return this\r\n  }\r\n  // Get morphed color at given position\r\n, at: function(pos) {\r\n    // make sure a destination is defined\r\n    if (!this.destination) return this\r\n\r\n    // normalise pos\r\n    pos = pos < 0 ? 0 : pos > 1 ? 1 : pos\r\n\r\n    // generate morphed color\r\n    return new SVG.Color({\r\n      r: ~~(this.r + (this.destination.r - this.r) * pos)\r\n    , g: ~~(this.g + (this.destination.g - this.g) * pos)\r\n    , b: ~~(this.b + (this.destination.b - this.b) * pos)\r\n    })\r\n  }\r\n\r\n})\r\n\r\n// Testers\r\n\r\n// Test if given value is a color string\r\nSVG.Color.test = function(color) {\r\n  color += ''\r\n  return SVG.regex.isHex.test(color)\r\n      || SVG.regex.isRgb.test(color)\r\n}\r\n\r\n// Test if given value is a rgb object\r\nSVG.Color.isRgb = function(color) {\r\n  return color && typeof color.r == 'number'\r\n               && typeof color.g == 'number'\r\n               && typeof color.b == 'number'\r\n}\r\n\r\n// Test if given value is a color\r\nSVG.Color.isColor = function(color) {\r\n  return SVG.Color.isRgb(color) || SVG.Color.test(color)\r\n}\n// Module for array conversion\r\nSVG.Array = function(array, fallback) {\r\n  array = (array || []).valueOf()\r\n\r\n  // if array is empty and fallback is provided, use fallback\r\n  if (array.length == 0 && fallback)\r\n    array = fallback.valueOf()\r\n\r\n  // parse array\r\n  this.value = this.parse(array)\r\n}\r\n\r\nSVG.extend(SVG.Array, {\r\n  // Make array morphable\r\n  morph: function(array) {\r\n    this.destination = this.parse(array)\r\n\r\n    // normalize length of arrays\r\n    if (this.value.length != this.destination.length) {\r\n      var lastValue       = this.value[this.value.length - 1]\r\n        , lastDestination = this.destination[this.destination.length - 1]\r\n\r\n      while(this.value.length > this.destination.length)\r\n        this.destination.push(lastDestination)\r\n      while(this.value.length < this.destination.length)\r\n        this.value.push(lastValue)\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Clean up any duplicate points\r\n, settle: function() {\r\n    // find all unique values\r\n    for (var i = 0, il = this.value.length, seen = []; i < il; i++)\r\n      if (seen.indexOf(this.value[i]) == -1)\r\n        seen.push(this.value[i])\r\n\r\n    // set new value\r\n    return this.value = seen\r\n  }\r\n  // Get morphed array at given position\r\n, at: function(pos) {\r\n    // make sure a destination is defined\r\n    if (!this.destination) return this\r\n\r\n    // generate morphed array\r\n    for (var i = 0, il = this.value.length, array = []; i < il; i++)\r\n      array.push(this.value[i] + (this.destination[i] - this.value[i]) * pos)\r\n\r\n    return new SVG.Array(array)\r\n  }\r\n  // Convert array to string\r\n, toString: function() {\r\n    return this.value.join(' ')\r\n  }\r\n  // Real value\r\n, valueOf: function() {\r\n    return this.value\r\n  }\r\n  // Parse whitespace separated string\r\n, parse: function(array) {\r\n    array = array.valueOf()\r\n\r\n    // if already is an array, no need to parse it\r\n    if (Array.isArray(array)) return array\r\n\r\n    return this.split(array)\r\n  }\r\n  // Strip unnecessary whitespace\r\n, split: function(string) {\r\n    return string.trim().split(SVG.regex.delimiter).map(parseFloat)\r\n  }\r\n  // Reverse array\r\n, reverse: function() {\r\n    this.value.reverse()\r\n\r\n    return this\r\n  }\r\n, clone: function() {\r\n    var clone = new this.constructor()\r\n    clone.value = array_clone(this.value)\r\n    return clone\r\n  }\r\n})\n// Poly points array\r\nSVG.PointArray = function(array, fallback) {\r\n  SVG.Array.call(this, array, fallback || [[0,0]])\r\n}\r\n\r\n// Inherit from SVG.Array\r\nSVG.PointArray.prototype = new SVG.Array\r\nSVG.PointArray.prototype.constructor = SVG.PointArray\r\n\r\nSVG.extend(SVG.PointArray, {\r\n  // Convert array to string\r\n  toString: function() {\r\n    // convert to a poly point string\r\n    for (var i = 0, il = this.value.length, array = []; i < il; i++)\r\n      array.push(this.value[i].join(','))\r\n\r\n    return array.join(' ')\r\n  }\r\n  // Convert array to line object\r\n, toLine: function() {\r\n    return {\r\n      x1: this.value[0][0]\r\n    , y1: this.value[0][1]\r\n    , x2: this.value[1][0]\r\n    , y2: this.value[1][1]\r\n    }\r\n  }\r\n  // Get morphed array at given position\r\n, at: function(pos) {\r\n    // make sure a destination is defined\r\n    if (!this.destination) return this\r\n\r\n    // generate morphed point string\r\n    for (var i = 0, il = this.value.length, array = []; i < il; i++)\r\n      array.push([\r\n        this.value[i][0] + (this.destination[i][0] - this.value[i][0]) * pos\r\n      , this.value[i][1] + (this.destination[i][1] - this.value[i][1]) * pos\r\n      ])\r\n\r\n    return new SVG.PointArray(array)\r\n  }\r\n  // Parse point string and flat array\r\n, parse: function(array) {\r\n    var points = []\r\n\r\n    array = array.valueOf()\r\n\r\n    // if it is an array\r\n    if (Array.isArray(array)) {\r\n      // and it is not flat, there is no need to parse it\r\n      if(Array.isArray(array[0])) {\r\n        // make sure to use a clone\r\n        return array.map(function (el) { return el.slice() })\r\n      } else if (array[0].x != null){\r\n        // allow point objects to be passed\r\n        return array.map(function (el) { return [el.x, el.y] })\r\n      }\r\n    } else { // Else, it is considered as a string\r\n      // parse points\r\n      array = array.trim().split(SVG.regex.delimiter).map(parseFloat)\r\n    }\r\n\r\n    // validate points - https://svgwg.org/svg2-draft/shapes.html#DataTypePoints\r\n    // Odd number of coordinates is an error. In such cases, drop the last odd coordinate.\r\n    if (array.length % 2 !== 0) array.pop()\r\n\r\n    // wrap points in two-tuples and parse points as floats\r\n    for(var i = 0, len = array.length; i < len; i = i + 2)\r\n      points.push([ array[i], array[i+1] ])\r\n\r\n    return points\r\n  }\r\n  // Move point string\r\n, move: function(x, y) {\r\n    var box = this.bbox()\r\n\r\n    // get relative offset\r\n    x -= box.x\r\n    y -= box.y\r\n\r\n    // move every point\r\n    if (!isNaN(x) && !isNaN(y))\r\n      for (var i = this.value.length - 1; i >= 0; i--)\r\n        this.value[i] = [this.value[i][0] + x, this.value[i][1] + y]\r\n\r\n    return this\r\n  }\r\n  // Resize poly string\r\n, size: function(width, height) {\r\n    var i, box = this.bbox()\r\n\r\n    // recalculate position of all points according to new size\r\n    for (i = this.value.length - 1; i >= 0; i--) {\r\n      if(box.width) this.value[i][0] = ((this.value[i][0] - box.x) * width)  / box.width  + box.x\r\n      if(box.height) this.value[i][1] = ((this.value[i][1] - box.y) * height) / box.height + box.y\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Get bounding box of points\r\n, bbox: function() {\r\n    SVG.parser.poly.setAttribute('points', this.toString())\r\n\r\n    return SVG.parser.poly.getBBox()\r\n  }\r\n})\r\n\nvar pathHandlers = {\r\n  M: function(c, p, p0) {\r\n    p.x = p0.x = c[0]\r\n    p.y = p0.y = c[1]\r\n\r\n    return ['M', p.x, p.y]\r\n  },\r\n  L: function(c, p) {\r\n    p.x = c[0]\r\n    p.y = c[1]\r\n    return ['L', c[0], c[1]]\r\n  },\r\n  H: function(c, p) {\r\n    p.x = c[0]\r\n    return ['H', c[0]]\r\n  },\r\n  V: function(c, p) {\r\n    p.y = c[0]\r\n    return ['V', c[0]]\r\n  },\r\n  C: function(c, p) {\r\n    p.x = c[4]\r\n    p.y = c[5]\r\n    return ['C', c[0], c[1], c[2], c[3], c[4], c[5]]\r\n  },\r\n  S: function(c, p) {\r\n    p.x = c[2]\r\n    p.y = c[3]\r\n    return ['S', c[0], c[1], c[2], c[3]]\r\n  },\r\n  Q: function(c, p) {\r\n    p.x = c[2]\r\n    p.y = c[3]\r\n    return ['Q', c[0], c[1], c[2], c[3]]\r\n  },\r\n  T: function(c, p) {\r\n    p.x = c[0]\r\n    p.y = c[1]\r\n    return ['T', c[0], c[1]]\r\n  },\r\n  Z: function(c, p, p0) {\r\n    p.x = p0.x\r\n    p.y = p0.y\r\n    return ['Z']\r\n  },\r\n  A: function(c, p) {\r\n    p.x = c[5]\r\n    p.y = c[6]\r\n    return ['A', c[0], c[1], c[2], c[3], c[4], c[5], c[6]]\r\n  }\r\n}\r\n\r\nvar mlhvqtcsa = 'mlhvqtcsaz'.split('')\r\n\r\nfor(var i = 0, il = mlhvqtcsa.length; i < il; ++i){\r\n  pathHandlers[mlhvqtcsa[i]] = (function(i){\r\n    return function(c, p, p0) {\r\n      if(i == 'H') c[0] = c[0] + p.x\r\n      else if(i == 'V') c[0] = c[0] + p.y\r\n      else if(i == 'A'){\r\n        c[5] = c[5] + p.x,\r\n        c[6] = c[6] + p.y\r\n      }\r\n      else\r\n        for(var j = 0, jl = c.length; j < jl; ++j) {\r\n          c[j] = c[j] + (j%2 ? p.y : p.x)\r\n        }\r\n\r\n      return pathHandlers[i](c, p, p0)\r\n    }\r\n  })(mlhvqtcsa[i].toUpperCase())\r\n}\r\n\r\n// Path points array\r\nSVG.PathArray = function(array, fallback) {\r\n  SVG.Array.call(this, array, fallback || [['M', 0, 0]])\r\n}\r\n\r\n// Inherit from SVG.Array\r\nSVG.PathArray.prototype = new SVG.Array\r\nSVG.PathArray.prototype.constructor = SVG.PathArray\r\n\r\nSVG.extend(SVG.PathArray, {\r\n  // Convert array to string\r\n  toString: function() {\r\n    return arrayToString(this.value)\r\n  }\r\n  // Move path string\r\n, move: function(x, y) {\r\n    // get bounding box of current situation\r\n    var box = this.bbox()\r\n\r\n    // get relative offset\r\n    x -= box.x\r\n    y -= box.y\r\n\r\n    if (!isNaN(x) && !isNaN(y)) {\r\n      // move every point\r\n      for (var l, i = this.value.length - 1; i >= 0; i--) {\r\n        l = this.value[i][0]\r\n\r\n        if (l == 'M' || l == 'L' || l == 'T')  {\r\n          this.value[i][1] += x\r\n          this.value[i][2] += y\r\n\r\n        } else if (l == 'H')  {\r\n          this.value[i][1] += x\r\n\r\n        } else if (l == 'V')  {\r\n          this.value[i][1] += y\r\n\r\n        } else if (l == 'C' || l == 'S' || l == 'Q')  {\r\n          this.value[i][1] += x\r\n          this.value[i][2] += y\r\n          this.value[i][3] += x\r\n          this.value[i][4] += y\r\n\r\n          if (l == 'C')  {\r\n            this.value[i][5] += x\r\n            this.value[i][6] += y\r\n          }\r\n\r\n        } else if (l == 'A')  {\r\n          this.value[i][6] += x\r\n          this.value[i][7] += y\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Resize path string\r\n, size: function(width, height) {\r\n    // get bounding box of current situation\r\n    var i, l, box = this.bbox()\r\n\r\n    // recalculate position of all points according to new size\r\n    for (i = this.value.length - 1; i >= 0; i--) {\r\n      l = this.value[i][0]\r\n\r\n      if (l == 'M' || l == 'L' || l == 'T')  {\r\n        this.value[i][1] = ((this.value[i][1] - box.x) * width)  / box.width  + box.x\r\n        this.value[i][2] = ((this.value[i][2] - box.y) * height) / box.height + box.y\r\n\r\n      } else if (l == 'H')  {\r\n        this.value[i][1] = ((this.value[i][1] - box.x) * width)  / box.width  + box.x\r\n\r\n      } else if (l == 'V')  {\r\n        this.value[i][1] = ((this.value[i][1] - box.y) * height) / box.height + box.y\r\n\r\n      } else if (l == 'C' || l == 'S' || l == 'Q')  {\r\n        this.value[i][1] = ((this.value[i][1] - box.x) * width)  / box.width  + box.x\r\n        this.value[i][2] = ((this.value[i][2] - box.y) * height) / box.height + box.y\r\n        this.value[i][3] = ((this.value[i][3] - box.x) * width)  / box.width  + box.x\r\n        this.value[i][4] = ((this.value[i][4] - box.y) * height) / box.height + box.y\r\n\r\n        if (l == 'C')  {\r\n          this.value[i][5] = ((this.value[i][5] - box.x) * width)  / box.width  + box.x\r\n          this.value[i][6] = ((this.value[i][6] - box.y) * height) / box.height + box.y\r\n        }\r\n\r\n      } else if (l == 'A')  {\r\n        // resize radii\r\n        this.value[i][1] = (this.value[i][1] * width)  / box.width\r\n        this.value[i][2] = (this.value[i][2] * height) / box.height\r\n\r\n        // move position values\r\n        this.value[i][6] = ((this.value[i][6] - box.x) * width)  / box.width  + box.x\r\n        this.value[i][7] = ((this.value[i][7] - box.y) * height) / box.height + box.y\r\n      }\r\n\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Test if the passed path array use the same path data commands as this path array\r\n, equalCommands: function(pathArray) {\r\n    var i, il, equalCommands\r\n\r\n    pathArray = new SVG.PathArray(pathArray)\r\n\r\n    equalCommands = this.value.length === pathArray.value.length\r\n    for(i = 0, il = this.value.length; equalCommands && i < il; i++) {\r\n      equalCommands = this.value[i][0] === pathArray.value[i][0]\r\n    }\r\n\r\n    return equalCommands\r\n  }\r\n  // Make path array morphable\r\n, morph: function(pathArray) {\r\n    pathArray = new SVG.PathArray(pathArray)\r\n\r\n    if(this.equalCommands(pathArray)) {\r\n      this.destination = pathArray\r\n    } else {\r\n      this.destination = null\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Get morphed path array at given position\r\n, at: function(pos) {\r\n    // make sure a destination is defined\r\n    if (!this.destination) return this\r\n\r\n    var sourceArray = this.value\r\n      , destinationArray = this.destination.value\r\n      , array = [], pathArray = new SVG.PathArray()\r\n      , i, il, j, jl\r\n\r\n    // Animate has specified in the SVG spec\r\n    // See: https://www.w3.org/TR/SVG11/paths.html#PathElement\r\n    for (i = 0, il = sourceArray.length; i < il; i++) {\r\n      array[i] = [sourceArray[i][0]]\r\n      for(j = 1, jl = sourceArray[i].length; j < jl; j++) {\r\n        array[i][j] = sourceArray[i][j] + (destinationArray[i][j] - sourceArray[i][j]) * pos\r\n      }\r\n      // For the two flags of the elliptical arc command, the SVG spec say:\r\n      // Flags and booleans are interpolated as fractions between zero and one, with any non-zero value considered to be a value of one/true\r\n      // Elliptical arc command as an array followed by corresponding indexes:\r\n      // ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\r\n      //   0    1   2        3                 4             5      6  7\r\n      if(array[i][0] === 'A') {\r\n        array[i][4] = +(array[i][4] != 0)\r\n        array[i][5] = +(array[i][5] != 0)\r\n      }\r\n    }\r\n\r\n    // Directly modify the value of a path array, this is done this way for performance\r\n    pathArray.value = array\r\n    return pathArray\r\n  }\r\n  // Absolutize and parse path to array\r\n, parse: function(array) {\r\n    // if it's already a patharray, no need to parse it\r\n    if (array instanceof SVG.PathArray) return array.valueOf()\r\n\r\n    // prepare for parsing\r\n    var i, x0, y0, s, seg, arr\r\n      , x = 0\r\n      , y = 0\r\n      , paramCnt = { 'M':2, 'L':2, 'H':1, 'V':1, 'C':6, 'S':4, 'Q':4, 'T':2, 'A':7, 'Z':0 }\r\n\r\n    if(typeof array == 'string'){\r\n\r\n      array = array\r\n        .replace(SVG.regex.numbersWithDots, pathRegReplace) // convert 45.123.123 to 45.123 .123\r\n        .replace(SVG.regex.pathLetters, ' $& ') // put some room between letters and numbers\r\n        .replace(SVG.regex.hyphen, '$1 -')      // add space before hyphen\r\n        .trim()                                 // trim\r\n        .split(SVG.regex.delimiter)   // split into array\r\n\r\n    }else{\r\n      array = array.reduce(function(prev, curr){\r\n        return [].concat.call(prev, curr)\r\n      }, [])\r\n    }\r\n\r\n    // array now is an array containing all parts of a path e.g. ['M', '0', '0', 'L', '30', '30' ...]\r\n    var arr = []\r\n      , p = new SVG.Point()\r\n      , p0 = new SVG.Point()\r\n      , index = 0\r\n      , len = array.length\r\n\r\n    do{\r\n      // Test if we have a path letter\r\n      if(SVG.regex.isPathLetter.test(array[index])){\r\n        s = array[index]\r\n        ++index\r\n      // If last letter was a move command and we got no new, it defaults to [L]ine\r\n      }else if(s == 'M'){\r\n        s = 'L'\r\n      }else if(s == 'm'){\r\n        s = 'l'\r\n      }\r\n\r\n      arr.push(pathHandlers[s].call(null,\r\n          array.slice(index, (index = index + paramCnt[s.toUpperCase()])).map(parseFloat),\r\n          p, p0\r\n        )\r\n      )\r\n\r\n    }while(len > index)\r\n\r\n    return arr\r\n\r\n  }\r\n  // Get bounding box of path\r\n, bbox: function() {\r\n    SVG.parser.path.setAttribute('d', this.toString())\r\n\r\n    return SVG.parser.path.getBBox()\r\n  }\r\n\r\n})\r\n\n// Module for unit convertions\r\nSVG.Number = SVG.invent({\r\n  // Initialize\r\n  create: function(value, unit) {\r\n    // initialize defaults\r\n    this.value = 0\r\n    this.unit  = unit || ''\r\n\r\n    // parse value\r\n    if (typeof value === 'number') {\r\n      // ensure a valid numeric value\r\n      this.value = isNaN(value) ? 0 : !isFinite(value) ? (value < 0 ? -3.4e+38 : +3.4e+38) : value\r\n\r\n    } else if (typeof value === 'string') {\r\n      unit = value.match(SVG.regex.numberAndUnit)\r\n\r\n      if (unit) {\r\n        // make value numeric\r\n        this.value = parseFloat(unit[1])\r\n\r\n        // normalize\r\n        if (unit[5] == '%')\r\n          this.value /= 100\r\n        else if (unit[5] == 's')\r\n          this.value *= 1000\r\n\r\n        // store unit\r\n        this.unit = unit[5]\r\n      }\r\n\r\n    } else {\r\n      if (value instanceof SVG.Number) {\r\n        this.value = value.valueOf()\r\n        this.unit  = value.unit\r\n      }\r\n    }\r\n\r\n  }\r\n  // Add methods\r\n, extend: {\r\n    // Stringalize\r\n    toString: function() {\r\n      return (\r\n        this.unit == '%' ?\r\n          ~~(this.value * 1e8) / 1e6:\r\n        this.unit == 's' ?\r\n          this.value / 1e3 :\r\n          this.value\r\n      ) + this.unit\r\n    }\r\n  , toJSON: function() {\r\n      return this.toString()\r\n    }\r\n  , // Convert to primitive\r\n    valueOf: function() {\r\n      return this.value\r\n    }\r\n    // Add number\r\n  , plus: function(number) {\r\n      number = new SVG.Number(number)\r\n      return new SVG.Number(this + number, this.unit || number.unit)\r\n    }\r\n    // Subtract number\r\n  , minus: function(number) {\r\n      number = new SVG.Number(number)\r\n      return new SVG.Number(this - number, this.unit || number.unit)\r\n    }\r\n    // Multiply number\r\n  , times: function(number) {\r\n      number = new SVG.Number(number)\r\n      return new SVG.Number(this * number, this.unit || number.unit)\r\n    }\r\n    // Divide number\r\n  , divide: function(number) {\r\n      number = new SVG.Number(number)\r\n      return new SVG.Number(this / number, this.unit || number.unit)\r\n    }\r\n    // Convert to different unit\r\n  , to: function(unit) {\r\n      var number = new SVG.Number(this)\r\n\r\n      if (typeof unit === 'string')\r\n        number.unit = unit\r\n\r\n      return number\r\n    }\r\n    // Make number morphable\r\n  , morph: function(number) {\r\n      this.destination = new SVG.Number(number)\r\n\r\n      if(number.relative) {\r\n        this.destination.value += this.value\r\n      }\r\n\r\n      return this\r\n    }\r\n    // Get morphed number at given position\r\n  , at: function(pos) {\r\n      // Make sure a destination is defined\r\n      if (!this.destination) return this\r\n\r\n      // Generate new morphed number\r\n      return new SVG.Number(this.destination)\r\n          .minus(this)\r\n          .times(pos)\r\n          .plus(this)\r\n    }\r\n\r\n  }\r\n})\r\n\n\r\nSVG.Element = SVG.invent({\r\n  // Initialize node\r\n  create: function(node) {\r\n    // make stroke value accessible dynamically\r\n    this._stroke = SVG.defaults.attrs.stroke\r\n    this._event = null\r\n    this._events = {}\r\n\r\n    // initialize data object\r\n    this.dom = {}\r\n\r\n    // create circular reference\r\n    if (this.node = node) {\r\n      this.type = node.nodeName\r\n      this.node.instance = this\r\n      this._events = node._events || {}\r\n\r\n      // store current attribute value\r\n      this._stroke = node.getAttribute('stroke') || this._stroke\r\n    }\r\n  }\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Move over x-axis\r\n    x: function(x) {\r\n      return this.attr('x', x)\r\n    }\r\n    // Move over y-axis\r\n  , y: function(y) {\r\n      return this.attr('y', y)\r\n    }\r\n    // Move by center over x-axis\r\n  , cx: function(x) {\r\n      return x == null ? this.x() + this.width() / 2 : this.x(x - this.width() / 2)\r\n    }\r\n    // Move by center over y-axis\r\n  , cy: function(y) {\r\n      return y == null ? this.y() + this.height() / 2 : this.y(y - this.height() / 2)\r\n    }\r\n    // Move element to given x and y values\r\n  , move: function(x, y) {\r\n      return this.x(x).y(y)\r\n    }\r\n    // Move element by its center\r\n  , center: function(x, y) {\r\n      return this.cx(x).cy(y)\r\n    }\r\n    // Set width of element\r\n  , width: function(width) {\r\n      return this.attr('width', width)\r\n    }\r\n    // Set height of element\r\n  , height: function(height) {\r\n      return this.attr('height', height)\r\n    }\r\n    // Set element size to given width and height\r\n  , size: function(width, height) {\r\n      var p = proportionalSize(this, width, height)\r\n\r\n      return this\r\n        .width(new SVG.Number(p.width))\r\n        .height(new SVG.Number(p.height))\r\n    }\r\n    // Clone element\r\n  , clone: function(parent) {\r\n      // write dom data to the dom so the clone can pickup the data\r\n      this.writeDataToDom()\r\n\r\n      // clone element and assign new id\r\n      var clone = assignNewId(this.node.cloneNode(true))\r\n\r\n      // insert the clone in the given parent or after myself\r\n      if(parent) parent.add(clone)\r\n      else this.after(clone)\r\n\r\n      return clone\r\n    }\r\n    // Remove element\r\n  , remove: function() {\r\n      if (this.parent())\r\n        this.parent().removeElement(this)\r\n\r\n      return this\r\n    }\r\n    // Replace element\r\n  , replace: function(element) {\r\n      this.after(element).remove()\r\n\r\n      return element\r\n    }\r\n    // Add element to given container and return self\r\n  , addTo: function(parent) {\r\n      return parent.put(this)\r\n    }\r\n    // Add element to given container and return container\r\n  , putIn: function(parent) {\r\n      return parent.add(this)\r\n    }\r\n    // Get / set id\r\n  , id: function(id) {\r\n      return this.attr('id', id)\r\n    }\r\n    // Checks whether the given point inside the bounding box of the element\r\n  , inside: function(x, y) {\r\n      var box = this.bbox()\r\n\r\n      return x > box.x\r\n          && y > box.y\r\n          && x < box.x + box.width\r\n          && y < box.y + box.height\r\n    }\r\n    // Show element\r\n  , show: function() {\r\n      return this.style('display', '')\r\n    }\r\n    // Hide element\r\n  , hide: function() {\r\n      return this.style('display', 'none')\r\n    }\r\n    // Is element visible?\r\n  , visible: function() {\r\n      return this.style('display') != 'none'\r\n    }\r\n    // Return id on string conversion\r\n  , toString: function() {\r\n      return this.attr('id')\r\n    }\r\n    // Return array of classes on the node\r\n  , classes: function() {\r\n      var attr = this.attr('class')\r\n\r\n      return attr == null ? [] : attr.trim().split(SVG.regex.delimiter)\r\n    }\r\n    // Return true if class exists on the node, false otherwise\r\n  , hasClass: function(name) {\r\n      return this.classes().indexOf(name) != -1\r\n    }\r\n    // Add class to the node\r\n  , addClass: function(name) {\r\n      if (!this.hasClass(name)) {\r\n        var array = this.classes()\r\n        array.push(name)\r\n        this.attr('class', array.join(' '))\r\n      }\r\n\r\n      return this\r\n    }\r\n    // Remove class from the node\r\n  , removeClass: function(name) {\r\n      if (this.hasClass(name)) {\r\n        this.attr('class', this.classes().filter(function(c) {\r\n          return c != name\r\n        }).join(' '))\r\n      }\r\n\r\n      return this\r\n    }\r\n    // Toggle the presence of a class on the node\r\n  , toggleClass: function(name) {\r\n      return this.hasClass(name) ? this.removeClass(name) : this.addClass(name)\r\n    }\r\n    // Get referenced element form attribute value\r\n  , reference: function(attr) {\r\n      return SVG.get(this.attr(attr))\r\n    }\r\n    // Returns the parent element instance\r\n  , parent: function(type) {\r\n      var parent = this\r\n\r\n      // check for parent\r\n      if(!parent.node.parentNode) return null\r\n\r\n      // get parent element\r\n      parent = SVG.adopt(parent.node.parentNode)\r\n\r\n      if(!type) return parent\r\n\r\n      // loop trough ancestors if type is given\r\n      while(parent && parent.node instanceof window.SVGElement){\r\n        if(typeof type === 'string' ? parent.matches(type) : parent instanceof type) return parent\r\n        if(!parent.node.parentNode || parent.node.parentNode.nodeName == '#document' || parent.node.parentNode.nodeName == '#document-fragment') return null // #759, #720\r\n        parent = SVG.adopt(parent.node.parentNode)\r\n      }\r\n    }\r\n    // Get parent document\r\n  , doc: function() {\r\n      return this instanceof SVG.Doc ? this : this.parent(SVG.Doc)\r\n    }\r\n    // return array of all ancestors of given type up to the root svg\r\n  , parents: function(type) {\r\n      var parents = [], parent = this\r\n\r\n      do{\r\n        parent = parent.parent(type)\r\n        if(!parent || !parent.node) break\r\n\r\n        parents.push(parent)\r\n      } while(parent.parent)\r\n\r\n      return parents\r\n    }\r\n    // matches the element vs a css selector\r\n  , matches: function(selector){\r\n      return matches(this.node, selector)\r\n    }\r\n    // Returns the svg node to call native svg methods on it\r\n  , native: function() {\r\n      return this.node\r\n    }\r\n    // Import raw svg\r\n  , svg: function(svg) {\r\n      // create temporary holder\r\n      var well = document.createElement('svg')\r\n\r\n      // act as a setter if svg is given\r\n      if (svg && this instanceof SVG.Parent) {\r\n        // dump raw svg\r\n        well.innerHTML = '<svg>' + svg.replace(/\\n/, '').replace(/<([\\w:-]+)([^<]+?)\\/>/g, '<$1$2></$1>') + '</svg>'\r\n\r\n        // transplant nodes\r\n        for (var i = 0, il = well.firstChild.childNodes.length; i < il; i++)\r\n          this.node.appendChild(well.firstChild.firstChild)\r\n\r\n      // otherwise act as a getter\r\n      } else {\r\n        // create a wrapping svg element in case of partial content\r\n        well.appendChild(svg = document.createElement('svg'))\r\n\r\n        // write svgjs data to the dom\r\n        this.writeDataToDom()\r\n\r\n        // insert a copy of this node\r\n        svg.appendChild(this.node.cloneNode(true))\r\n\r\n        // return target element\r\n        return well.innerHTML.replace(/^<svg>/, '').replace(/<\\/svg>$/, '')\r\n      }\r\n\r\n      return this\r\n    }\r\n  // write svgjs data to the dom\r\n  , writeDataToDom: function() {\r\n\r\n      // dump variables recursively\r\n      if(this.each || this.lines){\r\n        var fn = this.each ? this : this.lines();\r\n        fn.each(function(){\r\n          this.writeDataToDom()\r\n        })\r\n      }\r\n\r\n      // remove previously set data\r\n      this.node.removeAttribute('svgjs:data')\r\n\r\n      if(Object.keys(this.dom).length)\r\n        this.node.setAttribute('svgjs:data', JSON.stringify(this.dom)) // see #428\r\n\r\n      return this\r\n    }\r\n  // set given data to the elements data property\r\n  , setData: function(o){\r\n      this.dom = o\r\n      return this\r\n    }\r\n  , is: function(obj){\r\n      return is(this, obj)\r\n    }\r\n  }\r\n})\r\n\nSVG.easing = {\r\n  '-': function(pos){return pos}\r\n, '<>':function(pos){return -Math.cos(pos * Math.PI) / 2 + 0.5}\r\n, '>': function(pos){return  Math.sin(pos * Math.PI / 2)}\r\n, '<': function(pos){return -Math.cos(pos * Math.PI / 2) + 1}\r\n}\r\n\r\nSVG.morph = function(pos){\r\n  return function(from, to) {\r\n    return new SVG.MorphObj(from, to).at(pos)\r\n  }\r\n}\r\n\r\nSVG.Situation = SVG.invent({\r\n\r\n  create: function(o){\r\n    this.init = false\r\n    this.reversed = false\r\n    this.reversing = false\r\n\r\n    this.duration = new SVG.Number(o.duration).valueOf()\r\n    this.delay = new SVG.Number(o.delay).valueOf()\r\n\r\n    this.start = +new Date() + this.delay\r\n    this.finish = this.start + this.duration\r\n    this.ease = o.ease\r\n\r\n    // this.loop is incremented from 0 to this.loops\r\n    // it is also incremented when in an infinite loop (when this.loops is true)\r\n    this.loop = 0\r\n    this.loops = false\r\n\r\n    this.animations = {\r\n      // functionToCall: [list of morphable objects]\r\n      // e.g. move: [SVG.Number, SVG.Number]\r\n    }\r\n\r\n    this.attrs = {\r\n      // holds all attributes which are not represented from a function svg.js provides\r\n      // e.g. someAttr: SVG.Number\r\n    }\r\n\r\n    this.styles = {\r\n      // holds all styles which should be animated\r\n      // e.g. fill-color: SVG.Color\r\n    }\r\n\r\n    this.transforms = [\r\n      // holds all transformations as transformation objects\r\n      // e.g. [SVG.Rotate, SVG.Translate, SVG.Matrix]\r\n    ]\r\n\r\n    this.once = {\r\n      // functions to fire at a specific position\r\n      // e.g. \"0.5\": function foo(){}\r\n    }\r\n\r\n  }\r\n\r\n})\r\n\r\n\r\nSVG.FX = SVG.invent({\r\n\r\n  create: function(element) {\r\n    this._target = element\r\n    this.situations = []\r\n    this.active = false\r\n    this.situation = null\r\n    this.paused = false\r\n    this.lastPos = 0\r\n    this.pos = 0\r\n    // The absolute position of an animation is its position in the context of its complete duration (including delay and loops)\r\n    // When performing a delay, absPos is below 0 and when performing a loop, its value is above 1\r\n    this.absPos = 0\r\n    this._speed = 1\r\n  }\r\n\r\n, extend: {\r\n\r\n    /**\r\n     * sets or returns the target of this animation\r\n     * @param o object || number In case of Object it holds all parameters. In case of number its the duration of the animation\r\n     * @param ease function || string Function which should be used for easing or easing keyword\r\n     * @param delay Number indicating the delay before the animation starts\r\n     * @return target || this\r\n     */\r\n    animate: function(o, ease, delay){\r\n\r\n      if(typeof o == 'object'){\r\n        ease = o.ease\r\n        delay = o.delay\r\n        o = o.duration\r\n      }\r\n\r\n      var situation = new SVG.Situation({\r\n        duration: o || 1000,\r\n        delay: delay || 0,\r\n        ease: SVG.easing[ease || '-'] || ease\r\n      })\r\n\r\n      this.queue(situation)\r\n\r\n      return this\r\n    }\r\n\r\n    /**\r\n     * sets a delay before the next element of the queue is called\r\n     * @param delay Duration of delay in milliseconds\r\n     * @return this.target()\r\n     */\r\n  , delay: function(delay){\r\n      // The delay is performed by an empty situation with its duration\r\n      // attribute set to the duration of the delay\r\n      var situation = new SVG.Situation({\r\n        duration: delay,\r\n        delay: 0,\r\n        ease: SVG.easing['-']\r\n      })\r\n\r\n      return this.queue(situation)\r\n    }\r\n\r\n    /**\r\n     * sets or returns the target of this animation\r\n     * @param null || target SVG.Element which should be set as new target\r\n     * @return target || this\r\n     */\r\n  , target: function(target){\r\n      if(target && target instanceof SVG.Element){\r\n        this._target = target\r\n        return this\r\n      }\r\n\r\n      return this._target\r\n    }\r\n\r\n    // returns the absolute position at a given time\r\n  , timeToAbsPos: function(timestamp){\r\n      return (timestamp - this.situation.start) / (this.situation.duration/this._speed)\r\n    }\r\n\r\n    // returns the timestamp from a given absolute positon\r\n  , absPosToTime: function(absPos){\r\n      return this.situation.duration/this._speed * absPos + this.situation.start\r\n    }\r\n\r\n    // starts the animationloop\r\n  , startAnimFrame: function(){\r\n      this.stopAnimFrame()\r\n      this.animationFrame = window.requestAnimationFrame(function(){ this.step() }.bind(this))\r\n    }\r\n\r\n    // cancels the animationframe\r\n  , stopAnimFrame: function(){\r\n      window.cancelAnimationFrame(this.animationFrame)\r\n    }\r\n\r\n    // kicks off the animation - only does something when the queue is currently not active and at least one situation is set\r\n  , start: function(){\r\n      // dont start if already started\r\n      if(!this.active && this.situation){\r\n        this.active = true\r\n        this.startCurrent()\r\n      }\r\n\r\n      return this\r\n    }\r\n\r\n    // start the current situation\r\n  , startCurrent: function(){\r\n      this.situation.start = +new Date + this.situation.delay/this._speed\r\n      this.situation.finish = this.situation.start + this.situation.duration/this._speed\r\n      return this.initAnimations().step()\r\n    }\r\n\r\n    /**\r\n     * adds a function / Situation to the animation queue\r\n     * @param fn function / situation to add\r\n     * @return this\r\n     */\r\n  , queue: function(fn){\r\n      if(typeof fn == 'function' || fn instanceof SVG.Situation)\r\n        this.situations.push(fn)\r\n\r\n      if(!this.situation) this.situation = this.situations.shift()\r\n\r\n      return this\r\n    }\r\n\r\n    /**\r\n     * pulls next element from the queue and execute it\r\n     * @return this\r\n     */\r\n  , dequeue: function(){\r\n      // stop current animation\r\n      this.stop()\r\n\r\n      // get next animation from queue\r\n      this.situation = this.situations.shift()\r\n\r\n      if(this.situation){\r\n        if(this.situation instanceof SVG.Situation) {\r\n          this.start()\r\n        } else {\r\n          // If it is not a SVG.Situation, then it is a function, we execute it\r\n          this.situation.call(this)\r\n        }\r\n      }\r\n\r\n      return this\r\n    }\r\n\r\n    // updates all animations to the current state of the element\r\n    // this is important when one property could be changed from another property\r\n  , initAnimations: function() {\r\n      var i, j, source\r\n      var s = this.situation\r\n\r\n      if(s.init) return this\r\n\r\n      for(i in s.animations){\r\n        source = this.target()[i]()\r\n\r\n        if(!Array.isArray(source)) {\r\n          source = [source]\r\n        }\r\n\r\n        if(!Array.isArray(s.animations[i])) {\r\n          s.animations[i] = [s.animations[i]]\r\n        }\r\n\r\n        //if(s.animations[i].length > source.length) {\r\n        //  source.concat = source.concat(s.animations[i].slice(source.length, s.animations[i].length))\r\n        //}\r\n\r\n        for(j = source.length; j--;) {\r\n          // The condition is because some methods return a normal number instead\r\n          // of a SVG.Number\r\n          if(s.animations[i][j] instanceof SVG.Number)\r\n            source[j] = new SVG.Number(source[j])\r\n\r\n          s.animations[i][j] = source[j].morph(s.animations[i][j])\r\n        }\r\n      }\r\n\r\n      for(i in s.attrs){\r\n        s.attrs[i] = new SVG.MorphObj(this.target().attr(i), s.attrs[i])\r\n      }\r\n\r\n      for(i in s.styles){\r\n        s.styles[i] = new SVG.MorphObj(this.target().style(i), s.styles[i])\r\n      }\r\n\r\n      s.initialTransformation = this.target().matrixify()\r\n\r\n      s.init = true\r\n      return this\r\n    }\r\n  , clearQueue: function(){\r\n      this.situations = []\r\n      return this\r\n    }\r\n  , clearCurrent: function(){\r\n      this.situation = null\r\n      return this\r\n    }\r\n    /** stops the animation immediately\r\n     * @param jumpToEnd A Boolean indicating whether to complete the current animation immediately.\r\n     * @param clearQueue A Boolean indicating whether to remove queued animation as well.\r\n     * @return this\r\n     */\r\n  , stop: function(jumpToEnd, clearQueue){\r\n      var active = this.active\r\n      this.active = false\r\n\r\n      if(clearQueue){\r\n        this.clearQueue()\r\n      }\r\n\r\n      if(jumpToEnd && this.situation){\r\n        // initialize the situation if it was not\r\n        !active && this.startCurrent()\r\n        this.atEnd()\r\n      }\r\n\r\n      this.stopAnimFrame()\r\n\r\n      return this.clearCurrent()\r\n    }\r\n\r\n    /** resets the element to the state where the current element has started\r\n     * @return this\r\n     */\r\n  , reset: function(){\r\n      if(this.situation){\r\n        var temp = this.situation\r\n        this.stop()\r\n        this.situation = temp\r\n        this.atStart()\r\n      }\r\n      return this\r\n    }\r\n\r\n    // Stop the currently-running animation, remove all queued animations, and complete all animations for the element.\r\n  , finish: function(){\r\n\r\n      this.stop(true, false)\r\n\r\n      while(this.dequeue().situation && this.stop(true, false));\r\n\r\n      this.clearQueue().clearCurrent()\r\n\r\n      return this\r\n    }\r\n\r\n    // set the internal animation pointer at the start position, before any loops, and updates the visualisation\r\n  , atStart: function() {\r\n      return this.at(0, true)\r\n    }\r\n\r\n    // set the internal animation pointer at the end position, after all the loops, and updates the visualisation\r\n  , atEnd: function() {\r\n      if (this.situation.loops === true) {\r\n        // If in a infinite loop, we end the current iteration\r\n        this.situation.loops = this.situation.loop + 1\r\n      }\r\n\r\n      if(typeof this.situation.loops == 'number') {\r\n        // If performing a finite number of loops, we go after all the loops\r\n        return this.at(this.situation.loops, true)\r\n      } else {\r\n        // If no loops, we just go at the end\r\n        return this.at(1, true)\r\n      }\r\n    }\r\n\r\n    // set the internal animation pointer to the specified position and updates the visualisation\r\n    // if isAbsPos is true, pos is treated as an absolute position\r\n  , at: function(pos, isAbsPos){\r\n      var durDivSpd = this.situation.duration/this._speed\r\n\r\n      this.absPos = pos\r\n      // If pos is not an absolute position, we convert it into one\r\n      if (!isAbsPos) {\r\n        if (this.situation.reversed) this.absPos = 1 - this.absPos\r\n        this.absPos += this.situation.loop\r\n      }\r\n\r\n      this.situation.start = +new Date - this.absPos * durDivSpd\r\n      this.situation.finish = this.situation.start + durDivSpd\r\n\r\n      return this.step(true)\r\n    }\r\n\r\n    /**\r\n     * sets or returns the speed of the animations\r\n     * @param speed null || Number The new speed of the animations\r\n     * @return Number || this\r\n     */\r\n  , speed: function(speed){\r\n      if (speed === 0) return this.pause()\r\n\r\n      if (speed) {\r\n        this._speed = speed\r\n        // We use an absolute position here so that speed can affect the delay before the animation\r\n        return this.at(this.absPos, true)\r\n      } else return this._speed\r\n    }\r\n\r\n    // Make loopable\r\n  , loop: function(times, reverse) {\r\n      var c = this.last()\r\n\r\n      // store total loops\r\n      c.loops = (times != null) ? times : true\r\n      c.loop = 0\r\n\r\n      if(reverse) c.reversing = true\r\n      return this\r\n    }\r\n\r\n    // pauses the animation\r\n  , pause: function(){\r\n      this.paused = true\r\n      this.stopAnimFrame()\r\n\r\n      return this\r\n    }\r\n\r\n    // unpause the animation\r\n  , play: function(){\r\n      if(!this.paused) return this\r\n      this.paused = false\r\n      // We use an absolute position here so that the delay before the animation can be paused\r\n      return this.at(this.absPos, true)\r\n    }\r\n\r\n    /**\r\n     * toggle or set the direction of the animation\r\n     * true sets direction to backwards while false sets it to forwards\r\n     * @param reversed Boolean indicating whether to reverse the animation or not (default: toggle the reverse status)\r\n     * @return this\r\n     */\r\n  , reverse: function(reversed){\r\n      var c = this.last()\r\n\r\n      if(typeof reversed == 'undefined') c.reversed = !c.reversed\r\n      else c.reversed = reversed\r\n\r\n      return this\r\n    }\r\n\r\n\r\n    /**\r\n     * returns a float from 0-1 indicating the progress of the current animation\r\n     * @param eased Boolean indicating whether the returned position should be eased or not\r\n     * @return number\r\n     */\r\n  , progress: function(easeIt){\r\n      return easeIt ? this.situation.ease(this.pos) : this.pos\r\n    }\r\n\r\n    /**\r\n     * adds a callback function which is called when the current animation is finished\r\n     * @param fn Function which should be executed as callback\r\n     * @return number\r\n     */\r\n  , after: function(fn){\r\n      var c = this.last()\r\n        , wrapper = function wrapper(e){\r\n            if(e.detail.situation == c){\r\n              fn.call(this, c)\r\n              this.off('finished.fx', wrapper) // prevent memory leak\r\n            }\r\n          }\r\n\r\n      this.target().on('finished.fx', wrapper)\r\n\r\n      return this._callStart()\r\n    }\r\n\r\n    // adds a callback which is called whenever one animation step is performed\r\n  , during: function(fn){\r\n      var c = this.last()\r\n        , wrapper = function(e){\r\n            if(e.detail.situation == c){\r\n              fn.call(this, e.detail.pos, SVG.morph(e.detail.pos), e.detail.eased, c)\r\n            }\r\n          }\r\n\r\n      // see above\r\n      this.target().off('during.fx', wrapper).on('during.fx', wrapper)\r\n\r\n      this.after(function(){\r\n        this.off('during.fx', wrapper)\r\n      })\r\n\r\n      return this._callStart()\r\n    }\r\n\r\n    // calls after ALL animations in the queue are finished\r\n  , afterAll: function(fn){\r\n      var wrapper = function wrapper(e){\r\n            fn.call(this)\r\n            this.off('allfinished.fx', wrapper)\r\n          }\r\n\r\n      // see above\r\n      this.target().off('allfinished.fx', wrapper).on('allfinished.fx', wrapper)\r\n\r\n      return this._callStart()\r\n    }\r\n\r\n    // calls on every animation step for all animations\r\n  , duringAll: function(fn){\r\n      var wrapper = function(e){\r\n            fn.call(this, e.detail.pos, SVG.morph(e.detail.pos), e.detail.eased, e.detail.situation)\r\n          }\r\n\r\n      this.target().off('during.fx', wrapper).on('during.fx', wrapper)\r\n\r\n      this.afterAll(function(){\r\n        this.off('during.fx', wrapper)\r\n      })\r\n\r\n      return this._callStart()\r\n    }\r\n\r\n  , last: function(){\r\n      return this.situations.length ? this.situations[this.situations.length-1] : this.situation\r\n    }\r\n\r\n    // adds one property to the animations\r\n  , add: function(method, args, type){\r\n      this.last()[type || 'animations'][method] = args\r\n      return this._callStart()\r\n    }\r\n\r\n    /** perform one step of the animation\r\n     *  @param ignoreTime Boolean indicating whether to ignore time and use position directly or recalculate position based on time\r\n     *  @return this\r\n     */\r\n  , step: function(ignoreTime){\r\n\r\n      // convert current time to an absolute position\r\n      if(!ignoreTime) this.absPos = this.timeToAbsPos(+new Date)\r\n\r\n      // This part convert an absolute position to a position\r\n      if(this.situation.loops !== false) {\r\n        var absPos, absPosInt, lastLoop\r\n\r\n        // If the absolute position is below 0, we just treat it as if it was 0\r\n        absPos = Math.max(this.absPos, 0)\r\n        absPosInt = Math.floor(absPos)\r\n\r\n        if(this.situation.loops === true || absPosInt < this.situation.loops) {\r\n          this.pos = absPos - absPosInt\r\n          lastLoop = this.situation.loop\r\n          this.situation.loop = absPosInt\r\n        } else {\r\n          this.absPos = this.situation.loops\r\n          this.pos = 1\r\n          // The -1 here is because we don't want to toggle reversed when all the loops have been completed\r\n          lastLoop = this.situation.loop - 1\r\n          this.situation.loop = this.situation.loops\r\n        }\r\n\r\n        if(this.situation.reversing) {\r\n          // Toggle reversed if an odd number of loops as occured since the last call of step\r\n          this.situation.reversed = this.situation.reversed != Boolean((this.situation.loop - lastLoop) % 2)\r\n        }\r\n\r\n      } else {\r\n        // If there are no loop, the absolute position must not be above 1\r\n        this.absPos = Math.min(this.absPos, 1)\r\n        this.pos = this.absPos\r\n      }\r\n\r\n      // while the absolute position can be below 0, the position must not be below 0\r\n      if(this.pos < 0) this.pos = 0\r\n\r\n      if(this.situation.reversed) this.pos = 1 - this.pos\r\n\r\n\r\n      // apply easing\r\n      var eased = this.situation.ease(this.pos)\r\n\r\n      // call once-callbacks\r\n      for(var i in this.situation.once){\r\n        if(i > this.lastPos && i <= eased){\r\n          this.situation.once[i].call(this.target(), this.pos, eased)\r\n          delete this.situation.once[i]\r\n        }\r\n      }\r\n\r\n      // fire during callback with position, eased position and current situation as parameter\r\n      if(this.active) this.target().fire('during', {pos: this.pos, eased: eased, fx: this, situation: this.situation})\r\n\r\n      // the user may call stop or finish in the during callback\r\n      // so make sure that we still have a valid situation\r\n      if(!this.situation){\r\n        return this\r\n      }\r\n\r\n      // apply the actual animation to every property\r\n      this.eachAt()\r\n\r\n      // do final code when situation is finished\r\n      if((this.pos == 1 && !this.situation.reversed) || (this.situation.reversed && this.pos == 0)){\r\n\r\n        // stop animation callback\r\n        this.stopAnimFrame()\r\n\r\n        // fire finished callback with current situation as parameter\r\n        this.target().fire('finished', {fx:this, situation: this.situation})\r\n\r\n        if(!this.situations.length){\r\n          this.target().fire('allfinished')\r\n\r\n          // Recheck the length since the user may call animate in the afterAll callback\r\n          if(!this.situations.length){\r\n            this.target().off('.fx') // there shouldnt be any binding left, but to make sure...\r\n            this.active = false\r\n          }\r\n        }\r\n\r\n        // start next animation\r\n        if(this.active) this.dequeue()\r\n        else this.clearCurrent()\r\n\r\n      }else if(!this.paused && this.active){\r\n        // we continue animating when we are not at the end\r\n        this.startAnimFrame()\r\n      }\r\n\r\n      // save last eased position for once callback triggering\r\n      this.lastPos = eased\r\n      return this\r\n\r\n    }\r\n\r\n    // calculates the step for every property and calls block with it\r\n  , eachAt: function(){\r\n      var i, len, at, self = this, target = this.target(), s = this.situation\r\n\r\n      // apply animations which can be called trough a method\r\n      for(i in s.animations){\r\n\r\n        at = [].concat(s.animations[i]).map(function(el){\r\n          return typeof el !== 'string' && el.at ? el.at(s.ease(self.pos), self.pos) : el\r\n        })\r\n\r\n        target[i].apply(target, at)\r\n\r\n      }\r\n\r\n      // apply animation which has to be applied with attr()\r\n      for(i in s.attrs){\r\n\r\n        at = [i].concat(s.attrs[i]).map(function(el){\r\n          return typeof el !== 'string' && el.at ? el.at(s.ease(self.pos), self.pos) : el\r\n        })\r\n\r\n        target.attr.apply(target, at)\r\n\r\n      }\r\n\r\n      // apply animation which has to be applied with style()\r\n      for(i in s.styles){\r\n\r\n        at = [i].concat(s.styles[i]).map(function(el){\r\n          return typeof el !== 'string' && el.at ? el.at(s.ease(self.pos), self.pos) : el\r\n        })\r\n\r\n        target.style.apply(target, at)\r\n\r\n      }\r\n\r\n      // animate initialTransformation which has to be chained\r\n      if(s.transforms.length){\r\n\r\n        // get initial initialTransformation\r\n        at = s.initialTransformation\r\n        for(i = 0, len = s.transforms.length; i < len; i++){\r\n\r\n          // get next transformation in chain\r\n          var a = s.transforms[i]\r\n\r\n          // multiply matrix directly\r\n          if(a instanceof SVG.Matrix){\r\n\r\n            if(a.relative){\r\n              at = at.multiply(new SVG.Matrix().morph(a).at(s.ease(this.pos)))\r\n            }else{\r\n              at = at.morph(a).at(s.ease(this.pos))\r\n            }\r\n            continue\r\n          }\r\n\r\n          // when transformation is absolute we have to reset the needed transformation first\r\n          if(!a.relative)\r\n            a.undo(at.extract())\r\n\r\n          // and reapply it after\r\n          at = at.multiply(a.at(s.ease(this.pos)))\r\n\r\n        }\r\n\r\n        // set new matrix on element\r\n        target.matrix(at)\r\n      }\r\n\r\n      return this\r\n\r\n    }\r\n\r\n\r\n    // adds an once-callback which is called at a specific position and never again\r\n  , once: function(pos, fn, isEased){\r\n      var c = this.last()\r\n      if(!isEased) pos = c.ease(pos)\r\n\r\n      c.once[pos] = fn\r\n\r\n      return this\r\n    }\r\n\r\n  , _callStart: function() {\r\n      setTimeout(function(){this.start()}.bind(this), 0)\r\n      return this\r\n    }\r\n\r\n  }\r\n\r\n, parent: SVG.Element\r\n\r\n  // Add method to parent elements\r\n, construct: {\r\n    // Get fx module or create a new one, then animate with given duration and ease\r\n    animate: function(o, ease, delay) {\r\n      return (this.fx || (this.fx = new SVG.FX(this))).animate(o, ease, delay)\r\n    }\r\n  , delay: function(delay){\r\n      return (this.fx || (this.fx = new SVG.FX(this))).delay(delay)\r\n    }\r\n  , stop: function(jumpToEnd, clearQueue) {\r\n      if (this.fx)\r\n        this.fx.stop(jumpToEnd, clearQueue)\r\n\r\n      return this\r\n    }\r\n  , finish: function() {\r\n      if (this.fx)\r\n        this.fx.finish()\r\n\r\n      return this\r\n    }\r\n    // Pause current animation\r\n  , pause: function() {\r\n      if (this.fx)\r\n        this.fx.pause()\r\n\r\n      return this\r\n    }\r\n    // Play paused current animation\r\n  , play: function() {\r\n      if (this.fx)\r\n        this.fx.play()\r\n\r\n      return this\r\n    }\r\n    // Set/Get the speed of the animations\r\n  , speed: function(speed) {\r\n      if (this.fx)\r\n        if (speed == null)\r\n          return this.fx.speed()\r\n        else\r\n          this.fx.speed(speed)\r\n\r\n      return this\r\n    }\r\n  }\r\n\r\n})\r\n\r\n// MorphObj is used whenever no morphable object is given\r\nSVG.MorphObj = SVG.invent({\r\n\r\n  create: function(from, to){\r\n    // prepare color for morphing\r\n    if(SVG.Color.isColor(to)) return new SVG.Color(from).morph(to)\r\n    // check if we have a list of values\r\n    if(SVG.regex.delimiter.test(from)) {\r\n      // prepare path for morphing\r\n      if(SVG.regex.pathLetters.test(from)) return new SVG.PathArray(from).morph(to)\r\n      // prepare value list for morphing\r\n      else return new SVG.Array(from).morph(to)\r\n    }\r\n    // prepare number for morphing\r\n    if(SVG.regex.numberAndUnit.test(to)) return new SVG.Number(from).morph(to)\r\n\r\n    // prepare for plain morphing\r\n    this.value = from\r\n    this.destination = to\r\n  }\r\n\r\n, extend: {\r\n    at: function(pos, real){\r\n      return real < 1 ? this.value : this.destination\r\n    },\r\n\r\n    valueOf: function(){\r\n      return this.value\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.extend(SVG.FX, {\r\n  // Add animatable attributes\r\n  attr: function(a, v, relative) {\r\n    // apply attributes individually\r\n    if (typeof a == 'object') {\r\n      for (var key in a)\r\n        this.attr(key, a[key])\r\n\r\n    } else {\r\n      this.add(a, v, 'attrs')\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Add animatable styles\r\n, style: function(s, v) {\r\n    if (typeof s == 'object')\r\n      for (var key in s)\r\n        this.style(key, s[key])\r\n\r\n    else\r\n      this.add(s, v, 'styles')\r\n\r\n    return this\r\n  }\r\n  // Animatable x-axis\r\n, x: function(x, relative) {\r\n    if(this.target() instanceof SVG.G){\r\n      this.transform({x:x}, relative)\r\n      return this\r\n    }\r\n\r\n    var num = new SVG.Number(x)\r\n    num.relative = relative\r\n    return this.add('x', num)\r\n  }\r\n  // Animatable y-axis\r\n, y: function(y, relative) {\r\n    if(this.target() instanceof SVG.G){\r\n      this.transform({y:y}, relative)\r\n      return this\r\n    }\r\n\r\n    var num = new SVG.Number(y)\r\n    num.relative = relative\r\n    return this.add('y', num)\r\n  }\r\n  // Animatable center x-axis\r\n, cx: function(x) {\r\n    return this.add('cx', new SVG.Number(x))\r\n  }\r\n  // Animatable center y-axis\r\n, cy: function(y) {\r\n    return this.add('cy', new SVG.Number(y))\r\n  }\r\n  // Add animatable move\r\n, move: function(x, y) {\r\n    return this.x(x).y(y)\r\n  }\r\n  // Add animatable center\r\n, center: function(x, y) {\r\n    return this.cx(x).cy(y)\r\n  }\r\n  // Add animatable size\r\n, size: function(width, height) {\r\n    if (this.target() instanceof SVG.Text) {\r\n      // animate font size for Text elements\r\n      this.attr('font-size', width)\r\n\r\n    } else {\r\n      // animate bbox based size for all other elements\r\n      var box\r\n\r\n      if(!width || !height){\r\n        box = this.target().bbox()\r\n      }\r\n\r\n      if(!width){\r\n        width = box.width / box.height  * height\r\n      }\r\n\r\n      if(!height){\r\n        height = box.height / box.width  * width\r\n      }\r\n\r\n      this.add('width' , new SVG.Number(width))\r\n          .add('height', new SVG.Number(height))\r\n\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Add animatable width\r\n, width: function(width) {\r\n    return this.add('width', new SVG.Number(width))\r\n  }\r\n  // Add animatable height\r\n, height: function(height) {\r\n    return this.add('height', new SVG.Number(height))\r\n  }\r\n  // Add animatable plot\r\n, plot: function(a, b, c, d) {\r\n    // Lines can be plotted with 4 arguments\r\n    if(arguments.length == 4) {\r\n      return this.plot([a, b, c, d])\r\n    }\r\n\r\n    return this.add('plot', new (this.target().morphArray)(a))\r\n  }\r\n  // Add leading method\r\n, leading: function(value) {\r\n    return this.target().leading ?\r\n      this.add('leading', new SVG.Number(value)) :\r\n      this\r\n  }\r\n  // Add animatable viewbox\r\n, viewbox: function(x, y, width, height) {\r\n    if (this.target() instanceof SVG.Container) {\r\n      this.add('viewbox', new SVG.ViewBox(x, y, width, height))\r\n    }\r\n\r\n    return this\r\n  }\r\n, update: function(o) {\r\n    if (this.target() instanceof SVG.Stop) {\r\n      if (typeof o == 'number' || o instanceof SVG.Number) {\r\n        return this.update({\r\n          offset:  arguments[0]\r\n        , color:   arguments[1]\r\n        , opacity: arguments[2]\r\n        })\r\n      }\r\n\r\n      if (o.opacity != null) this.attr('stop-opacity', o.opacity)\r\n      if (o.color   != null) this.attr('stop-color', o.color)\r\n      if (o.offset  != null) this.attr('offset', o.offset)\r\n    }\r\n\r\n    return this\r\n  }\r\n})\r\n\nSVG.Box = SVG.invent({\r\n  create: function(x, y, width, height) {\r\n    if (typeof x == 'object' && !(x instanceof SVG.Element)) {\r\n      // chromes getBoundingClientRect has no x and y property\r\n      return SVG.Box.call(this, x.left != null ? x.left : x.x , x.top != null ? x.top : x.y, x.width, x.height)\r\n    } else if (arguments.length == 4) {\r\n      this.x = x\r\n      this.y = y\r\n      this.width = width\r\n      this.height = height\r\n    }\r\n\r\n    // add center, right, bottom...\r\n    fullBox(this)\r\n  }\r\n, extend: {\r\n    // Merge rect box with another, return a new instance\r\n    merge: function(box) {\r\n      var b = new this.constructor()\r\n\r\n      // merge boxes\r\n      b.x      = Math.min(this.x, box.x)\r\n      b.y      = Math.min(this.y, box.y)\r\n      b.width  = Math.max(this.x + this.width,  box.x + box.width)  - b.x\r\n      b.height = Math.max(this.y + this.height, box.y + box.height) - b.y\r\n\r\n      return fullBox(b)\r\n    }\r\n\r\n  , transform: function(m) {\r\n      var xMin = Infinity, xMax = -Infinity, yMin = Infinity, yMax = -Infinity, p, bbox\r\n\r\n      var pts = [\r\n        new SVG.Point(this.x, this.y),\r\n        new SVG.Point(this.x2, this.y),\r\n        new SVG.Point(this.x, this.y2),\r\n        new SVG.Point(this.x2, this.y2)\r\n      ]\r\n\r\n      pts.forEach(function(p) {\r\n        p = p.transform(m)\r\n        xMin = Math.min(xMin,p.x)\r\n        xMax = Math.max(xMax,p.x)\r\n        yMin = Math.min(yMin,p.y)\r\n        yMax = Math.max(yMax,p.y)\r\n      })\r\n\r\n      bbox = new this.constructor()\r\n      bbox.x = xMin\r\n      bbox.width = xMax-xMin\r\n      bbox.y = yMin\r\n      bbox.height = yMax-yMin\r\n\r\n      fullBox(bbox)\r\n\r\n      return bbox\r\n    }\r\n  }\r\n})\r\n\r\nSVG.BBox = SVG.invent({\r\n  // Initialize\r\n  create: function(element) {\r\n    SVG.Box.apply(this, [].slice.call(arguments))\r\n\r\n    // get values if element is given\r\n    if (element instanceof SVG.Element) {\r\n      var box\r\n\r\n      // yes this is ugly, but Firefox can be a pain when it comes to elements that are not yet rendered\r\n      try {\r\n\r\n        if (!document.documentElement.contains){\r\n          // This is IE - it does not support contains() for top-level SVGs\r\n          var topParent = element.node\r\n          while (topParent.parentNode){\r\n            topParent = topParent.parentNode\r\n          }\r\n          if (topParent != document) throw new Exception('Element not in the dom')\r\n        } else {\r\n          // the element is NOT in the dom, throw error\r\n          if(!document.documentElement.contains(element.node)) throw new Exception('Element not in the dom')\r\n        }\r\n\r\n        // find native bbox\r\n        box = element.node.getBBox()\r\n      } catch(e) {\r\n        if(element instanceof SVG.Shape){\r\n          var clone = element.clone(SVG.parser.draw.instance).show()\r\n          box = clone.node.getBBox()\r\n          clone.remove()\r\n        }else{\r\n          box = {\r\n            x:      element.node.clientLeft\r\n          , y:      element.node.clientTop\r\n          , width:  element.node.clientWidth\r\n          , height: element.node.clientHeight\r\n          }\r\n        }\r\n      }\r\n\r\n      SVG.Box.call(this, box)\r\n    }\r\n\r\n  }\r\n\r\n  // Define ancestor\r\n, inherit: SVG.Box\r\n\r\n  // Define Parent\r\n, parent: SVG.Element\r\n\r\n  // Constructor\r\n, construct: {\r\n    // Get bounding box\r\n    bbox: function() {\r\n      return new SVG.BBox(this)\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.BBox.prototype.constructor = SVG.BBox\r\n\r\n\r\nSVG.extend(SVG.Element, {\r\n  tbox: function(){\r\n    console.warn('Use of TBox is deprecated and mapped to RBox. Use .rbox() instead.')\r\n    return this.rbox(this.doc())\r\n  }\r\n})\r\n\r\nSVG.RBox = SVG.invent({\r\n  // Initialize\r\n  create: function(element) {\r\n    SVG.Box.apply(this, [].slice.call(arguments))\r\n\r\n    if (element instanceof SVG.Element) {\r\n      SVG.Box.call(this, element.node.getBoundingClientRect())\r\n    }\r\n  }\r\n\r\n, inherit: SVG.Box\r\n\r\n  // define Parent\r\n, parent: SVG.Element\r\n\r\n, extend: {\r\n    addOffset: function() {\r\n      // offset by window scroll position, because getBoundingClientRect changes when window is scrolled\r\n      this.x += window.pageXOffset\r\n      this.y += window.pageYOffset\r\n      return this\r\n    }\r\n  }\r\n\r\n  // Constructor\r\n, construct: {\r\n    // Get rect box\r\n    rbox: function(el) {\r\n      if (el) return new SVG.RBox(this).transform(el.screenCTM().inverse())\r\n      return new SVG.RBox(this).addOffset()\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.RBox.prototype.constructor = SVG.RBox\r\n\nSVG.Matrix = SVG.invent({\r\n  // Initialize\r\n  create: function(source) {\r\n    var i, base = arrayToMatrix([1, 0, 0, 1, 0, 0])\r\n\r\n    // ensure source as object\r\n    source = source instanceof SVG.Element ?\r\n      source.matrixify() :\r\n    typeof source === 'string' ?\r\n      arrayToMatrix(source.split(SVG.regex.delimiter).map(parseFloat)) :\r\n    arguments.length == 6 ?\r\n      arrayToMatrix([].slice.call(arguments)) :\r\n    Array.isArray(source) ?\r\n      arrayToMatrix(source) :\r\n    typeof source === 'object' ?\r\n      source : base\r\n\r\n    // merge source\r\n    for (i = abcdef.length - 1; i >= 0; --i)\r\n      this[abcdef[i]] = source[abcdef[i]] != null ?\r\n        source[abcdef[i]] : base[abcdef[i]]\r\n  }\r\n\r\n  // Add methods\r\n, extend: {\r\n    // Extract individual transformations\r\n    extract: function() {\r\n      // find delta transform points\r\n      var px    = deltaTransformPoint(this, 0, 1)\r\n        , py    = deltaTransformPoint(this, 1, 0)\r\n        , skewX = 180 / Math.PI * Math.atan2(px.y, px.x) - 90\r\n\r\n      return {\r\n        // translation\r\n        x:        this.e\r\n      , y:        this.f\r\n      , transformedX:(this.e * Math.cos(skewX * Math.PI / 180) + this.f * Math.sin(skewX * Math.PI / 180)) / Math.sqrt(this.a * this.a + this.b * this.b)\r\n      , transformedY:(this.f * Math.cos(skewX * Math.PI / 180) + this.e * Math.sin(-skewX * Math.PI / 180)) / Math.sqrt(this.c * this.c + this.d * this.d)\r\n        // skew\r\n      , skewX:    -skewX\r\n      , skewY:    180 / Math.PI * Math.atan2(py.y, py.x)\r\n        // scale\r\n      , scaleX:   Math.sqrt(this.a * this.a + this.b * this.b)\r\n      , scaleY:   Math.sqrt(this.c * this.c + this.d * this.d)\r\n        // rotation\r\n      , rotation: skewX\r\n      , a: this.a\r\n      , b: this.b\r\n      , c: this.c\r\n      , d: this.d\r\n      , e: this.e\r\n      , f: this.f\r\n      , matrix: new SVG.Matrix(this)\r\n      }\r\n    }\r\n    // Clone matrix\r\n  , clone: function() {\r\n      return new SVG.Matrix(this)\r\n    }\r\n    // Morph one matrix into another\r\n  , morph: function(matrix) {\r\n      // store new destination\r\n      this.destination = new SVG.Matrix(matrix)\r\n\r\n      return this\r\n    }\r\n    // Get morphed matrix at a given position\r\n  , at: function(pos) {\r\n      // make sure a destination is defined\r\n      if (!this.destination) return this\r\n\r\n      // calculate morphed matrix at a given position\r\n      var matrix = new SVG.Matrix({\r\n        a: this.a + (this.destination.a - this.a) * pos\r\n      , b: this.b + (this.destination.b - this.b) * pos\r\n      , c: this.c + (this.destination.c - this.c) * pos\r\n      , d: this.d + (this.destination.d - this.d) * pos\r\n      , e: this.e + (this.destination.e - this.e) * pos\r\n      , f: this.f + (this.destination.f - this.f) * pos\r\n      })\r\n\r\n      return matrix\r\n    }\r\n    // Multiplies by given matrix\r\n  , multiply: function(matrix) {\r\n      return new SVG.Matrix(this.native().multiply(parseMatrix(matrix).native()))\r\n    }\r\n    // Inverses matrix\r\n  , inverse: function() {\r\n      return new SVG.Matrix(this.native().inverse())\r\n    }\r\n    // Translate matrix\r\n  , translate: function(x, y) {\r\n      return new SVG.Matrix(this.native().translate(x || 0, y || 0))\r\n    }\r\n    // Scale matrix\r\n  , scale: function(x, y, cx, cy) {\r\n      // support uniformal scale\r\n      if (arguments.length == 1) {\r\n        y = x\r\n      } else if (arguments.length == 3) {\r\n        cy = cx\r\n        cx = y\r\n        y = x\r\n      }\r\n\r\n      return this.around(cx, cy, new SVG.Matrix(x, 0, 0, y, 0, 0))\r\n    }\r\n    // Rotate matrix\r\n  , rotate: function(r, cx, cy) {\r\n      // convert degrees to radians\r\n      r = SVG.utils.radians(r)\r\n\r\n      return this.around(cx, cy, new SVG.Matrix(Math.cos(r), Math.sin(r), -Math.sin(r), Math.cos(r), 0, 0))\r\n    }\r\n    // Flip matrix on x or y, at a given offset\r\n  , flip: function(a, o) {\r\n      return a == 'x' ?\r\n          this.scale(-1, 1, o, 0) :\r\n        a == 'y' ?\r\n          this.scale(1, -1, 0, o) :\r\n          this.scale(-1, -1, a, o != null ? o : a)\r\n    }\r\n    // Skew\r\n  , skew: function(x, y, cx, cy) {\r\n      // support uniformal skew\r\n      if (arguments.length == 1) {\r\n        y = x\r\n      } else if (arguments.length == 3) {\r\n        cy = cx\r\n        cx = y\r\n        y = x\r\n      }\r\n\r\n      // convert degrees to radians\r\n      x = SVG.utils.radians(x)\r\n      y = SVG.utils.radians(y)\r\n\r\n      return this.around(cx, cy, new SVG.Matrix(1, Math.tan(y), Math.tan(x), 1, 0, 0))\r\n    }\r\n    // SkewX\r\n  , skewX: function(x, cx, cy) {\r\n      return this.skew(x, 0, cx, cy)\r\n    }\r\n    // SkewY\r\n  , skewY: function(y, cx, cy) {\r\n      return this.skew(0, y, cx, cy)\r\n    }\r\n    // Transform around a center point\r\n  , around: function(cx, cy, matrix) {\r\n      return this\r\n        .multiply(new SVG.Matrix(1, 0, 0, 1, cx || 0, cy || 0))\r\n        .multiply(matrix)\r\n        .multiply(new SVG.Matrix(1, 0, 0, 1, -cx || 0, -cy || 0))\r\n    }\r\n    // Convert to native SVGMatrix\r\n  , native: function() {\r\n      // create new matrix\r\n      var matrix = SVG.parser.native.createSVGMatrix()\r\n\r\n      // update with current values\r\n      for (var i = abcdef.length - 1; i >= 0; i--)\r\n        matrix[abcdef[i]] = this[abcdef[i]]\r\n\r\n      return matrix\r\n    }\r\n    // Convert matrix to string\r\n  , toString: function() {\r\n      // Construct the matrix directly, avoid values that are too small\r\n      return 'matrix(' + float32String(this.a) + ',' + float32String(this.b)\r\n        + ',' + float32String(this.c) + ',' + float32String(this.d)\r\n        + ',' + float32String(this.e) + ',' + float32String(this.f)\r\n        + ')'\r\n    }\r\n  }\r\n\r\n  // Define parent\r\n, parent: SVG.Element\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Get current matrix\r\n    ctm: function() {\r\n      return new SVG.Matrix(this.node.getCTM())\r\n    },\r\n    // Get current screen matrix\r\n    screenCTM: function() {\r\n      /* https://bugzilla.mozilla.org/show_bug.cgi?id=1344537\r\n         This is needed because FF does not return the transformation matrix\r\n         for the inner coordinate system when getScreenCTM() is called on nested svgs.\r\n         However all other Browsers do that */\r\n      if(this instanceof SVG.Nested) {\r\n        var rect = this.rect(1,1)\r\n        var m = rect.node.getScreenCTM()\r\n        rect.remove()\r\n        return new SVG.Matrix(m)\r\n      }\r\n      return new SVG.Matrix(this.node.getScreenCTM())\r\n    }\r\n\r\n  }\r\n\r\n})\r\n\nSVG.Point = SVG.invent({\r\n  // Initialize\r\n  create: function(x,y) {\r\n    var i, source, base = {x:0, y:0}\r\n\r\n    // ensure source as object\r\n    source = Array.isArray(x) ?\r\n      {x:x[0], y:x[1]} :\r\n    typeof x === 'object' ?\r\n      {x:x.x, y:x.y} :\r\n    x != null ?\r\n      {x:x, y:(y != null ? y : x)} : base // If y has no value, then x is used has its value\r\n\r\n    // merge source\r\n    this.x = source.x\r\n    this.y = source.y\r\n  }\r\n\r\n  // Add methods\r\n, extend: {\r\n    // Clone point\r\n    clone: function() {\r\n      return new SVG.Point(this)\r\n    }\r\n    // Morph one point into another\r\n  , morph: function(x, y) {\r\n      // store new destination\r\n      this.destination = new SVG.Point(x, y)\r\n\r\n      return this\r\n    }\r\n    // Get morphed point at a given position\r\n  , at: function(pos) {\r\n      // make sure a destination is defined\r\n      if (!this.destination) return this\r\n\r\n      // calculate morphed matrix at a given position\r\n      var point = new SVG.Point({\r\n        x: this.x + (this.destination.x - this.x) * pos\r\n      , y: this.y + (this.destination.y - this.y) * pos\r\n      })\r\n\r\n      return point\r\n    }\r\n    // Convert to native SVGPoint\r\n  , native: function() {\r\n      // create new point\r\n      var point = SVG.parser.native.createSVGPoint()\r\n\r\n      // update with current values\r\n      point.x = this.x\r\n      point.y = this.y\r\n\r\n      return point\r\n    }\r\n    // transform point with matrix\r\n  , transform: function(matrix) {\r\n      return new SVG.Point(this.native().matrixTransform(matrix.native()))\r\n    }\r\n\r\n  }\r\n\r\n})\r\n\r\nSVG.extend(SVG.Element, {\r\n\r\n  // Get point\r\n  point: function(x, y) {\r\n    return new SVG.Point(x,y).transform(this.screenCTM().inverse());\r\n  }\r\n\r\n})\r\n\nSVG.extend(SVG.Element, {\r\n  // Set svg element attribute\r\n  attr: function(a, v, n) {\r\n    // act as full getter\r\n    if (a == null) {\r\n      // get an object of attributes\r\n      a = {}\r\n      v = this.node.attributes\r\n      for (n = v.length - 1; n >= 0; n--)\r\n        a[v[n].nodeName] = SVG.regex.isNumber.test(v[n].nodeValue) ? parseFloat(v[n].nodeValue) : v[n].nodeValue\r\n\r\n      return a\r\n\r\n    } else if (typeof a == 'object') {\r\n      // apply every attribute individually if an object is passed\r\n      for (v in a) this.attr(v, a[v])\r\n\r\n    } else if (v === null) {\r\n        // remove value\r\n        this.node.removeAttribute(a)\r\n\r\n    } else if (v == null) {\r\n      // act as a getter if the first and only argument is not an object\r\n      v = this.node.getAttribute(a)\r\n      return v == null ?\r\n        SVG.defaults.attrs[a] :\r\n      SVG.regex.isNumber.test(v) ?\r\n        parseFloat(v) : v\r\n\r\n    } else {\r\n      // BUG FIX: some browsers will render a stroke if a color is given even though stroke width is 0\r\n      if (a == 'stroke-width')\r\n        this.attr('stroke', parseFloat(v) > 0 ? this._stroke : null)\r\n      else if (a == 'stroke')\r\n        this._stroke = v\r\n\r\n      // convert image fill and stroke to patterns\r\n      if (a == 'fill' || a == 'stroke') {\r\n        if (SVG.regex.isImage.test(v))\r\n          v = this.doc().defs().image(v, 0, 0)\r\n\r\n        if (v instanceof SVG.Image)\r\n          v = this.doc().defs().pattern(0, 0, function() {\r\n            this.add(v)\r\n          })\r\n      }\r\n\r\n      // ensure correct numeric values (also accepts NaN and Infinity)\r\n      if (typeof v === 'number')\r\n        v = new SVG.Number(v)\r\n\r\n      // ensure full hex color\r\n      else if (SVG.Color.isColor(v))\r\n        v = new SVG.Color(v)\r\n\r\n      // parse array values\r\n      else if (Array.isArray(v))\r\n        v = new SVG.Array(v)\r\n\r\n      // if the passed attribute is leading...\r\n      if (a == 'leading') {\r\n        // ... call the leading method instead\r\n        if (this.leading)\r\n          this.leading(v)\r\n      } else {\r\n        // set given attribute on node\r\n        typeof n === 'string' ?\r\n          this.node.setAttributeNS(n, a, v.toString()) :\r\n          this.node.setAttribute(a, v.toString())\r\n      }\r\n\r\n      // rebuild if required\r\n      if (this.rebuild && (a == 'font-size' || a == 'x'))\r\n        this.rebuild(a, v)\r\n    }\r\n\r\n    return this\r\n  }\r\n})\nSVG.extend(SVG.Element, {\r\n  // Add transformations\r\n  transform: function(o, relative) {\r\n    // get target in case of the fx module, otherwise reference this\r\n    var target = this\r\n      , matrix, bbox\r\n\r\n    // act as a getter\r\n    if (typeof o !== 'object') {\r\n      // get current matrix\r\n      matrix = new SVG.Matrix(target).extract()\r\n\r\n      return typeof o === 'string' ? matrix[o] : matrix\r\n    }\r\n\r\n    // get current matrix\r\n    matrix = new SVG.Matrix(target)\r\n\r\n    // ensure relative flag\r\n    relative = !!relative || !!o.relative\r\n\r\n    // act on matrix\r\n    if (o.a != null) {\r\n      matrix = relative ?\r\n        // relative\r\n        matrix.multiply(new SVG.Matrix(o)) :\r\n        // absolute\r\n        new SVG.Matrix(o)\r\n\r\n    // act on rotation\r\n    } else if (o.rotation != null) {\r\n      // ensure centre point\r\n      ensureCentre(o, target)\r\n\r\n      // apply transformation\r\n      matrix = relative ?\r\n        // relative\r\n        matrix.rotate(o.rotation, o.cx, o.cy) :\r\n        // absolute\r\n        matrix.rotate(o.rotation - matrix.extract().rotation, o.cx, o.cy)\r\n\r\n    // act on scale\r\n    } else if (o.scale != null || o.scaleX != null || o.scaleY != null) {\r\n      // ensure centre point\r\n      ensureCentre(o, target)\r\n\r\n      // ensure scale values on both axes\r\n      o.scaleX = o.scale != null ? o.scale : o.scaleX != null ? o.scaleX : 1\r\n      o.scaleY = o.scale != null ? o.scale : o.scaleY != null ? o.scaleY : 1\r\n\r\n      if (!relative) {\r\n        // absolute; multiply inversed values\r\n        var e = matrix.extract()\r\n        o.scaleX = o.scaleX * 1 / e.scaleX\r\n        o.scaleY = o.scaleY * 1 / e.scaleY\r\n      }\r\n\r\n      matrix = matrix.scale(o.scaleX, o.scaleY, o.cx, o.cy)\r\n\r\n    // act on skew\r\n    } else if (o.skew != null || o.skewX != null || o.skewY != null) {\r\n      // ensure centre point\r\n      ensureCentre(o, target)\r\n\r\n      // ensure skew values on both axes\r\n      o.skewX = o.skew != null ? o.skew : o.skewX != null ? o.skewX : 0\r\n      o.skewY = o.skew != null ? o.skew : o.skewY != null ? o.skewY : 0\r\n\r\n      if (!relative) {\r\n        // absolute; reset skew values\r\n        var e = matrix.extract()\r\n        matrix = matrix.multiply(new SVG.Matrix().skew(e.skewX, e.skewY, o.cx, o.cy).inverse())\r\n      }\r\n\r\n      matrix = matrix.skew(o.skewX, o.skewY, o.cx, o.cy)\r\n\r\n    // act on flip\r\n    } else if (o.flip) {\r\n      if(o.flip == 'x' || o.flip == 'y') {\r\n        o.offset = o.offset == null ? target.bbox()['c' + o.flip] : o.offset\r\n      } else {\r\n        if(o.offset == null) {\r\n          bbox = target.bbox()\r\n          o.flip = bbox.cx\r\n          o.offset = bbox.cy\r\n        } else {\r\n          o.flip = o.offset\r\n        }\r\n      }\r\n\r\n      matrix = new SVG.Matrix().flip(o.flip, o.offset)\r\n\r\n    // act on translate\r\n    } else if (o.x != null || o.y != null) {\r\n      if (relative) {\r\n        // relative\r\n        matrix = matrix.translate(o.x, o.y)\r\n      } else {\r\n        // absolute\r\n        if (o.x != null) matrix.e = o.x\r\n        if (o.y != null) matrix.f = o.y\r\n      }\r\n    }\r\n\r\n    return this.attr('transform', matrix)\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.FX, {\r\n  transform: function(o, relative) {\r\n    // get target in case of the fx module, otherwise reference this\r\n    var target = this.target()\r\n      , matrix, bbox\r\n\r\n    // act as a getter\r\n    if (typeof o !== 'object') {\r\n      // get current matrix\r\n      matrix = new SVG.Matrix(target).extract()\r\n\r\n      return typeof o === 'string' ? matrix[o] : matrix\r\n    }\r\n\r\n    // ensure relative flag\r\n    relative = !!relative || !!o.relative\r\n\r\n    // act on matrix\r\n    if (o.a != null) {\r\n      matrix = new SVG.Matrix(o)\r\n\r\n    // act on rotation\r\n    } else if (o.rotation != null) {\r\n      // ensure centre point\r\n      ensureCentre(o, target)\r\n\r\n      // apply transformation\r\n      matrix = new SVG.Rotate(o.rotation, o.cx, o.cy)\r\n\r\n    // act on scale\r\n    } else if (o.scale != null || o.scaleX != null || o.scaleY != null) {\r\n      // ensure centre point\r\n      ensureCentre(o, target)\r\n\r\n      // ensure scale values on both axes\r\n      o.scaleX = o.scale != null ? o.scale : o.scaleX != null ? o.scaleX : 1\r\n      o.scaleY = o.scale != null ? o.scale : o.scaleY != null ? o.scaleY : 1\r\n\r\n      matrix = new SVG.Scale(o.scaleX, o.scaleY, o.cx, o.cy)\r\n\r\n    // act on skew\r\n    } else if (o.skewX != null || o.skewY != null) {\r\n      // ensure centre point\r\n      ensureCentre(o, target)\r\n\r\n      // ensure skew values on both axes\r\n      o.skewX = o.skewX != null ? o.skewX : 0\r\n      o.skewY = o.skewY != null ? o.skewY : 0\r\n\r\n      matrix = new SVG.Skew(o.skewX, o.skewY, o.cx, o.cy)\r\n\r\n    // act on flip\r\n    } else if (o.flip) {\r\n      if(o.flip == 'x' || o.flip == 'y') {\r\n        o.offset = o.offset == null ? target.bbox()['c' + o.flip] : o.offset\r\n      } else {\r\n        if(o.offset == null) {\r\n          bbox = target.bbox()\r\n          o.flip = bbox.cx\r\n          o.offset = bbox.cy\r\n        } else {\r\n          o.flip = o.offset\r\n        }\r\n      }\r\n\r\n      matrix = new SVG.Matrix().flip(o.flip, o.offset)\r\n\r\n    // act on translate\r\n    } else if (o.x != null || o.y != null) {\r\n      matrix = new SVG.Translate(o.x, o.y)\r\n    }\r\n\r\n    if(!matrix) return this\r\n\r\n    matrix.relative = relative\r\n\r\n    this.last().transforms.push(matrix)\r\n\r\n    return this._callStart()\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Element, {\r\n  // Reset all transformations\r\n  untransform: function() {\r\n    return this.attr('transform', null)\r\n  },\r\n  // merge the whole transformation chain into one matrix and returns it\r\n  matrixify: function() {\r\n\r\n    var matrix = (this.attr('transform') || '')\r\n      // split transformations\r\n      .split(SVG.regex.transforms).slice(0,-1).map(function(str){\r\n        // generate key => value pairs\r\n        var kv = str.trim().split('(')\r\n        return [kv[0], kv[1].split(SVG.regex.delimiter).map(function(str){ return parseFloat(str) })]\r\n      })\r\n      // merge every transformation into one matrix\r\n      .reduce(function(matrix, transform){\r\n\r\n        if(transform[0] == 'matrix') return matrix.multiply(arrayToMatrix(transform[1]))\r\n        return matrix[transform[0]].apply(matrix, transform[1])\r\n\r\n      }, new SVG.Matrix())\r\n\r\n    return matrix\r\n  },\r\n  // add an element to another parent without changing the visual representation on the screen\r\n  toParent: function(parent) {\r\n    if(this == parent) return this\r\n    var ctm = this.screenCTM()\r\n    var pCtm = parent.screenCTM().inverse()\r\n\r\n    this.addTo(parent).untransform().transform(pCtm.multiply(ctm))\r\n\r\n    return this\r\n  },\r\n  // same as above with parent equals root-svg\r\n  toDoc: function() {\r\n    return this.toParent(this.doc())\r\n  }\r\n\r\n})\r\n\r\nSVG.Transformation = SVG.invent({\r\n\r\n  create: function(source, inversed){\r\n\r\n    if(arguments.length > 1 && typeof inversed != 'boolean'){\r\n      return this.constructor.call(this, [].slice.call(arguments))\r\n    }\r\n\r\n    if(Array.isArray(source)){\r\n      for(var i = 0, len = this.arguments.length; i < len; ++i){\r\n        this[this.arguments[i]] = source[i]\r\n      }\r\n    } else if(typeof source == 'object'){\r\n      for(var i = 0, len = this.arguments.length; i < len; ++i){\r\n        this[this.arguments[i]] = source[this.arguments[i]]\r\n      }\r\n    }\r\n\r\n    this.inversed = false\r\n\r\n    if(inversed === true){\r\n      this.inversed = true\r\n    }\r\n\r\n  }\r\n\r\n, extend: {\r\n\r\n    arguments: []\r\n  , method: ''\r\n\r\n  , at: function(pos){\r\n\r\n      var params = []\r\n\r\n      for(var i = 0, len = this.arguments.length; i < len; ++i){\r\n        params.push(this[this.arguments[i]])\r\n      }\r\n\r\n      var m = this._undo || new SVG.Matrix()\r\n\r\n      m = new SVG.Matrix().morph(SVG.Matrix.prototype[this.method].apply(m, params)).at(pos)\r\n\r\n      return this.inversed ? m.inverse() : m\r\n\r\n    }\r\n\r\n  , undo: function(o){\r\n      for(var i = 0, len = this.arguments.length; i < len; ++i){\r\n        o[this.arguments[i]] = typeof this[this.arguments[i]] == 'undefined' ? 0 : o[this.arguments[i]]\r\n      }\r\n\r\n      // The method SVG.Matrix.extract which was used before calling this\r\n      // method to obtain a value for the parameter o doesn't return a cx and\r\n      // a cy so we use the ones that were provided to this object at its creation\r\n      o.cx = this.cx\r\n      o.cy = this.cy\r\n\r\n      this._undo = new SVG[capitalize(this.method)](o, true).at(1)\r\n\r\n      return this\r\n    }\r\n\r\n  }\r\n\r\n})\r\n\r\nSVG.Translate = SVG.invent({\r\n\r\n  parent: SVG.Matrix\r\n, inherit: SVG.Transformation\r\n\r\n, create: function(source, inversed){\r\n    this.constructor.apply(this, [].slice.call(arguments))\r\n  }\r\n\r\n, extend: {\r\n    arguments: ['transformedX', 'transformedY']\r\n  , method: 'translate'\r\n  }\r\n\r\n})\r\n\r\nSVG.Rotate = SVG.invent({\r\n\r\n  parent: SVG.Matrix\r\n, inherit: SVG.Transformation\r\n\r\n, create: function(source, inversed){\r\n    this.constructor.apply(this, [].slice.call(arguments))\r\n  }\r\n\r\n, extend: {\r\n    arguments: ['rotation', 'cx', 'cy']\r\n  , method: 'rotate'\r\n  , at: function(pos){\r\n      var m = new SVG.Matrix().rotate(new SVG.Number().morph(this.rotation - (this._undo ? this._undo.rotation : 0)).at(pos), this.cx, this.cy)\r\n      return this.inversed ? m.inverse() : m\r\n    }\r\n  , undo: function(o){\r\n      this._undo = o\r\n      return this\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.Scale = SVG.invent({\r\n\r\n  parent: SVG.Matrix\r\n, inherit: SVG.Transformation\r\n\r\n, create: function(source, inversed){\r\n    this.constructor.apply(this, [].slice.call(arguments))\r\n  }\r\n\r\n, extend: {\r\n    arguments: ['scaleX', 'scaleY', 'cx', 'cy']\r\n  , method: 'scale'\r\n  }\r\n\r\n})\r\n\r\nSVG.Skew = SVG.invent({\r\n\r\n  parent: SVG.Matrix\r\n, inherit: SVG.Transformation\r\n\r\n, create: function(source, inversed){\r\n    this.constructor.apply(this, [].slice.call(arguments))\r\n  }\r\n\r\n, extend: {\r\n    arguments: ['skewX', 'skewY', 'cx', 'cy']\r\n  , method: 'skew'\r\n  }\r\n\r\n})\r\n\nSVG.extend(SVG.Element, {\r\n  // Dynamic style generator\r\n  style: function(s, v) {\r\n    if (arguments.length == 0) {\r\n      // get full style\r\n      return this.node.style.cssText || ''\r\n\r\n    } else if (arguments.length < 2) {\r\n      // apply every style individually if an object is passed\r\n      if (typeof s == 'object') {\r\n        for (v in s) this.style(v, s[v])\r\n\r\n      } else if (SVG.regex.isCss.test(s)) {\r\n        // parse css string\r\n        s = s.split(/\\s*;\\s*/)\r\n          // filter out suffix ; and stuff like ;;\r\n          .filter(function(e) { return !!e })\r\n          .map(function(e){ return e.split(/\\s*:\\s*/) })\r\n\r\n        // apply every definition individually\r\n        while (v = s.pop()) {\r\n          this.style(v[0], v[1])\r\n        }\r\n      } else {\r\n        // act as a getter if the first and only argument is not an object\r\n        return this.node.style[camelCase(s)]\r\n      }\r\n\r\n    } else {\r\n      this.node.style[camelCase(s)] = v === null || SVG.regex.isBlank.test(v) ? '' : v\r\n    }\r\n\r\n    return this\r\n  }\r\n})\nSVG.Parent = SVG.invent({\r\n  // Initialize node\r\n  create: function(element) {\r\n    this.constructor.call(this, element)\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Element\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Returns all child elements\r\n    children: function() {\r\n      return SVG.utils.map(SVG.utils.filterSVGElements(this.node.childNodes), function(node) {\r\n        return SVG.adopt(node)\r\n      })\r\n    }\r\n    // Add given element at a position\r\n  , add: function(element, i) {\r\n      if (i == null)\r\n        this.node.appendChild(element.node)\r\n      else if (element.node != this.node.childNodes[i])\r\n        this.node.insertBefore(element.node, this.node.childNodes[i])\r\n\r\n      return this\r\n    }\r\n    // Basically does the same as `add()` but returns the added element instead\r\n  , put: function(element, i) {\r\n      this.add(element, i)\r\n      return element\r\n    }\r\n    // Checks if the given element is a child\r\n  , has: function(element) {\r\n      return this.index(element) >= 0\r\n    }\r\n    // Gets index of given element\r\n  , index: function(element) {\r\n      return [].slice.call(this.node.childNodes).indexOf(element.node)\r\n    }\r\n    // Get a element at the given index\r\n  , get: function(i) {\r\n      return SVG.adopt(this.node.childNodes[i])\r\n    }\r\n    // Get first child\r\n  , first: function() {\r\n      return this.get(0)\r\n    }\r\n    // Get the last child\r\n  , last: function() {\r\n      return this.get(this.node.childNodes.length - 1)\r\n    }\r\n    // Iterates over all children and invokes a given block\r\n  , each: function(block, deep) {\r\n      var i, il\r\n        , children = this.children()\r\n\r\n      for (i = 0, il = children.length; i < il; i++) {\r\n        if (children[i] instanceof SVG.Element)\r\n          block.apply(children[i], [i, children])\r\n\r\n        if (deep && (children[i] instanceof SVG.Container))\r\n          children[i].each(block, deep)\r\n      }\r\n\r\n      return this\r\n    }\r\n    // Remove a given child\r\n  , removeElement: function(element) {\r\n      this.node.removeChild(element.node)\r\n\r\n      return this\r\n    }\r\n    // Remove all elements in this container\r\n  , clear: function() {\r\n      // remove children\r\n      while(this.node.hasChildNodes())\r\n        this.node.removeChild(this.node.lastChild)\r\n\r\n      // remove defs reference\r\n      delete this._defs\r\n\r\n      return this\r\n    }\r\n  , // Get defs\r\n    defs: function() {\r\n      return this.doc().defs()\r\n    }\r\n  }\r\n\r\n})\r\n\nSVG.extend(SVG.Parent, {\r\n\r\n  ungroup: function(parent, depth) {\r\n    if(depth === 0 || this instanceof SVG.Defs || this.node == SVG.parser.draw) return this\r\n\r\n    parent = parent || (this instanceof SVG.Doc ? this : this.parent(SVG.Parent))\r\n    depth = depth || Infinity\r\n\r\n    this.each(function(){\r\n      if(this instanceof SVG.Defs) return this\r\n      if(this instanceof SVG.Parent) return this.ungroup(parent, depth-1)\r\n      return this.toParent(parent)\r\n    })\r\n\r\n    this.node.firstChild || this.remove()\r\n\r\n    return this\r\n  },\r\n\r\n  flatten: function(parent, depth) {\r\n    return this.ungroup(parent, depth)\r\n  }\r\n\r\n})\nSVG.Container = SVG.invent({\r\n  // Initialize node\r\n  create: function(element) {\r\n    this.constructor.call(this, element)\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Parent\r\n\r\n})\n\r\nSVG.ViewBox = SVG.invent({\r\n\r\n  create: function(source) {\r\n    var i, base = [0, 0, 0, 0]\r\n\r\n    var x, y, width, height, box, view, we, he\r\n      , wm   = 1 // width multiplier\r\n      , hm   = 1 // height multiplier\r\n      , reg  = /[+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:e[+-]?\\d+)?/gi\r\n\r\n    if(source instanceof SVG.Element){\r\n\r\n      we = source\r\n      he = source\r\n      view = (source.attr('viewBox') || '').match(reg)\r\n      box = source.bbox\r\n\r\n      // get dimensions of current node\r\n      width  = new SVG.Number(source.width())\r\n      height = new SVG.Number(source.height())\r\n\r\n      // find nearest non-percentual dimensions\r\n      while (width.unit == '%') {\r\n        wm *= width.value\r\n        width = new SVG.Number(we instanceof SVG.Doc ? we.parent().offsetWidth : we.parent().width())\r\n        we = we.parent()\r\n      }\r\n      while (height.unit == '%') {\r\n        hm *= height.value\r\n        height = new SVG.Number(he instanceof SVG.Doc ? he.parent().offsetHeight : he.parent().height())\r\n        he = he.parent()\r\n      }\r\n\r\n      // ensure defaults\r\n      this.x      = 0\r\n      this.y      = 0\r\n      this.width  = width  * wm\r\n      this.height = height * hm\r\n      this.zoom   = 1\r\n\r\n      if (view) {\r\n        // get width and height from viewbox\r\n        x      = parseFloat(view[0])\r\n        y      = parseFloat(view[1])\r\n        width  = parseFloat(view[2])\r\n        height = parseFloat(view[3])\r\n\r\n        // calculate zoom accoring to viewbox\r\n        this.zoom = ((this.width / this.height) > (width / height)) ?\r\n          this.height / height :\r\n          this.width  / width\r\n\r\n        // calculate real pixel dimensions on parent SVG.Doc element\r\n        this.x      = x\r\n        this.y      = y\r\n        this.width  = width\r\n        this.height = height\r\n\r\n      }\r\n\r\n    }else{\r\n\r\n      // ensure source as object\r\n      source = typeof source === 'string' ?\r\n        source.match(reg).map(function(el){ return parseFloat(el) }) :\r\n      Array.isArray(source) ?\r\n        source :\r\n      typeof source == 'object' ?\r\n        [source.x, source.y, source.width, source.height] :\r\n      arguments.length == 4 ?\r\n        [].slice.call(arguments) :\r\n        base\r\n\r\n      this.x = source[0]\r\n      this.y = source[1]\r\n      this.width = source[2]\r\n      this.height = source[3]\r\n    }\r\n\r\n\r\n  }\r\n\r\n, extend: {\r\n\r\n    toString: function() {\r\n      return this.x + ' ' + this.y + ' ' + this.width + ' ' + this.height\r\n    }\r\n  , morph: function(x, y, width, height){\r\n      this.destination = new SVG.ViewBox(x, y, width, height)\r\n      return this\r\n    }\r\n\r\n  , at: function(pos) {\r\n\r\n      if(!this.destination) return this\r\n\r\n      return new SVG.ViewBox([\r\n          this.x + (this.destination.x - this.x) * pos\r\n        , this.y + (this.destination.y - this.y) * pos\r\n        , this.width + (this.destination.width - this.width) * pos\r\n        , this.height + (this.destination.height - this.height) * pos\r\n      ])\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Define parent\r\n, parent: SVG.Container\r\n\r\n  // Add parent method\r\n, construct: {\r\n\r\n    // get/set viewbox\r\n    viewbox: function(x, y, width, height) {\r\n      if (arguments.length == 0)\r\n        // act as a getter if there are no arguments\r\n        return new SVG.ViewBox(this)\r\n\r\n      // otherwise act as a setter\r\n      return this.attr('viewBox', new SVG.ViewBox(x, y, width, height))\r\n    }\r\n\r\n  }\r\n\r\n})\n// Add events to elements\r\n\r\n;[ 'click',\r\n  'dblclick',\r\n  'mousedown',\r\n  'mouseup',\r\n  'mouseover',\r\n  'mouseout',\r\n  'mousemove',\r\n  'mouseenter',\r\n  'mouseleave',\r\n  'touchstart',\r\n  'touchmove',\r\n  'touchleave',\r\n  'touchend',\r\n  'touchcancel' ].forEach(function (event) {\r\n    // add event to SVG.Element\r\n    SVG.Element.prototype[event] = function (f) {\r\n      // bind event to element rather than element node\r\n      if (f == null) {\r\n        SVG.off(this, event)\r\n      } else {\r\n        SVG.on(this, event, f)\r\n      }\r\n      return this\r\n    }\r\n  })\r\n\r\nSVG.listenerId = 0\r\n\r\n// Add event binder in the SVG namespace\r\nSVG.on = function (node, events, listener, binding, options) {\r\n  var l = listener.bind(binding || node)\r\n  var n = node instanceof SVG.Element ? node.node : node\r\n\r\n  // ensure instance object for nodes which are not adopted\r\n  n.instance = n.instance || {_events: {}}\r\n\r\n  var bag = n.instance._events\r\n\r\n  // add id to listener\r\n  if (!listener._svgjsListenerId) { listener._svgjsListenerId = ++SVG.listenerId }\r\n\r\n  events.split(SVG.regex.delimiter).forEach(function (event) {\r\n    var ev = event.split('.')[0]\r\n    var ns = event.split('.')[1] || '*'\r\n\r\n    // ensure valid object\r\n    bag[ev] = bag[ev] || {}\r\n    bag[ev][ns] = bag[ev][ns] || {}\r\n\r\n    // reference listener\r\n    bag[ev][ns][listener._svgjsListenerId] = l\r\n\r\n    // add listener\r\n    n.addEventListener(ev, l, options || false)\r\n  })\r\n}\r\n\r\n// Add event unbinder in the SVG namespace\r\nSVG.off = function (node, events, listener, options) {\r\n  var n = node instanceof SVG.Element ? node.node : node\r\n  if (!n.instance) return\r\n\r\n  // listener can be a function or a number\r\n  if (typeof listener === 'function') {\r\n    listener = listener._svgjsListenerId\r\n    if (!listener) return\r\n  }\r\n\r\n  var bag = n.instance._events\r\n\r\n  ;(events || '').split(SVG.regex.delimiter).forEach(function (event) {\r\n    var ev = event && event.split('.')[0]\r\n    var ns = event && event.split('.')[1]\r\n    var namespace, l\r\n\r\n    if (listener) {\r\n      // remove listener reference\r\n      if (bag[ev] && bag[ev][ns || '*']) {\r\n        // removeListener\r\n        n.removeEventListener(ev, bag[ev][ns || '*'][listener], options || false)\r\n\r\n        delete bag[ev][ns || '*'][listener]\r\n      }\r\n    } else if (ev && ns) {\r\n      // remove all listeners for a namespaced event\r\n      if (bag[ev] && bag[ev][ns]) {\r\n        for (l in bag[ev][ns]) { SVG.off(n, [ev, ns].join('.'), l) }\r\n\r\n        delete bag[ev][ns]\r\n      }\r\n    } else if (ns) {\r\n      // remove all listeners for a specific namespace\r\n      for (event in bag) {\r\n        for (namespace in bag[event]) {\r\n          if (ns === namespace) { SVG.off(n, [event, ns].join('.')) }\r\n        }\r\n      }\r\n    } else if (ev) {\r\n      // remove all listeners for the event\r\n      if (bag[ev]) {\r\n        for (namespace in bag[ev]) { SVG.off(n, [ev, namespace].join('.')) }\r\n\r\n        delete bag[ev]\r\n      }\r\n    } else {\r\n      // remove all listeners on a given node\r\n      for (event in bag) { SVG.off(n, event) }\r\n\r\n      n.instance._events = {}\r\n    }\r\n  })\r\n}\r\n\r\nSVG.extend(SVG.Element, {\r\n  // Bind given event to listener\r\n  on: function (event, listener, binding, options) {\r\n    SVG.on(this, event, listener, binding, options)\r\n    return this\r\n  },\r\n  // Unbind event from listener\r\n  off: function (event, listener) {\r\n    SVG.off(this.node, event, listener)\r\n    return this\r\n  },\r\n  fire: function (event, data) {\r\n    // Dispatch event\r\n    if (event instanceof window.Event) {\r\n      this.node.dispatchEvent(event)\r\n    } else {\r\n      this.node.dispatchEvent(event = new SVG.CustomEvent(event, {detail: data, cancelable: true}))\r\n    }\r\n    this._event = event\r\n    return this\r\n  },\r\n  event: function() {\r\n    return this._event\r\n  }\r\n})\r\n\n\r\nSVG.Defs = SVG.invent({\r\n  // Initialize node\r\n  create: 'defs'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n})\nSVG.G = SVG.invent({\r\n  // Initialize node\r\n  create: 'g'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Move over x-axis\r\n    x: function(x) {\r\n      return x == null ? this.transform('x') : this.transform({ x: x - this.x() }, true)\r\n    }\r\n    // Move over y-axis\r\n  , y: function(y) {\r\n      return y == null ? this.transform('y') : this.transform({ y: y - this.y() }, true)\r\n    }\r\n    // Move by center over x-axis\r\n  , cx: function(x) {\r\n      return x == null ? this.gbox().cx : this.x(x - this.gbox().width / 2)\r\n    }\r\n    // Move by center over y-axis\r\n  , cy: function(y) {\r\n      return y == null ? this.gbox().cy : this.y(y - this.gbox().height / 2)\r\n    }\r\n  , gbox: function() {\r\n\r\n      var bbox  = this.bbox()\r\n        , trans = this.transform()\r\n\r\n      bbox.x  += trans.x\r\n      bbox.x2 += trans.x\r\n      bbox.cx += trans.x\r\n\r\n      bbox.y  += trans.y\r\n      bbox.y2 += trans.y\r\n      bbox.cy += trans.y\r\n\r\n      return bbox\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a group element\r\n    group: function() {\r\n      return this.put(new SVG.G)\r\n    }\r\n  }\r\n})\r\n\nSVG.Doc = SVG.invent({\r\n  // Initialize node\r\n  create: function(element) {\r\n    if (element) {\r\n      // ensure the presence of a dom element\r\n      element = typeof element == 'string' ?\r\n        document.getElementById(element) :\r\n        element\r\n\r\n      // If the target is an svg element, use that element as the main wrapper.\r\n      // This allows svg.js to work with svg documents as well.\r\n      if (element.nodeName == 'svg') {\r\n        this.constructor.call(this, element)\r\n      } else {\r\n        this.constructor.call(this, SVG.create('svg'))\r\n        element.appendChild(this.node)\r\n        this.size('100%', '100%')\r\n      }\r\n\r\n      // set svg element attributes and ensure defs node\r\n      this.namespace().defs()\r\n    }\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Add namespaces\r\n    namespace: function() {\r\n      return this\r\n        .attr({ xmlns: SVG.ns, version: '1.1' })\r\n        .attr('xmlns:xlink', SVG.xlink, SVG.xmlns)\r\n        .attr('xmlns:svgjs', SVG.svgjs, SVG.xmlns)\r\n    }\r\n    // Creates and returns defs element\r\n  , defs: function() {\r\n      if (!this._defs) {\r\n        var defs\r\n\r\n        // Find or create a defs element in this instance\r\n        if (defs = this.node.getElementsByTagName('defs')[0])\r\n          this._defs = SVG.adopt(defs)\r\n        else\r\n          this._defs = new SVG.Defs\r\n\r\n        // Make sure the defs node is at the end of the stack\r\n        this.node.appendChild(this._defs.node)\r\n      }\r\n\r\n      return this._defs\r\n    }\r\n    // custom parent method\r\n  , parent: function() {\r\n      if(!this.node.parentNode || this.node.parentNode.nodeName == '#document' || this.node.parentNode.nodeName == '#document-fragment') return null\r\n      return this.node.parentNode\r\n    }\r\n    // Fix for possible sub-pixel offset. See:\r\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=608812\r\n  , spof: function() {\r\n      var pos = this.node.getScreenCTM()\r\n\r\n      if (pos)\r\n        this\r\n          .style('left', (-pos.e % 1) + 'px')\r\n          .style('top',  (-pos.f % 1) + 'px')\r\n\r\n      return this\r\n    }\r\n\r\n      // Removes the doc from the DOM\r\n  , remove: function() {\r\n      if(this.parent()) {\r\n        this.parent().removeChild(this.node)\r\n      }\r\n\r\n      return this\r\n    }\r\n  , clear: function() {\r\n      // remove children\r\n      while(this.node.hasChildNodes())\r\n        this.node.removeChild(this.node.lastChild)\r\n\r\n      // remove defs reference\r\n      delete this._defs\r\n\r\n      // add back parser\r\n      if(!SVG.parser.draw.parentNode)\r\n        this.node.appendChild(SVG.parser.draw)\r\n\r\n      return this\r\n    }\r\n  , clone: function (parent) {\r\n      // write dom data to the dom so the clone can pickup the data\r\n      this.writeDataToDom()\r\n\r\n      // get reference to node\r\n      var node = this.node\r\n\r\n      // clone element and assign new id\r\n      var clone = assignNewId(node.cloneNode(true))\r\n\r\n      // insert the clone in the given parent or after myself\r\n      if(parent) {\r\n        (parent.node || parent).appendChild(clone.node)\r\n      } else {\r\n        node.parentNode.insertBefore(clone.node, node.nextSibling)\r\n      }\r\n\r\n      return clone\r\n    }\r\n  }\r\n\r\n})\r\n\n// ### This module adds backward / forward functionality to elements.\r\n\r\n//\r\nSVG.extend(SVG.Element, {\r\n  // Get all siblings, including myself\r\n  siblings: function() {\r\n    return this.parent().children()\r\n  }\r\n  // Get the curent position siblings\r\n, position: function() {\r\n    return this.parent().index(this)\r\n  }\r\n  // Get the next element (will return null if there is none)\r\n, next: function() {\r\n    return this.siblings()[this.position() + 1]\r\n  }\r\n  // Get the next element (will return null if there is none)\r\n, previous: function() {\r\n    return this.siblings()[this.position() - 1]\r\n  }\r\n  // Send given element one step forward\r\n, forward: function() {\r\n    var i = this.position() + 1\r\n      , p = this.parent()\r\n\r\n    // move node one step forward\r\n    p.removeElement(this).add(this, i)\r\n\r\n    // make sure defs node is always at the top\r\n    if (p instanceof SVG.Doc)\r\n      p.node.appendChild(p.defs().node)\r\n\r\n    return this\r\n  }\r\n  // Send given element one step backward\r\n, backward: function() {\r\n    var i = this.position()\r\n\r\n    if (i > 0)\r\n      this.parent().removeElement(this).add(this, i - 1)\r\n\r\n    return this\r\n  }\r\n  // Send given element all the way to the front\r\n, front: function() {\r\n    var p = this.parent()\r\n\r\n    // Move node forward\r\n    p.node.appendChild(this.node)\r\n\r\n    // Make sure defs node is always at the top\r\n    if (p instanceof SVG.Doc)\r\n      p.node.appendChild(p.defs().node)\r\n\r\n    return this\r\n  }\r\n  // Send given element all the way to the back\r\n, back: function() {\r\n    if (this.position() > 0)\r\n      this.parent().removeElement(this).add(this, 0)\r\n\r\n    return this\r\n  }\r\n  // Inserts a given element before the targeted element\r\n, before: function(element) {\r\n    element.remove()\r\n\r\n    var i = this.position()\r\n\r\n    this.parent().add(element, i)\r\n\r\n    return this\r\n  }\r\n  // Insters a given element after the targeted element\r\n, after: function(element) {\r\n    element.remove()\r\n\r\n    var i = this.position()\r\n\r\n    this.parent().add(element, i + 1)\r\n\r\n    return this\r\n  }\r\n\r\n})\nSVG.Mask = SVG.invent({\r\n  // Initialize node\r\n  create: function() {\r\n    this.constructor.call(this, SVG.create('mask'))\r\n\r\n    // keep references to masked elements\r\n    this.targets = []\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Unmask all masked elements and remove itself\r\n    remove: function() {\r\n      // unmask all targets\r\n      for (var i = this.targets.length - 1; i >= 0; i--)\r\n        if (this.targets[i])\r\n          this.targets[i].unmask()\r\n      this.targets = []\r\n\r\n      // remove mask from parent\r\n      SVG.Element.prototype.remove.call(this)\r\n\r\n      return this\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create masking element\r\n    mask: function() {\r\n      return this.defs().put(new SVG.Mask)\r\n    }\r\n  }\r\n})\r\n\r\n\r\nSVG.extend(SVG.Element, {\r\n  // Distribute mask to svg element\r\n  maskWith: function(element) {\r\n    // use given mask or create a new one\r\n    this.masker = element instanceof SVG.Mask ? element : this.parent().mask().add(element)\r\n\r\n    // store reverence on self in mask\r\n    this.masker.targets.push(this)\r\n\r\n    // apply mask\r\n    return this.attr('mask', 'url(\"#' + this.masker.attr('id') + '\")')\r\n  }\r\n  // Unmask element\r\n, unmask: function() {\r\n    delete this.masker\r\n    return this.attr('mask', null)\r\n  }\r\n\r\n})\r\n\nSVG.ClipPath = SVG.invent({\r\n  // Initialize node\r\n  create: function() {\r\n    this.constructor.call(this, SVG.create('clipPath'))\r\n\r\n    // keep references to clipped elements\r\n    this.targets = []\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Unclip all clipped elements and remove itself\r\n    remove: function() {\r\n      // unclip all targets\r\n      for (var i = this.targets.length - 1; i >= 0; i--)\r\n        if (this.targets[i])\r\n          this.targets[i].unclip()\r\n      this.targets = []\r\n\r\n      // remove clipPath from parent\r\n      this.parent().removeElement(this)\r\n\r\n      return this\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create clipping element\r\n    clip: function() {\r\n      return this.defs().put(new SVG.ClipPath)\r\n    }\r\n  }\r\n})\r\n\r\n//\r\nSVG.extend(SVG.Element, {\r\n  // Distribute clipPath to svg element\r\n  clipWith: function(element) {\r\n    // use given clip or create a new one\r\n    this.clipper = element instanceof SVG.ClipPath ? element : this.parent().clip().add(element)\r\n\r\n    // store reverence on self in mask\r\n    this.clipper.targets.push(this)\r\n\r\n    // apply mask\r\n    return this.attr('clip-path', 'url(\"#' + this.clipper.attr('id') + '\")')\r\n  }\r\n  // Unclip element\r\n, unclip: function() {\r\n    delete this.clipper\r\n    return this.attr('clip-path', null)\r\n  }\r\n\r\n})\nSVG.Gradient = SVG.invent({\r\n  // Initialize node\r\n  create: function(type) {\r\n    this.constructor.call(this, SVG.create(type + 'Gradient'))\r\n\r\n    // store type\r\n    this.type = type\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Add a color stop\r\n    at: function(offset, color, opacity) {\r\n      return this.put(new SVG.Stop).update(offset, color, opacity)\r\n    }\r\n    // Update gradient\r\n  , update: function(block) {\r\n      // remove all stops\r\n      this.clear()\r\n\r\n      // invoke passed block\r\n      if (typeof block == 'function')\r\n        block.call(this, this)\r\n\r\n      return this\r\n    }\r\n    // Return the fill id\r\n  , fill: function() {\r\n      return 'url(#' + this.id() + ')'\r\n    }\r\n    // Alias string convertion to fill\r\n  , toString: function() {\r\n      return this.fill()\r\n    }\r\n    // custom attr to handle transform\r\n  , attr: function(a, b, c) {\r\n      if(a == 'transform') a = 'gradientTransform'\r\n      return SVG.Container.prototype.attr.call(this, a, b, c)\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create gradient element in defs\r\n    gradient: function(type, block) {\r\n      return this.defs().gradient(type, block)\r\n    }\r\n  }\r\n})\r\n\r\n// Add animatable methods to both gradient and fx module\r\nSVG.extend(SVG.Gradient, SVG.FX, {\r\n  // From position\r\n  from: function(x, y) {\r\n    return (this._target || this).type == 'radial' ?\r\n      this.attr({ fx: new SVG.Number(x), fy: new SVG.Number(y) }) :\r\n      this.attr({ x1: new SVG.Number(x), y1: new SVG.Number(y) })\r\n  }\r\n  // To position\r\n, to: function(x, y) {\r\n    return (this._target || this).type == 'radial' ?\r\n      this.attr({ cx: new SVG.Number(x), cy: new SVG.Number(y) }) :\r\n      this.attr({ x2: new SVG.Number(x), y2: new SVG.Number(y) })\r\n  }\r\n})\r\n\r\n// Base gradient generation\r\nSVG.extend(SVG.Defs, {\r\n  // define gradient\r\n  gradient: function(type, block) {\r\n    return this.put(new SVG.Gradient(type)).update(block)\r\n  }\r\n\r\n})\r\n\r\nSVG.Stop = SVG.invent({\r\n  // Initialize node\r\n  create: 'stop'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Element\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // add color stops\r\n    update: function(o) {\r\n      if (typeof o == 'number' || o instanceof SVG.Number) {\r\n        o = {\r\n          offset:  arguments[0]\r\n        , color:   arguments[1]\r\n        , opacity: arguments[2]\r\n        }\r\n      }\r\n\r\n      // set attributes\r\n      if (o.opacity != null) this.attr('stop-opacity', o.opacity)\r\n      if (o.color   != null) this.attr('stop-color', o.color)\r\n      if (o.offset  != null) this.attr('offset', new SVG.Number(o.offset))\r\n\r\n      return this\r\n    }\r\n  }\r\n\r\n})\r\n\nSVG.Pattern = SVG.invent({\r\n  // Initialize node\r\n  create: 'pattern'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Return the fill id\r\n    fill: function() {\r\n      return 'url(#' + this.id() + ')'\r\n    }\r\n    // Update pattern by rebuilding\r\n  , update: function(block) {\r\n      // remove content\r\n      this.clear()\r\n\r\n      // invoke passed block\r\n      if (typeof block == 'function')\r\n        block.call(this, this)\r\n\r\n      return this\r\n    }\r\n    // Alias string convertion to fill\r\n  , toString: function() {\r\n      return this.fill()\r\n    }\r\n    // custom attr to handle transform\r\n  , attr: function(a, b, c) {\r\n      if(a == 'transform') a = 'patternTransform'\r\n      return SVG.Container.prototype.attr.call(this, a, b, c)\r\n    }\r\n\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create pattern element in defs\r\n    pattern: function(width, height, block) {\r\n      return this.defs().pattern(width, height, block)\r\n    }\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Defs, {\r\n  // Define gradient\r\n  pattern: function(width, height, block) {\r\n    return this.put(new SVG.Pattern).update(block).attr({\r\n      x:            0\r\n    , y:            0\r\n    , width:        width\r\n    , height:       height\r\n    , patternUnits: 'userSpaceOnUse'\r\n    })\r\n  }\r\n\r\n})\nSVG.Shape = SVG.invent({\r\n  // Initialize node\r\n  create: function(element) {\r\n    this.constructor.call(this, element)\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Element\r\n\r\n})\n\r\nSVG.Bare = SVG.invent({\r\n  // Initialize\r\n  create: function(element, inherit) {\r\n    // construct element\r\n    this.constructor.call(this, SVG.create(element))\r\n\r\n    // inherit custom methods\r\n    if (inherit)\r\n      for (var method in inherit.prototype)\r\n        if (typeof inherit.prototype[method] === 'function')\r\n          this[method] = inherit.prototype[method]\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Element\r\n\r\n  // Add methods\r\n, extend: {\r\n    // Insert some plain text\r\n    words: function(text) {\r\n      // remove contents\r\n      while (this.node.hasChildNodes())\r\n        this.node.removeChild(this.node.lastChild)\r\n\r\n      // create text node\r\n      this.node.appendChild(document.createTextNode(text))\r\n\r\n      return this\r\n    }\r\n  }\r\n})\r\n\r\n\r\nSVG.extend(SVG.Parent, {\r\n  // Create an element that is not described by SVG.js\r\n  element: function(element, inherit) {\r\n    return this.put(new SVG.Bare(element, inherit))\r\n  }\r\n})\r\n\nSVG.Symbol = SVG.invent({\r\n  // Initialize node\r\n  create: 'symbol'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n, construct: {\r\n    // create symbol\r\n    symbol: function() {\r\n      return this.put(new SVG.Symbol)\r\n    }\r\n  }\r\n})\r\n\nSVG.Use = SVG.invent({\r\n  // Initialize node\r\n  create: 'use'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Use element as a reference\r\n    element: function(element, file) {\r\n      // Set lined element\r\n      return this.attr('href', (file || '') + '#' + element, SVG.xlink)\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a use element\r\n    use: function(element, file) {\r\n      return this.put(new SVG.Use).element(element, file)\r\n    }\r\n  }\r\n})\nSVG.Rect = SVG.invent({\r\n  // Initialize node\r\n  create: 'rect'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a rect element\r\n    rect: function(width, height) {\r\n      return this.put(new SVG.Rect()).size(width, height)\r\n    }\r\n  }\r\n})\nSVG.Circle = SVG.invent({\r\n  // Initialize node\r\n  create: 'circle'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create circle element, based on ellipse\r\n    circle: function(size) {\r\n      return this.put(new SVG.Circle).rx(new SVG.Number(size).divide(2)).move(0, 0)\r\n    }\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Circle, SVG.FX, {\r\n  // Radius x value\r\n  rx: function(rx) {\r\n    return this.attr('r', rx)\r\n  }\r\n  // Alias radius x value\r\n, ry: function(ry) {\r\n    return this.rx(ry)\r\n  }\r\n})\r\n\r\nSVG.Ellipse = SVG.invent({\r\n  // Initialize node\r\n  create: 'ellipse'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create an ellipse\r\n    ellipse: function(width, height) {\r\n      return this.put(new SVG.Ellipse).size(width, height).move(0, 0)\r\n    }\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Ellipse, SVG.Rect, SVG.FX, {\r\n  // Radius x value\r\n  rx: function(rx) {\r\n    return this.attr('rx', rx)\r\n  }\r\n  // Radius y value\r\n, ry: function(ry) {\r\n    return this.attr('ry', ry)\r\n  }\r\n})\r\n\r\n// Add common method\r\nSVG.extend(SVG.Circle, SVG.Ellipse, {\r\n    // Move over x-axis\r\n    x: function(x) {\r\n      return x == null ? this.cx() - this.rx() : this.cx(x + this.rx())\r\n    }\r\n    // Move over y-axis\r\n  , y: function(y) {\r\n      return y == null ? this.cy() - this.ry() : this.cy(y + this.ry())\r\n    }\r\n    // Move by center over x-axis\r\n  , cx: function(x) {\r\n      return x == null ? this.attr('cx') : this.attr('cx', x)\r\n    }\r\n    // Move by center over y-axis\r\n  , cy: function(y) {\r\n      return y == null ? this.attr('cy') : this.attr('cy', y)\r\n    }\r\n    // Set width of element\r\n  , width: function(width) {\r\n      return width == null ? this.rx() * 2 : this.rx(new SVG.Number(width).divide(2))\r\n    }\r\n    // Set height of element\r\n  , height: function(height) {\r\n      return height == null ? this.ry() * 2 : this.ry(new SVG.Number(height).divide(2))\r\n    }\r\n    // Custom size function\r\n  , size: function(width, height) {\r\n      var p = proportionalSize(this, width, height)\r\n\r\n      return this\r\n        .rx(new SVG.Number(p.width).divide(2))\r\n        .ry(new SVG.Number(p.height).divide(2))\r\n    }\r\n})\nSVG.Line = SVG.invent({\r\n  // Initialize node\r\n  create: 'line'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Get array\r\n    array: function() {\r\n      return new SVG.PointArray([\r\n        [ this.attr('x1'), this.attr('y1') ]\r\n      , [ this.attr('x2'), this.attr('y2') ]\r\n      ])\r\n    }\r\n    // Overwrite native plot() method\r\n  , plot: function(x1, y1, x2, y2) {\r\n      if (x1 == null)\r\n        return this.array()\r\n      else if (typeof y1 !== 'undefined')\r\n        x1 = { x1: x1, y1: y1, x2: x2, y2: y2 }\r\n      else\r\n        x1 = new SVG.PointArray(x1).toLine()\r\n\r\n      return this.attr(x1)\r\n    }\r\n    // Move by left top corner\r\n  , move: function(x, y) {\r\n      return this.attr(this.array().move(x, y).toLine())\r\n    }\r\n    // Set element size to given width and height\r\n  , size: function(width, height) {\r\n      var p = proportionalSize(this, width, height)\r\n\r\n      return this.attr(this.array().size(p.width, p.height).toLine())\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a line element\r\n    line: function(x1, y1, x2, y2) {\r\n      // make sure plot is called as a setter\r\n      // x1 is not necessarily a number, it can also be an array, a string and a SVG.PointArray\r\n      return SVG.Line.prototype.plot.apply(\r\n        this.put(new SVG.Line)\r\n      , x1 != null ? [x1, y1, x2, y2] : [0, 0, 0, 0]\r\n      )\r\n    }\r\n  }\r\n})\r\n\nSVG.Polyline = SVG.invent({\r\n  // Initialize node\r\n  create: 'polyline'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a wrapped polyline element\r\n    polyline: function(p) {\r\n      // make sure plot is called as a setter\r\n      return this.put(new SVG.Polyline).plot(p || new SVG.PointArray)\r\n    }\r\n  }\r\n})\r\n\r\nSVG.Polygon = SVG.invent({\r\n  // Initialize node\r\n  create: 'polygon'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a wrapped polygon element\r\n    polygon: function(p) {\r\n      // make sure plot is called as a setter\r\n      return this.put(new SVG.Polygon).plot(p || new SVG.PointArray)\r\n    }\r\n  }\r\n})\r\n\r\n// Add polygon-specific functions\r\nSVG.extend(SVG.Polyline, SVG.Polygon, {\r\n  // Get array\r\n  array: function() {\r\n    return this._array || (this._array = new SVG.PointArray(this.attr('points')))\r\n  }\r\n  // Plot new path\r\n, plot: function(p) {\r\n    return (p == null) ?\r\n      this.array() :\r\n      this.clear().attr('points', typeof p == 'string' ? p : (this._array = new SVG.PointArray(p)))\r\n  }\r\n  // Clear array cache\r\n, clear: function() {\r\n    delete this._array\r\n    return this\r\n  }\r\n  // Move by left top corner\r\n, move: function(x, y) {\r\n    return this.attr('points', this.array().move(x, y))\r\n  }\r\n  // Set element size to given width and height\r\n, size: function(width, height) {\r\n    var p = proportionalSize(this, width, height)\r\n\r\n    return this.attr('points', this.array().size(p.width, p.height))\r\n  }\r\n\r\n})\r\n\n// unify all point to point elements\r\nSVG.extend(SVG.Line, SVG.Polyline, SVG.Polygon, {\r\n  // Define morphable array\r\n  morphArray:  SVG.PointArray\r\n  // Move by left top corner over x-axis\r\n, x: function(x) {\r\n    return x == null ? this.bbox().x : this.move(x, this.bbox().y)\r\n  }\r\n  // Move by left top corner over y-axis\r\n, y: function(y) {\r\n    return y == null ? this.bbox().y : this.move(this.bbox().x, y)\r\n  }\r\n  // Set width of element\r\n, width: function(width) {\r\n    var b = this.bbox()\r\n\r\n    return width == null ? b.width : this.size(width, b.height)\r\n  }\r\n  // Set height of element\r\n, height: function(height) {\r\n    var b = this.bbox()\r\n\r\n    return height == null ? b.height : this.size(b.width, height)\r\n  }\r\n})\nSVG.Path = SVG.invent({\r\n  // Initialize node\r\n  create: 'path'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Define morphable array\r\n    morphArray:  SVG.PathArray\r\n    // Get array\r\n  , array: function() {\r\n      return this._array || (this._array = new SVG.PathArray(this.attr('d')))\r\n    }\r\n    // Plot new path\r\n  , plot: function(d) {\r\n      return (d == null) ?\r\n        this.array() :\r\n        this.clear().attr('d', typeof d == 'string' ? d : (this._array = new SVG.PathArray(d)))\r\n    }\r\n    // Clear array cache\r\n  , clear: function() {\r\n      delete this._array\r\n      return this\r\n    }\r\n    // Move by left top corner\r\n  , move: function(x, y) {\r\n      return this.attr('d', this.array().move(x, y))\r\n    }\r\n    // Move by left top corner over x-axis\r\n  , x: function(x) {\r\n      return x == null ? this.bbox().x : this.move(x, this.bbox().y)\r\n    }\r\n    // Move by left top corner over y-axis\r\n  , y: function(y) {\r\n      return y == null ? this.bbox().y : this.move(this.bbox().x, y)\r\n    }\r\n    // Set element size to given width and height\r\n  , size: function(width, height) {\r\n      var p = proportionalSize(this, width, height)\r\n\r\n      return this.attr('d', this.array().size(p.width, p.height))\r\n    }\r\n    // Set width of element\r\n  , width: function(width) {\r\n      return width == null ? this.bbox().width : this.size(width, this.bbox().height)\r\n    }\r\n    // Set height of element\r\n  , height: function(height) {\r\n      return height == null ? this.bbox().height : this.size(this.bbox().width, height)\r\n    }\r\n\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a wrapped path element\r\n    path: function(d) {\r\n      // make sure plot is called as a setter\r\n      return this.put(new SVG.Path).plot(d || new SVG.PathArray)\r\n    }\r\n  }\r\n})\r\n\nSVG.Image = SVG.invent({\r\n  // Initialize node\r\n  create: 'image'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // (re)load image\r\n    load: function(url) {\r\n      if (!url) return this\r\n\r\n      var self = this\r\n        , img  = new window.Image()\r\n\r\n      // preload image\r\n      SVG.on(img, 'load', function() {\r\n        SVG.off(img)\r\n\r\n        var p = self.parent(SVG.Pattern)\r\n\r\n        if(p === null) return\r\n\r\n        // ensure image size\r\n        if (self.width() == 0 && self.height() == 0)\r\n          self.size(img.width, img.height)\r\n\r\n        // ensure pattern size if not set\r\n        if (p && p.width() == 0 && p.height() == 0)\r\n          p.size(self.width(), self.height())\r\n\r\n        // callback\r\n        if (typeof self._loaded === 'function')\r\n          self._loaded.call(self, {\r\n            width:  img.width\r\n          , height: img.height\r\n          , ratio:  img.width / img.height\r\n          , url:    url\r\n          })\r\n      })\r\n\r\n      SVG.on(img, 'error', function(e){\r\n        SVG.off(img)\r\n\r\n        if (typeof self._error === 'function'){\r\n            self._error.call(self, e)\r\n        }\r\n      })\r\n\r\n      return this.attr('href', (img.src = this.src = url), SVG.xlink)\r\n    }\r\n    // Add loaded callback\r\n  , loaded: function(loaded) {\r\n      this._loaded = loaded\r\n      return this\r\n    }\r\n\r\n  , error: function(error) {\r\n      this._error = error\r\n      return this\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // create image element, load image and set its size\r\n    image: function(source, width, height) {\r\n      return this.put(new SVG.Image).load(source).size(width || 0, height || width || 0)\r\n    }\r\n  }\r\n\r\n})\nSVG.Text = SVG.invent({\r\n  // Initialize node\r\n  create: function() {\r\n    this.constructor.call(this, SVG.create('text'))\r\n\r\n    this.dom.leading = new SVG.Number(1.3)    // store leading value for rebuilding\r\n    this._rebuild = true                      // enable automatic updating of dy values\r\n    this._build   = false                     // disable build mode for adding multiple lines\r\n\r\n    // set default font\r\n    this.attr('font-family', SVG.defaults.attrs['font-family'])\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Move over x-axis\r\n    x: function(x) {\r\n      // act as getter\r\n      if (x == null)\r\n        return this.attr('x')\r\n\r\n      return this.attr('x', x)\r\n    }\r\n    // Move over y-axis\r\n  , y: function(y) {\r\n      var oy = this.attr('y')\r\n        , o  = typeof oy === 'number' ? oy - this.bbox().y : 0\r\n\r\n      // act as getter\r\n      if (y == null)\r\n        return typeof oy === 'number' ? oy - o : oy\r\n\r\n      return this.attr('y', typeof y.valueOf() === 'number' ? y + o : y)\r\n    }\r\n    // Move center over x-axis\r\n  , cx: function(x) {\r\n      return x == null ? this.bbox().cx : this.x(x - this.bbox().width / 2)\r\n    }\r\n    // Move center over y-axis\r\n  , cy: function(y) {\r\n      return y == null ? this.bbox().cy : this.y(y - this.bbox().height / 2)\r\n    }\r\n    // Set the text content\r\n  , text: function(text) {\r\n      // act as getter\r\n      if (typeof text === 'undefined'){\r\n        var text = ''\r\n        var children = this.node.childNodes\r\n        for(var i = 0, len = children.length; i < len; ++i){\r\n\r\n          // add newline if its not the first child and newLined is set to true\r\n          if(i != 0 && children[i].nodeType != 3 && SVG.adopt(children[i]).dom.newLined == true){\r\n            text += '\\n'\r\n          }\r\n\r\n          // add content of this node\r\n          text += children[i].textContent\r\n        }\r\n\r\n        return text\r\n      }\r\n\r\n      // remove existing content\r\n      this.clear().build(true)\r\n\r\n      if (typeof text === 'function') {\r\n        // call block\r\n        text.call(this, this)\r\n\r\n      } else {\r\n        // store text and make sure text is not blank\r\n        text = text.split('\\n')\r\n\r\n        // build new lines\r\n        for (var i = 0, il = text.length; i < il; i++)\r\n          this.tspan(text[i]).newLine()\r\n      }\r\n\r\n      // disable build mode and rebuild lines\r\n      return this.build(false).rebuild()\r\n    }\r\n    // Set font size\r\n  , size: function(size) {\r\n      return this.attr('font-size', size).rebuild()\r\n    }\r\n    // Set / get leading\r\n  , leading: function(value) {\r\n      // act as getter\r\n      if (value == null)\r\n        return this.dom.leading\r\n\r\n      // act as setter\r\n      this.dom.leading = new SVG.Number(value)\r\n\r\n      return this.rebuild()\r\n    }\r\n    // Get all the first level lines\r\n  , lines: function() {\r\n      var node = (this.textPath && this.textPath() || this).node\r\n\r\n      // filter tspans and map them to SVG.js instances\r\n      var lines = SVG.utils.map(SVG.utils.filterSVGElements(node.childNodes), function(el){\r\n        return SVG.adopt(el)\r\n      })\r\n\r\n      // return an instance of SVG.set\r\n      return new SVG.Set(lines)\r\n    }\r\n    // Rebuild appearance type\r\n  , rebuild: function(rebuild) {\r\n      // store new rebuild flag if given\r\n      if (typeof rebuild == 'boolean')\r\n        this._rebuild = rebuild\r\n\r\n      // define position of all lines\r\n      if (this._rebuild) {\r\n        var self = this\r\n          , blankLineOffset = 0\r\n          , dy = this.dom.leading * new SVG.Number(this.attr('font-size'))\r\n\r\n        this.lines().each(function() {\r\n          if (this.dom.newLined) {\r\n            if (!self.textPath())\r\n              this.attr('x', self.attr('x'))\r\n            if(this.text() == '\\n') {\r\n              blankLineOffset += dy\r\n            }else{\r\n              this.attr('dy', dy + blankLineOffset)\r\n              blankLineOffset = 0\r\n            }\r\n          }\r\n        })\r\n\r\n        this.fire('rebuild')\r\n      }\r\n\r\n      return this\r\n    }\r\n    // Enable / disable build mode\r\n  , build: function(build) {\r\n      this._build = !!build\r\n      return this\r\n    }\r\n    // overwrite method from parent to set data properly\r\n  , setData: function(o){\r\n      this.dom = o\r\n      this.dom.leading = new SVG.Number(o.leading || 1.3)\r\n      return this\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create text element\r\n    text: function(text) {\r\n      return this.put(new SVG.Text).text(text)\r\n    }\r\n    // Create plain text element\r\n  , plain: function(text) {\r\n      return this.put(new SVG.Text).plain(text)\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.Tspan = SVG.invent({\r\n  // Initialize node\r\n  create: 'tspan'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Set text content\r\n    text: function(text) {\r\n      if(text == null) return this.node.textContent + (this.dom.newLined ? '\\n' : '')\r\n\r\n      typeof text === 'function' ? text.call(this, this) : this.plain(text)\r\n\r\n      return this\r\n    }\r\n    // Shortcut dx\r\n  , dx: function(dx) {\r\n      return this.attr('dx', dx)\r\n    }\r\n    // Shortcut dy\r\n  , dy: function(dy) {\r\n      return this.attr('dy', dy)\r\n    }\r\n    // Create new line\r\n  , newLine: function() {\r\n      // fetch text parent\r\n      var t = this.parent(SVG.Text)\r\n\r\n      // mark new line\r\n      this.dom.newLined = true\r\n\r\n      // apply new hy¡n\r\n      return this.dy(t.dom.leading * t.attr('font-size')).attr('x', t.x())\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.extend(SVG.Text, SVG.Tspan, {\r\n  // Create plain text node\r\n  plain: function(text) {\r\n    // clear if build mode is disabled\r\n    if (this._build === false)\r\n      this.clear()\r\n\r\n    // create text node\r\n    this.node.appendChild(document.createTextNode(text))\r\n\r\n    return this\r\n  }\r\n  // Create a tspan\r\n, tspan: function(text) {\r\n    var node  = (this.textPath && this.textPath() || this).node\r\n      , tspan = new SVG.Tspan\r\n\r\n    // clear if build mode is disabled\r\n    if (this._build === false)\r\n      this.clear()\r\n\r\n    // add new tspan\r\n    node.appendChild(tspan.node)\r\n\r\n    return tspan.text(text)\r\n  }\r\n  // Clear all lines\r\n, clear: function() {\r\n    var node = (this.textPath && this.textPath() || this).node\r\n\r\n    // remove existing child nodes\r\n    while (node.hasChildNodes())\r\n      node.removeChild(node.lastChild)\r\n\r\n    return this\r\n  }\r\n  // Get length of text element\r\n, length: function() {\r\n    return this.node.getComputedTextLength()\r\n  }\r\n})\r\n\nSVG.TextPath = SVG.invent({\r\n  // Initialize node\r\n  create: 'textPath'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Parent\r\n\r\n  // Define parent class\r\n, parent: SVG.Text\r\n\r\n  // Add parent method\r\n, construct: {\r\n    morphArray: SVG.PathArray\r\n    // Create path for text to run on\r\n  , path: function(d) {\r\n      // create textPath element\r\n      var path  = new SVG.TextPath\r\n        , track = this.doc().defs().path(d)\r\n\r\n      // move lines to textpath\r\n      while (this.node.hasChildNodes())\r\n        path.node.appendChild(this.node.firstChild)\r\n\r\n      // add textPath element as child node\r\n      this.node.appendChild(path.node)\r\n\r\n      // link textPath to path and add content\r\n      path.attr('href', '#' + track, SVG.xlink)\r\n\r\n      return this\r\n    }\r\n    // return the array of the path track element\r\n  , array: function() {\r\n      var track = this.track()\r\n\r\n      return track ? track.array() : null\r\n    }\r\n    // Plot path if any\r\n  , plot: function(d) {\r\n      var track = this.track()\r\n        , pathArray = null\r\n\r\n      if (track) {\r\n        pathArray = track.plot(d)\r\n      }\r\n\r\n      return (d == null) ? pathArray : this\r\n    }\r\n    // Get the path track element\r\n  , track: function() {\r\n      var path = this.textPath()\r\n\r\n      if (path)\r\n        return path.reference('href')\r\n    }\r\n    // Get the textPath child\r\n  , textPath: function() {\r\n      if (this.node.firstChild && this.node.firstChild.nodeName == 'textPath')\r\n        return SVG.adopt(this.node.firstChild)\r\n    }\r\n  }\r\n})\r\n\nSVG.Nested = SVG.invent({\r\n  // Initialize node\r\n  create: function() {\r\n    this.constructor.call(this, SVG.create('svg'))\r\n\r\n    this.style('overflow', 'visible')\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create nested svg document\r\n    nested: function() {\r\n      return this.put(new SVG.Nested)\r\n    }\r\n  }\r\n})\nSVG.A = SVG.invent({\r\n  // Initialize node\r\n  create: 'a'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Link url\r\n    to: function(url) {\r\n      return this.attr('href', url, SVG.xlink)\r\n    }\r\n    // Link show attribute\r\n  , show: function(target) {\r\n      return this.attr('show', target, SVG.xlink)\r\n    }\r\n    // Link target attribute\r\n  , target: function(target) {\r\n      return this.attr('target', target)\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a hyperlink element\r\n    link: function(url) {\r\n      return this.put(new SVG.A).to(url)\r\n    }\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Element, {\r\n  // Create a hyperlink element\r\n  linkTo: function(url) {\r\n    var link = new SVG.A\r\n\r\n    if (typeof url == 'function')\r\n      url.call(link, link)\r\n    else\r\n      link.to(url)\r\n\r\n    return this.parent().put(link).put(this)\r\n  }\r\n\r\n})\nSVG.Marker = SVG.invent({\r\n  // Initialize node\r\n  create: 'marker'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Set width of element\r\n    width: function(width) {\r\n      return this.attr('markerWidth', width)\r\n    }\r\n    // Set height of element\r\n  , height: function(height) {\r\n      return this.attr('markerHeight', height)\r\n    }\r\n    // Set marker refX and refY\r\n  , ref: function(x, y) {\r\n      return this.attr('refX', x).attr('refY', y)\r\n    }\r\n    // Update marker\r\n  , update: function(block) {\r\n      // remove all content\r\n      this.clear()\r\n\r\n      // invoke passed block\r\n      if (typeof block == 'function')\r\n        block.call(this, this)\r\n\r\n      return this\r\n    }\r\n    // Return the fill id\r\n  , toString: function() {\r\n      return 'url(#' + this.id() + ')'\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    marker: function(width, height, block) {\r\n      // Create marker element in defs\r\n      return this.defs().marker(width, height, block)\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.extend(SVG.Defs, {\r\n  // Create marker\r\n  marker: function(width, height, block) {\r\n    // Set default viewbox to match the width and height, set ref to cx and cy and set orient to auto\r\n    return this.put(new SVG.Marker)\r\n      .size(width, height)\r\n      .ref(width / 2, height / 2)\r\n      .viewbox(0, 0, width, height)\r\n      .attr('orient', 'auto')\r\n      .update(block)\r\n  }\r\n\r\n})\r\n\r\nSVG.extend(SVG.Line, SVG.Polyline, SVG.Polygon, SVG.Path, {\r\n  // Create and attach markers\r\n  marker: function(marker, width, height, block) {\r\n    var attr = ['marker']\r\n\r\n    // Build attribute name\r\n    if (marker != 'all') attr.push(marker)\r\n    attr = attr.join('-')\r\n\r\n    // Set marker attribute\r\n    marker = arguments[1] instanceof SVG.Marker ?\r\n      arguments[1] :\r\n      this.doc().marker(width, height, block)\r\n\r\n    return this.attr(attr, marker)\r\n  }\r\n\r\n})\n// Define list of available attributes for stroke and fill\r\nvar sugar = {\r\n  stroke: ['color', 'width', 'opacity', 'linecap', 'linejoin', 'miterlimit', 'dasharray', 'dashoffset']\r\n, fill:   ['color', 'opacity', 'rule']\r\n, prefix: function(t, a) {\r\n    return a == 'color' ? t : t + '-' + a\r\n  }\r\n}\r\n\r\n// Add sugar for fill and stroke\r\n;['fill', 'stroke'].forEach(function(m) {\r\n  var i, extension = {}\r\n\r\n  extension[m] = function(o) {\r\n    if (typeof o == 'undefined')\r\n      return this\r\n    if (typeof o == 'string' || SVG.Color.isRgb(o) || (o && typeof o.fill === 'function'))\r\n      this.attr(m, o)\r\n\r\n    else\r\n      // set all attributes from sugar.fill and sugar.stroke list\r\n      for (i = sugar[m].length - 1; i >= 0; i--)\r\n        if (o[sugar[m][i]] != null)\r\n          this.attr(sugar.prefix(m, sugar[m][i]), o[sugar[m][i]])\r\n\r\n    return this\r\n  }\r\n\r\n  SVG.extend(SVG.Element, SVG.FX, extension)\r\n\r\n})\r\n\r\nSVG.extend(SVG.Element, SVG.FX, {\r\n  // Map rotation to transform\r\n  rotate: function(d, cx, cy) {\r\n    return this.transform({ rotation: d, cx: cx, cy: cy })\r\n  }\r\n  // Map skew to transform\r\n, skew: function(x, y, cx, cy) {\r\n    return arguments.length == 1  || arguments.length == 3 ?\r\n      this.transform({ skew: x, cx: y, cy: cx }) :\r\n      this.transform({ skewX: x, skewY: y, cx: cx, cy: cy })\r\n  }\r\n  // Map scale to transform\r\n, scale: function(x, y, cx, cy) {\r\n    return arguments.length == 1  || arguments.length == 3 ?\r\n      this.transform({ scale: x, cx: y, cy: cx }) :\r\n      this.transform({ scaleX: x, scaleY: y, cx: cx, cy: cy })\r\n  }\r\n  // Map translate to transform\r\n, translate: function(x, y) {\r\n    return this.transform({ x: x, y: y })\r\n  }\r\n  // Map flip to transform\r\n, flip: function(a, o) {\r\n    o = typeof a == 'number' ? a : o\r\n    return this.transform({ flip: a || 'both', offset: o })\r\n  }\r\n  // Map matrix to transform\r\n, matrix: function(m) {\r\n    return this.attr('transform', new SVG.Matrix(arguments.length == 6 ? [].slice.call(arguments) : m))\r\n  }\r\n  // Opacity\r\n, opacity: function(value) {\r\n    return this.attr('opacity', value)\r\n  }\r\n  // Relative move over x axis\r\n, dx: function(x) {\r\n    return this.x(new SVG.Number(x).plus(this instanceof SVG.FX ? 0 : this.x()), true)\r\n  }\r\n  // Relative move over y axis\r\n, dy: function(y) {\r\n    return this.y(new SVG.Number(y).plus(this instanceof SVG.FX ? 0 : this.y()), true)\r\n  }\r\n  // Relative move over x and y axes\r\n, dmove: function(x, y) {\r\n    return this.dx(x).dy(y)\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Rect, SVG.Ellipse, SVG.Circle, SVG.Gradient, SVG.FX, {\r\n  // Add x and y radius\r\n  radius: function(x, y) {\r\n    var type = (this._target || this).type;\r\n    return type == 'radial' || type == 'circle' ?\r\n      this.attr('r', new SVG.Number(x)) :\r\n      this.rx(x).ry(y == null ? x : y)\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Path, {\r\n  // Get path length\r\n  length: function() {\r\n    return this.node.getTotalLength()\r\n  }\r\n  // Get point at length\r\n, pointAt: function(length) {\r\n    return this.node.getPointAtLength(length)\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Parent, SVG.Text, SVG.Tspan, SVG.FX, {\r\n  // Set font\r\n  font: function(a, v) {\r\n    if (typeof a == 'object') {\r\n      for (v in a) this.font(v, a[v])\r\n    }\r\n\r\n    return a == 'leading' ?\r\n        this.leading(v) :\r\n      a == 'anchor' ?\r\n        this.attr('text-anchor', v) :\r\n      a == 'size' || a == 'family' || a == 'weight' || a == 'stretch' || a == 'variant' || a == 'style' ?\r\n        this.attr('font-'+ a, v) :\r\n        this.attr(a, v)\r\n  }\r\n})\r\n\nSVG.Set = SVG.invent({\r\n  // Initialize\r\n  create: function(members) {\r\n    if (members instanceof SVG.Set) {\r\n      this.members = members.members.slice()\r\n    } else {\r\n      Array.isArray(members) ? this.members = members : this.clear()\r\n    }\r\n  }\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Add element to set\r\n    add: function() {\r\n      var i, il, elements = [].slice.call(arguments)\r\n\r\n      for (i = 0, il = elements.length; i < il; i++)\r\n        this.members.push(elements[i])\r\n\r\n      return this\r\n    }\r\n    // Remove element from set\r\n  , remove: function(element) {\r\n      var i = this.index(element)\r\n\r\n      // remove given child\r\n      if (i > -1)\r\n        this.members.splice(i, 1)\r\n\r\n      return this\r\n    }\r\n    // Iterate over all members\r\n  , each: function(block) {\r\n      for (var i = 0, il = this.members.length; i < il; i++)\r\n        block.apply(this.members[i], [i, this.members])\r\n\r\n      return this\r\n    }\r\n    // Restore to defaults\r\n  , clear: function() {\r\n      // initialize store\r\n      this.members = []\r\n\r\n      return this\r\n    }\r\n    // Get the length of a set\r\n  , length: function() {\r\n      return this.members.length\r\n    }\r\n    // Checks if a given element is present in set\r\n  , has: function(element) {\r\n      return this.index(element) >= 0\r\n    }\r\n    // retuns index of given element in set\r\n  , index: function(element) {\r\n      return this.members.indexOf(element)\r\n    }\r\n    // Get member at given index\r\n  , get: function(i) {\r\n      return this.members[i]\r\n    }\r\n    // Get first member\r\n  , first: function() {\r\n      return this.get(0)\r\n    }\r\n    // Get last member\r\n  , last: function() {\r\n      return this.get(this.members.length - 1)\r\n    }\r\n    // Default value\r\n  , valueOf: function() {\r\n      return this.members\r\n    }\r\n    // Get the bounding box of all members included or empty box if set has no items\r\n  , bbox: function(){\r\n      // return an empty box of there are no members\r\n      if (this.members.length == 0)\r\n        return new SVG.RBox()\r\n\r\n      // get the first rbox and update the target bbox\r\n      var rbox = this.members[0].rbox(this.members[0].doc())\r\n\r\n      this.each(function() {\r\n        // user rbox for correct position and visual representation\r\n        rbox = rbox.merge(this.rbox(this.doc()))\r\n      })\r\n\r\n      return rbox\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a new set\r\n    set: function(members) {\r\n      return new SVG.Set(members)\r\n    }\r\n  }\r\n})\r\n\r\nSVG.FX.Set = SVG.invent({\r\n  // Initialize node\r\n  create: function(set) {\r\n    // store reference to set\r\n    this.set = set\r\n  }\r\n\r\n})\r\n\r\n// Alias methods\r\nSVG.Set.inherit = function() {\r\n  var m\r\n    , methods = []\r\n\r\n  // gather shape methods\r\n  for(var m in SVG.Shape.prototype)\r\n    if (typeof SVG.Shape.prototype[m] == 'function' && typeof SVG.Set.prototype[m] != 'function')\r\n      methods.push(m)\r\n\r\n  // apply shape aliasses\r\n  methods.forEach(function(method) {\r\n    SVG.Set.prototype[method] = function() {\r\n      for (var i = 0, il = this.members.length; i < il; i++)\r\n        if (this.members[i] && typeof this.members[i][method] == 'function')\r\n          this.members[i][method].apply(this.members[i], arguments)\r\n\r\n      return method == 'animate' ? (this.fx || (this.fx = new SVG.FX.Set(this))) : this\r\n    }\r\n  })\r\n\r\n  // clear methods for the next round\r\n  methods = []\r\n\r\n  // gather fx methods\r\n  for(var m in SVG.FX.prototype)\r\n    if (typeof SVG.FX.prototype[m] == 'function' && typeof SVG.FX.Set.prototype[m] != 'function')\r\n      methods.push(m)\r\n\r\n  // apply fx aliasses\r\n  methods.forEach(function(method) {\r\n    SVG.FX.Set.prototype[method] = function() {\r\n      for (var i = 0, il = this.set.members.length; i < il; i++)\r\n        this.set.members[i].fx[method].apply(this.set.members[i].fx, arguments)\r\n\r\n      return this\r\n    }\r\n  })\r\n}\r\n\n\r\nSVG.extend(SVG.Element, {\r\n  // Store data values on svg nodes\r\n  data: function(a, v, r) {\r\n    if (typeof a == 'object') {\r\n      for (v in a)\r\n        this.data(v, a[v])\r\n\r\n    } else if (arguments.length < 2) {\r\n      try {\r\n        return JSON.parse(this.attr('data-' + a))\r\n      } catch(e) {\r\n        return this.attr('data-' + a)\r\n      }\r\n\r\n    } else {\r\n      this.attr(\r\n        'data-' + a\r\n      , v === null ?\r\n          null :\r\n        r === true || typeof v === 'string' || typeof v === 'number' ?\r\n          v :\r\n          JSON.stringify(v)\r\n      )\r\n    }\r\n\r\n    return this\r\n  }\r\n})\nSVG.extend(SVG.Element, {\r\n  // Remember arbitrary data\r\n  remember: function(k, v) {\r\n    // remember every item in an object individually\r\n    if (typeof arguments[0] == 'object')\r\n      for (var v in k)\r\n        this.remember(v, k[v])\r\n\r\n    // retrieve memory\r\n    else if (arguments.length == 1)\r\n      return this.memory()[k]\r\n\r\n    // store memory\r\n    else\r\n      this.memory()[k] = v\r\n\r\n    return this\r\n  }\r\n\r\n  // Erase a given memory\r\n, forget: function() {\r\n    if (arguments.length == 0)\r\n      this._memory = {}\r\n    else\r\n      for (var i = arguments.length - 1; i >= 0; i--)\r\n        delete this.memory()[arguments[i]]\r\n\r\n    return this\r\n  }\r\n\r\n  // Initialize or return local memory object\r\n, memory: function() {\r\n    return this._memory || (this._memory = {})\r\n  }\r\n\r\n})\n// Method for getting an element by id\r\nSVG.get = function(id) {\r\n  var node = document.getElementById(idFromReference(id) || id)\r\n  return SVG.adopt(node)\r\n}\r\n\r\n// Select elements by query string\r\nSVG.select = function(query, parent) {\r\n  return new SVG.Set(\r\n    SVG.utils.map((parent || document).querySelectorAll(query), function(node) {\r\n      return SVG.adopt(node)\r\n    })\r\n  )\r\n}\r\n\r\nSVG.extend(SVG.Parent, {\r\n  // Scoped select method\r\n  select: function(query) {\r\n    return SVG.select(query, this.node)\r\n  }\r\n\r\n})\nfunction pathRegReplace(a, b, c, d) {\r\n  return c + d.replace(SVG.regex.dots, ' .')\r\n}\r\n\r\n// creates deep clone of array\r\nfunction array_clone(arr){\r\n  var clone = arr.slice(0)\r\n  for(var i = clone.length; i--;){\r\n    if(Array.isArray(clone[i])){\r\n      clone[i] = array_clone(clone[i])\r\n    }\r\n  }\r\n  return clone\r\n}\r\n\r\n// tests if a given element is instance of an object\r\nfunction is(el, obj){\r\n  return el instanceof obj\r\n}\r\n\r\n// tests if a given selector matches an element\r\nfunction matches(el, selector) {\r\n  return (el.matches || el.matchesSelector || el.msMatchesSelector || el.mozMatchesSelector || el.webkitMatchesSelector || el.oMatchesSelector).call(el, selector);\r\n}\r\n\r\n// Convert dash-separated-string to camelCase\r\nfunction camelCase(s) {\r\n  return s.toLowerCase().replace(/-(.)/g, function(m, g) {\r\n    return g.toUpperCase()\r\n  })\r\n}\r\n\r\n// Capitalize first letter of a string\r\nfunction capitalize(s) {\r\n  return s.charAt(0).toUpperCase() + s.slice(1)\r\n}\r\n\r\n// Ensure to six-based hex\r\nfunction fullHex(hex) {\r\n  return hex.length == 4 ?\r\n    [ '#',\r\n      hex.substring(1, 2), hex.substring(1, 2)\r\n    , hex.substring(2, 3), hex.substring(2, 3)\r\n    , hex.substring(3, 4), hex.substring(3, 4)\r\n    ].join('') : hex\r\n}\r\n\r\n// Component to hex value\r\nfunction compToHex(comp) {\r\n  var hex = comp.toString(16)\r\n  return hex.length == 1 ? '0' + hex : hex\r\n}\r\n\r\n// Calculate proportional width and height values when necessary\r\nfunction proportionalSize(element, width, height) {\r\n  if (width == null || height == null) {\r\n    var box = element.bbox()\r\n\r\n    if (width == null)\r\n      width = box.width / box.height * height\r\n    else if (height == null)\r\n      height = box.height / box.width * width\r\n  }\r\n\r\n  return {\r\n    width:  width\r\n  , height: height\r\n  }\r\n}\r\n\r\n// Delta transform point\r\nfunction deltaTransformPoint(matrix, x, y) {\r\n  return {\r\n    x: x * matrix.a + y * matrix.c + 0\r\n  , y: x * matrix.b + y * matrix.d + 0\r\n  }\r\n}\r\n\r\n// Map matrix array to object\r\nfunction arrayToMatrix(a) {\r\n  return { a: a[0], b: a[1], c: a[2], d: a[3], e: a[4], f: a[5] }\r\n}\r\n\r\n// Parse matrix if required\r\nfunction parseMatrix(matrix) {\r\n  if (!(matrix instanceof SVG.Matrix))\r\n    matrix = new SVG.Matrix(matrix)\r\n\r\n  return matrix\r\n}\r\n\r\n// Add centre point to transform object\r\nfunction ensureCentre(o, target) {\r\n  o.cx = o.cx == null ? target.bbox().cx : o.cx\r\n  o.cy = o.cy == null ? target.bbox().cy : o.cy\r\n}\r\n\r\n// PathArray Helpers\r\nfunction arrayToString(a) {\r\n  for (var i = 0, il = a.length, s = ''; i < il; i++) {\r\n    s += a[i][0]\r\n\r\n    if (a[i][1] != null) {\r\n      s += a[i][1]\r\n\r\n      if (a[i][2] != null) {\r\n        s += ' '\r\n        s += a[i][2]\r\n\r\n        if (a[i][3] != null) {\r\n          s += ' '\r\n          s += a[i][3]\r\n          s += ' '\r\n          s += a[i][4]\r\n\r\n          if (a[i][5] != null) {\r\n            s += ' '\r\n            s += a[i][5]\r\n            s += ' '\r\n            s += a[i][6]\r\n\r\n            if (a[i][7] != null) {\r\n              s += ' '\r\n              s += a[i][7]\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return s + ' '\r\n}\r\n\r\n// Deep new id assignment\r\nfunction assignNewId(node) {\r\n  // do the same for SVG child nodes as well\r\n  for (var i = node.childNodes.length - 1; i >= 0; i--)\r\n    if (node.childNodes[i] instanceof window.SVGElement)\r\n      assignNewId(node.childNodes[i])\r\n\r\n  return SVG.adopt(node).id(SVG.eid(node.nodeName))\r\n}\r\n\r\n// Add more bounding box properties\r\nfunction fullBox(b) {\r\n  if (b.x == null) {\r\n    b.x      = 0\r\n    b.y      = 0\r\n    b.width  = 0\r\n    b.height = 0\r\n  }\r\n\r\n  b.w  = b.width\r\n  b.h  = b.height\r\n  b.x2 = b.x + b.width\r\n  b.y2 = b.y + b.height\r\n  b.cx = b.x + b.width / 2\r\n  b.cy = b.y + b.height / 2\r\n\r\n  return b\r\n}\r\n\r\n// Get id from reference string\r\nfunction idFromReference(url) {\r\n  var m = (url || '').toString().match(SVG.regex.reference)\r\n\r\n  if (m) return m[1]\r\n}\r\n\r\n// If values like 1e-88 are passed, this is not a valid 32 bit float,\r\n// but in those cases, we are so close to 0 that 0 works well!\r\nfunction float32String(v) {\r\n  return Math.abs(v) > 1e-37 ? v : 0\r\n}\r\n\r\n// Create matrix array for looping\r\nvar abcdef = 'abcdef'.split('')\r\n\n// Add CustomEvent to IE9 and IE10\r\nif (typeof window.CustomEvent !== 'function') {\r\n  // Code from: https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent\r\n  var CustomEventPoly = function(event, options) {\r\n    options = options || { bubbles: false, cancelable: false, detail: undefined }\r\n    var e = document.createEvent('CustomEvent')\r\n    e.initCustomEvent(event, options.bubbles, options.cancelable, options.detail)\r\n    return e\r\n  }\r\n\r\n  CustomEventPoly.prototype = window.Event.prototype\r\n\r\n  SVG.CustomEvent = CustomEventPoly\r\n} else {\r\n  SVG.CustomEvent = window.CustomEvent\r\n}\r\n\r\n// requestAnimationFrame / cancelAnimationFrame Polyfill with fallback based on Paul Irish\r\n(function(w) {\r\n  var lastTime = 0\r\n  var vendors = ['moz', 'webkit']\r\n\r\n  for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n    w.requestAnimationFrame = w[vendors[x] + 'RequestAnimationFrame']\r\n    w.cancelAnimationFrame  = w[vendors[x] + 'CancelAnimationFrame'] ||\r\n                              w[vendors[x] + 'CancelRequestAnimationFrame']\r\n  }\r\n\r\n  w.requestAnimationFrame = w.requestAnimationFrame ||\r\n    function(callback) {\r\n      var currTime = new Date().getTime()\r\n      var timeToCall = Math.max(0, 16 - (currTime - lastTime))\r\n\r\n      var id = w.setTimeout(function() {\r\n        callback(currTime + timeToCall)\r\n      }, timeToCall)\r\n\r\n      lastTime = currTime + timeToCall\r\n      return id\r\n    }\r\n\r\n  w.cancelAnimationFrame = w.cancelAnimationFrame || w.clearTimeout;\r\n\r\n}(window))\r\n\r\nreturn SVG\r\n\r\n}));\r","'use strict';\n\nexport class Point {\n  constructor(readonly x: number, readonly y: number) {}\n\n  // Returns the number of degrees to the given point.\n  public degreesTo(other: Point) {\n    const radians = Math.atan2(other.y - this.y, other.x - this.x);\n    return radians * 180 / Math.PI;\n  }\n}\n\nexport interface DragState {\n  // Note: all points are in SVG's global coordinate system.\n  mouse: {start: Point; current: Point;};\n  target: {\n    // start and current are for the center of element.\n    start: Point; current: Point; element: SVGGraphicsElement;\n  };\n}\n\nexport interface DragParams {\n  element: SVGGraphicsElement;\n  onStart?: (state: DragState) => void;\n  onMove?: (state: DragState) => void;\n  onFinish?: (state: DragState) => void;\n}\n\nexport function draggable(params: DragParams) {\n  let state: DragState|null = null;  // null if not currently dragging\n  const svg: SVGSVGElement =\n      params.element.ownerSVGElement || params.element as SVGSVGElement;\n\n  // Returns the center point of the element in the element's coordinate system.\n  const computeCenter = (element: SVGGraphicsElement) => {\n    const rect = element.getBoundingClientRect();\n    const cx = rect.left + rect.width / 2 + window.scrollX;\n    const cy = rect.top + rect.height / 2 + window.scrollY;\n    return new Point(cx, cy);\n  };\n\n  // Returns the point translated to param.element's coordinate system.\n  const translatePoint = (event: MouseEvent) => {\n    const point = svg.createSVGPoint();\n    point.x = event.clientX;\n    point.y = event.clientY;\n    const p = point.matrixTransform(svg.getScreenCTM()!.inverse());\n    return new Point(p.x, p.y);\n  };\n\n  const mouseDownHandler = (event: MouseEvent) => {\n    const center = computeCenter(params.element);\n    const mouse = translatePoint(event);\n    state = {\n      mouse: {\n        start: mouse,\n        current: mouse,\n      },\n      target: {\n        start: center,\n        current: center,\n        element: params.element,\n      },\n    };\n    if (params.onStart) {\n      params.onStart(state);\n    }\n    window.addEventListener('mousemove', mouseMoveHandler, false);\n  };\n\n  const mouseMoveHandler = (event: MouseEvent) => {\n    if (state === null) {\n      // Should we error out or do any cleanup?\n      return;\n    }\n    state.target.current = computeCenter(params.element);\n    state.mouse.current = translatePoint(event);\n    if (params.onMove) {\n      params.onMove(state);\n    }\n  };\n\n  const mouseUpHandler = (event: MouseEvent) => {\n    if (state === null) {\n      // Should we error out or do any cleanup?\n      return;\n    }\n    window.removeEventListener('mousemove', mouseMoveHandler, false);\n    state.target.current = computeCenter(params.element);\n    state.mouse.current = translatePoint(event);\n    if (params.onFinish) {\n      params.onFinish(state);\n    }\n    state = null;\n  };\n\n  window.addEventListener('mouseup', mouseUpHandler, false);\n  params.element.addEventListener('mousedown', mouseDownHandler, false);\n}\n","// Helper library for drawing SVG.\n\n'use strict';\n\ninterface XY {\n  x: number;\n  y: number;\n}\n\ninterface ArcOptionsRxRy {\n  rx: number;\n  ry: number;\n  rotation?: number;\n  largeArc?: boolean;\n  sweep?: boolean;\n}\n\ninterface ArcOptionsR {\n  r: number;\n  largeArc?: boolean;\n  sweep?: boolean;\n}\n\ntype ArcOptions = ArcOptionsRxRy|ArcOptionsR;\n\nfunction isArcOptionsR(o: ArcOptions): o is ArcOptionsR {\n  return 'r' in o;\n}\n\nexport function fromPolar({r, deg}: {r: number, deg: number}): XY {\n  const radians = deg * Math.PI / 180;\n  return {x: r * Math.cos(radians), y: r * Math.sin(radians)};\n}\n\nexport function addPoints(a: XY, b: XY) {\n  return {x: a.x + b.x, y: a.y + b.y};\n}\n\n// Used to construct an SVG <path>'s `d` attribute.\n// TODO: break lines so as not to exceed 255 chars\n// TODO: round numbers to proper number of significant digits\nexport class SvgPathBuilder {\n  private elements: string[];\n\n  constructor() { this.elements = []; }\n\n  public build(): string { return this.elements.join(' '); }\n\n  public close() { return this.Z(); }\n  public moveTo(p: XY) { return this.M(p.x, p.y); }\n  public lineTo(p: XY) { return this.L(p.x, p.y); }\n  public quadraticCurveTo(c: XY, p: XY) { return this.Q(c.x, c.y, p.x, p.y); }\n  public cubicCurveTo(c1: XY, c2: XY, p: XY) {\n    return this.C(c1.x, c1.y, c2.x, c2.y, p.x, p.y);\n  }\n  public arcTo(o: ArcOptions, p: XY) {\n    if (isArcOptionsR(o)) {\n      return this.A(o.r, o.r, 0, o.largeArc || false, o.sweep || false, p.x,\n                    p.y);\n    } else {\n      return this.A(o.rx, o.ry, o.rotation || 0, o.largeArc || false,\n                    o.sweep || false, p.x, p.y);\n    }\n  }\n\n  public M(x: number, y: number) { return this.push(`M${x},${y}`); }\n  public m(dx: number, dy: number) { return this.push(`m${dx},${dy}`); }\n  public Z() { return this.push('Z'); }\n  public z() { return this.push('z'); }\n  public L(x: number, y: number) { return this.push(`L${x},${y}`); }\n  public l(dx: number, dy: number) { return this.push(`l${dx},${dy}`); }\n  public H(x: number) { return this.push(`H${x}`); }\n  public h(dx: number) { return this.push(`h${dx}`); }\n  public V(y: number) { return this.push(`V${y}`); }\n  public v(dy: number) { return this.push(`v${dy}`); }\n  public C(c1x: number, c1y: number, c2x: number, c2y: number, x: number,\n           y: number) {\n    return this.push(`C${c1x},${c1y},${c2x},${c2y},${x},${y}`);\n  }\n  public c(c1dx: number, c1dy: number, c2dx: number, c2dy: number, dx: number,\n           dy: number) {\n    return this.push(`c${c1dx},${c1dy},${c2dx},${c2dy},${dx},${dy}`);\n  }\n  public S(c2x: number, c2y: number, x: number, y: number) {\n    return this.push(`S${c2x},${c2y},${x},${y}`);\n  }\n  public s(c2dx: number, c2dy: number, dx: number, dy: number) {\n    return this.push(`s${c2dx},${c2dy},${dx},${dy}`);\n  }\n  public Q(cx: number, cy: number, x: number, y: number) {\n    return this.push(`Q${cx},${cy},${x},${y}`);\n  }\n  public q(cdx: number, cdy: number, dx: number, dy: number) {\n    return this.push(`q${cdx},${cdy},${dx},${dy}`);\n  }\n  public T(x: number, y: number) { return this.push(`T${x},${y}`); }\n  public t(dx: number, dy: number) { return this.push(`t${dx},${dy}`); }\n  public A(rx: number, ry: number, xAxisRotate: number,\n           largeArc: number|boolean, sweep: number|boolean, x: number,\n           y: number) {\n    const lAF = largeArc ? 1 : 0;\n    const sF = sweep ? 1 : 0;\n    return this.push(`A${rx},${ry},${xAxisRotate},${lAF},${sF},${x},${y}`);\n  }\n  public a(rdx: number, rdy: number, xAxisRotate: number,\n           largeArc: number|boolean, sweep: number|boolean, dx: number,\n           dy: number) {\n    const lAF = largeArc ? 1 : 0;\n    const sF = sweep ? 1 : 0;\n    return this.push(`a${rdx},${rdy},${xAxisRotate},${lAF},${sF},${dx},${dy}`);\n  }\n\n  private push(s: string) {\n    this.elements.push(s);\n    return this;\n  }\n}\n\n// Returns an SVG path 'd' attribute for a donut.\nexport function donut(outer_radius: number, width: number): string {\n  const inner_radius = outer_radius - width;\n  return new SvgPathBuilder()\n      .moveTo({x: 0, y: outer_radius})\n      .arcTo({r: outer_radius, largeArc: true, sweep: false},\n             {x: 0, y: -outer_radius})\n      .arcTo({r: outer_radius, largeArc: true, sweep: false},\n             {x: 0, y: outer_radius})\n      .close()\n      .moveTo({x: 0, y: inner_radius})\n      .arcTo({r: inner_radius, largeArc: true, sweep: true},\n             {x: 0, y: -inner_radius})\n      .arcTo({r: inner_radius, largeArc: true, sweep: true},\n             {x: 0, y: inner_radius})\n      .close()\n      .build();\n}\n"],"sourceRoot":""}